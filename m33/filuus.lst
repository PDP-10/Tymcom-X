FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 1
S.MAC	 6-JUL-89 16:37		S.MAC - with system parameter file for P035/E, March 1989

     1				SUBTTL	S.MAC - with system parameter file for P035/E, March 1989
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
     7					.CREF
     8									TAPE>>
     9				; This file is PRINTF.MAC
    10				DEFINE PRINTF(A,B,C,D),<IF2,<;;Output message on MONKS build only
    11				PRINTX A B C D>>
    12
    13				TITLE	FILUUO	DISK SERVICE ROUTINE
    14
    15					STOPCD(,ENTRY,FILUUO)^
    16					ENTRY	FILUUO		;For library searches
    17	000000'	260040	000000*	FILUUO::PUSHJ	P,DIE		;**** Default stopcode for "FILUUO" ****
    18	000001'	465154	656557		SIXBIT	/FILUUO/  	;Title of module
    19	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "FILUUO+nnn(nnnnnn)"
    20			000000'	S$NAME==FILUUO			;For STOPCDs with no arguments
    21					SALL>
    22				^
    23
    24				;DEFINITIONS IN M
    25
    26			400000	UUOLUK==400000	;UUO IS A LOOKUP
    27			200000	EXTUUO==200000	;EXTENDED UUO
    28			100000	UUOMLK==100000	;MULTIPLE EXTENSION LOOKUP
    29			040000	UUOENT==040000	;UUO IS AN ENTER
    30			020000	UUOUFD==020000	;FILE UUO DEALS WITH IS A UFD
    31			010000	UUOREN==010000	;UUO IS A RENAME
    32			004000	UUOSIM==004000	;SET IN UPDATE IF ITS SIMULTANEOUS STYLE
    33			002000	UUOIRE==002000	;SET SO THAT FILFND STILL LEAVES ATB COUNT UP IF RIB ERROR,
    34						; WITH INFO FROM UFD IN THE ATB.
    35			777777	UUOMSK==777777	;CLEAR ALL BITS INCLUDING INDEX AND INDIR
    36
    37				;BITS IN UUXNUM.
    38			200000	UUPWDS==200000	;ENTER/RENAME--ALLOCATION WORD IS IN UNITS
    39						;OF WORDS, NOT BLOCKS.
    40			100000	UUPPID==100000	;LOOKUP/ENTER/RENAME - PID ACCESS BIT
    41
    42				INTERNAL UUOLUK,EXTUUO,UUOMLK,UUOENT,UUOUFD,UUOREN,UUOIRE
    43				INTERNAL DSKRES,DSKKJB,JOBSTR,DSKDSP
    44				INTERNAL PRTWDW,PRTWDR
    45				INTERNAL UUPPID
    46
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 2
FILUUO.MAC	19-SEP-89 19:52		S.MAC - with system parameter file for P035/E, March 1989

    47				;EXTERNALS FROM OTHER PARTS OF THE MONITOR
    48
    49				EXTERNAL GETWDS,GIVWDS,TPOPJ,CPOPJ,CPOPJ1,TPOPJ1,PJOBN,WATPCB
    50				EXTERNAL KMAPP,KFDEL,KFCRE,KFEXC,IOSERR,IOSRBE,IOSRIB,IOSUPR,KSMAPP
    51				EXTERN KVLRIB,KFFIFP,KFTRN,KMOVPG
    52				EXTERNAL JBTPRV,JBTPPN,JBTUNM,JBTUN1,JBTAUN,JBTSER
    53				EXTERN NORED,NOWRT,PIDACC
    54				EXTERNAL JBTDLK,JBTSLK,JBTERN,JBTLIC,JBYWPT,UPTPJC
    55				EXTERNAL UPTPID,UPTSPD
    56				EXTERNAL TIME,JFYSEC,THSDAT,WAIT1,HIGHJB,JOB,UPTJDA,CLOSE1
    57				EXTERNAL UPTRIB,UPTRB2,UPTSAT,QUEPCB,JBTABT,JBTSTS,CPOPJ2
    58				EXTERNAL SYDNM4,STOIOS,SAVE4,GET4WD,GIV4WD,PWAIT1,CURUPT,EPT,ONCTIM
    59			000371	  %COW.N==:371	;Hack for new MACRO/LINK
    60				EXT(<%UPT,%COW,%COW.N>)
    61				EXTERNAL UPTPDL,DATCOM
    62				EXTERNAL PDNMUP
    63
    64				;EXTERNAL IN OTHER PARTS OF FILSER
    65
    66				EXTERNAL SRCFIL,CHKPRV,FREATB,GETCBR,INVDDB,RIBRDL,RIBWTL,ZERDDB
    67				EXTERNAL RELLOK,SRCNAM,DLTTRC,FNDDRB,GIVCBR
    68				EXTERN GIVCB1,%RIB.C,MAPWLN,DLTNAM,USETI0,USETO0,DLTALL,%CTUPT
    69				EXTERNAL DIRSRC,TSTWRT,LKDATB,ULKDBL,TSTWRS
    70				EXTERNAL LOKPPB,NLKPPB,DEVLG,GUFBT,GIVCB1,RMVATB
    71				EXTERNAL MAPWTL,%RB2.C,MAPRLS,MAPXCH,GETER1,RIBDIR,MAPRDU
    72				EXTERNAL DIRBLK,PTROUT,CRBRWL,INSNAM,RRSETB,FPCSET
    73				EXTERNAL PCBCLR,PTROU2,GIVPAG,UUOSEK
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 3
FILUUO.MAC	19-SEP-89 19:52		S.MAC - with system parameter file for P035/E, March 1989

    74				;EXTERNAL IN COMMOD
    75
    76				EXTERNAL MFDPPN,SYSPPN,SYSDRB,UFDPRT,STNPRT,DSKDDB
    77				EXTERNAL CBUSER,INDPPN,SYSCOR,SYSUNI,ETSUNI,METSLN,ETSTAB
    78				EXTERNAL STRDDB,STRNAM,STRTAL,STROVR,STRNXT,STRUNI,STRSID,STRLEN
    79
    80				EXTERNAL UNILOG,UNINAM,UNISYS,UNIKON,UNIDES,UNITAL,UNICHR
    81				EXTERNAL UNIFEP,UNIPPU,UNIHID,UNISTR
    82				EXTERNAL UNYSIZ,UNYSPU,UNYWPS
    83
    84				EXTERNAL DEVATB,DEVDRB,DEVDBL,DEVELB,DEYTCT,DEYSTC
    85				EXTERNAL DEVRB1,DDBCOR,DDBLEN,DEVRIB,DEVRET,DEVFLO,DEVPOS
    86				EXTERNAL PTRCHG
    87
    88				EXTERNAL ATBFNB,ATBCNT,ATBSIZ,ATBPVW,ATBMSC,ATBLIC,ATBALP,ATBSTS
    89				EXTERNAL ATBRIB,ATBPRV,ATBLCW,ATBDOR,ATBLNK,ATBMWC,ATBUMC
    90				EXTERNAL ATBPID
    91				EXTERNAL ATPMXU,ATPDIR,ATPCRE,ATPNDL,ATPDEL,ATPUPD,ATPDMP,ATMCNT,ATPCNT
    92				EXTERNAL ATPSUP,ATPREN,ATPUFE,ATPPID,ATPALC,ATMCSC,ATMUFP,ATMUFU,ATMMWC,ATMUMC
    93				EXTERNAL ATYBSZ,ATYBLK,ATYXCD,ATYCTM,ATYCSC,ATYCTD,ATYCDT
    94				EXTERNAL ATYCNT,ATYPRV,ATYADT,ATYUF1,ATYUF2
    95
    96				EXTERNAL FNBEXT,FNBAPD,FNBNX,FNBRIB,FNBNAM,FNBDRB,FNBLNK,FNBUPD,FNBALT
    97				EXTERNAL FNPNX,FNBATB,FNBDBL,FNYUFP
    98
    99				EXTERNAL FNCLOK,FNCRED,FNCEXC,FNCCRE,FNCSUP,FNCAPP
   100				EXTERNAL FNCUPD,FNCTRN,FNCCAT,FNCDEL,FNCCNM,FNCCPR
   101
   102				EXTERNAL DRBCNT,DRBRIB,DRBALC,DRBMXA,DRBLNK,DRBUNM,DRBUN1,DRBNAM
   103				EXTERNAL DRBNX,DRBFNB,DRYPRV,DRYCNT
   104				EXTERNAL DRPMXC,DRPNX,DRMCNT,DRPLOG,DRBLOG
   105
   106				EXTERNAL RIBVER,RIBFUT,RIBPPN,RIBEST,RIBEXT,RIBPVW,RIBNAM,RIBPOS
   107				EXTERNAL RIBFT1,RIBLCW,RIBMTA,RIBDEV,RIBSTS,RIBELB,RIBXT1,RIBQTF
   108				EXTERNAL RIBQTO,RIBAUT,RIBUNM,RIBUN1,RIBTRU,RIBXT2,RIBSNM,RIBALC
   109				EXTERNAL RIBUSD,RIBMXA,RIBPID,RIBCOD,CODRIB,RIBSLF,RIBSZS,RBMASK
   110				EXTERNAL RIBALT
   111				EXTERNAL RIPDIR,RIPHRE,RIPHWE,RIPLOG,RIBPFS,RIPNFS,RIPUFE,RIPPID
   112				EXTERNAL RBYPN1,PTSPNO,PTNPNO,RBYUN1,RIBRIB,RIBSIZ,RIBALP,RIPBDR
   113				EXTERNAL RIBPJC,RIBPJ1,RIBPJ2	;-
   114				EXTERNAL RIPBDA,RIPBFS,RIBLST,RBDLTA,RBINDX,RIPSPP,RIPBDR
   115
   116				EXTERNAL STRHSH
   117
   118				EXTERNAL STRBTS,SRPNDS
   119
   120				EXTERNAL CMBLNK
   121
   122				EXTERNAL KONLTM
   123
   124				EXTERNAL UFPERR,UFDERR,UFDALP,UFDCDT,UFDEXT,UFDLIC,UFDNAM,UFDRIB
   125				EXTERNAL UFYCTM,UFYPRV,UFYUF1,UFYUF2,UFYXCD,RBREAL,UFDSIZ
   126				EXTERNAL UFYCDT,UFDLNK
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 3-2
FILUUO.MAC	19-SEP-89 19:52		S.MAC - with system parameter file for P035/E, March 1989

   127
   128				;EXTERNS FROM SIMIO MODULE
   129				EXTERN USETI0,USETO0,INBLT,OUTBLT,SIMRLS
   130				EXTERN UPTPOS
   131				EXTERN PCDTIM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 4
FILUUO.MAC	19-SEP-89 19:52		S.MAC - with system parameter file for P035/E, March 1989

   132				COMMENT ! **************************************************
   133
   134						DISK  DISPATCH  TABLE   DSKDSP
   135
   136						( DEVSER(F) POINTS HERE )
   137				***********************************************************!
   138
   139	777776				PHASE -2
   140	000003'	254000	000000*	DDO:	JRST	OUTBLT		;DUMP OUTPUT
   141	000004'	254000	000000*	DDI:	JRST	INBLT		;DMP INPUT.  SEE SIMIO
   142	000005'				DEPHASE
   143	000005'			DSKDSP:
   144	000000				PHASE 0
   145	000005'	000000	000037	DDXZ:	DSPSIZ
   146	000006'	263040	000000	DDINT:	POPJ	P,
   147	000007'	004400	004400	DBYT:	4400,,4400
   148	000010'	201300	000000*	DVSIZ:	MOVEI	T1,DDBLEN
   149	000011'	263040	000000	DINI:	POPJ	P,
   150	000012'	254000	000000*	DHNG:	JRST	CPOPJ1
   151	000013'	254000	001776'	DRL:	JRST	DSKREL		;CALLS CLOS IN/OUT WHICH CALL SIMRLS
   152	000014'	254000	001216'	DCL:	JRST	CLOSOU
   153	000015'	256000	000000'	DOU:	STOPCD			;BUFF OUTPUT. SIMBOU USES DDO EXCLUSIVELY
   154	000016'	256000	000000'	DIN:	STOPCD			;BUFF INPUT, SIMBIN USES DDI EXCLUSIVELY
   155	000017'	263040	000000	DZAP:	POPJ	P,		;FORGET ZAP
   156	000020'	263040	000000	DGTRD:	POPJ	P,		;FORGET GET READY
   157	000021'	263040	000000	DMT:	POPJ	P,
   158	000022'	254000	000155'	DGF:	JRST	DSKUGF
   159	000023'	254000	002274'	DEN:	JRST	UENTR
   160	000024'	254000	002031'	DLK:	JRST	ULOOK
   161	000025'	254000	003526'	DRN:	JRST	RENAM
   162	000026'	254000	000000*	DSI:	JRST	USETI0
   163	000027'	254000	000000*	DSO:	JRST	USETO0
   164	000030'	254000	001007'	DCLI:	JRST	CLOSIN
   165	000031'	254000	000271'	DUFD:	JRST	UFDUUO
   166	000032'	254000	000000*	DSEK:	JRST	UUOSEK
   167	000033'	254000	000000*	DVMAP:	JRST	KMAPP
   168	000034'	254000	000000*	DFDEL:	JRST	KFDEL
   169	000035'	254000	000000*	DFCRE:	JRST	KFCRE
   170	000036'	254000	000000*	DFEXC:	JRST	KFEXC
   171	000037'	254000	002556'	DSIM:	JRST	USIMUP		;SIMULTANEOUS UPDATE CHANIO
   172	000040'	254000	000000*	DFVLR:	JRST	KVLRIB
   173	000041'	254000	000000*	DVSMAP:	JRST	KSMAPP
   174	000042'	254000	000000*	DFFIF:	JRST	KFFIFP
   175	000043'	254000	000000*	DFTRN:	JRST	KFTRN
   176	000044'	254000	000000*	DMOVPG:	JRST	KMOVPG		;MAKE VP MAPPABLE FROM FILE
   177			000037		DSPSIZ==.-1
   178	000045'				DEPHASE
   179
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 5
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   180				SUBTTL	INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR
   181
   182				INTERN	TSTDSK,SETDDB,CLRDDB
   183
   184				;SUBROUTINE TO SAVE AND RESTORE TEMP ACS
   185				;CALLED BY PUSHJ P,SAVT   RETURN EITHER CPOPJ OR CPOPJ1 WHEN THROUGH
   186				INTERN SAVT
   187	000045'	250441	000000	SAVT:	EXCH	T4,(P)		;SAVE T4, GET RETURN ADR.
   188	000046'	261040	000010		PUSH	P,T3		;SAVE T3
   189	000047'	261040	000007		PUSH	P,T2		;AND T2
   190	000050'	260051	000000		PUSHJ	P,(T4)		;RETURN TO CALLER
   191	000051'	334000	000000		  SKIPA			;POPJ RETURN
   192	000052'	350001	777775		AOS	-3(P)		;CPOPJ1 - SET SKIP RETURN
   193	000053'	262040	000007		POP	P,T2		;RESTORE T3 ACS
   194	000054'	262040	000010		POP	P,T3
   195	000055'	262040	000011		POP	P,T4
   196	000056'	263040	000000		POPJ	P,		;AND RETURN
   197
   198				;SUBROUTINE TO TEST IF THE DEVICE WHOSE NAME IS IN T1 IS A DISK
   199				;ENTER WITH J (=J)= JOB NUMBER
   200				;EXIT CPOPJ IF A DISK, WITH F=PROTOTYPE DDB
   201				;EXIT CPOPJ1 IF NOT A DISK, OR A SINGLE-ACCESS DISK NOT FOR THIS JOB
   202				;CALLED BY DEVPHY
   203	000057'	322300	000012*	TSTDSK:	JUMPE	T1,CPOPJ1	;"0" IS NOT A DISK
   204	000060'	260040	000045'		PUSHJ	P,SAVT		;SAVE T2-T4
   205	000061'	201200	000000*		MOVEI	F,DSKDDB	;SET F FOR PROTOTYPE DDB
   206	000062'	260040	005674'		PUSHJ	P,ALIASD	;IS NAME AN ALIAS FOR "DSK"?
   207	000063'	263040	000000		  POPJ	P,		;YES. NON-SKIP RETURN
   208	000064'	316300	006033'		CAMN T1,[SIXBIT /DSKB/]	;CHECK FOR STR NAME
   209	000065'	263040	000000		  POPJ	P,
   210	000066'	260040	005766'		PUSHJ	P,SRUNI		;IS USER SUPPLYING A UNIT NAME?
   211	000067'	254000	000057*		  JRST	CPOPJ1		;NOT A DISK - SKIP RETURN
   212	000070'	255000	000000		  JFCL			;PHYSICAL DSK NAME (Logical unit return)
   213	000071'	550405	000000*		HRRZ	T3,UNISTR(U)	;YES, SET T3 TO STR DB LOC
   214	000072'	326400	000000*		JUMPN	T3,CPOPJ	;JOB MUST BE PRIVILEGED IF UNIT NOT IN AN STR
   215	000073'	205400	004000		MOVSI	T3,LICSTR
   216	000074'	616402	000000*		TDNN	T3,JBTLIC(J)	;SPECIAL FOR LICENSED JOB
   217	000075'	350001	000000		  AOS	(P)		;NO, ERROR RETURN
   218	000076'	263040	000000		POPJ	P,		;YES, OK RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 6
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   219				;SUBROUTINE TO CLEAN UP THE ACCESS TABLES FOR A JOB AFTER A SWAP-READ ERROR
   220				;SCANS THE DDB'S, WHEN IT FINDS ONE FOR THE JOB IT FIXES IT-
   221				; DECREMENTS THE READ-COUNT IF READING, CLEARS THE STATUS BYTE IF WRITING
   222				; AND INCREMENTS THE QUOTA IF CREATE OR SUPERSEDE
   223				;IT EXITS BY RETURNING ANY SYSTEM RESOURCES THE JOB MIGHT HAVE
   224	000077'	201200	000061*	SWPCLN:	MOVEI	F,DSKDDB	;START AT PROTOTYPE DDB
   225	000100'	265440	000000*		JSP T4,SAVE4	;SAVE SOME TEP ACS TO WORK IN (FOR CALLS)
   226	000101'	554204	000003	SWPCL1:	HLRZ	F,DEVSER(F)	;LINK TO NEXT DDB
   227	000102'	322200	000072*		JUMPE	F,CPOPJ		;DONE IF 0
   228	000103'	200304	000004		MOVE	T1,DEVMOD(F)
   229	000104'	607300	200000		TLNN	T1,DVDSK	;IS THIS DDB A DISK?
   230	000105'	263040	000000		POPJ P,			;NO, THROUGH
   231	000106'	135300	000000*		LDB	T1,PJOBN	;YES, SAME JOB?
   232	000107'	312300	000002		CAME	T1,J
   233	000110'	254000	000101'		JRST	SWPCL1		;NO, TRY NEXT DDB
   234	000111'	336644	000000*		SKIPN P2,DEVATB(F)
   235	000112'	254000	000101'		JRST SWPCL1
   236	000113'	554740	000015		HLRZ P4,P2	;DRB POINTER
   237	000114'	550715	000000*		HRRZ P3,ATBFNB(P2)
   238	000115'	553000	000015		HRRZS P2
   239	000116'	135300	000000*		LDB T1,DEYSTC	;WHAT WERE WE DOING
   240	000117'	201340	000000		MOVEI T2,0
   241	000120'	137340	000116*		DPB T2,DEYSTC
   242	000121'	256006	000122'		XCT .+1(T1)
   243	000000				PHASE 0
   244	000122'	254000	000101'		JRST SWPCL1
   245	000123'	254000	000141'	DECLUK:!JRST SWPLUK
   246	000124'	254000	000134'	DECUPD:!JRST SWPUPD
   247	000125'	254000	000152'	DECUP2:!JRST SWPUP2	;WAS UPDATING BUT INPUT CLOSED
   248	000126'	254000	000130'	DECENT:!JRST SWPENT	;FOR SUPERCEDE OR RENAME
   249	000127'	256000	000000'	DECSTP:! STOPCD (SLO)
   250					;IN THE MIDDLE OF A UUO
   251	000130'				DEPHASE
   252
   253	000130'	200315	000000*	SWPENT:	MOVE T1,ATBALP(P2)	;NUMBER OF PAGES ALLOCATED
   254	000131'	272317	000000*		ADDM T1,DRBALC(P4)	;RETURN TO HIS QUOTA
   255	000132'	260040	000000*		PUSHJ P,FREATB	;RETURN ATB TO FREE STORAGE
   256	000133'	254000	000144'		JRST SWPLK1	;AND RESET A FEW THINGS
   257
   258	000134'	201300	000000*	SWPUPD:	MOVEI T1,ATPUPD
   259	000135'	412315	000000*		ANDCAM T1,ATBSTS(P2)
   260	000136'	370317	000000*		SOS T1,DRBCNT(P4)
   261	000137'	602300	000000*		TRNE T1,DRPMXC
   262	000140'	256000	000000'		 STOPCD (SLO)
   263				           ;;SWPUPD+4
   264	000141'	370315	000000*	SWPLUK:	SOS T1,ATBCNT(P2)
   265	000142'	606300	000000*	SWPLK2:	TRNN T1,ATMCNT!ATPUPD!ATPREN
   266	000143'	260040	000000*		PUSHJ P,LKDATB	;MAKE DORMANT IF NOT IN USE
   267	000144'	370317	000136*	SWPLK1:	SOS T1,DRBCNT(P4)
   268	000145'	602300	000137*		TRNE T1,DRPMXC
   269	000146'	256000	000000'		 STOPCD (SLO)
   270				           ;;SWPLK1+2
   271	000147'	402004	000111*		SETZM DEVATB(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 6-2
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   272	000150'	260040	000000*		PUSHJ P,ULKDBL
   273	000151'	254000	000101'		JRST SWPCL1
   274
   275	000152'	205300	000134*	SWPUP2:	MOVSI T1,ATPUPD
   276	000153'	413315	000135*		ANDCAB T1,ATBSTS(P2)
   277	000154'	254000	000142'		JRST SWPLK2
   278
   279				INTERNAL SWPCLN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 7
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   280				;UGETF
   281
   282				COMMENT ! ROUTINE DSKUGF -- UGETF FOR DSK FILE.
   283				FUNCTION: RETURN TO USER LOC/ CURRENT POSITION,,FILE SIZE UNLESS
   284					EITHER VALUE EXCEEDS 18 BITS OR NO LOOKUP/ENTER DONE
   285					(IN WHICH CASES -1).
   286				EXPECTS: M/ USER DATA LOCN ADDR
   287					F/ DDB
   288					W/ CHANNEL
   289				!
   290	000155'	260040	000000*	DSKUGF:	PUSHJ P,WAIT1
   291	000156'	211300	000001		MOVNI T1,1		;READY FOR ERROR RETURN
   292	000157'	550344	000147*		HRRZ T2,DEVATB(F)
   293	000160'	322340	000170'		JUMPE T2,DSKUG1	;NO LOOKUP/ENTER, ERROR
   294	000161'	135300	000000*		LDB	T1,ATYBSZ
   295	000162'	603300	777777		TLNE	T1,-1
   296	000163'	254000	000172'		JRST	DSKUG2
   297	000164'	200344	000000*		MOVE	T2,DEVPOS(F)
   298	000165'	603340	377777		TLNE	T2,377777	;DONT TEST USETI/O FLAG 1B0
   299	000166'	254000	000172'		JRST	DSKUG2
   300	000167'	505307	000000		HRLI	T1,(T2)
   301	000170'	705313	000000	DSKUG1:	UMOVEM T1,(M)		;RETURN TO USER
   302	000171'	263040	000000		POPJ P,
   303	000172'	211300	000001	DSKUG2:	MOVNI	T1,1
   304	000173'	254000	000170'		JRST	DSKUG1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 8
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   305				; CALLED FROM COMMON IN CRASH CODE.
   306				;*;FILSTP::POPJ	P,	;DSKSTP:;GOOD PLACE TO WRITE SATS OUT
   307
   308				;HERE ON A LOGOUT, WHEN THERE ARE NO OTHER JOBS LOGGED IN UNDER THIS PPB
   309				;CALLED BY LOGOUT , WITH AC=PPN  (DSKLGO M)
   310	000174'	312300	000000*	DSKLGO:	CAME	T1,SYSPPN	;YES. IS JBTPPN FOR SYS?
   311	000175'	316300	000000*		CAMN	T1,MFDPPN	; OR AN MFD?
   312	000176'	263040	000000		  POPJ	P,		;YES, DONT DELETE  CORE BLOCKS
   313	000177'	260040	000000*		PUSHJ	P,GETCBR
   314	000200'	554340	000000*		HLRZ	T2,SYSDRB	;% NO. SET TO SEARCH DRB'S
   315	000201'	211400	000001		MOVNI	T3,1		;% DO NOT CREATE A NEW ONE
   316	000202'	260040	000000*		PUSHJ	P,SRCNAM	;% FIND PPB FOR THIS JOB
   317	000203'	322340	000000*		  JUMPE	T2,GIVCBR
   318	000204'	201300	000000*		MOVEI	T1,DRPLOG	;% FOUND - SET NLG
   319	000205'	412307	000000*		ANDCAM	T1,DRBLOG(T2)	;%  IN PPB BLOCK
   320	000206'	324740	000203*		PJRST	GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 9
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   321				INTERNAL DSKCLR
   322				EXTERNAL ADJMWS
   323
   324				;CODE TO CLEAR CORE INFO (CALLED BY DSKFIXER)
   325
   326	000207'	254000	000235'	DSKCTB:	JRST	DSKCL2			;0  CLEAR IN-CORE DISK INFO
   327	000210'	254000	000226'		JRST	DSKCL3			;1  SET STTFPC FOR ALL SATS
   328	000211'	254000	000222'		JRST	DSKCL4			;2  CLEAR SRPNDS ONLY
   329			000003	DCTBSZ==.-DSKCTB
   330
   331				PRINTF(<[DSKCLR This entire UUO needs work, maybe a STRUUO function]>)
   332	000212'	200302	000074*	DSKCLR:	MOVE	T1,JBTLIC(J)
   333	000213'	641300	000003		TLC	T1,LICWFL+LICWPJ
   334	000214'	643300	000003		TLCE	T1,LICWFL+LICWPJ	;DOES HE HAVE WRITE ABSOLUTE??
   335	000215'	254000	000067*		  JRST	CPOPJ1
   336	000216'	135300	006034'		LDB	T1,[POINT 4,M,^D12]	;GET AC FIELD.
   337	000217'	301300	000003		CAIL	TBSZ		;IS VALUE TOO LARGE?
   338	000220'	254000	000215*		  JRST	CPOPJ1			;YES
   339	000221'	256006	000207'		XCT	DSKCTB(T1)		;DISPATCH
   340
   341	000222'	201300	000000*	DSKCL4:	MOVEI	T1,SRPNDS		;CLEAR THE NEED DSKCLN FLAG
   342	000223'	412300	000000*		ANDCAM	T1,STRDDB+STRBTS	; FOR THIS STRUCTURE
   343	000224'	476000	000000*		SETOM	ADJMWS			;TURN MWS ADJUST
   344	000225'	263040	000000		POPJ	P,
   345	000226'	200301	000000*	DSKCL3:	MOVE	T1,PDNMUP(P)		;GET RETURN ADDR
   346	000227'	350001	000226*		AOS	PDNMUP(P)		;INC PAST ARG
   347	000230'	704306	000000		UMOVE	T1,(T1)			;GET AOBJN WORD ADDR
   348	000231'	260040	000000*		PUSHJ	P, FPCSET		;SET FREE PGS
   349	000232'	370001	000000		SOS	0(P)
   350	000233'	476000	000224*		SETOM	ADJMWS			;TURN ON MWS ADJUST
   351	000234'	254000	000220*		JRST	CPOPJ1
   352	000235'	260040	000000*	DSKCL2:	PUSHJ	P,PCBCLR		;ZAP ALL SAT AND RIB PCBS.
   353	000236'	263040	000000		  POPJ	P,			;PCB I/O IN PROGRESS
   354	000237'	254000	000234*		  JRST	CPOPJ1			;CAN NOT CLEAR PCBS
   355	000240'	350000	000000*		AOS	%UPT+UPTPDL		;FOR MULTIPLE SKIP RETURN TO USER
   356	000241'	260040	000177*		PUSHJ	P,GETCBR
   357	000242'	554740	000200*		HLRZ	P4,SYSDRB		;% ALL DRB BLOCKS
   358	000243'	322740	000000*		JUMPE	P4,GIVCB1		;% SKIP RETURN, ALL DONE
   359	000244'	135300	000000*	DSKCL1:	LDB	T1,DRYCNT		;% GET COUNT
   360	000245'	326300	000206*		JUMPN	T1,GIVCBR		;% DRB IN USE, ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 10
FILUUO.MAC	19-SEP-89 19:52		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   361	000246'	554717	000000*		HLRZ	P3,DRBFNB(P4)		;% NOW THE NAME BLOCK
   362	000247'	322700	000262'		JUMPE	P3,DSKCL7		;% ALL DONE, GIVE BACK DRB
   363	000250'	554656	000000*	DSKCL6:	HLRZ	P2,FNBATB(P3)		;% FOR FOR THE ACCESS TABLE
   364	000251'	322640	000254'		JUMPE	P2,DSKCL5		;% NONE THERE, GIVE BACK FNB
   365	000252'	260040	000000*		PUSHJ	P,RMVATB		;% GET RID OF ATB (DRBCNT=0 SO OK)
   366	000253'	254000	000250'		JRST	DSKCL6			;%
   367
   368	000254'	200300	000000*	DSKCL5:	MOVE	T1,SYSCOR
   369	000255'	250316	000000*		EXCH	T1,CMBLNK(P3)		;% THIS POINTS TO NEXT FNB (MAYBE)
   370	000256'	516700	000254*		HRLZM	P3,SYSCOR		;% NOW FNB RETURNED
   371	000257'	502317	000246*		HLLM	T1,DRBFNB(P4)		;% SO LINK FROM DRB OK
   372	000260'	554700	000006		HLRZ	P3,T1			;% NEXT LINK
   373	000261'	326700	000250'		JUMPN	P3,DSKCL6		;%
   374
   375	000262'	200300	000256*	DSKCL7:	MOVE	T1,SYSCOR		;% NOW GIVE BACK DRB
   376	000263'	250317	000255*		EXCH	T1,CMBLNK(P4)
   377	000264'	516740	000262*		HRLZM	P4,SYSCOR
   378	000265'	512300	000242*		HLLZM	T1,SYSDRB		;% RELINK START
   379	000266'	554740	000006		HLRZ	P4,T1			;%
   380	000267'	326740	000244'		JUMPN	P4,DSKCL1		;%
   381	000270'	254000	000243*		JRST	GIVCB1			;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 11
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   382				SUBTTL	.CHUFD - Read UFD uuo
   383				EXTERN USETST,UNLFIL,LOKUNM,RELRIB,IOBDRB
   384
   385	000271'	607200	040000	UFDUUO:	TLNN	F,LOOKB
   386	000272'	263040	000000		 POPJ	P,
   387	000273'	550644	000157*		HRRZ	P2,DEVATB(F)		;MUST HAVE A UFD LOOKED UP
   388	000274'	201300	000000*		MOVEI	T1,ATPDIR
   389	000275'	616315	000153*		TDNN	T1,ATBSTS(P2)
   390	000276'	263040	000000		 POPJ	P,
   391	000277'	260040	000000*		NOCHARGE
   392	000300'	704753	000001		UMOVE	P4,1(M)			;NAME
   393	000301'	256200	006035'		XCTBU	<HLLZ P2,2(M)>		;EXTENSION
   394	000302'	256200	006036'		XCTBU	<SETZM 7(M)>		;ZERO COUNT
   395	000303'	403700	000014		SETZB	P3,P1			;NO MASK YET
   396	000304'	256200	006037'		XCTBU	<SKIPGE 3(M)>		;CHECK TO SEE IF WANT * AND #
   397	000305'	254000	000313'		 JRST	UFDNMK			;NO
   398	000306'	250640	000017		EXCH	P2,P4
   399	000307'	260040	000565'		PUSHJ	P,UFDMSK		;CONVERT * AND # IN P2 TO MASK IN P1
   400	000310'	250640	000017		EXCH	P2,P4			;PUT NAME BACK IN P4
   401	000311'	200700	000014		MOVE	P3,P1			;GET MASK
   402	000312'	260040	000565'		PUSHJ	P,UFDMSK		;NOW DO EXTENSION, EXT MASK IN P1
   403	000313'	557000	000015	UFDNMK:	HLRZS	P2			;EXTENSION IN RH
   404	000314'	557000	000014		HLRZS	P1			;EXTENSION MASK IN RH
   405	000315'	504600	000013		HRL	P1,M			;P1/USER ADDR,,MASK
   406	000316'	256200	006040'		XCTBU	<SKIPN T1,4(M)>		;MONITOR WORD IS ZERO?
   407					 JRST	[			;SET UP INITIAL HASH LINK
   408						JUMPN P3,UFDNXM		;NOT ONE SPECIFIC NAME
   409						MOVE  T1,P4
   410						TLZ   T1,(1B0)
   411						HRRZ  T2,STRDDB+STRHSH
   412						IDIV  T1,T2
   413						MOVE  T1,T2
   414	000317'	254000	006041'			JRST  UFDNXM]
   415
   416				;; P4/NAME  P3/NMASK  P2/0,,EXT  P1/USERADDR,,MASK  T1/HASH LINK
   417	000320'	504640	000006	UFDNXM:	HRL	P2,T1			;P2/HASH LINK,,FILE EXT
   418	000321'	620300	400000		TRZ	T1,400000
   419	000322'	357540	000006		AOSG	M,T1			;M/PAGE IN UFD
   420	000323'	263040	000000		 POPJ	P,			;PG 0 OR <0 BAD OR END
   421	000324'	260040	000000*		PUSHJ	P,LOKUNM		;LOCK(UNMODIFIABLE) F/UFD DDB
   422									;DESTROY NO ACS
   423	000325'	550344	000273*		HRRZ	T2,DEVATB(F)
   424	000326'	135300	000161*		LDB	T1,ATYBSZ		;SIZE OF UFD, IN BLOCKS
   425	000327'	271300	000003		ADDI	T1,3	
   426	000330'	242300	777776		LSH	T1,-2			;T1/SIZE UFD, IN PAGES
   427	000331'	315300	000013		CAMGE	T1,M			;SKIP IF PAGE IN M AT OR BEFORE EOF
   428					 JRST	[PUSHJ P,UNLFIL		;PAST EOF,UNLOCK
   429						 TDO   S,[IOEND,,IODEND]
   430	000332'	254000	006051'			 PJRST STOIOS]		;SET IN DEVIOS & NOSKIP RTN
   431	000333'	260040	000000*		PUSHJ	P,USETST		;GET @DEVRET(F) SETUP FOR
   432									;M/PAGE. CLOB T1-T4,U,PG. SKIP SUCCESS
   433					 JRST	[TRO   S,IODTER
   434	000334'	254000	006054'			 PJRST STOIOS]		;NOSKIP RTN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 11-2
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   435	000335'	260040	000000*		PUSHJ	P,UNLFIL		;UNLOCK,DESTROY NO ACS
   436	000336'	260040	000000*		PUSHJ	P,RELRIB		;RELEASE RIB IN %RIB, CLOB T1-T4,PG
   437	000337'	602000	760000		TRNE	S,760000		;ANY ERRORS?
   438	000340'	263040	000000		 POPJ	P,			;
   439	000341'	554540	000014		HLRZ	M,P1			;M/USER CONTROL BLOCK ADDR AGAIN
   440	000342'	200324	000000*		MOVE	T1,@DEVRET(F)
   441	000343'	607300	000000*		TLNN	T1,RBREAL
   442	000344'	254000	000524'		 JRST	UFDSPR			;HOLE.
   443	000345'	201140	000000*		MOVEI	PG,%RIB.C
   444	000346'	260040	000000*		PUSHJ	P,MAPRDU		;READ IT
   445	000347'	135100	000106*		LDB	J,PJOBN
   446	000350'	201340	000551'		MOVEI	T2,UFDRLK
   447	000351'	202342	000000*		MOVEM	T2,JBTABT(J)
   448	000352'	260040	000000*		PUSHJ	P,GTCGSZ		;GET T1/ CHARGING SIZE.
   449	000353'	272300	000000*		ADDM	T1,JBTSIN
   450	000354'	272302	000353*		ADDM	T1,JBTSIN(J)
   451	000355'	350000	000000*		AOS	JBTRCT
   452	000356'	350002	000355*		AOS	JBTRCT(J)
   453	000357'	205340	000000*		MOVSI	T2,-<1000/UFDSIZ>	;NUMBER OF ENTRIES TO SEARCH
   454	000360'	325640	000375'		JUMPGE	P2,UFDSFD		;DO NOT SEARCH FOR NAME, NEW BLK
   455	000361'	704413	000005		UMOVE	T3,5(M)			;NAME TO SEARCH FOR
   456	000362'	256200	006056'		XCTBU	<HLRZ T4,6(M)>
   457	000363'	312407	376000*	UFDSLP:	CAME	T3,%RIB+UFDNAM(T2)
   458	000364'	254000	000370'		 JRST	UFDNSL			;NOT THIS ONE, CONTINUE
   459	000365'	554307	376000*		HLRZ	T1,%RIB+UFDEXT(T2)
   460	000366'	316300	000011		CAMN	T1,T4
   461	000367'	254000	000373'		 JRST	UFDSF0			;FOUND IT
   462	000370'	271340	777777*	UFDNSL:	ADDI	T2,UFDSIZ-1
   463	000371'	253340	000363'		AOBJN	T2,UFDSLP
   464	000372'	254000	000551'		JRST	UFDRLK			;GIVE UP AND ERROR RETURN IF NOT FOUND
   465
   466	000373'	271340	777777*	UFDSF0:	ADDI	T2,UFDSIZ-1		;FOUND THE STARTING NAME
   467	000374'	252340	000554'		AOBJP	T2,FINUS0		;FINISHED
   468	000375'	261040	000017	UFDSFD:	PUSH	P,P4
   469	000376'	261040	000016		PUSH	P,P3
   470	000377'	704453	000000		UMOVE	T4,(M)			;GET AOBJN POINTER FOR RETURNING DATA
   471					JUMPGE	T4,[POP  P,P3		;ERROR IF NONE TO RETURN
   472						    POP  P,P4
   473	000400'	325440	006057'			    JRST UFDRLK]
   474
   475	000401'	336307	376000*	UFDLLP:	SKIPN	T1,%RIB+UFDNAM(T2)	;SEARCH FOR NAMES THAT MATCH MASK
   476	000402'	254000	000507'		 JRST	UFDLCN
   477	000403'	420301	000000		ANDCM	T1,(P)
   478	000404'	312301	777777		CAME	T1,-1(P)
   479	000405'	254000	000507'		 JRST	UFDLCN			;NAME DOES NOT MATCH
   480	000406'	554307	376000*		HLRZ	T1,%RIB+UFDEXT(T2)
   481	000407'	420300	000014		ANDCM	T1,P1
   482	000410'	302315	000000		CAIE	T1,(P2)
   483	000411'	254000	000507'		 JRST	UFDLCN			;EXT DOES NOT MATCH
   484	000412'	120707	376000*		DMOVE	P3,%RIB+UFDNAM(T2)
   485	000413'	252440	000530'		AOBJP	T4,FINSUP
   486	000414'	513000	000017		HLLZS	P4
   487	000415'	256200	006062'		XCTBU	<DMOVEM P3,-1(T4)>	;RETURN NAME AND EXT TO USER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 11-3
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   488	000416'	704413	000003		UMOVE	T3,3(M)
   489	000417'	607400	200000		TLNN	T3,(1B1)
   490	000420'	254000	000427'		 JRST	UFNBLK			;NO BLOCKS
   491	000421'	252440	000530'		AOBJP	T4,FINSUP
   492	000422'	554307	376000*		HLRZ	T1,%RIB+UFDALP(T2)
   493	000423'	602300	400000		TRNE	T1,400000
   494	000424'	665300	777777		TLOA	T1,-1
   495	000425'	242300	000002		 LSH	T1,2			;CONVERT TO BLOCKS, NEG IF UNKNOWN
   496	000426'	705311	000000		UMOVEM	T1,(T4)
   497	000427'	607400	100000	UFNBLK:	TLNN	T3,(1B2)
   498	000430'	254000	000434'		 JRST	UFNLIC			;NO LICENSE
   499	000431'	252440	000530'		AOBJP	T4,FINSUP
   500	000432'	550307	376000*		HRRZ	T1,%RIB+UFDLIC(T2)
   501	000433'	705311	000000		UMOVEM	T1,(T4)
   502	000434'	607400	040000	UFNLIC:	TLNN	T3,(1B3)
   503	000435'	254000	000473'		 JRST	UFNDAT			;NO DATE
   504	000436'	252440	000530'		AOBJP	T4,FINSUP
   505	000437'	135740	000000*		LDB	P4,UFYCDT
   506	000440'	135700	000000*		LDB	P3,UFYXCD
   507	000441'	137700	006063'		DPB	P3,[POINT 2,P4,23]
   508	000442'	135700	000000*		LDB	P3,UFYCTM
   509	000443'	607400	000200		TLNN	T3,200			;DOES HE WANT TIME AND DATE CONVERSION
   510	000444'	254000	000471'		 JRST	UFNNCV			;NO, HE WANTS TYMSHARE FORMAT
   511	000445'	220700	000000*		IMUL	P3,JFYSEC
   512	000446'	261040	000007		PUSH	P,T2
   513	000447'	120300	000016		DMOVE	T1,P3
   514	000450'	204740	000010		MOVS	P4,T3
   515	000451'	405740	000177		ANDI	P4,177
   516	000452'	622740	000100		TRZE	P4,100			;WANT IT IN DEC FORMAT?
   517	000453'	660740	400000		 TRO	P4,400000		;NO, TYMSHARE BUT DIFFERENT TIME ZONE
   518	000454'	505740	400020		HRLI	P4,400020		;FROM GMT
   519	000455'	261040	000010		PUSH	P,T3
   520	000456'	261040	000011		PUSH	P,T4
   521	000457'	260040	000000*		PUSHJ	P,DATCOM
   522	000460'	255000	000000		  JFCL
   523	000461'	250300	000007		EXCH	T1,T2
   524	000462'	230340	000445*		IDIV	T2,JFYSEC		;RECONVERT
   525	000463'	506340	000006		HRLM	T2,T1
   526	000464'	262040	000011		POP	P,T4
   527	000465'	262040	000010		POP	P,T3
   528	000466'	262040	000007		POP	P,T2
   529	000467'	256200	006064'		XCTBU	<MOVSM T1,(T4)>		;STORE CONVERTED
   530	000470'	254000	000473'		JRST	UFNDAT
   531
   532	000471'	506740	000016	UFNNCV:	HRLM	P4,P3
   533	000472'	705711	000000		UMOVEM	P3,(T4)			;STORE NONCONVERTED DATE
   534	000473'	607400	020000	UFNDAT:	TLNN	T3,(1B4)
   535	000474'	254000	000504'		 JRST	UFNSTS			;NO STATUS
   536	000475'	252440	000530'		AOBJP	T4,FINSUP
   537	000476'	135740	000000*		LDB	P4,UFYPRV
   538	000477'	135300	000000*		LDB	T1,UFYUF2
   539	000500'	137300	006065'		DPB	T1,[POINT 8,P4,26]
   540	000501'	135300	000000*		LDB	T1,UFYUF1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 11-4
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   541	000502'	137300	006066'		DPB	T1,[POINT 4,P4,18]
   542	000503'	705751	000000		UMOVEM	P4,(T4)
   543	000504'	504600	000007	UFNSTS:	HRL	P1,T2			;SAVE LOCATION
   544	000505'	256200	006067'		XCTBU	<AOS 7(M)>		;COUNT NUMBER OF FILES RETURNED
   545	000506'	252440	000530'		AOBJP	T4,FINSUP
   546	000507'	271340	777777*	UFDLCN:	ADDI	T2,UFDSIZ-1
   547	000510'	253340	000401'		AOBJN	T2,UFDLLP
   548	000511'	262040	000016		POP	P,P3
   549	000512'	262040	000017		POP	P,P4
   550	000513'	256200	006070'		XCTBU	<SKIPN 7(M)>		;ANY MATCHES AT ALL?
   551	000514'	254000	000554'		 JRST	FINUS0
   552					JUMPN	P3,[HLRZ T1,P2
   553	000515'	326700	006071'			    AOJA T1,FINNXB]
   554	000516'	336300	376000*		SKIPN	T1,%RIB+UFDLNK
   555	000517'	201300	377777		 MOVEI	T1,377777
   556	000520'	254000	000542'		JRST	FINNXB
   557
   558
   559	000521'	260040	000000*	UFDSP1:	PUSHJ	P,RELLOK
   560	000522'	135300	000347*		LDB	T1,PJOBN
   561	000523'	402006	000351*		SETZM	JBTABT(T1)
   562	000524'	322700	000546'	UFDSPR:	JUMPE	P3,UFDEOF		;SPECIFIC NAME, ONLY ONE HASH CODE
   563	000525'	554300	000015		HLRZ	T1,P2
   564	000526'	620300	400000		TRZ	T1,400000
   565	000527'	344300	000320'		AOJA	T1,UFDNXM
   566
   567	000530'	262040	000016	FINSUP:	POP	P,P3
   568	000531'	262040	000017		POP	P,P4
   569	000532'	256200	006070'		XCTBU	<SKIPN 7(M)>		;COUNT OF MATCHES
   570	000533'	254000	000551'		 JRST	UFDRLK			;ERROR IF NONE FOUND
   571	000534'	554440	000014		HLRZ	T4,P1
   572	000535'	120311	376000*		DMOVE	T1,%RIB+UFDNAM(T4)	;GET LAST NAME STORED
   573	000536'	513000	000007		HLLZS	T2
   574	000537'	256200	006073'		XCTBU	<DMOVEM T1,5(M)>	;STARTING NAME AND EXT FOR NEXT TIME
   575	000540'	554300	000015		HLRZ	T1,P2
   576	000541'	664300	400000		TROA	T1,400000		;SEARCH THIS AGAIN
   577	000542'	620300	400000	FINNXB:	 TRZ	T1,400000
   578	000543'	705313	000004		UMOVEM	T1,4(M)
   579	000544'	350001	000000		AOS	(P)			;SKIP RETURN
   580	000545'	254000	000551'		JRST	UFDRLK			;DONE
   581
   582	000546'	670000	006074'	UFDEOF:	TDO	S,[IOEND,IODEND]
   583	000547'	202004	000002		MOVEM	S,DEVIOS(F)
   584	000550'	263040	000000		POPJ	P,
   585
   586	000551'	135300	000522*	UFDRLK:	LDB	T1,PJOBN
   587	000552'	402006	000523*		SETZM	JBTABT(T1)
   588	000553'	324740	000521*		PJRST	RELLOK
   589
   590	000554'	336300	376000*	FINUS0:	SKIPN	T1,%RIB+UFDLNK
   591	000555'	254000	000521'		 JRST	UFDSP1			;NO LINK, EOF IF SPECIAL NAME, ELSE NEXT
   592	000556'	326700	000521'		JUMPN	P3,UFDSP1		;LINK AND NOT SPECIAL
   593	000557'	261040	000006		PUSH	P,T1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 11-5
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   594	000560'	260040	000553*		PUSHJ	P,RELLOK
   595	000561'	135300	000551*		LDB	T1,PJOBN
   596	000562'	402006	000552*		SETZM	JBTABT(T1)
   597	000563'	262040	000006		POP	P,T1
   598	000564'	254000	000320'		JRST	UFDNXM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 12
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   599				;CHECK P2 FOR * AND #, RETURN MASK IN P1
   600	000565'	316640	006075'	UFDMSK:	CAMN	P2,[SIXBIT /*/]
   601					 JRST	[MOVNI P1,1
   602						 MOVEI P2,0
   603	000566'	254000	006076'			 POPJ  P,]
   604	000567'	200340	000015		MOVE	T2,P2
   605	000570'	430340	006101'		XOR	T2,[SIXBIT /######/]
   606	000571'	201600	000000		MOVEI	P1,0
   607	000572'	205300	770000		MOVSI	T1,770000
   608	000573'	616340	000006	UFDMS0:	TDNN	T2,T1
   609	000574'	670600	000006		 TDO	P1,T1
   610	000575'	242300	777772		LSH	T1,-6
   611	000576'	326300	000573'		JUMPN	T1,UFDMS0
   612	000577'	420640	000014		ANDCM	P2,P1			;GET RID OF #'S
   613	000600'	263040	000000		POPJ	P,
   614
   615
   616				;UUO TO SET PID TO NEW VALUE
   617				; CALL:
   618				;	MOVE	AC,[PID]
   619				;	PIDSET	AC,
   620				;	  <ERROR RETURN>		;NOT AUTHORIZED TO SET PID
   621				;	<SUCCESS RETURN>
   622	000601'	322300	000620'	SETPID::JUMPE	T1,SETPIO		;ZERO ALWAYS OK
   623	000602'	135340	000000*		LDB	T2,JBYWPT		;IF WF, CAN SET PID TO ANYTHING.
   624	000603'	303340	000001		CAILE	T2,1			;SKIP IF WP OR LESS
   625	000604'	254000	000620'		  JRST	SETPIO			;OK TO SET ANY PID IF WF OR WA.
   626	000605'	204342	000000*		MOVS	T2,JBTAUN(J)		;GET UUN IN LH
   627	000606'	430340	000006		XOR	T2,T1			;LH = 0 IF ALL BITS MATCH
   628	000607'	607340	777777		TLNN	T2,-1			;SKIP IF MATCH ON AUN
   629	000610'	254000	000620'		  JRST	SETPIO			;OK, SAVE OLD PID AND SET NEW ONE
   630	000611'	316300	000000*		CAMN	T1,%UPT+UPTSPD		;SETTING BACK TO LAST VALUE?
   631	000612'	254000	000620'		  JRST	SETPIO			;YES, THAT'S OK
   632	000613'	316300	000000*		CAMN	T1,%UPT+UPTPID		;NOT CHANGING?
   633	000614'	350001	000000		  AOS	(P)			;NOT CHANGING, DON'T BOTHER WITH UPTSPD
   634	000615'	200300	000000*		MOVE	T1,%UPT+UPTPID		;GET CURRENT PID
   635	000616'	705313	000000		UMOVEM	T1,(M)			;RETURN "OLD" PID (SAME AS NEW)
   636	000617'	263040	000000		POPJ	P,			;NOT AUTHORIZED TO SET THIS PID
   637
   638	000620'	250300	000000*	SETPIO:	EXCH	T1,%UPT+UPTPID		;SET NEW PID, GET OLD ONE
   639	000621'	332000	000006		SKIPE	T1			;DON'T SET SAVED PID TO ZERO, SO IF
   640									; JOB HAS PID, SETS IT TO ZERO, SETS IT
   641									; TO ANOTHER PID, DOESN'T LOSE ABILITY
   642									; TO RESET TO ORIGINAL PID.
   643	000622'	202300	000000*		  MOVEM	T1,%UPT+UPTSPD		;REMEMBER WHAT LAST ONE WAS SO CAN RESTORE IT.
   644	000623'	705313	000000		UMOVEM	T1,(M)			;RETURN OLD PID VALUE
   645	000624'	254000	000237*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 13
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   646				;SUBROUTINE TO BUILD A DISK DEVICE DATA BLOCK
   647				;ENTER WITH T1=DEVICE NAME, F=LOC OF DDB (OR PROTOTYPE DDB)
   648				;CALLED BY ASSPRG
   649				;HERE FROM ONCE-ONLY CODE
   650				INTERN SETDDO
   651	000625'	261040	000077*	SETDDO:	PUSH	P,DSKDDB	;SAVE NAME
   652	000626'	254000	000644'		JRST	SETDD3		;GO CREATE THE DDB
   653
   654				;THIS IS THE NORMAL ENTRY POINT
   655	000627'	260040	000045'	SETDDB:	PUSHJ	P,SAVT		;SAVE T2-T4
   656	000630'	550400	000004		HRRZ	T3,F		;ADDR. OF THE DDB
   657	000631'	302400	000625*		CAIE	T3,DSKDDB	;IS IT THE PROTOTYPE?
   658	000632'	200304	000000		  MOVE	T1,DEVNAM(F)	;NO. GET THE PHYSICAL DEVICE NAME
   659	000633'	261040	000006		PUSH	P,T1		;SAVE NAME
   660	000634'	200304	000004		MOVE	T1,DEVMOD(F)
   661	000635'	602300	200000		TRNE	T1,ASSPRG	;DDB BEEN INITED?
   662	000636'	254000	000641'		  JRST	SETDD1		;YES. HAVE TO COPY PROTOTYPE
   663	000637'	302400	000631*		CAIE	T3,DSKDDB	;IS IT PROTOTYPE?
   664	000640'	254000	000654'		  JRST	SETDD2		;NO. USE IT
   665
   666				;HERE WHEN WE MUST MAKE A COPY OF THE PROTOTYPE DDB
   667	000641'	201340	000000*	SETDD1:	MOVEI	T2,DDBCOR	;NO OF 4-WORD BLOCKS NEEDED
   668	000642'	260040	000000*		PUSHJ	P,GET4WD	;GET THE CORE
   669	000643'	254000	000000*		  JRST	TPOPJ		;CANT GET IT - RETURN
   670	000644'	540200	000006	SETDD3:	HRR	F,T1		;LOC OF THE CORE
   671	000645'	505300	000637*		HRLI	T1,DSKDDB	;FROM THE PROTOTYPE
   672	000646'	251304	777777*		BLT	T1,DDBLEN-1(F)	;BLT THE NEEDED INFORMATION
   673	000647'	506200	000003*		HRLM	F,DSKDDB+DEVSER	;LINK PROTOTYPE TO THEIS DDB
   674								;(COPY ALREADY CONTAINS LINK TO NEXT)
   675	000650'	201300	600000		MOVEI	T1,ASSCON+ASSPRG	;MAKE SURE ASSIGN BITS ARE OFF
   676	000651'	412304	000004		ANDCAM	T1,DEVMOD(F)	;(1 WILL BE TURNED ON BY ASSPRG)
   677
   678	000652'	262044	000000	SETDD4:	POP	P,DEVNAM(F)	;SET NAME INTO DDB
   679	000653'	254000	000624*		JRST	CPOPJ1		;SUCCESS RETURN
   680
   681	000654'	201304	000006	SETDD2:	MOVEI	T1,DEVLOG+1(F)	;MAKE SURE DDB PROPERLY INITED
   682	000655'	505300	000006*		HRLI	T1,DSKDDB+DEVLOG+1 ;BUT SKIP STUFF BEFORE THIS
   683	000656'	251304	777777*		BLT	T1,DEVRB1-1(F)
   684	000657'	402004	000002		SETZM	DEVIOS(F)	;EXCEPT FOR DEVIOS
   685	000660'	254000	000652'		JRST	SETDD4
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 14
FILUUO.MAC	19-SEP-89 19:52		.CHUFD - Read UFD uuo

   686				;SUBROUTINE TO CLEAR A DISK DEVICE DATA BLOCK
   687				;ENTER WITH F=LOC OF DDB
   688				;CALLED BY RELEASE CODE AND ONCDSK AT ONCE TIME
   689
   690	000661'			CLRDDB:
   691					;PUSHJ P,IOLDEL		;NO IOLIST TO DELETE IN VM SYSTEM
   692
   693	000661'	201300	000645*		MOVEI	T1,DSKDDB	;START AT PROTOTYPE
   694	000662'	200340	000006	CLRDD1:	MOVE	T2,T1
   695	000663'	554307	000003		HLRZ	T1,DEVSER(T2)	;GET SUCCESSOR TO THIS DDB
   696	000664'	336000	000006		SKIPN	T1		;END?
   697	000665'	256000	000000'		 STOPCD (SLO)
   698						;;CLRDD1+3
   699	000666'	302304	000000		CAIE	T1,(F)		;NO. IS LINK THE ONE WE WANT?
   700	000667'	254000	000662'		JRST	CLRDD1		;NO. TRY NEXT
   701
   702				;HERE WITH T2=LOC OF DDB WHOSE LINK IS THE ONE WE WANT
   703	000670'	200404	000003		MOVE	T3,DEVSER(F)	;LINK OF DDB WE ARE REMOVING
   704	000671'	502407	000003		HLLM	T3,DEVSER(T2)	;SAVE IN LINK OF PREDECESSOR
   705	000672'	201300	000641*		MOVEI	T1,DDBCOR	;NO OF 4-WORD BLOCKS TO RETURN
   706	000673'	550340	000004		HRRZ	T2,F		;LOC OF DDB TO CLEAR
   707	000674'	332000	000000*		SKIPE	ONCTIM		;SKIP IF AT ONCE TIME
   708	000675'	324740	000000*		PJRST	GIV4WD		;RETURN THE CORE AND RETURN TO CALLER
   709	000676'	263040	000000		POPJ 	P,
   710
   711					INTERN	NAMSTR
   712				;SUBROUTINE TO RETURN THE ACTUAL STR NAME FOR A DDB
   713				;ENTER WITH F=LOC OF DDB
   714				;EXIT CPOPJ IF NOT A DISK OR NO UNIT ASSOCIATED WITH DDB (LOOKUP NOT DONE)
   715				;EXIT CPOPJ1 IF A DISK, WITH T1=NAME OF STR
   716
   717				PRINTF(<[NAMSTR Ought to return STRNAM( DRBSTR( DEVDRB(F) ) ) as name]>)
   718	000677'	200304	000004	NAMSTR:	MOVE	T1,DEVMOD(F)	;IS DEVICE A DISK?
   719	000700'	607300	200000		TLNN	T1,DVDSK
   720	000701'	263040	000000		  POPJ	P,
   721
   722				;;*;;	Might need CB resource for this -- consider this!
   723				;;*;;	HLRZ	T1,DEVDRB(F)		; Get directory block
   724				;;*;;	HRRZ	T1,DRBSTR(T1)		; and structure block
   725				;;*;;	MOVE	T1,STRNAM(T1)		; Name of structure
   726
   727	000702'	200300	006033'		MOVE	T1,[SIXBIT /DSKB/]	; Think DSKB for now
   728	000703'	324740	000653*		PJRST	CPOPJ1			;SKIP-RETURN
   729
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 15
FILUUO.MAC	19-SEP-89 19:52		COMCON - COMMAND DECODER INTERFACE ROUTINES

   730				SUBTTL	COMCON - COMMAND DECODER INTERFACE ROUTINES
   731
   732				;SUBROUTINE TO PERFORM "DISK" COMMAND - PRINT DISK ACCESSES
   733				;CALL:	MOVE	J,JOB NO.
   734				;	PUSHJ	P,DSKCOM	;CALLED FROM COMCON - COMMAND DECODER
   735				;	ALWAYS RETURN
   736				;PRINTS INCREMENTAL READS AND WRITES, TOTAL READS AND WRITES
   737				;TOTAL BLOCKS ALLOCATED, AND KILO-DISK-MIN FOR ALL STRS COMBINED
   738
   739					INTERN	DSKCOM
   740				EXTERN	DECIN,COMERA,ATT1,CRLF,JBTRCT,JBTWCT,JBYRCT,RADX10,JBTSIN
   741					EXTERN	JBYWCT,INLMES,JOBN,CHKSGJ
   742
   743	000704'	260040	000000*	DSKCOM:	PUSHJ	P,DECIN		;GET DECIMAL JOB NO. ARG IF ANY
   744	000705'	254000	000720'		  JRST	DSKCM1		;NO ARG, ASSUME USER'S OWN JOB(AC [=J)
   745	000706'	254000	000000*		  JRST	COMERA		;BAD CHARACTER, PRINT ERROR
   746	000707'	301340	000000*		CAIL	T2,JOBN		;JOB NUMBER TO LARGE?
   747	000710'	254000	000000*		JRST	ATT1		;YES, PRINT NOT A JOB NO.
   748	000711'	250100	000007		EXCH	J,T2		;NO, SETUP JOB NUMBER
   749	000712'	260040	000000*		PUSHJ P,CHKSGJ		;SEE IF HE CAN HAVE THAT INFO
   750					  JRST	[MOVE J,T2	;No - restore caller's frame number
   751	000713'	254000	006102'			 JRST COMERA]	;And take common command error exit.
   752	000714'	261040	000007		PUSH P,T2		;SAVE JOB NUM (IN CASE DSK 0)
   753	000715'	260040	000730'		PUSHJ P,DSKCM2
   754	000716'	262040	000002		POP P,J
   755	000717'	263040	000000		POPJ P,
   756
   757				;HERE WHEN USER DID NOT SPECIFY A JOB NUMBER - SO DO HIS WITH INCREMENTAL
   758	000720'	260040	000000*	DSKCM1:	PUSHJ	P,INLMES	;NO, PRINT MESSAGE
   759	000721'	512105	453650		ASCIZ	/RD,WT=/
	000722'	364000	000000
   760	000723'	260040	000750'		PUSHJ	P,DSKINC	;PRINT INCREMENTAL DISK READS
   761	000724'	260040	000720*		PUSHJ	P,INLMES	;COMMA
   762	000725'	260000	000000		ASCIZ	/,/
   763	000726'	260040	000744'		PUSHJ	P,PRTWDW	;PRINT NO OF INCREMENTAL DISK WRITES
   764	000727'	260040	000000*		PUSHJ	P,CRLF		;PRINT CRLF
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 16
FILUUO.MAC	19-SEP-89 19:52		COMCON - COMMAND DECODER INTERFACE ROUTINES

   765				;HERE TO PRINT DATA FOR ANOTHER JOB(IE DO NOT PRINT INCREMENTAL)
   766	000730'	260040	000724*	DSKCM2:	PUSHJ	P,INLMES	;PRINT HEADING
   767	000731'	512105	453650		ASCIZ	/RD,WT=/
	000732'	364000	000000
   768	000733'	135300	000000*		LDB	T1,JBYRCT	;TOTAL NO. OF READS FOR JOB SINCE LOG-IN
   769	000734'	260040	000000*		PUSHJ	P,RADX10	;PRINT DECIMAL
   770	000735'	260040	000730*		PUSHJ	P,INLMES	;PRINT COMMA
   771	000736'	260000	000000		ASCIZ	/,/
   772	000737'	271100	000000*		ADDI	J,JBTWCT-JBTRCT	;INCREASE JOB NO. BY DIFF. IN TABLE ORIGINS
   773	000740'	135300	000000*		LDB	T1,JBYWCT	;TOTAL NO. OF WRITES FOR JOB SINCE LOGIN
   774	000741'	260040	000734*		PUSHJ	P,RADX10	;PRINT DECIMAL
   775	000742'	201102	000000*		MOVEI	J,JBTRCT-JBTWCT(J)	;RESTORE J TO ORIGINAL JOB NO. (ELSE COMCON CONFUSED)
   776	000743'	324740	000727*		PJRST	CRLF		;PRINT CRLF AND RETURN
   777
   778				;SUBROUTINE TO PRINT NO OF DISK WRITES (RESULT OF WATCH COMMAND)
   779				;CALL:	MOVE J,JOB NO [J=J]
   780				;	PUSHJ P,PRTWDW
   781	000744'	271100	000000*	PRTWDW:	ADDI	J,JBTWCT-JBTRCT	;INCREASE JOB NO BY DIFF IN READ/WRITE TABLE ORIGINS
   782	000745'	260040	000750'		PUSHJ	P,DSKINC	;PRINT INCREMENTAL DISK WRITES
   783	000746'	201102	000000*		MOVEI	J,JBTRCT-JBTWCT(J)	;@ECREASE JOB NO BY DIFF IN TABLE ORIGINS
   784	000747'	263040	000000		POPJ	P,
   785
   786				;SUBROUTINE TO PRINT INCREMENTAL NO. OF BLOCKS READ OR WRITTEN
   787				;CALL:	MOVE	J,JOB NO.(J=J)
   788				;	PUSHJ	P,DSKINC
   789				;	ALWAYS RETURN
   790
   791					EXTERN	JBYIRD,JBRIRD
   792
   793	000750'			PRTWDR:				;PRINT INCREMENTAL NO OF BLOCKS READ
   794	000750'	135300	000733*	DSKINC:	LDB	T1,JBYRCT	;TOTAL NO OF READS(OR WRITES) FOR JOB
   795	000751'	135340	000000*		LDB	T2,JBYIRD	;INCREMENTAL SETTING(LOW ORDER N BITS
   796								; OR TOTAL NO.)
   797	000752'	137300	000751*		DPB	T1,JBYIRD	;UPDATE INCREMENTAL SETTING WITH CURRENT TOTAL
   798	000753'	274300	000007		SUB	T1,T2		;DIFFERENCE CUR TOTAL-LAST TOTAL
   799	000754'	405300	000000*		ANDI	T1,JBRIRD	;MASK OUT ALL BITS OUTSIDE INCREMENTAL FIELD
   800	000755'	324740	000741*		PJRST	RADX10		;PRINT DECIMAL AND RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 17
FILUUO.MAC	19-SEP-89 19:52		COMCON - COMMAND DECODER INTERFACE ROUTINES

   801				;COMMAND TO PRINT FILE STRUCTURES IN SYSTEM, AND UNITS NOT IN STRUCTURES
   802				; (RESOURCES COMMAND)
   803			000000	DSKRES==CPOPJ		;FOR NOW
   804
   805				;SUBROUTINE TO CLEAN UP CORE ON A KJOB COMMAND
   806				;CALLED AT CLOCK LEVEL IF NO CORE, M LEVEL IF CORE WHEN JOB IS KILLED
   807				;CALL	MOVE J,JOB NUMBER
   808				;	PUSHJ P,DSKKJB
   809	000756'	200302	000000*	DSKKJB:	MOVE	T1,JBTPPN(J)	;PPN OF JOB
   810	000757'	200340	000000*		MOVE	T2,HIGHJB	;CHECK FOR OTHER JOBS WITH SAME PPN
   811	000760'	306342	000000	DSKKLP:	CAIN	T2,(J)		;IS NEXT JOB=CURRENT JOB?
   812	000761'	363340	000174'		SOJLE	T2,DSKLGO	;YES, DONT TEST PPN'S
   813	000762'	316307	000756*		CAMN	T1,JBTPPN(T2)	;NO. IS ANOTHER JOB LOGGED IN UNDER SAME NUMBER?
   814	000763'	263040	000000		POPJ P,
   815	000764'	367340	000760'		SOJG	T2,DSKKLP	;NO, KEEP LOOKING
   816	000765'	324740	000174'		PJRST DSKLGO
   817
   818				;CHGPPN - Change PPN, used by the GFD program, called from CALLI 74 uuo
   819
   820	000766'	205340	001000	CHGPPN::MOVSI	T2,LICJAL	;Must have JL license
   821	000767'	312300	000175*		CAME	T1,MFDPPN	;Cannot GFD to (UFD)[1,1]
   822	000770'	616342	000212*		TDNN	T2,JBTLIC(J)
   823	000771'	263040	000000		 POPJ	P,
   824	000772'	261040	000006		PUSH	P,T1
   825	000773'	260040	000756'		PUSHJ	P,DSKKJB	;GET RID OF OLD PPN
   826	000774'	402002	000000*		SETZM	JBTNM1(J)	;Clear out the username associated with GFD'd
   827	000775'	402002	000000*		SETZM	JBTNM2(J)	; PPN so CHGNAM will work
   828	000776'	262042	000762*		POP	P,JBTPPN(J)
   829	000777'	260040	001001'		PUSHJ	P,CHGNAM	;Make sure GETTAB tables 31 and 32 match
   830	001000'	254000	000703*		JRST	CPOPJ1		;End of CHGPPN uuo
   831
   832				;CHGNAM - Change name, called from CHGPPN, LOGIN, and CREFRM uuos
   833
   834	001001'	200302	000776*	CHGNAM::MOVE	T1,JBTPPN##(J)	;Get current PPN (as set by GFD)
   835	001002'	260040	003132'		PUSHJ	P,PPNUSR	;Get username in T2 and T3
   836	001003'	403340	000010		  SETZB	T2,T3		;Not found
   837	001004'	202342	000774*		MOVEM	T2,JBTNM1##(J)	;Store first half
   838	001005'	202402	000775*		MOVEM	T3,JBTNM2##(J)	;2nd half
   839	001006'	263040	000000		POPJ	P,		;End of CHGNAM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 18
FILUUO.MAC	19-SEP-89 19:52		CLOSE

   840				SUBTTL	CLOSE
   841				;WHEN RENAME CALLS CLOSE, IT MAY ALREADY HAVE THE MONITOR BUFFER, AND THE RIB
   842				;MAY BE IN IT. IF SO, DEPRIB IS ON IN S
   843
   844				;INPUT CLOSE
   845	001007'	627200	040000	CLOSIN:	TLZN	F,LOOKB		;LOOKUP IN FORCE?
   846	001010'	324740	000000*		  PJRST	STOIOS		;NO. RETURN
   847	001011'	260040	000277*		NOCHARGE
   848	001012'	607200	020000		TLNN	F,ENTRB		;IF OUTPUT STILL OPEN, DON'T WIPE OUT UPTPOS.
   849	001013'	260040	000000*		  PUSHJ	P,SIMRLS	;CLEAN UP SIMIO DATA BASE
   850	001014'	201300	000005		MOVEI	T1,DECSTP
   851	001015'	137300	000120*		DPB	T1,DEYSTC	;IN CASE OF ERROR HERE
   852	001016'	260040	000241*		PUSHJ	P,GETCBR
   853	001017'	550644	000325*		HRRZ	P2,DEVATB(F)	;% CHECK ON STATUS OF FILE
   854	001020'	554744	000000*		HLRZ	P4,DEVDRB(F)
   855	001021'	332000	000015		SKIPE	P2
   856	001022'	336000	000017		  SKIPN	P4
   857	001023'	256000	000000'		 STOPCD (SLO)
   858				           ;;CLOSIN+14
   859	001024'	200315	000275*		MOVE	T1,ATBSTS(P2)
   860	001025'	602300	000000*		TRNE	T1,ATPREN	;% IF RENAME ON, THE ONE WHO TURNS
   861	001026'	254000	001200'		  JRST	CLSXT1		;% IT OFF WILL WORRY ABOUT READ COUNT=0
   862	001027'	260040	002012'		PUSHJ	P,TSTRES	;% MAKE SURE WE GIVE UP RESOURCES(UNLESS RENAME)
   863	001030'	606300	777777*	CLOSRN:	TRNN	T1,ATMCNT-1	;% IS HE THE LAST READER?
   864	001031'	606300	000000*		TRNN	T1,ATPDEL	;% FILE MARKED FOR DELETION?
   865	001032'	254000	001062'		  JRST	CLSIN2		;% NO
   866	001033'	260040	000245*	CLIDEL:	PUSHJ	P,GIVCBR
   867	001034'	260040	000000*		PUSHJ	P,RIBWTL	;GET RIB WRITE LOCKED
   868	001035'	254000	001053'		  JRST	CLIBDR		;BAD RIB, FIX QUOTAS AND GO TO FREACC.
   869	001036'	260040	000000*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
   870	001037'	255000	000000		  JFCL			;IGNORE ERROR RETURN
   871								;DON'T TRY TO ADJUST QUOTAS, GIVPAG SUBTRACTS AS IT GOES ALONG.
   872
   873	001040'	402015	000000*		SETZM	ATBRIB(P2)	;IN CASE THE FILE IS STILL MAPPED,
   874								; TELLS REMOVE THAT RIB WENT AWAY.
   875	001041'	260040	001527'		PUSHJ	P,LOGTST	;RECOMPUTE RIBUSD IF PPN NOT LOGGED IN
   876
   877				;HERE WHEN THE FILE NAME WAS NOT FOUND IN THE UFD.
   878				; ALSO COME HERE FROM DELETE CODE WHEN RIB ERROR OCCURS, ATBRIB CAN BE ZERO!
   879	001042'	621200	020040	FREACC:	TLZ	F,RENMB!ENTRB		;TURN OFF RENMB SO CLOSE OUTPUT WONT DO ANYTHING
   880	001043'	260040	001016*		PUSHJ P,GETCBR
   881	001044'	550715	000114*		HRRZ P3,ATBFNB(P2)	;% FOR DELETING FNB
   882	001045'	260040	000150*		PUSHJ P,ULKDBL		;% AND REMOVE DDB
   883	001046'	211300	000000*		MOVNI	T1,ATPCNT	;% ONE LESS READER OF FILE
   884	001047'	273315	001024*		ADDB	T1,ATBSTS(P2)	;% AND GET ATBSTS IN T1
   885	001050'	607300	000000*		TLNN	T1,ATMUMC	;% ANYONE STILL HAVE A PAGE MAPPED?
   886	001051'	324740	001153'		PJRST CLSN3A		;% NO, DELETE PPB ETC. IF NECESSARY
   887	001052'	324740	001176'		PJRST CLSIN5		;% YES, JUST ZERO DEVATB AND LEAVE AT ALONE
   888
   889				;HERE IF BAD RIB TRYING TO DELETE ATPDEL FILE OR BAD RIB IN DELETE
   890				; CODE
   891
   892	001053'	200315	000130*	CLIBDR:	MOVE	T1,ATBALP(P2) ;TRY TO ADJUST QUOTAS PROPERLY
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 18-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

   893	001054'	270317	000131*		ADD	T1,DRBALC(P4)  ;GET PROPER VALUE - AS IF WE DELETED THE PAGES
   894	001055'	331017	001054*		SKIPL	DRBALC(P4)	;IF NEGATIVE, REPLACE ANYWAY
   895	001056'	331000	000006		SKIPL	T1		;DON'T DECREASE
   896	001057'	202317	001055*		MOVEM	T1,DRBALC(P4)	;STORE NEW DRBALC
   897	001060'	260040	001527'		PUSHJ	P,LOGTST	;IF DIRECTORY NOT CONNECTED TO, RECOMPUTE RIBUSD AND RIBMXA
   898	001061'	254000	001042'		JRST	FREACC		;AND GO GET RID OF ATB IF WE CAN.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 19
FILUUO.MAC	19-SEP-89 19:52		CLOSE

   899				;HERE WHEN FILE IS NOT MARKED FOR DELETION
   900	001062'	606540	000001	CLSIN2:	TRNN	M,CLSOUT	;% SUPPRESSING OUTPUT CLOSE?
   901	001063'	607200	020040		TLNN	F,ENTRB+RENMB	;% NO, ENTER OR RENAME DONE?(IF SO, CLSOUT WILL BE CALLED)
   902	001064'	334000	000000		SKIPA
   903	001065'	254000	001204'		JRST CLSXIT		;% YES. RETURN
   904	001066'	200302	000770*		MOVE	T1,JBTLIC(J)	;% GET PROCESS LIC
   905	001067'	602540	100000		TRNE	M,CLSDMP	;% SET DUMPED BIT?
   906	001070'	607300	001002		TLNN	T1,LICJAL+LICWFL	;% APPROPRIATE LIC?
   907	001071'	254000	001077'		JRST	CLSIN7		;% NO
   908	001072'	205300	000000*		MOVSI	T1,ATPDMP
   909	001073'	436315	000000*		IORM	T1,ATBLCW(P2)	;% SET DUMPED BIT
   910	001074'	260040	001726'		PUSHJ	P,UPDUF0	;% UPDATE THE UFD
   911	001075'	260040	001043*		PUSHJ	P,GETCBR	;GET CB BACK
   912	001076'	254000	001101'		JRST	CLSIN8		;UPDATE RIB
   913	001077'	602540	000010	CLSIN7:	TRNE	M,CLSACC	;% SUPPRESS UPDATING ACCESS DATE?
   914	001100'	254000	001141'		JRST	CLSIN3		;% YES, DONT WRITE RIB
   915
   916				;NOW CLEAR ATPALC IF ITS OK TO. IF CLSACC ON, TRY TO GUARANTEE
   917				; THAT WE DON'T WRITE ANY DISK ON INPUT CLOSE - THUS THIS CALL
   918				; IS AFTER CHECK ON CLSACC.
   919
   920	001101'	200315	001073*	CLSIN8:	MOVE	T1,ATBLCW(P2)	;% GET LIC WORD
   921	001102'	603300	000000*		TLNE	T1,ATPALC	;% IF THIS BIT IS SET,
   922	001103'	260040	001706'		 PUSHJ	P,CLRACH	;% TRY TO CLEAR IT.
   923	001104'	135440	000000*		LDB	T4,ATYADT	;% GET CURRENT ACCESS DATE FOR BELOW
   924	001105'	200315	001101*		MOVE	T1,ATBLCW(P2)	;% GET NEW LIC WORD
   925	001106'	603300	001102*		TLNE	T1,ATPALC	;% IF ATPALC HAS CHANGED (WENT OFF)
   926	001107'	603300	001072*		TLNE	T1,ATPDMP	;%  OR ATPDMP IS SET
   927	001110'	254000	001114'		 JRST	CLSN2B		;%  THEN ALWAYS UPDATE RIB
   928	001111'	312440	000000*		CAME	T4,THSDAT	;% IS ACCESS DATE=TODAY?
   929	001112'	607200	010004		 TLNN	F,INPB!MAPB	;% DATE NEQ TODAY, ANY INPUTS DONE?
   930	001113'	254000	001141'		  JRST	CLSIN3		;% NO NEED TO UPDATE ACCESS DATE, JUST SET A.T. DORMANT
   931	001114'	603200	010004	CLSN2B: TLNE	F,INPB!MAPB	;% IN CASE FORCING RIB OUT DUE TO ATPALC
   932	001115'	200440	001111*		 MOVE	T4,THSDAT	;% SET ACCESS DATE=TODAY IF INPUT DONE
   933	001116'	606540	000010		TRNN 	M,CLSACC	;% DO NOT RESET ACCESS IF HERE ON ERR
   934	001117'	137440	001104*		 DPB	T4,ATYADT	;% IN AKB
   935	001120'	260040	001033*		PUSHJ 	P,GIVCBR
   936	001121'	260040	001034*		PUSHJ 	P,RIBWTL	;GET RIB WRITE LOCKED
   937	001122'	254000	001131'		 JRST 	CLSN2A		;ERROR
   938	001123'	554355	000000*		HLRZ T2,ATBMSC(P2)	;RESET ACCESS DATE
   939	001124'	542340	376000*		HRRM T2,%RIB+RIBEXT
   940	001125'	200355	001105*		MOVE T2,ATBLCW(P2)	;GET LIC WORD
   941	001126'	312340	376000*		CAME T2,%RIB+RIBLCW	;IF ITS CHANGING
   942	001127'	202340	376000*		MOVEM T2,%RIB+RIBLCW	;THEN CHANGE IT.
   943	001130'	260040	000560*		PUSHJ P,RELLOK		;FINISHED WITH RIB
   944	001131'	260040	001075*	CLSN2A:	PUSHJ P,GETCBR
   945	001132'	200355	001047*		MOVE T2,ATBSTS(P2)
   946	001133'	602340	001025*		TRNE T2,ATPREN
   947	001134'	254000	001200'		JRST CLSXT1		;% RENAME ON WHILE RIB FIDDLE, EXIT
   948	001135'	602340	777777*		TRNE T2,ATMCNT-1		;% COUNT NOW 1?
   949	001136'	254000	001141'		JRST CLSIN3		;% NO
   950	001137'	602340	001031*		TRNE T2,ATPDEL		;% YES, HAS DELETE GONE ON?
   951	001140'	254000	001033'		JRST CLIDEL		;%YES, GO DELETE FILE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 19-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

   952
   953				;DELETE EXPECTS TO JUMP INTO THIS POINT ON RIB ERROR, WITH ATBRIB POSSIBLY 0.
   954
   955	001141'	603200	020040	CLSIN3:	TLNE	F,ENTRB+RENMB	;% ENTER OR RENAME DONE?
   956	001142'	254000	001204'		JRST CLSXIT		;% YES, EXIT (UPDATE SUPPRESSING OUTPUT CLOSE)
   957	001143'	550715	001044*		HRRZ P3,ATBFNB(P2)
   958	001144'	260040	001045*		PUSHJ P,ULKDBL	;REMOVE DDB FROM LINKED LIST
   959	001145'	211300	001046*		MOVNI T1,ATPCNT
   960	001146'	273315	001132*		ADDB T1,ATBSTS(P2)	;DECREMENT COUNT
   961	001147'	612300	006104'		TDNE T1,[ATMUMC,,ATMCNT!ATPUPD!ATPMXU]
   962	001150'	254000	001176'		JRST CLSIN5		;STILL IN USE
   963	001151'	603200	010004		TLNE	F,INPB!MAPB		;% NO. ANY INPUTS BEEN DONE?
   964	001152'	254000	001175'		JRST	CLSIN6		;% YES, JUST MAKE A.T. DORMANT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 20
FILUUO.MAC	19-SEP-89 19:52		CLOSE

   965				;HERE TO SEE IF NMB NOW HAS NO A.T.S IN ITS RING
   966	001153'	260040	000132*	CLSN3A:	PUSHJ P,FREATB		;% RETURN AT TO FREE STORAGE
   967	001154'	554316	000250*		HLRZ T1,FNBATB(P3)	;% ANY ATBS LEFT?
   968	001155'	326300	001176'		JUMPN T1,CLSIN5		;% YES, DO NOT DELETE FNB
   969	001156'	550356	000000*		HRRZ T2,FNBDRB(P3)	;% GET SET TO REMOVE FNB
   970	001157'	201407	000000*		MOVEI T3,DRBFNB-FNBLNK(T2)	;% FAKE A PRED.
   971	001160'	554347	000257*		HLRZ T2,DRBFNB(T2)	;% FIRST FNB
   972	001161'	306356	000000	CLSN3B:	CAIN T2,(P3)
   973	001162'	254000	001167'		JRST CLSIN4
   974	001163'	200400	000007		MOVE T3,T2		;% RESET PRED
   975	001164'	554347	000000*		HLRZ T2,FNBLNK(T2)	;% NEXT
   976	001165'	326340	001161'		JUMPN T2,CLSN3B
   977	001166'	256000	000000'		 STOPCD (SLO)
   978						;;CLSN3B+5
   979
   980	001167'	200316	001164*	CLSIN4:	MOVE T1,FNBLNK(P3)	;% NOW LINK AROUND FNB
   981	001170'	502310	001167*		HLLM T1,FNBLNK(T3)
   982	001171'	200340	000264*		MOVE T2,SYSCOR
   983	001172'	506700	001171*		HRLM P3,SYSCOR
   984	001173'	502356	000263*		HLLM T2,CMBLNK(P3)	;% AND PUT FNB ON FREE LIST
   985	001174'	254000	001176'		JRST CLSIN5
   986
   987	001175'	260040	000143*	CLSIN6:	PUSHJ P,LKDATB		;%JUST PUT THE ATB ON DORMANT LIST
   988	001176'	402004	001017*	CLSIN5:	SETZM DEVATB(F)
   989	001177'	254000	001210'		JRST CLSXT2
   990
   991	001200'	550715	001143*	CLSXT1:	HRRZ P3,ATBFNB(P2)
   992	001201'	260040	001144*		PUSHJ P,ULKDBL
   993	001202'	402004	001176*		SETZM DEVATB(F)
   994	001203'	634300	000006		TDZA T1,T1	;FOR DEB IN DAYSTS
   995	001204'	201300	000003	CLSXIT:	MOVEI T1,DECUP2	;HERE ON UPDATE CLOSE IN (SET DEYSTC
   996	001205'	137300	001015*		DPB T1,DEYSTC
   997	001206'	211300	001145*		MOVNI T1,ATPCNT
   998	001207'	272315	001146*		ADDM T1,ATBSTS(P2)	;% DEC COUNT
   999	001210'	370317	000144*	CLSXT2:	SOS T1,DRBCNT(P4)
  1000	001211'	602300	000145*		TRNE T1,DRPMXC
  1001	001212'	256000	000000'		 STOPCD (SLO)
  1002				           ;;CLSXT2+2
  1003	001213'	202004	000002	STOCBR:	MOVEM S,DEVIOS(F)
  1004	001214'	502212	000000*		HLLM F,%UPT+UPTJDA(W)
  1005	001215'	324740	001120*		PJRST GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 21
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1006				;CLOSE OUTPUT
  1007
  1008
  1009	001216'	607200	020000	CLOSOU:	TLNN	F,ENTRB	;ENTER OR RENAME DONE?
  1010	001217'	263040	000000		POPJ	P,		;NO. RETURN
  1011	001220'	260040	002012'		PUSHJ P,TSTRES
  1012	001221'	260040	001011*		NOCHARGE	;TURN OFF CHARGING
  1013	001222'	260040	001013*		PUSHJ P,SIMRLS		;CLEAN UP SIMIO DATA BASE
  1014	001223'	201300	000005		MOVEI T1,DECSTP
  1015	001224'	137300	001205*		DPB T1,DEYSTC
  1016	001225'	550644	001202*		HRRZ P2,DEVATB(F)
  1017	001226'	554744	001020*		HLRZ P4,DEVDRB(F)
  1018	001227'	332000	000015		SKIPE P2
  1019	001230'	336000	000017		SKIPN P4
  1020	001231'	256000	000000'		 STOPCD (SLO)
  1021				           ;;CLOSOU+11
  1022	001232'	550715	001200*		HRRZ P3,ATBFNB(P2)	;JUST TO MAKE SURE ITS LOADED
  1023	001233'	260040	000000*		PUSHJ P,PTROUT	;DUMP CHANGED POINTERS
  1024	001234'	254000	001300'		 JRST NOOUT2	;RIB ERROR
  1025	001235'	254000	001241'		 JRST CLSOU1	;NONE (RIB NOT GOTTEN)
  1026	001236'	336000	376000*		SKIPN %RIB+RIBRIB	;IS IT THE PRIME RIB IN CORE
  1027	001237'	254000	001243'		JRST CLSOU0	;YES, GO
  1028	001240'	260040	001130*		PUSHJ P,RELLOK	;GET RID OF IT
  1029	001241'	260040	001121*	CLSOU1:	PUSHJ P,RIBWTL	;GET RIB WRITE LOCKED
  1030	001242'	254000	001300'		 JRST NOOUT2	;CAN NOT, RIB ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 22
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1031				;HERE WHEN THE FILE IS COMPLETELY WRITTEN
  1032	001243'	602540	000040	CLSOU0:	TRNE	M,CLSRST	;SHOULD THIS CLOSE ACT LIKE A RESET?
  1033	001244'	661200	000020		TLO	F,RESETB	;YES. TURN ON RESETB
  1034	001245'	550644	001225*		HRRZ	P2,DEVATB(F)	;NO. JUST GET LOC OF A.T.
  1035	001246'	200355	001207*		MOVE	T2,ATBSTS(P2)	;STATUS OF FILE
  1036	001247'	606340	000000*		TRNN	T2,ATPCRE!ATPSUP ;SKIP IF NOT UPDATING
  1037	001250'	621200	000020		TLZ	F,RESETB	;UPDATING, MAKE SURE FILE ISNT DELETED
  1038	001251'	627200	000020		TLZN F,RESETB	;IS THIS A RESET?
  1039	001252'	254000	001315'		JRST CLSOU2	;NO, GO
  1040	001253'	260040	001036*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
  1041	001254'	255000	000000		 JFCL
  1042	001255'	402015	001040*		SETZM	ATBRIB(P2) ;TELL REMOVE RIB IS GONE. NO ONE ELSE
  1043							; CAN USE THIS ATB YET IS ASSUMPTION.
  1044	001256'	260040	001527'		PUSHJ P,LOGTST	;AND UFD QUOTAS
  1045	001257'	260040	001131*	CLORS1:	PUSHJ P,GETCBR
  1046	001260'	550715	001232*		HRRZ P3,ATBFNB(P2)
  1047	001261'	260040	001201*		PUSHJ P,ULKDBL	;UNLINK DDB FROM FNB
  1048	001262'	201300	000000*		MOVEI T1,ATPCRE!ATPSUP	;TURN THESE OFF IN CASE THIS STAYS AROUND
  1049	001263'	410315	001246*		ANDCA T1,ATBSTS(P2)	;GET STATUS WITHOUT BITS
  1050	001264'	607300	001050*		TLNN T1,ATMUMC		;ANYTHING STILL MAPPED?
  1051								; (MUST BE THIS JOB)
  1052	001265'	254000	001271'		JRST CLORS2		;NO, DELETE THE ATB
  1053	001266'	660300	001137*		TRO T1,ATPDEL		;YES, SET ATPDEL SO DECUMC WILL DELETE THE ATB
  1054								;WHEN LAST PAGE IS UNMAPPED
  1055	001267'	202315	001263*		MOVEM T1,ATBSTS(P2)	;STORE
  1056	001270'	254000	001272'		JRST CLORS3
  1057	001271'	260040	001153*	CLORS2:	PUSHJ P,FREATB	;RETURN ATB TO FREE CORE
  1058	001272'	370357	001210*	CLORS3:	SOS T2,DRBCNT(P4)	;DECREMENT COUNT
  1059	001273'	602340	001211*		TRNE T2,DRPMXC
  1060	001274'	256000	000000'		 STOPCD (SLO)
  1061						;;CLORS3+2
  1062	001275'	402004	001245*		SETZM DEVATB(F)
  1063	001276'	621200	060040		TLZ F,ENTRB!RENMB!LOOKB
  1064	001277'	324740	001213'		PJRST STOCBR	;DONE
  1065
  1066	001300'	623200	000020	NOOUT2:	TLZE F,RESETB	;RIB ERROR, RESET?
  1067	001301'	254000	001307'		JRST CLORST	;YES, GO DUMP IT
  1068	001302'	200315	001267*		MOVE T1,ATBSTS(P2)
  1069	001303'	606300	000000*		TRNN	T1,ATPCRE!ATPSUP	;SKIP IF NOT UPDATE
  1070	001304'	254000	001465'		JRST	CLOUPD	;THIS IS UPDATE, MUST WATCH OUT FOR OTHER USERS OF FILE ETC.
  1071	001305'	602300	000000*		TRNE T1,ATPCRE	;IS THIS CREATE?
  1072	001306'	254000	001444'		JRST CLOSCR	;GO DO IT ANYWAY
  1073
  1074	001307'	200315	001053*	CLORST:	MOVE T1,ATBALP(P2)	;TRY TO ADJUST QUOTAS
  1075	001310'	270317	001057*		ADD T1,DRBALC(P4)
  1076	001311'	331017	001310*		SKIPL DRBALC(P4)
  1077	001312'	331000	000006		SKIPL T1
  1078	001313'	202317	001311*		MOVEM T1,DRBALC(P4)
  1079	001314'	254000	001257'		JRST CLORS1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 23
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1080	001315'	200315	000000*	CLSOU2:	MOVE	T1,ATBSIZ(P2)	;RESET SOME THING IN RIB
  1081	001316'	602300	000177		TRNE	T1,177
  1082	001317'	275300	000200		SUBI	T1,200
  1083	001320'	312300	376000*		CAME	T1,%RIB+RIBSIZ	;CHANGE ONLY IF CHANGING
  1084	001321'	202300	376000*		MOVEM	T1,%RIB+RIBSIZ
  1085	001322'	200300	001115*		MOVE	T1,THSDAT
  1086	001323'	200415	001302*		MOVE	T3,ATBSTS(P2)
  1087	001324'	606400	000000*		TRNN	T3,ATPCRE!ATPSUP
  1088	001325'	603200	014004		TLNE	F,INPB!OUTPB!MAPB	;IF UPDATE, RESET ONLY IF I/O
  1089	001326'	137300	001117*		DPB	T1,ATYADT		;SET ACCESS DATE
  1090	001327'	554315	001123*		HLRZ	T1,ATBMSC(P2)
  1091	001330'	550340	376000*		HRRZ	T2,%RIB+RIBEXT	;SEE IF CHANGING
  1092	001331'	312300	000007		CAME	T1,T2
  1093	001332'	542300	376000*		HRRM	T1,%RIB+RIBEXT
  1094	001333'	200315	001125*		MOVE	T1,ATBLCW(P2)
  1095	001334'	200340	376000*		MOVE	T2,%RIB+RIBSTS
  1096	001335'	606340	000000*		TRNN	T2,RIPHWE!RIPHRE!RIPBDA!RIPBFS!RIPBDR
  1097	001336'	625300	000000*		TLZA	T1,ATPUFE
  1098	001337'	661300	001336*		TLO	T1,ATPUFE
  1099	001340'	602400	000000*		TRNE	T3,ATPSUP!ATPCRE	;IF NOT UPDATE,
  1100	001341'	661300	001106*		TLO	T1,ATPALC	;THEN HAVE TO SET THIS BECAUSE PRIME RIB GOT ALLOCATED
  1101								;IF NOTHING ELSE.
  1102	001342'	202315	001333*		MOVEM	T1,ATBLCW(P2)	;GET SET FROM ERROR BITS
  1103	001343'	312300	376000*		CAME	T1,%RIB+RIBLCW 	;ONLY WRITE IF ITS CHANGING
  1104	001344'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  1105	001345'	200315	001307*		MOVE	T1,ATBALP(P2)
  1106	001346'	312300	376000*		CAME	T1,%RIB+RIBALP
  1107	001347'	202300	376000*		MOVEM	T1,%RIB+RIBALP
  1108	001350'	200315	000000*		MOVE	T1,ATBPVW(P2)
  1109	001351'	312300	376000*		CAME	T1,%RIB+RIBPVW
  1110	001352'	202300	376000*		MOVEM	T1,%RIB+RIBPVW
  1111	001353'	550415	001260*		HRRZ	T3,ATBFNB(P2)	;GET FNB
  1112	001354'	200315	001342*		MOVE	T1,ATBLCW(P2)	;GET ATPALC BIT
  1113	001355'	607300	001341*		TLNN	T1,ATPALC	;IF ATPALC IS SET, THEN NEED TO STORE RIBALT AND FNBALT
  1114	001356'	254000	001363'		JRST	CLSOU3
  1115	001357'	200340	000000*		MOVE	T2,PCDTIM	;OK, SET FNBALT AND RIBALT FOR ANY ALLOCATION
  1116								; THAT MIGHT HAVE HAPPENED
  1117	001360'	312340	376000*		CAME	T2,%RIB+RIBALT  	;ONLY CHANGE IF ITS CHANGING
  1118	001361'	202340	376000*		MOVEM	T2,%RIB+RIBALT	;SET CORRECT VALUE.
  1119	001362'	202350	000000*		MOVEM	T2,FNBALT(T3)	;WE MAY BE INCREASING THE FNBALT FOR
  1120								; THE OLD FILE, BUT DOESN'T MATTER SINCE
  1121								; NORMALLY OLD FILE GOES AWAY UNLESS
  1122								; CAN'T UPDATE UFD OR SOMETHING, IN WHICH
  1123								; CASE NO HARM MAKING THIS BIGGER.
  1124								; (IN THAT CASE, RIBALT WILL DIFFER FROM FNBALT)
  1125	001363'	260040	001240*	CLSOU3:	PUSHJ	P,RELLOK	;ASSUME THIS WON'T RESCHEDULE.
  1126								; (OR ELSE PCDTIM WILL BE WRONG FOR THE RIB.)
  1127	001364'	200355	001323*		MOVE	T2,ATBSTS(P2)
  1128	001365'	602340	001305*		TRNE	T2,ATPCRE
  1129	001366'	254000	001444'		JRST	CLOSCR		;CLOSE FOR CREATE
  1130	001367'	260040	001727'		PUSHJ	P,UPDUFD	;UPDATE THE UFD.
  1131	001370'	200315	001364*		MOVE	T1,ATBSTS(P2)
  1132	001371'	606300	000000*		TRNN	T1,ATPSUP 	;IF SUPERCEDE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 23-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1133	001372'	254000	001465'		JRST	CLOUPD		;NOT, MUST BE UPDATE
  1134	001373'	205340	001355*		MOVSI	T2,ATPALC	;AND IF ALC IS ON,
  1135	001374'	612355	001354*		TDNE	T2,ATBLCW(P2)	;THEN
  1136	001375'	260040	000000*		PUSHJ	P,WATPCB	;MUST WAIT FOR UFPALC TO GO OUT.
  1137								; OR ELSE MIGHT GET OLD UFD POINTER WITH NO
  1138								; BIT ON POINTING TO FREE PAGE.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 24
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1139				;SUPERCEDE MUST LOOK AT OTHER A.T.'S
  1140
  1141	001376'	260040	001257*		PUSHJ P,GETCBR
  1142	001377'	201340	000000*		MOVEI T2,ATPUPD!ATPSUP!ATPMXU
  1143								;TURN SUP INTO UPD
  1144								; SO THAT ANYONE WHO LOOKS UP THIS
  1145								; FILE WHILE WE'RE STILL CLOSING WILL
  1146								; GET THIS COPY.
  1147	001400'	432355	001370*		XORM T2,ATBSTS(P2)
  1148	001401'	350355	000000*		AOS T2,ATBMWC(P2)	;INCREMENT MAX WRITE COUNT
  1149	001402'	606340	000000*		TRNN T2,ATMMWC		;CHECK FOR OVERFLOW
  1150	001403'	256000	000000'		 STOPCD (SLO)
  1151						;;CLOSU3+20
  1152	001404'	350016	000000*		AOS FNBUPD(P3)		;BUMP COUNT OF UPDATERS
  1153	001405'	554356	001154*		HLRZ T2,FNBATB(P3)	;GET SET TO SEARCH
  1154	001406'	200307	001400*	CLOSU1:	MOVE T1,ATBSTS(T2)	;IF THERE IS ONE SUP ATB, SHOULDN'T BE
  1155	001407'	602300	000000*		TRNE T1,ATPCRE!ATPSUP!ATPREN ; ANY OTHER WRITERS
  1156	001410'	256000	000000'		 STOPCD (SLO)
  1157						;;CLOSU1+2
  1158	001411'	602300	000000*		TRNE T1,ATPUPD!ATPDEL ;IGNORE OUR OWN AND DELETED ONES
  1159	001412'	254000	001421'		JRST CLOSU2	;IGNORE THESE
  1160	001413'	332007	000000*		SKIPE ATBDOR(T2)	;NOT DORMANT MUST BE READERS
  1161	001414'	254000	001437'		JRST CLOSU3
  1162	001415'	201300	001266*		MOVEI T1,ATPDEL
  1163	001416'	436307	001406*		IORM T1,ATBSTS(T2)	;MARK TO DELETE IT
  1164	001417'	260040	001215*		PUSHJ P,GIVCBR
  1165	001420'	254000	001471'		JRST CLOCOM	;AND GO
  1166
  1167	001421'	554347	000000*	CLOSU2:	HLRZ T2,ATBLNK(T2)	;NEXT ATB
  1168	001422'	326340	001406'		JUMPN T2,CLOSU1
  1169	001423'	200315	001255*	CLOSU4:	MOVE T1,ATBRIB(P2)
  1170	001424'	250316	000000*		EXCH T1,FNBRIB(P3)
  1171	001425'	260040	001417*		PUSHJ P,GIVCBR
  1172	001426'	202304	000000*		MOVEM T1,DEVRIB(F)	;NOW MUST DELETE OLD
  1173	001427'	661000	000020		TLO S,IO
  1174	001430'	260040	000000*		PUSHJ P,CRBRWL
  1175					 JRST	[PUSHJ P,RELLOK
  1176	001431'	254000	006105'			JRST CLOCOM]	;RIB ERROR, GIVE UP
  1177	001432'	513004	001275*		HLLZS DEVATB(F)	;DO NOT WANT ATBALP ADJUSTED
  1178	001433'	260040	001253*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
  1179	001434'	255000	000000		 JFCL
  1180	001435'	542644	001432*		HRRM P2,DEVATB(F)	;RESTORE
  1181	001436'	254000	001471'		JRST CLOCOM	;NOW FOR COMMON CODE
  1182
  1183	001437'	261040	000015	CLOSU3:	PUSH P,P2
  1184	001440'	200640	000007		MOVE P2,T2	;MUST REMOVE ATB
  1185	001441'	260040	000252*		PUSHJ P,RMVATB
  1186	001442'	262040	000015		POP P,P2
  1187	001443'	254000	001423'		JRST CLOSU4	;AND FINISH UP
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 25
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1188	001444'	400340	000000	CLOSCR:	SETZ	T2,		;NO RET PNTR SUPPLIED TO INSNAM.
  1189	001445'	260040	000000*		PUSHJ P,INSNAM	;CREATE, INSERT NAME IN UFD
  1190	001446'	254000	001471'		 JRST CLOCOM	;COULDN'T(ALLOC FAIL, RIB ERR, DIR FULL).
  1191	001447'	260040	001545'		PUSHJ P,CREUFD	;PUT STUFF INTO THE DIRECTORY
  1192	001450'	260040	001363*		PUSHJ P,RELLOK
  1193	001451'	201300	000274*		MOVEI T1,ATPDIR
  1194	001452'	616315	001416*		TDNN T1,ATBSTS(P2)
  1195	001453'	254000	001471'		JRST CLOCOM
  1196	001454'	260040	001376*		PUSHJ P,GETCBR	;ITS A UFD. MUST WORRY IF DRB
  1197	001455'	200304	000015		MOVE T1,DEVFIL(F)
  1198	001456'	260040	000000*		PUSHJ P,FNDDRB
  1199	001457'	254000	001463'		 JRST CLOUF1	;NONE THERE
  1200	001460'	402007	000000*		SETZM DRBRIB(T2)
  1201	001461'	201300	000000*		MOVEI T1,DRPNX
  1202	001462'	412307	000000*		ANDCAM T1,DRBNX(T2)
  1203	001463'	260040	001425*	CLOUF1:	PUSHJ P,GIVCBR
  1204	001464'	254000	001471'		JRST CLOCOM
  1205
  1206	001465'	607200	040000	CLOUPD:	TLNN F,LOOKB	;IF CLOSING OUTPUT ONLY
  1207	001466'	254000	001471'		JRST CLOCOM
  1208	001467'	260040	000000*		PUSHJ	P,INVDDB	;INVALIDATE THE DDB, SET FILE LOC TO START.
  1209						;FALL INTO COMMON CODE
  1210	001470'	334300	006107'		SKIPA T1,[DECLUK]	;SET TO LOOKUP IF ONLY OUT CLSD
  1211	001471'	201300	000000	CLOCOM:	MOVEI T1,0	;DONE WITH STATUS
  1212	001472'	137300	001224*		DPB T1,DEYSTC
  1213	001473'	260040	001527'		PUSHJ P,LOGTST	;RESET UFD USD INFO IF NEEDED
  1214	001474'	200315	001423*		MOVE T1,ATBRIB(P2)
  1215	001475'	621200	020040		TLZ F,ENTRB!RENMB
  1216	001476'	202316	001424*		MOVEM T1,FNBRIB(P3)
  1217	001477'	205300	000000*		MOVSI T1,FNPNX
  1218	001500'	412316	000000*		ANDCAM T1,FNBNX(P3)	;MAKE SURE FNB MARKED AS THERE
  1219	001501'	260040	001454*		PUSHJ P,GETCBR
  1220	001502'	200315	001452*		MOVE T1,ATBSTS(P2)	;PICKUP ATBSTS
  1221	001503'	622300	000000*		TRZE T1,ATPSUP!ATPCRE	;CLEAR THESE, SKIP IF UPDATING
  1222	001504'	254000	001513'		JRST CLOCM1		;CREATE (SUPERCEDE TURNED INTO UPDATE)
  1223	001505'	375016	001404*		SOSGE FNBUPD(P3)	;DECREMENT UPDATE COUNT
  1224	001506'	256000	000000'		 STOPCD (SLO)
  1225						;;CLOCOM+15
  1226	001507'	370355	001401*		SOS T2,ATBMWC(P2)	;DECREMENT MWC FOR UPDATER
  1227	001510'	606340	001402*		TRNN T2,ATMMWC		;COUNT GO TO ZERO?
  1228	001511'	620300	000000*		TRZ T1,ATPMXU		;YES, CLEAR MAX WRITE BIT
  1229	001512'	620300	000152*		TRZ T1,ATPUPD		;CLEAR IN CASE IT WAS SINGLE UPDATER
  1230	001513'	202315	001502*	CLOCM1:	MOVEM T1,ATBSTS(P2)	;STORE NEW ATBSTS.
  1231	001514'	616300	006110'		TDNN T1,[ATMUMC,,ATPMXU!ATMCNT] ;SKIP IF ANY USERS STILL
  1232	001515'	260040	001175*		PUSHJ P,LKDATB	;MAKE ATB DORMANT IF NO MORE USERS
  1233	001516'	370317	001272*		SOS T1,DRBCNT(P4)
  1234	001517'	602300	001273*		TRNE T1,DRPMXC
  1235	001520'	256000	000000'		 STOPCD (SLO)
  1236				           ;;CLOCM1+5
  1237	001521'	603200	040000		TLNE	F,LOOKB
  1238	001522'	254000	001525'		JRST	CLOCM2		;ALMOST DONE.
  1239	001523'	260040	001261*		PUSHJ	P,ULKDBL	;REMOVE FROM DDB LIST
  1240	001524'	402004	001435*		SETZM	DEVATB(F)	;NO MORE AT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 25-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1241	001525'	260040	001213'	CLOCM2:	PUSHJ	P,STOCBR	;
  1242	001526'	324740	001375*		PJRST	WATPCB		;
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 26
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1243				;TEST TO SEE IF THE USER IS LOGGED IN AND RESET UFD USD IF NOT
  1244
  1245	001527'	201340	000204*	LOGTST:	MOVEI T2,DRPLOG
  1246	001530'	612357	000205*		TDNE T2,DRBLOG(P4)
  1247	001531'	263040	000000		POPJ P,		;NOT LOGGED IN
  1248	001532'	661000	000020		TLO S,IO
  1249	001533'	260040	000000*		PUSHJ P,RIBDIR
  1250	001534'	324740	001450*		 PJRST RELLOK	;CAN NOT GET IT
  1251	001535'	554304	001226*		HLRZ T1,DEVDRB(F)
  1252	001536'	200340	376000*		MOVE T2,%RIB+RIBQTF
  1253	001537'	274346	001313*		SUB T2,DRBALC(T1)
  1254	001540'	202340	376000*		MOVEM T2,%RIB+RIBUSD
  1255	001541'	200340	376000*		MOVE T2,%RIB+RIBQTF
  1256	001542'	274346	000000*		SUB T2,DRBMXA(T1)
  1257	001543'	202340	376000*		MOVEM T2,%RIB+RIBMXA
  1258	001544'	324740	001534*		PJRST RELLOK	;ALL DONE
  1259
  1260				;FILL IN THE UFD FROM THE IN CORE TABLES
  1261				; USES T1-T3. EXPECT P2/ATB ADDRESS.
  1262
  1263	001545'	261040	000016	CREUFD:	PUSH	P,P3		;SAVE P3 AND SETUP TO BE FNB ADDRESS
  1264	001546'	550715	001353*		HRRZ	P3,ATBFNB(P2)	;GET FNB ADDR IN P3
  1265	001547'	261040	000011		PUSH	P,T4		;SVE T4 FOR COMPARES BELOW
  1266	001550'	200304	000015		MOVE T1,DEVFIL(F)
  1267	001551'	312307	376000*		CAME	T1,%RIB+UFDNAM(T2) ;DON'T WRITE IF ITS THE SAME
  1268	001552'	202307	376000*		MOVEM T1,%RIB+UFDNAM(T2)	;T2 POINTS TO THE UFD SLOT
  1269	001553'	510304	000016		HLLZ T1,DEVEXT(F)
  1270	001554'	510447	376000*		HLLZ	T4,%RIB+UFDEXT(T2)	;SEE IF ITS SAME
  1271	001555'	312300	000011		CAME	T1,T4
  1272	001556'	202307	376000*		MOVEM	T1,%RIB+UFDEXT(T2)	;NOT, UPDATE.
  1273	001557'	135400	000000*		LDB T3,ATYPRV
  1274	001560'	135440	000476*		LDB	T4,UFYPRV		;SEE IF SAME
  1275	001561'	312400	000011		CAME	T3,T4		;SKIP IF NO NEED TO WRITE
  1276	001562'	137400	001560*		DPB T3,UFYPRV
  1277	001563'	135400	000000*		LDB T3,ATYUF2
  1278	001564'	135440	000477*		LDB	T4,UFYUF2	;SEE IF ANY NEED TO WRITE
  1279	001565'	312400	000011		CAME	T3,T4		;?
  1280	001566'	137400	001564*		DPB T3,UFYUF2
  1281	001567'	135300	000000*		LDB T1,ATYCDT
  1282	001570'	312307	376000*		CAME	T1,%RIB+UFDCDT(T2)	;ANY NEED TO WRITE?
  1283	001571'	202307	376000*		MOVEM T1,%RIB+UFDCDT(T2)	;CREATION DATE
  1284	001572'	135300	000000*		LDB T1,ATYXCD
  1285	001573'	135440	000440*		LDB	T4,UFYXCD	;SEE IF SAME
  1286	001574'	312300	000011		CAME	T1,T4
  1287	001575'	137300	001573*		DPB T1,UFYXCD	;AND THE EXTENDED PART
  1288	001576'	135300	000000*		LDB T1,ATYCTM
  1289	001577'	221300	000074		IMULI T1,^D60
  1290	001600'	135400	000000*		LDB T3,ATYCSC	;SECONDS
  1291	001601'	270300	000010		ADD T1,T3
  1292	001602'	135440	000442*		LDB	T4,UFYCTM	;SEE IF SAME
  1293	001603'	312300	000011		CAME	T1,T4
  1294	001604'	137300	001602*		DPB T1,UFYCTM	;AND STORE IN UFD
  1295	001605'	135300	000000*		LDB T1,ATYUF1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 26-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1296	001606'	135440	000501*		LDB	T4,UFYUF1
  1297	001607'	312300	000011		CAME	T1,T4
  1298	001610'	137300	001606*		DPB T1,UFYUF1	;MORE BITS
  1299	001611'	200315	000000*		MOVE T1,ATBLIC(P2)
  1300	001612'	550447	376000*		HRRZ	T4,%RIB+UFDLIC(T2)
  1301	001613'	312300	000011		CAME	T1,T4
  1302	001614'	552307	376000*		HRRZM T1,%RIB+UFDLIC(T2)
  1303	001615'	200315	001345*		MOVE T1,ATBALP(P2)	;NUMBER OF ALLOCATED PAGES
  1304	001616'	301300	400000		CAIL T1,400000
  1305	001617'	201300	400000		MOVEI T1,400000	;SET FLAGIF VERY BIG. NEEDS LOOKUP
  1306	001620'	554447	376000*		HLRZ	T4,%RIB+UFDALP(T2)
  1307	001621'	312300	000011		CAME	T1,T4
  1308	001622'	506307	376000*		HRLM T1,%RIB+UFDALP(T2)
  1309	001623'	200315	001474*		MOVE T1,ATBRIB(P2)
  1310	001624'	312307	376000*		CAME	T1,%RIB+UFDRIB(T2)
  1311	001625'	202307	376000*		MOVEM T1,%RIB+UFDRIB(T2)
  1312	001626'	262040	000011		POP	P,T4		;RESTORE T4 AND
  1313	001627'	262040	000016		POP	P,P3		;P3
  1314	001630'	263040	000000		POPJ P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 27
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1315				;ROUTINE TO FILL IN ATB WITH PRELIMINARY INFORMATION FROM UFD
  1316				; ENTRY IN CASE WE GET A RIB ERROR TRYING TO READ RIB.
  1317				; CALLED FROM SRCFIL WITH CB, DRBCNT UP, RIB LOCKED STILL.
  1318				; DOES NOT FILL IN ATBRIB, SINCE INFO IS REALLY NOT VALID - IS
  1319				; OVERWRITTEN WITH THE REAL DATA FROM THE RIB NORMALLY.
  1320				; IF GET A RIB ERROR, PROTECTION AND PID ARE SETUP SO THAT
  1321				; USER CAN DELETE IT IF IT REALLY WAS HIS FILE AND IT WAS
  1322				; PROTECTED SO HE COULD DELETE IT.
  1323				; P2 HAS ATB ADDRESS, T2 HAS POINER TO UFD ENTRY (%RIB+UFD???(T2))
  1324
  1325	001631'	332015	001623*	UFDATB::SKIPE	ATBRIB(P2)	;MAKE SURE NOTHING IN THERE ALREADY
  1326	001632'	256000	000000'		 STOPCD (SLO)
  1327						;;UFDATB+1
  1328	001633'	135300	001562*		LDB	T1,UFYPRV	;GET PROTECTION CODE
  1329	001634'	137300	001557*		DPB	T1,ATYPRV	;STORE IT THERE.
  1330	001635'	135300	001566*		LDB	T1,UFYUF2	;GET DUMPED, ERROR, PID BITS ETC
  1331	001636'	137300	001563*		DPB	T1,ATYUF2
  1332	001637'	200307	376000*		MOVE	T1,%RIB+UFDCDT(T2) ;GET CREATION DATE
  1333	001640'	137300	001567*		DPB	T1,ATYCDT
  1334	001641'	135300	001575*		LDB	T1,UFYXCD	;GET REST OF BITS (EXTENDED)
  1335	001642'	137300	001572*		DPB	T1,ATYXCD
  1336	001643'	135300	001604*		LDB	T1,UFYCTM
  1337	001644'	231300	000074		IDIVI	T1,^D60		;GET SECONDS IN T2, TIME IN T1
  1338	001645'	137300	001576*		DPB	T1,ATYCTM	;IN MINUTES
  1339	001646'	137340	001600*		DPB	T2,ATYCSC	;IN SECONDS
  1340	001647'	135300	001610*		LDB	T1,UFYUF1	;GET FIRST 4 BITS
  1341	001650'	137300	001605*		DPB	T1,ATYUF1	;AND STORE THEM
  1342	001651'	550307	376000*		HRRZ	T1,%RIB+UFDLIC(T2)
  1343	001652'	542315	001611*		HRRM	T1,ATBLIC(P2)	;STORE INTO RH OF ATBLIC.
  1344								;(FOR INFO - CAN'T RUN ANYTHING ANYWAY)
  1345	001653'	200307	376000*		MOVE	T1,%RIB+UFDALP(T2) ;GET SIZE
  1346	001654'	202315	001615*		MOVEM	T1,ATBALP(P2)	;STORE. INCLUDES 400000,,0 IF DON'T KNOW HOW BIG.
  1347	001655'	205300	000000*		MOVSI	T1,ATPPID	;DOES THIS FILE HAVE A PID?
  1348	001656'	616315	001374*		TDNN	T1,ATBLCW(P2)	;IF NOT, JUST RETURN.
  1349	001657'	263040	000000		POPJ	P,		;AND RETURN.
  1350	001660'	201300	777777		MOVEI	T1,777777	;USE LAST SYSTEM PID
  1351					MOVEM	T1,ATBPID(P2)	;SO THAT ITS PROTECTED AGAINST THE OWNER UNLESS HE HAS LICENSE.
  1352	001661'	202315	000000*
  1353	001662'	263040	000000		POPJ	P,		;RETURN NOW.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 28
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1354				;ROUTINE CALLED BY ROUTINES THAT ALLOCATE BEFORE THEY ALLOCATE
  1355				; TO SET UFDALC AND ATBALC. GETS CB RESOURCE, NEEDS %RIB TO
  1356				; PUT UFD INTO.
  1357				; EXPECTS F/DDB ADDRESS
  1358				; USES T1-T3
  1359				; IF CALER DOESN'T WANT ANYTHING TO HAPPEN UNLESS ATPALC IS CLEAR,
  1360				; HE MUST CHECK HIMSELF. OTHERWISE ALL CHANGED UFD VALUES WILL GET
  1361				; UPDATED.
  1362
  1363	001663'	260040	001501*	SETACH::PUSHJ	P,GETCBR	;GET CB RESOURCE
  1364	001664'	550344	001524*		HRRZ	T2,DEVATB(F)	;GET ATB ADDRESS IN T2 FOR FILSER ROUTINES
  1365	001665'	550407	001546*		HRRZ	T3,ATBFNB(T2)	;GET FNB ADDRESS IN T3
  1366	001666'	200307	001631*		MOVE	T1,ATBRIB(T2)	;MAKE SURE THIS FILE-ATB IS THE ONE WITH UFD ENTRY
  1367	001667'	312310	001476*		CAME	T1,FNBRIB(T3)
  1368	001670'	324740	001463*		PJRST	GIVCBR		;ITS NOT, DON'T HAVE TO SET THE BIT
  1369	001671'	476010	001362*		SETOM	FNBALT(T3)	;SO THAT NO ONE WILL CLEAR IT - ACTUALLY JUST DEBUGGING CHECK
  1370	001672'	205300	001373*		MOVSI	T1,ATPALC	;GET THE BIT
  1371	001673'	612307	001656*		TDNE	T1,ATBLCW(T2)	;IS IS SET ALREADY?
  1372	001674'	324740	001670*		PJRST	GIVCBR		;YES, THEN NO NEED TO WRITE OUT UFD AGAIN
  1373	001675'	436307	001673*		IORM	T1,ATBLCW(T2)	;NO, SO SET IT. NO ONE WILL CLEAR THIS
  1374								; AFTER RELEASE OF CB, SINCE WE HAVE WRITE
  1375								; BITS ON IN THIS ATB.
  1376	001676'	261040	000015		PUSH	P,P2		;SAVE P2, NEED IT FOR ATB ADDRESS FOR UPDUF0
  1377	001677'	200640	000007		MOVE	P2,T2		;GET ATB ADDRESS IN P2
  1378	001700'	260040	001726'		PUSHJ	P,UPDUF0	;DO THE COMMON WORK
  1379	001701'	262040	000015		POP	P,P2		;RESTORE P2
  1380	001702'	261040	000011		PUSH	P,T4		;BOY OH BOY, WATPCB CLOBBERS T4 AND WE CAN'T
  1381	001703'	260040	001526*		PUSHJ	P,WATPCB
  1382	001704'	262040	000011		POP	P,T4
  1383	001705'	263040	000000		POPJ	P,		;RETURN.
  1384
  1385				;HERE IF ATPALC WAS ON TO CLEAR IT
  1386				; WITH CB RESOURCE.
  1387				;EXPECTS ATB ADDRESS IN P2
  1388				;SMASHES T1-T3
  1389
  1390	001706'	260040	000000*	CLRACH:	PUSHJ	P,TSTWRT	;DON'T MUCK WITH IT IF FILE IS OPEN FOR ANY SORT OF WRITE
  1391	001707'	263040	000000		  POPJ	P,		;GO AWAY, STILL HAVE CB
  1392	001710'	550415	001665*		HRRZ	T3,ATBFNB(P2)	;GET FNB ADDR IN T3
  1393	001711'	200315	001666*		MOVE	T1,ATBRIB(P2)	;GET RIB POINTER
  1394	001712'	312310	001667*		CAME	T1,FNBRIB(T3)	;MAKE SURE THIS FILE IS STILL IN UFD
  1395	001713'	263040	000000		POPJ	P,		;JUST RETURN WITH CB STILL
  1396	001714'	200310	001671*		MOVE	T1,FNBALT(T3)	;GET WHAT PCB DIRTY MONITOR CLOCK WAS AFTER ALLOCATION
  1397	001715'	313300	001357*		CAMLE	T1,PCDTIM	;IF ALT IS GREATER THAN CURRENT PCDTIM,
  1398	001716'	254000	001722'		JRST	CLRAC0		; THEN RIBALT MUST HAVE BEEN FROM PREVIOUS MONITOR.
  1399								; SO CLEAR ATPALC.
  1400	001717'	271300	000002		ADDI	T1,2		;ONE COUNT FOR THE PCBS THAT WERE ON THEIR
  1401								; WAY OUT, ONE FOR THE ONES THAT WERE DIRTY
  1402	001720'	313300	001715*		CAMLE	T1,PCDTIM	;IF IT HAS INCREMENTED 2 TIMES, WE WIN
  1403	001721'	263040	000000		POPJ	P,		;SORRY, EVERTHING HASN'T GONE OUT YET.
  1404
  1405				;NOW WE NOW THERE ARE NO MORE WRITERS OF FILE, THE ATB STILL
  1406				; REPRESENTS THE FILE WHICH HAS A UFD ENTRY, AND ALL THE PCBS THAT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 28-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1407				; WERE DIRTY AT THE LAST ALLOCATION CHANGE HAVE BEEN WRITTEN OUT
  1408				; AT LEAST ONCE, AND ALL THE PCBS WHICH HAD IO IN PROGRESS HAVE
  1409				; BEEN WRITTEN OUT ONCE AFTER THAT IO STOPPED. WE CAN NOW SAFELY
  1410				; SAY THAT ALL INFORMATION (RIBS, SATS, UFD ENTRIES) FOR THE FILE
  1411				; ARE ON THE DISK.
  1412	001722'	205300	001672*	CLRAC0:	MOVSI	T1,ATPALC
  1413	001723'	412315	001675*		ANDCAM	T1,ATBLCW(P2)	;CLEAR IT AND
  1414	001724'	260040	001726'		PUSHJ	P,UPDUF0	;UPDATE THE UFD
  1415	001725'	324740	001663*		PJRST	GETCBR		;GET CB BACK FOR CALLER AND RETURN.
  1416								;(NO NEED TO WAIT FOR CLEARED BIT TO MAKE IT BACK TO DISK.)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 29
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1417				;ROUTINE TO UPDATE A UFD ENTRY FROM ATB INFORMATION
  1418				; CAL WITH CB AT UPDUF0 OR WITHOUT AT UPDUFD
  1419				; USES T1-T3, %RIB.
  1420				; EXPECTS ATB ADDRESS IN P2, DDB ADDRESS IN F.
  1421
  1422	001726'	260040	001674*	UPDUF0:	PUSHJ	P,GIVCBR	;GIVE BACK CB CALLER SHOULD HAVE HAD.
  1423	001727'	261040	000017	UPDUFD:	PUSH	P,P4		;SVE THIS
  1424	001730'	261040	000011		PUSH	P,T4		;MUST SAVE THIS TOO.
  1425	001731'	554744	001664*		HLRZ	P4,DEVATB(F)	;GET DRB ADDRESS
  1426	001732'	260040	001533*		PUSHJ	P,RIBDIR	;GET UFD RIB IN %RIB
  1427	001733'	254000	001757'		  JRST	UPDNUR		;NO UFD RIB, MUST CALL RELLOK
  1428	001734'	261040	000016		PUSH	P,P3		;SAVE P3
  1429	001735'	550715	001710*		HRRZ	P3,ATBFNB(P2)	;GET FNB ADDRESS
  1430	001736'	135300	000000*		LDB	T1,FNYUFP	;GET POINTER TO THE UFD ENTRY
  1431	001737'	661000	000020		TLO	S,IO		;NEED TO WRITE INTO IT
  1432	001740'	621000	000000*		TLZ	S,IOSRIB	;NOTHING IN %RIB, SO USE IT, NOT %RB2
  1433	001741'	260040	000000*		PUSHJ	P,DIRBLK	;GET PAGE OF THE UFD THAT ENTRY IS IN
  1434					  PJSP	T1,[POP P,P3	;RESTORE P3
  1435	001742'	265300	006111'			    JRST UPDNU1] ;AND GO SAY MUST DO SLOW DSKCLN.
  1436	001743'	260040	000000*		PUSHJ	P,DIRSRC	;OK, GET ENTRY ADDRESS IN T2
  1437	001744'	254000	001751'		  JRST	UPDUF1		;HAVE IT
  1438				;P035/D06 - The only way to get to UPDUFD is if the file was not marked for
  1439				;           deletion last time we checked.  If someone (such as MAILER)
  1440				;           deleted the file while we where in the page fault from RIBDIR
  1441				;           or from DIRSRC, then we should ignore this file.
  1442	001745'	200315	001513*		MOVE	T1,ATBSTS(P2)	;Could not find file, check its ATB status
  1443	001746'	602300	001415*		TRNE	T1,ATPDEL	;This bit wasn't set when we started, if
  1444	001747'	254000	001752'		 JRST	UPDUF2		; now set, then file went away
  1445	001750'	256000	006113'		 STOPCD (.,DISK,UFDER1,,<UFD error - file disappeared>)
  1446				 ;;UPDUFD+16
  1447
  1448	001751'	260040	001545'	UPDUF1:	PUSHJ	P,CREUFD	;OK, UPDATE UFD IF NECESSARY
  1449	001752'	260040	001544*	UPDUF2:	PUSHJ	P,RELLOK	;GET RID OF IT NOW
  1450	001753'	262040	000016		POP	P,P3		;RESTORE P3 AND
  1451	001754'	262040	000011		POP	P,T4		; T4
  1452	001755'	262040	000017		POP	P,P4
  1453	001756'	263040	000000		POPJ	P,		;AND RETURN. (DON'T PJRST, RELLOK SMASHES T4.)
  1454
  1455	001757'	260040	001752*	UPDNUR:	PUSHJ	P,RELLOK
  1456	001760'	262040	000011	UPDNU1:	POP	P,T4
  1457	001761'	262040	000017		POP	P,P4		;RESTORE THIS.
  1458					 STOPCD (.+1,INFO,BADUFD,DSKCLN##,<Inconsistent UFD - FULL DSKCLN requested>);;UPDNU1+3
  1459	001762'	256000	006116'
  1460	001763'	263040	000000		POPJ	P,
  1461
  1462				;ROUTINE TO SET FNBALT. EXPECTS LIVE DDB IN F (RH(DEVATB) SETUP)
  1463				; PRESERVES T1, USES T2 AND T3.
  1464				; DON'T NEED CB, SINCE FILE SHOULD HAVE ATPMXU ON, PREVENTING
  1465				; SOMEONE ELSE FROM DELETING IT OUT FROM UNDER US (EITHER ITS
  1466				; ALREADY DELETED (TRUNCATING RENAME) OR IT IS STILL IN UFD.
  1467
  1468	001764'	261040	000006	SETALT::PUSH	P,T1		;PRESERVE T1
  1469	001765'	261040	000015		PUSH	P,P2		;SAVE P2 ALSO
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 29-2
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1470	001766'	550644	001731*		HRRZ	P2,DEVATB(F)	;GET ATB IN P2
  1471	001767'	550315	001735*		HRRZ	T1,ATBFNB(P2)	;GET FNB
  1472	001770'	200406	001712*		MOVE	T3,FNBRIB(T1)	;GET POINTER
  1473	001771'	200340	001720*		MOVE	T2,PCDTIM	;GET READY IN CASE THIS IS FILE IN UFD
  1474	001772'	316415	001711*		CAMN	T3,ATBRIB(P2)	;IS THIS THE FILE IN THE UFD?
  1475	001773'	202346	001714*		MOVEM	T2,FNBALT(T1)	;YES, MAKE COUNT >= TO WHAT IT WAS
  1476	001774'	262040	000015		POP	P,P2		;RESTORE
  1477	001775'	254000	000643*		JRST	TPOPJ		;AND RETURN.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 30
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1478				;RELEASE UUO
  1479	001776'	260040	000155*	DSKREL:	PUSHJ	P,WAIT1		;WAIT FOR I/O TO STOP
  1480	001777'	200100	000000*		MOVE 	J,JOB
  1481	002000'	260040	001222*		PUSHJ	P,SIMRLS	;FIX SIMIO DATA BASE (DO THIS
  1482								;HERE FOR SUPERIO)
  1483	002001'	661200	000020		TLO	F,RESETB	;INDICATE RESET IN PROGRESS
  1484	002002'	260040	001007'		PUSHJ	P,CLOSIN	;CLOSE INPUT (IF NOT ALREADY DONE)
  1485	002003'	260040	001216'		PUSHJ	P,CLOSOU	;CLOSE OUTPUT (DITTO)
  1486	002004'	621200	000020		TLZ	F,RESETB	;RESET BIT
  1487	002005'	402004	000015		SETZM	DEVFIL(F)	;INDICATE FILE RELEASED
  1488	002006'	402004	000164*		SETZM 	DEVPOS(F)	;FOR GOOD MEASURE, MARK BAD POSITION
  1489	002007'	402004	000017		SETZM DEVPPN(F)
  1490	002010'	621000	000000*		TLZ S,IOSUPR
  1491	002011'	324740	001010*		PJRST STOIOS
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 31
FILUUO.MAC	19-SEP-89 19:52		CLOSE

  1492				;THIS ROUTINE IS AN ERROR CHECKING ROUTINE CALLED AT THE START
  1493				;OF VARIOUS UUO'S. IT INSERTS A NEW RETURN ON THE PUSH-DOWN
  1494				;LIST WHICH WILL CHECK TO SEE THAT RESOURCES HAVE BEEN RELEASED.
  1495
  1496	002012'	262041	000000	TSTRES:	POP P,(P)	;CALLED WITH PUSHJ GET STACK DECED
  1497	002013'	260061	000001		PUSHJ P,@1(P)	;NOW CALL USING OLD RETURN ADDRESS
  1498	002014'	334000	000000		 SKIPA
  1499	002015'	350001	000000		AOS (P)		;SKIP RETURN
  1500	002016'	261040	000006		PUSH P,T1
  1501	002017'	200300	001777*		MOVE T1,JOB
  1502	002020'	312300	000000*		CAME T1,CBUSER	;SEE IF JOB HAS CB
  1503	002021'	332006	000000*		SKIPE QUEPCB(T1)	;OR A DIRECTORY
  1504	002022'	256000	006122'	UUOXWR:: STOPCD (.,DISK,UUOXWR,,<UUO eXit with Resources still owned>);;TSTRES+10
  1505	002023'	336000	000000*		SKIPN %UPT+UPTRIB	;NO BLOCKS LOCKED
  1506	002024'	332000	000000*		SKIPE %UPT+UPTRB2
  1507	002025'	256000	002022'		 STOPCD (,XCT,UUOXWR)
  1508					;;TSTRES+13
  1509	002026'	332000	000000*		SKIPE %UPT+UPTSAT
  1510	002027'	256000	002022'		 STOPCD (,XCT,UUOXWR)
  1511					;;TSTRES+15
  1512	002030'	254000	001775*		JRST TPOPJ
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 32
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1513				SUBTTL	LOOKUP
  1514
  1515				;LOOKUP
  1516	002031'	260040	002012'	ULOOK:	PUSHJ P,TSTRES	;MAKE SURE WE EVENTUALLY GIVE ALL BACK
  1517	002032'	607000	002010*		TLNN	S,IOSUPR
  1518	002033'	603200	020000		TLNE F,ENTRB
  1519	002034'	254000	005112'		JRST LUKER1	;CAN NOT DO LOOKUP AFTER ENTER
  1520	002035'	260040	001221*		NOCHARGE
  1521	002036'	260040	003510'		PUSHJ P,LKSET	;CHARGE 1 LOOKUP
  1522	002037'	260040	003040'		PUSHJ P,CHKARG	;CHECK ARGUMENT LIST
  1523	002040'	254000	005110'		 JRST ILNMER	;BAD NAME (ACTUALLY EXTENDED WITH SMALL COUNT)
  1524	002041'	661540	400000		TLO M,UUOLUK	;SET FOR LOOKUP
  1525	002042'	260040	003122'		PUSHJ P,SETFIL	;GET FILE NAME STORED
  1526	002043'	254000	005110'		 JRST ILNMER	;BAD NAME
  1527	002044'	201300	000005		MOVEI T1,DECSTP
  1528	002045'	137300	001472*		DPB T1,DEYSTC
  1529	002046'	554304	000016		HLRZ T1,DEVEXT(F)	;SEE IF UFD
  1530	002047'	603540	200000		TLNE M,EXTUUO		;ONLY ON EXTENDED UUO
  1531	002050'	302300	654644		CAIE T1,'UFD'
  1532	002051'	254000	002063'		JRST ULOOK2		;NOT EXTENDED OR NOT UFD
  1533	002052'	200304	000017		MOVE T1,DEVPPN(F)
  1534	002053'	312300	000767*		CAME T1,MFDPPN
  1535	002054'	254000	002063'		JRST ULOOK2
  1536	002055'	200304	000015		MOVE T1,DEVFIL(F)
  1537	002056'	603300	777777		TLNE T1,-1		;IS L.H. 0
  1538	002057'	254000	002063'		JRST ULOOK2		;NO
  1539	002060'	260040	003242'		PUSHJ P,LOKLUD		;GET USER NAME TO PPN
  1540	002061'	202304	000015		MOVEM T1,DEVFIL(F)
  1541	002062'	705313	000002		UMOVEM T1,UUXNAM(M)
  1542	002063'	607540	200000	ULOOK2:	TLNN M,EXTUUO	;CHECK FOR MULTIPLE EXTENSION LOOKUP
  1543	002064'	254000	002071'		JRST ULOOK3	;CAN NOT BE
  1544	002065'	704313	000000		UMOVE T1,(M)
  1545	002066'	606300	400000		TRNN T1,400000
  1546	002067'	254000	002071'		JRST ULOOK3	;THAT WAS THE FLAG
  1547
  1548				COMMENT ! DISABLE FANCY LOOKUP FEATURE 16 NOV 77 AAA.
  1549					(GIVE ERROR 0 IF FANCY LOOKUP SPECIFIED) !
  1550	002070'	254000	005110'		JRST ILNMER
  1551				COMMENT !
  1552				;PROCESS FANCY (MULTIPLE EXTENSION) LOOKUP. READ USER ARGUMENT
  1553				;POINTED AT BY USER'S EXTENSION WORD, NOW IN DEVEXT(F).
  1554				;DEVEXT(F)/     USER BLOCK,,0		USER BLOCK/  N
  1555				;					          / EXT 1
  1556				;						  / EXT 2
  1557				;						...ETC...
  1558				;						  / EXT N
  1559
  1560					HLRZ P2,DEVEXT(F)	;THIS IS THE CORE TABLE OF EXTENSIONS
  1561					UMOVE T2,(P2)
  1562					CAIGE T2,1000
  1563					CAIG T2,0	;DON'T ALLOW TOO MANY
  1564					JRST ERRLKM
  1565					MOVE T1,P2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 32-2
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1566					ADD T1,T2
  1567					UMOVE T1,(T1)	;TRY TO READ IT SO WE FAULT NOW
  1568FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 33
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1569				;PROCESS FANCY LOOKUP
  1570					HRL P2,T2	;P2/ USER COUNT,,USER ADDR
  1571					ADDI T2,1	;NEED <USER COUNT>EXTENSION WDS+1 COUNT WD
  1572					HRLZ P3,T2	;P3/WDS BEING ALLOCATED,,0
  1573					PUSHJ P,GETWDS	;TAKE T2/WDS NEEDED. RETURN T1/LOC FREECORE
  1574					 JRST ERRNET	;NOT AVAILABLE
  1575					HRR P3,T1	;P3/SIZE EXTBLOCK,,ADDR EXTBLOCK
  1576					SETZM (T1)	;EXTBLOCK[0]_COUNT OF DISTINCT EXT'S SEEN
  1577					HLRZ T2,P2	;T2/USER COUNT
  1578					MOVNS T2	;T2/-USER COUNT
  1579					HRLM T1,DEVEXT(F)	;DEVEXT(F)/EXTBLOCK ADDR,,0
  1580					HRLM T2,P2	;P2/-USER COUNT,,USER ADDR SEE ULK2A
  1581					UMOVE T2,1(P2)
  1582					AOJA T1,ULK2D	;GO STORE IN MONITOR CORE
  1583				;ULK2C - ULK2A:  PICK UP EXTENSIONS FROM USER BLOCK
  1584				;AND CHECK TO SEE THAT THEY'RE NOT ALREADY IN MONITOR EXTBLOCK
  1585				;(DON'T REPEAT IF USER REPEATS AN EXT). INCREMENT EXTBLOCK
  1586				;CONTROL COUNT FOR EACH DISTINCT EXT SEEN.
  1587				;T1/EXTBLOCK ADDR	T2/GET USER EXT		T3/TEST EXTBLOCK EXT
  1588				;P2/USER AOBJN		P3/SIZE,,ADDR OF EXTBLOCK[0] CONTROL WORD
  1589
  1590				ULK2C:	 XCTBU <HLLZ T2,1(P2)>	;NORMAL LOOP. NEXT EXT
  1591					MOVEI T3,1(P3)	;POINT TO MONITOR CORE
  1592				ULK2B:	CAMN T2,(T3)	;HAVE WE SEEN THIS EXT BEFORE?
  1593					JRST ULK2A	;YES, SKIP IT
  1594					CAIE T3,(T1)	;HAVE WE LOOKED AT ALL OF THEM?
  1595					AOJA T3,ULK2B	;NO, CONTINUE
  1596					ADDI T1,1	;THIS ONE IS NEW, STORE IT
  1597				ULK2D:	AOS (P3)	;COUNT ONE MORE
  1598					HLLZM T2,(T1)	;AND STORE EXTENSION
  1599				ULK2A:	AOBJN P2,ULK2C	;ANY MORE FROM USER?
  1600
  1601
  1602							;FINISHED ALL USER BLOCK.
  1603					MOVN T2,(P3)	;T2/-COUNT DISTINCT EXTENSIONS
  1604					HRLM T2,(P3)	;EXTBLOCK[0]_-COUNT,,COUNT FOR SRCFIL
  1605					TLO M,UUOMLK	;SET FLAG
  1606				;******************************************************
  1607					PUSHJ P,SRCFIL	;GO FIND FILE. P1-P4 PRESERVED
  1608					 SKIPA		;NO FILE
  1609					JRST FOUND0
  1610				;PASS SRCFIL THE FOLLOWING ARGUMENT:
  1611				;DEVEXT(F)/ FREECORE EXTBLOCK,,0
  1612				;FREECORE EXTBLOCK/ -COUNT,,COUNT
  1613				;		  / EXTENSION,,0
  1614				;		  / EXTENSION,,0
  1615				; ETC.
  1616				;( COUNT IS THE NUMBER OF UNIQUE EXTENSIONS PRESENT, NOT THE
  1617				;  SIZE OF THE FREECORE AREA ALLOCATED. THAT IS IN P3, FOR
  1618				;  CLNML.  COUNT MAY BE ALTERED BY SRCFIL AS IT FINDS NX FILES,
  1619				;  ETC.)
  1620				;********************************************************
  1621					PUSHJ P,CLNML	;RETURN FREE CORE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 33-2
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1622					JRST STRERZ	;AND GIVE ERROR
  1623
  1624				CLNML:	;RETURN EXTBLOCK FREECORE. EXPECTS
  1625					;P3/SIZE OF EXTBLOCK,,ADDR EXTBLOCK
  1626					;DESTROYS T2
  1627					PUSH P,T1
  1628					HRRZ T2,P3	;T2/ADDR FREECORE
  1629					HLRZ T1,P3	;T1/SIZE
  1630					PUSHJ P,GIVWDS	;EXPECTS T1,T2
  1631					JRST TPOPJ
  1632
  1633				FOUND0:	PUSHJ P,CLNML
  1634					HLL T1,DEVEXT(F)
  1635					XCTBU <HLLM T1,UUXEXT(M)>	;RETURN TO USER
  1636					JRST FOUND
  1637
  1638				END FANCY LOOKUP !
  1639
  1640				;PROCESS ORDINARY SINGLE-EXTENSION LOOKUP. M/ UUOMLK IS OFF
  1641				; AND DEVEXT(F)/EXTENSION,,0
  1642
  1643	002071'	260040	000000*	ULOOK3:	PUSHJ P,SRCFIL
  1644	002072'	254000	005163'		 JRST STRERZ
  1645	002073'	621000	001740*		TLZ	S,IOSRIB	;CLEAR DUMB FLAG.
  1646							;FALL INTO FOUND
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 34
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1647				;HERE WHEN FILE NAME IS FOUND ON LOOKUP
  1648	002074'	550644	001766*	FOUND:	HRRZ P2,DEVATB(F)	;GET ATB LOCATION
  1649	002075'	554744	001535*		HLRZ P4,DEVDRB(F)	;AND DRB
  1650	002076'	201300	000000*		MOVEI T1,FNCLOK
  1651	002077'	260040	000000*		PUSHJ P,CHKPRV
  1652	002100'	254000	005143'		 JRST LKER1		;CAN NOT REALLY DO THE LOOKUP
  1653	002101'	201300	000000*		MOVEI T1,FNCRED		;CAN LOOKUP, NOW CHECK READ
  1654	002102'	603200	000010		TLNE F,GETB		;IF FROM GET OR RUN
  1655	002103'	201300	000000*		MOVEI T1,FNCEXC		;THEN EXECUTE IS ENOUGH
  1656	002104'	260040	002077*		PUSHJ P,CHKPRV
  1657	002105'	334000	000000		SKIPA
  1658	002106'	254000	002111'		JRST FNDROK		;OK TO READ
  1659	002107'	205300	000000*		MOVSI T1,NORED
  1660	002110'	436304	000007		IORM T1,DEVIAD(F)
  1661	002111'	607200	000010	FNDROK:	TLNN F,GETB		;IS IT A GET OR RUN??
  1662	002112'	254000	002122'		JRST FNDNGT		;NO
  1663	002113'	201300	002101*		MOVEI T1,FNCRED	;SEE IF HE CAN READ
  1664	002114'	260040	002104*		PUSHJ P,CHKPRV
  1665	002115'	334000	000000		SKIPA			;NO, EXECUTE ONLY
  1666	002116'	254000	002122'		JRST FNDNGT
  1667	002117'	201300	004000		MOVEI T1,PVEXOG
  1668	002120'	135340	000561*		LDB T2,PJOBN
  1669	002121'	436307	000000*		IORM T1,JBTPRV(T2)	;SET GOT EX ONLY R BIT
  1670	002122'	603540	200000	FNDNGT:	TLNE	M,EXTUUO	;EXTENDED M?
  1671	002123'	254000	002140'		JRST FOUND2	;YES
  1672	002124'	200315	001315*		MOVE T1,ATBSIZ(P2)
  1673	002125'	303300	400000		CAILE T1,400000	;TOO BIG TO REPORT WORDS?
  1674					JRST	[LSH T1,W2BLSH	;YES, JUST REPORT BLOCKS
  1675	002126'	254000	006125'			JRST FOUND1]
  1676	002127'	602300	000177		TRNE T1,177	;CORRECT FOR ADJUST MENT TO BLOCK FIELD
  1677	002130'	275300	000200		SUBI T1,200
  1678	002131'	213000	000006		MOVNS T1
  1679	002132'	256200	006127'	FOUND1:	 XCTTU <HRLZM T1,UUNPPN(M)>	;GIVE USER SIZE
  1680	002133'	200315	001350*		MOVE T1,ATBPVW(P2)	;GET PRIVS, ETC
  1681	002134'	705313	000002		UMOVEM T1,UUNATT(M)	;AND GIVE TO USER
  1682	002135'	554315	001327*		HLRZ T1,ATBMSC(P2)	;ACCESS DATE
  1683	002136'	256200	006130'		XCTBU <HRRM T1,UUNEXT(M)>
  1684	002137'	254000	002156'		JRST FOUND3	;FINISH UP
  1685
  1686				;HERE WHEN FILE IS FOUND FOR AN EXTENDED LOOKUP
  1687	002140'	554315	002135*	FOUND2:	HLRZ	T1,ATBMSC(P2)	;ACCESS DATE
  1688	002141'	256200	006131'		XCTBU <HRRM T1,UUXEXT(M)>	;AND ACCESS DATE
  1689	002142'	305600	000004		CAIGE	P1,UUXPRV		;STORE VALUES?
  1690	002143'	254000	002156'		JRST	FOUND3		;NO. FINISH UP
  1691	002144'	200315	002133*		MOVE	T1,ATBPVW(P2)	;PRIVILEGES WORD
  1692	002145'	705313	000004		UMOVEM T1,UUXPRV(M)	;GIVE PRIVS TO USER
  1693	002146'	305600	000005		CAIGE P1,UUXSIZ
  1694	002147'	254000	002156'		JRST FOUND3
  1695	002150'	200315	002124*		MOVE T1,ATBSIZ(P2)
  1696	002151'	602300	000177		TRNE T1,177
  1697	002152'	275300	000200		SUBI T1,200	;CORRECT FOR BLOCK ADJUSTMENT
  1698	002153'	705313	000005		UMOVEM	T1,UUXSIZ(M)		;YES. SAVE IT
  1699	002154'	303600	000005		CAILE	P1,UUXSIZ	;NEED MORE VALUES?
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 34-2
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1700	002155'	254000	002160'		JRST FOUND4	;YES. GO READ RIB
  1701
  1702				;HERE TO FINISH UP A LOOKUP IF THE RIB DOESN'T HAVE TO BE READ
  1703	002156'	621000	000020	FOUND3:	TLZ S,IO
  1704	002157'	254000	002175'		JRST FOUND8
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 35
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1705				;HERE WHEN USER WANTS MORE VALUES THAN ARE STORED IN ACCESS TABLE
  1706				;READ RIB (IF IT ISN'T ALREADY IN CORE)
  1707	002160'	621000	000020	FOUND4:	TLZ	S,IO		;NO MORE NEED TO WRITE IN RIB.
  1708	002161'	332020	000000*		SKIPE	@%RIB.C+%CTUPT	;DO WE HAVE THE RIB?
  1709	002162'	254000	002165'		JRST	FOUND5		;YES.
  1710	002163'	260040	000000*		PUSHJ	P,RIBRDL	;NO.
  1711	002164'	254000	002175'		JRST	FOUND8		;SOMETHING WRONG WITH RIB
  1712
  1713				;HERE WITH FILE RIB IN CORE
  1714	002165'	275600	000005	FOUND5:	SUBI P1,UUXVER-1	;NUMBER MORE TO TRANSFER
  1715	002166'	213000	000014		MOVNS P1
  1716	002167'	507000	000014		HRLS P1
  1717	002170'	541600	000006		HRRI P1,UUXVER
  1718	002171'	661540	000014		TLO M,P1		;FORCE INDEXING FOR M.
  1719	002172'	256014	002177'		XCT TUTAB-UUXVER(P1)	;XCT FOR SPECIAL ARGS
  1720	002173'	705320	000013		UMOVEM T1,@M
  1721	002174'	253600	002172'		AOBJN P1,.-2
  1722				    ;HERE WHEN VALUES SET UP, OR NO NEED TO DO SO,  OR COULDN'T
  1723				    ;GET GOOD RIB TO DO SO.
  1724	002175'	260040	001467*	FOUND8:	PUSHJ P,INVDDB	;INVALIDATE DDB AREA, SET FILE LOC TO START.
  1725	002176'	261040	000003		PUSH	P,PG		;SAVE PG.
  1726	002177'	260040	000336*		PUSHJ	P,RELRIB	;GET RID OF RIB IF WE HAVE IT.
  1727	002200'	262040	000003		POP	P,PG		;
  1728	002201'	201300	000001		MOVEI T1,DECLUK
  1729	002202'	137300	002045*		DPB T1,DEYSTC
  1730	002203'	202004	000002		MOVEM S,DEVIOS(F)
  1731	002204'	324740	001000*		PJRST CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 36
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1732				;TABLE FOR LOADING ARGUMENTS TO RETURN TO USER
  1733
  1734				;To User from RIB (LOOKUP), FUTAB is From User (ENTER)
  1735	002205'	200300	376000*	TUTAB:	MOVE T1,%RIB+RIBVER	;RIBVER
  1736	002206'	200300	376000*		MOVE T1,%RIB+RIBFUT
  1737	002207'	200300	376000*		MOVE T1,%RIB+RIBEST
  1738	002210'	260040	002240'		PUSHJ P,CLCALC		;SPECIAL FOR ALLOCATED
  1739	002211'	200300	376000*		MOVE T1,%RIB+RIBPOS
  1740	002212'	200300	376000*		MOVE T1,%RIB+RIBFT1
  1741	002213'	200300	376000*		MOVE T1,%RIB+RIBLCW
  1742	002214'	200300	376000*		MOVE T1,%RIB+RIBMTA
  1743	002215'	200300	376000*		MOVE T1,%RIB+RIBDEV
  1744	002216'	200300	376000*		MOVE T1,%RIB+RIBSTS
  1745	002217'	200300	376000*		MOVE T1,%RIB+RIBELB
  1746	002220'	200300	376000*		MOVE T1,%RIB+RIBXT1
  1747	002221'	200300	376000*		MOVE T1,%RIB+RIBQTF
  1748	002222'	200300	376000*		MOVE T1,%RIB+RIBQTO
  1749	002223'	260040	002244'		PUSHJ P,CLCMXA		;IF DIRECTORY, SPECIAL
  1750	002224'	260040	002267'		PUSHJ P,CLCUSD		;ALSO
  1751	002225'	200300	376000*		MOVE T1,%RIB+RIBAUT
  1752	002226'	200300	376000*		MOVE T1,%RIB+RIBUNM
  1753	002227'	200300	376000*		MOVE T1,%RIB+RIBUN1
  1754	002230'	200300	376000*		MOVE T1,%RIB+RIBTRU
  1755	002231'	200300	376000*		MOVE T1,%RIB+RIBXT2
  1756	002232'	200315	001654*		MOVE T1,ATBALP(P2)
  1757	002233'	200300	376000*		MOVE T1,%RIB+RIBSNM
  1758	002234'	200300	376000*		MOVE T1,%RIB+RIBPJC	;PROJECT CODE
  1759	002235'	200300	376000*		MOVE T1,%RIB+RIBPJ1	;-
  1760	002236'	200300	376000*		MOVE T1,%RIB+RIBPJ2	;-
  1761	002237'	200300	376000*		MOVE T1,%RIB+RIBPID	;PROCESSOR ID
  1762
  1763	002240'	135300	000000*	CLCALC:	LDB T1,ATYBLK	;GET NUMBER OF BLOCKS IN FILE (TO EOF)
  1764	002241'	315300	376000*		CAMGE T1,%RIB+RIBALC
  1765	002242'	200300	376000*		MOVE T1,%RIB+RIBALC	;GET LARGEST REQUEST
  1766	002243'	263040	000000		POPJ P,
  1767
  1768	002244'	201300	001451*	CLCMXA:	MOVEI T1,ATPDIR
  1769	002245'	616315	001745*		TDNN T1,ATBSTS(P2)
  1770	002246'	254000	002264'		JRST MXACL1
  1771	002247'	260040	001725*		PUSHJ P,GETCBR
  1772	002250'	200304	000015		MOVE T1,DEVFIL(F)
  1773	002251'	554340	000265*		HLRZ T2,SYSDRB	;WHERE TO START AND NO CREATE
  1774	002252'	211400	000001		MOVNI T3,1	;SET T3 NEG SO NO NEW BLOCK
  1775	002253'	260040	000202*		PUSHJ P,SRCNAM
  1776	002254'	254000	002263'		 JRST MXACL2	;JUST USE IT FROM RIB
  1777	002255'	336007	001460*		SKIPN DRBRIB(T2)
  1778	002256'	254000	002263'		JRST MXACL2	;ALSO IF RIB NOT READ YET
  1779	002257'	200700	000007		MOVE P3,T2	;FOR RIBUSD
  1780	002260'	210316	001542*		MOVN T1,DRBMXA(P3)
  1781	002261'	270300	376000*		ADD T1,%RIB+RIBQTF
  1782	002262'	324740	001726*		PJRST GIVCBR
  1783
  1784	002263'	260040	002262*	MXACL2:	PUSHJ P,GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 36-2
FILUUO.MAC	19-SEP-89 19:52		LOOKUP

  1785	002264'	201700	000000	MXACL1:	MOVEI P3,0	;FOR RIBUSD IF WANTED
  1786	002265'	200300	376000*		MOVE T1,%RIB+RIBMXA
  1787	002266'	263040	000000		POPJ P,
  1788
  1789	002267'	332000	000016	CLCUSD:	SKIPE P3
  1790	002270'	334300	376000*		SKIPA T1,%RIB+RIBQTF
  1791	002271'	334300	376000*		SKIPA T1,%RIB+RIBUSD	;JUST GET ARG FROM RIB
  1792	002272'	274316	001537*		SUB T1,DRBALC(P3)
  1793	002273'	263040	000000		POPJ P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 37
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1794				SUBTTL	ENTER
  1795
  1796
  1797				COMMENT ! ROUTINE UENTR - DISPATCH HERE FROM DSKDSP
  1798				CALL:	HRRZ AC,DEVSER(F)
  1799					PUSHJ P,DEN(AC)
  1800					RETURN HERE FAILURE
  1801					SUCCESS
  1802				!
  1803	002274'	260040	002035*	UENTR:	NOCHARGE
  1804	002275'	260040	002012'		PUSHJ	P,TSTRES
  1805	002276'	603000	002032*		TLNE	S,IOSUPR		;Check if supersede
  1806	002277'	254000	005112'		 JRST	LUKER1
  1807	002300'	260040	003517'		PUSHJ	P,ERNSET		;CHARGE 1 ENTER
  1808	002301'	260040	000000*		PUSHJ	P,SIMENT##		;DEAL WITH SIMIO DATA BASE
  1809	002302'	603200	040000		TLNE	F,LOOKB			;LOOKUP IN FORCE?
  1810	002303'	254000	002567'		 JRST	UPDATE			;YES. UPDATE
  1811	002304'	260040	003040'		PUSHJ	P,CHKARG		;NO. SET M FOR ENTER
  1812	002305'	254000	005110'		  JRST	ILNMER			;BAD NAME - ERROR
  1813	002306'	661540	040000		TLO	M,UUOENT		;INDICATE ENTER
  1814	002307'	260040	003122'		PUSHJ	P,SETFIL		;SET UP FILE NAME
  1815	002310'	254000	005110'		  JRST	ILNMER
  1816	002311'	201300	000005		MOVEI	T1,DECSTP
  1817	002312'	137300	002202*		DPB	T1,DEYSTC
  1818	002313'	260040	002071*		PUSHJ	P,SRCFIL		;SEARCH FOR MATCH, SET A.T.
  1819	002314'	254000	005163'		  JRST	STRERZ			;ERROR
  1820	002315'	550644	002074*		HRRZ	P2,DEVATB(F)		;LOC OF A.T.
  1821	002316'	554744	002075*		HLRZ	P4,DEVDRB(F)
  1822	002317'	200355	002245*		MOVE	T2,ATBSTS(P2)
  1823	002320'	201300	000000*		MOVEI	T1,FNCCRE
  1824	002321'	606340	001365*		TRNN	T2,ATPCRE
  1825	002322'	201300	000000*		 MOVEI	T1,FNCSUP		;CHECK SUP OR CRE
  1826	002323'	606340	000000*		TRNN	T2,ATPNDL		;IF NO DELETE SET, FORGET IT
  1827	002324'	260040	002114*		 PUSHJ	P,CHKPRV
  1828	002325'	254000	005152'		  JRST	ENTER1			;CAN NOT DO IT
  1829	002326'	331017	002272*		SKIPL	DRBALC(P4)		;See if room in this UFD
  1830				PRINTF(<[UENTR++ ROOM ON DSK?  DRBALC(P4) + SKIPG STRTAL(DRBSTR(P4))]>)
  1831	002327'	337000	000000*		SKIPG	STRDDB+STRTAL		;AND IF ROOM ON DISK
  1832	002330'	254000	005155'		 JRST	ENTER2			;NO ROOM
  1833	002331'	336304	000000*		SKIPN	T1,DEV1UN(F)		;SPECIAL UNIT STUFF?
  1834	002332'	254000	002335'		 JRST	.+3			;NO.
  1835	002333'	337006	000000*		SKIPG	UNITAL(T1)		;YES, ROOM ON SPECIAL UNIT?
  1836	002334'	254000	005155'		 JRST	ENTER2			;NO.
  1837	002335'	402015	002150*		SETZM	ATBSIZ(P2)
  1838	002336'	402015	002232*		SETZM	ATBALP(P2)		;FORCE TO ZERO
  1839	002337'	550404	002315*		HRRZ	T3,DEVATB(F)		;T3/ ATB ADDR OR 0 IF NO ATB.
  1840	002340'	201300	000000*		MOVEI	T1,FBIT##		;(Used to call GETAPG before P035/B02)
  1841	002341'	260040	000000*		PUSHJ	P,GETUPG##		;Get a page from unit with most space
  1842	002342'	254000	005155'		  JRST	ENTER2			;Couldn't get page to build the RIB
  1843	002343'	202355	001772*		MOVEM	T2,ATBRIB(P2)
  1844	002344'	200300	000007		MOVE	T1,T2
  1845	002345'	201140	000345*		MOVEI	PG,%RIB.C
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 37-2
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1846	002346'	260040	000000*		PUSHJ	P,MAPWLN
  1847	002347'	402000	376000		SETZM	%RIB
  1848	002350'	200300	006132'		MOVE	T1,[%RIB,,%RIB+1]
  1849	002351'	251300	376777		BLT	T1,%RIB+777		;ZERO ENTIRE RIB
  1850	002352'	201300	000000*		MOVEI	T1,RIPSPP
  1851	002353'	135340	002120*		LDB	T2,PJOBN
  1852	002354'	200347	001001*		MOVE	T2,JBTPPN(T2)
  1853	002355'	316344	000017		CAMN	T2,DEVPPN(F)		;IS IT THE SAME PPN AS CREATOR
  1854	002356'	436300	376000*		 IORM	T1,%RIB+RIBSTS		;YES, SET BIT
  1855	002357'	553015	002140*		HRRZS	ATBMSC(P2)
  1856	002360'	201300	002244*		MOVEI	T1,ATPDIR
  1857	002361'	603540	020000		TLNE	M,UUOUFD
  1858	002362'	436315	002317*		 IORM	T1,ATBSTS(P2)
  1859	002363'	260040	002550'		PUSHJ	P,SAVLIC
  1860	002364'	552315	001652*		HRRZM	T1,ATBLIC(P2)		;PRESERVE WHAT WE CAN
  1861				;-MOVE PJC IN UPT TO RIB EXCEPT ON UFD'S
  1862	002365'	200300	006133'		MOVE	T1,[%UPT+UPTPJC,,%RIB+RIBPJC]	;-
  1863	002366'	607540	020000		TLNN	M,UUOUFD			;-
  1864	002367'	251300	376000*		 BLT	T1,%RIB+RIBPJ2			;-
  1865	002370'	402015	001661*		SETZM	ATBPID(P2)		;CLEAR PID NOW, GETS SETUP AGAIN AT
  1866									; SETVAL IF USER IS ALLOWED
  1867	002371'	402000	376000*		SETZM	%RIB+RIBPID		;ATPPID CLEARED ABOVE, STORED INTO RIBLCW AT SETEN5.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 38
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1868	002372'	260040	003112'		PUSHJ	P,GETEXT
  1869	002373'	242300	777762		LSH	T1,-^D14
  1870	002374'	137300	001642*		DPB	T1,ATYXCD		;SET EXTENDED DATE FIELD
  1871	002375'	201713	000002		MOVEI	P3,UUNATT(M)		;SET P2 TO POINT TO PRV WORD
  1872	002376'	603540	200000		TLNE	M,EXTUUO
  1873	002377'	201713	000004		 MOVEI	P3,UUXPRV(M)
  1874	002400'	603540	200000		TLNE	M,EXTUUO		;IS IT EXTENDED UUO
  1875	002401'	301600	000004		CAIL	P1,UUXPRV		;AND SPECIFIED
  1876	002402'	256200	006134'		 XCTFU	<SKIPA T2,(P3)>		;NOT EXTENDED OR SPECIFIED
  1877	002403'	201340	000000		MOVEI	T2,0			;NOT SPECIFIED, USE 0
  1878	002404'	612340	006135'		TDNE	T2,[37,,-1]		;TIME, DATE GIVEN?
  1879	002405'	254000	002424'		 JRST	SETEN1			;YES
  1880	002406'	135300	002374*		LDB	T1,ATYXCD		;GET EXTENDED DATE
  1881	002407'	326300	002424'		JUMPN	T1,SETEN1		;SINCE IT ALSO COUNTS
  1882	002410'	500700	000007		HLL	P3,T2			;SAVE LEFT HALF OF T2
  1883	002411'	260040	000000*		PUSHJ	P,GETGMT##		;GET T1/TIME T2/DATE
  1884	002412'	200400	000007		MOVE	T3,T2
  1885	002413'	230300	000462*		IDIV	T1,JFYSEC
  1886	002414'	231300	000074		IDIVI 	T1,^D60			;GET SECONDS PART TOO
  1887	002415'	137340	001646*		DPB 	T2,ATYCSC		;SAVE SECONDS PART
  1888	002416'	550340	000010		HRRZ	T2,T3
  1889	002417'	241340	777764		ROT 	T2,-^D12
  1890	002420'	137340	002406*		DPB 	T2,ATYXCD		;SAVE HIGH PART OF DATE
  1891	002421'	241340	000014		ROT 	T2,^D12			;AND GET DATE BACK
  1892	002422'	500340	000016		HLL 	T2,P3			;GET LEFT HALF BACK
  1893	002423'	137300	006136'		DPB	T1,[POINT 11,T2,23]	;STORE TIME IN T2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 39
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1894
  1895	002424'	201400	001371*	SETEN1:	MOVEI	T3,ATPSUP
  1896	002425'	616415	002362*		TDNN	T3,ATBSTS(P2)		;IS IT SUPERSEDE
  1897	002426'	254000	002432'		 JRST	SETEN2			;NO, USE STANDARD IF NO PROT GIVEN
  1898	002427'	205400	777000		MOVSI	T3,777000		;YES, USE OLD IF NO PROT GIVEN
  1899	002430'	404415	000000*		AND	T3,ATBPRV(P2)
  1900	002431'	254000	002435'		JRST	SETEN3
  1901	002432'	603540	020000	SETEN2:	TLNE	M,UUOUFD		;CREATE, SET UP DEFAULT PROT. DIRECTORY FILE?
  1902	002433'	334400	000000*		 SKIPA	T3,UFDPRT		;YES. USE UFD STANDARD PROTECTION
  1903	002434'	200400	000000*		MOVE	T3,STNPRT		;NO. USE REGULAR STANDARD PROTECTION
  1904	002435'	607340	777740	SETEN3:	TLNN	T2,777740		;PROTECTION  ALREADY GIVEN? (OR MODE IF 000 DESIRED)
  1905	002436'	434340	000010		 OR	T2,T3			;NO, SET STANDARD PROTECTION
  1906	002437'	137000	006137'		DPB	S,[POINT 4,T2,12]	;MODE
  1907	002440'	135300	006140'		LDB	T1,[POINT 12,T2,35]	;GET DATE
  1908	002441'	135400	002420*		LDB	T3,ATYXCD
  1909	002442'	137400	006141'		DPB	T3,[POINT 2,T1,23]	;GET ALL OF DATE
  1910	002443'	317300	001322*		CAMG	T1,THSDAT		;IN THE FUTURE?
  1911	002444'	254000	002451'		 JRST	SETN3A			;NO
  1912	002445'	200300	002443*		MOVE	T1,THSDAT
  1913	002446'	137300	006140'		DPB	T1,[POINT 12,T2,35]
  1914	002447'	242300	777764		LSH	T1,-^D12
  1915	002450'	137300	002441*		DPB	T1,ATYXCD		;IN FUTURE, SET TODAY
  1916	002451'	603540	200000	SETN3A:	TLNE	M,EXTUUO		;IF NOT EXTENDED
  1917	002452'	301600	000004		 CAIL	P1,UUXPRV		;SAVE IN USERS AREA
  1918	002453'	705356	000000		  UMOVEM T2,(P3)			; IF HE ASKED FOR IT
  1919	002454'	202355	002144*		MOVEM	T2,ATBPVW(P2)		;SAVE IN AKB
  1920	002455'	607540	200000		TLNN	M,EXTUUO		;EXTENDED M?
  1921	002456'	254000	002463'		 JRST	SETEN4
  1922	002457'	256200	006142'		XCTBU	<HRRZ T4,UUXEXT(M)>
  1923	002460'	405440	037777		ANDI	T4,37777		;GET ONLY ACCESS DATE
  1924	002461'	332000	000011		SKIPE	T4			;IF NONE GIVEN
  1925	002462'	313440	002445*		CAMLE	T4,THSDAT		;OR IF GREATER THAN TODAY
  1926	002463'	200440	002462*	SETEN4:	 MOVE	T4,THSDAT		;USE TODAY'S DATE
  1927	002464'	137440	001326*		DPB	T4,ATYADT		;STORE THE ACCESS DATE
  1928	002465'	200355	002425*		MOVE	T2,ATBSTS(P2)
  1929	002466'	606340	002321*		TRNN	T2,ATPCRE		;IS THIS A CREATE??
  1930	002467'	660440	400000		 TRO	T4,400000		;NO, SET OLD FILE FLAG
  1931	002470'	135340	002450*		LDB	T2,ATYXCD
  1932	002471'	137340	006143'		DPB	T2,[POINT 2,T4,21]	;SAVE EXTENDED DATE INFO
  1933	002472'	607540	200000		TLNN	M,EXTUUO
  1934	002473'	254000	002477'		 JRST	SETN5A			;NOT EXTENDED
  1935	002474'	256200	006144'		XCTBU	<HRRM T4,UUXEXT(M)>	;GIVE ARG TO USER
  1936	002475'	260040	004427'		PUSHJ	P,SETVAL
  1937	002476'	334000	000000		  SKIPA
  1938	002477'	256200	006145'	SETN5A:	 XCTBU	<HRRM T4,UUNEXT(M)>
  1939
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 40
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1940				;HERE WHEN THE RIB BLOCK IS SET UP. INSERT CONSTANT VALUES, WRITE IT
  1941	002500'	200355	002343*	SETEN5:	MOVE	T2,ATBRIB(P2)		;GET RIB POINTER
  1942	002501'	202340	376000*		MOVEM	T2,%RIB+RIBSLF		;SAVE ADR AS LAST WORD OF RIB
  1943	002502'	135400	002353*		LDB	T3,PJOBN		;JOB NUMBER
  1944	002503'	200410	000605*		MOVE	T3,JBTAUN(T3)		;AUTHORS PRJ,PRG NUMBER
  1945	002504'	336000	376000*		SKIPN	%RIB+RIBAUT		;IF NO PRJ,PRG GIVEN
  1946	002505'	202400	376000*		 MOVEM	T3,%RIB+RIBAUT		;STORE USERS PRJ,PRG
  1947	002506'	201400	000000*		MOVEI	T3,CODRIB		;CODE WORD SHOWING THIS BLOCK IS A RIB
  1948	002507'	202400	376000*		MOVEM	T3,%RIB+RIBCOD		;SAVE IN RIB BLOCK
  1949	002510'	201300	000001		MOVEI	T1,1
  1950	002511'	202300	376000*		MOVEM	T1,%RIB+RIBSZS		;SET SPARE RIB SIZE
  1951	002512'	200455	002454*		MOVE	T4,ATBPVW(P2)		;PRIVS, DATE
  1952	002513'	202440	376000*		MOVEM	T4,%RIB+RIBPVW		;SAVE IN RIB
  1953	002514'	200455	001723*		MOVE	T4,ATBLCW(P2)
  1954	002515'	202440	376000*		MOVEM	T4,%RIB+RIBLCW
  1955	002516'	200440	376000*		MOVE	T4,%RIB+RIBSTS
  1956	002517'	661440	000000*		TLO	T4,RIPLOG
  1957	002520'	603540	020000		TLNE	M,UUOUFD		;DIRECTORY FILE?
  1958	002521'	664440	000000*		 TROA	T4,RIPDIR		;YES. SET A BIT IN RIBSTS
  1959	002522'	620440	002521*		 TRZ	T4,RIPDIR		;  ELSE CLEAR IT
  1960	002523'	202440	376000*		MOVEM	T4,%RIB+RIBSTS	
  1961	002524'	120304	000015		DMOVE	T1,DEVFIL(F)		;GET NAME AND EXTENSION
  1962	002525'	544355	002357*		HLR	T2,ATBMSC(P2)		;ACCESS DATE AND EXTENDED DATE
  1963	002526'	124300	376000*		DMOVEM	T1,%RIB+RIBNAM		;TO RIB
  1964	002527'	200304	000017		MOVE	T1,DEVPPN(F)
  1965	002530'	202300	376000*		MOVEM	T1,%RIB+RIBPPN
  1966	002531'	607540	020000		TLNN	M,UUOUFD		;IS THIS A DIRECTORY
  1967	002532'	254000	002542'		 JRST	SETENA			;NO
  1968	002533'	550300	000000*		HRRZ	T1,STRDDB+STRHSH	;MUST PUT A FEW NX PTRS THERE
  1969	002534'	201340	000001		MOVEI	T2,1			;THIS WILL DO
  1970	002535'	202346	375777*		MOVEM	T2,%RIB+RIBPFS-1(T1)
  1971	002536'	367300	002535'		SOJG	T1,.-1
  1972	002537'	550300	000000*		HRRZ	T1,STRDDB+STRHSH
  1973	002540'	221300	001000		IMULI	T1,1000
  1974	002541'	202315	002335*		MOVEM	T1,ATBSIZ(P2)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 41
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1975	002542'	260040	000000*	SETENA:	PUSHJ	P,ZERDDB		;ALL 0 BUT NOT READ RIB BEFORE CREATE PNTRS
  1976	002543'	350001	000000		  AOS	(P)
  1977	002544'	201300	000004		MOVEI	T1,DECENT
  1978	002545'	137300	002312*		DPB	T1,DEYSTC
  1979	002546'	202004	000002		MOVEM	S,DEVIOS(F)
  1980	002547'	254000	001757*		JRST	RELLOK			;NO RELEASE RIB
  1981
  1982				;GET PART OF OLD LICENSE THAT CAN STILL BEE SET ON FILE
  1983
  1984	002550'	135440	002502*	SAVLIC:	LDB	T4,PJOBN		;GET SET TO PRESERVE LICENSE ON SUP
  1985	002551'	510351	001066*		HLLZ	T2,JBTLIC(T4)
  1986	002552'	200411	002354*		MOVE	T3,JBTPPN(T4)
  1987	002553'	430404	000017		XOR	T3,DEVPPN(F)
  1988	002554'	550315	002364*		HRRZ	T1,ATBLIC(P2) 		;WILL BE 0 FOR CRE, OLD FOR SUP OR UPD
  1989	002555'	324740	004757'		PJRST	FILLIC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 42
FILUUO.MAC	19-SEP-89 19:52		ENTER

  1990				;SIMULTANEOUS UPDATE CHANIO COMES HERE.
  1991
  1992	002556'	260040	002274*	USIMUP:	NOCHARGE			;DON'T CHARGE MICROCYCLES
  1993	002557'	260040	002012'		PUSHJ	P,TSTRES		;SETUP STACK FOR RETURN CHECK
  1994	002560'	607200	040000		TLNN	F,LOOKB			;GUY HAD TO DO LOOKUP
  1995	002561'	254000	005112'		  JRST	LUKER1			;HE DIDN'T, ILLEGAL SEQUENCE OF UUOS
  1996	002562'	260040	003517'		PUSHJ	P,ERNSET		;CHARGE ONE ENTER
  1997	002563'	260040	003043'		PUSHJ	P,CHKAG1		;CHECK ARGS, SETUP M
  1998	002564'	254000	005110'		  JRST	ILNMER			;ILLEGAL NAME ERROR
  1999	002565'	661540	004000		TLO	M,UUOSIM		;SET THE FLAG FOR UPDATE
  2000	002566'	254000	002571'		JRST	UPDAT1			;AND JOIN COMMON CODE.
  2001
  2002				;HERE WHEN THE ENTER IS AN UPDATE (LOOKUP ALREADY DONE)
  2003				; OR FROM THE SIMULTANEOUS UPDATE CHANIO, ABOVE, WITH UUOSIM SET.
  2004
  2005	002567'	260040	003043'	UPDATE:	PUSHJ	P,CHKAG1		;CHECK ARGUMENTS NOW
  2006	002570'	254000	005110'		  JRST	ILNMER			;SAY ILLEGAL NAME
  2007	002571'	260040	001776*	UPDAT1:	PUSHJ	P,WAIT1			;WAIT FOR I/O TO STOP
  2008	002572'	260040	002247*		PUSHJ	P,GETCBR
  2009	002573'	260040	003106'		PUSHJ	P,GETNAM
  2010	002574'	312304	000015		CAME	T1,DEVFIL(F)
  2011	002575'	254000	005121'		  JRST	UILNMD			;%  NAME DOES NOT MATCH
  2012	002576'	260040	003112'		PUSHJ	P,GETEXT
  2013	002577'	513000	000006		HLLZS	T1			;% ONLY WANT LEFT HALF
  2014	002600'	510344	000016		HLLZ	T2,DEVEXT(F)
  2015	002601'	312300	000007		CAME	T1,T2
  2016	002602'	254000	005121'		  JRST	UILNMD
  2017	002603'	260040	003116'		PUSHJ	P,GETPPN
  2018	002604'	312304	000017		CAME	T1,DEVPPN(F)
  2019	002605'	254000	005121'		  JRST	UILNMD
  2020	002606'	550644	002337*		HRRZ	P2,DEVATB(F)
  2021	002607'	554744	002316*		HLRZ	P4,DEVDRB(F)		;% LOAD POINTERS FOR PROTECTION CHECK ETC
  2022	002610'	200315	002500*		MOVE	T1,ATBRIB(P2)		;SET UP
  2023	002611'	202304	001426*		MOVEM	T1,DEVRIB(F)		;FOR
  2024	002612'	476004	000000*		SETOM	DEVFLO(F)		;TRUNCATION.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 43
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2025				;% HERE WHEN THE NAME, EXTENSION AND PRJ,PRG AGREE WITH THE LOOKED-UP FILE
  2026	002613'	205300	000000*		MOVSI	T1,NOWRT
  2027	002614'	412304	000007		ANDCAM	T1,DEVIAD(F)		;% TURN OFF IN CASE ON FROM BEFORE
  2028	002615'	201340	002323*		MOVEI	T2,ATPNDL		;% DO NOT ALLOW IF UNDELETABLE
  2029	002616'	201300	000000*		MOVEI	T1,FNCAPP		;% CHECK TO SEE IF APPEND IS LEGAL
  2030	002617'	616355	002465*		TDNN	T2,ATBSTS(P2)
  2031	002620'	260040	002324*		 PUSHJ	P,CHKPRV		;% OK?
  2032	002621'	254000	005124'		  JRST	UPDER2			;% NO. ERROR
  2033	002622'	201300	000000*		MOVEI	T1,FNCUPD		;% NOW CHECK IF APPEND OR UPDATE
  2034	002623'	260040	002620*		PUSHJ	P,CHKPRV
  2035	002624'	334000	000000		  SKIPA
  2036	002625'	254000	002630'		 JRST	WRTOK
  2037	002626'	205300	002613*		MOVSI	T1,NOWRT
  2038	002627'	436304	000007		IORM	T1,DEVIAD(F)		;% SET NO WRITE BIT
  2039	002630'	201300	000005	WRTOK:	MOVEI	T1,DECSTP
  2040	002631'	137300	002545*		DPB	T1,DEYSTC
  2041	002632'	200415	002617*		MOVE	T3,ATBSTS(P2)		;% FILE STATUS
  2042	002633'	602400	001746*		TRNE	T3,ATPDEL		;% IF FILE IS GOING TO GO AWAY
  2043	002634'	254000	005126'		  JRST	UPDER3			;% GIVE BEING MODIFIED ERROR
  2044	002635'	607540	004000		TLNN	M,UUOSIM		;% THIS SIMULTANEOUS UPDATE?
  2045	002636'	254000	002643'		  JRST	WRTOK1			;% NO, MAKE SURE NO OTHER WRITERS.
  2046	002637'	260040	000000*		PUSHJ	P,TSTWRS		;% BOMB IF SINGLE UPDATER OR SUPERCEDE
  2047	002640'	254000	005126'		  JRST	UPDER3			;% BEING MODIFIED SOMEHOW.
  2048	002641'	201340	001511*		MOVEI	T2,ATPMXU		;% DON'T SET ATPUPD
  2049	002642'	254000	002646'		JRST	WRTOK2			;% GO SET MXU
  2050	002643'	260040	001706*	WRTOK1:	PUSHJ	P,TSTWRT		;% SINGLE UPDATE, IF OTHER WRITERS,
  2051	002644'	254000	005126'		  JRST	UPDER3			;% GIVE FILE BEING MODIFIED.
  2052	002645'	201340	000000*		MOVEI	T2,ATPUPD!ATPMXU	;% MAX WRITE COUNT IS ABOUT TO BE INCED
  2053	002646'	436355	002632*	WRTOK2:	IORM	T2,ATBSTS(P2)
  2054	002647'	550415	001767*		HRRZ	T3,ATBFNB(P2)
  2055	002650'	350010	001505*		AOS	FNBUPD(T3)
  2056	002651'	350415	001507*		AOS	T3,ATBMWC(P2)		;% INCREMENT COUNT WHICH INCLUDES UPDATERS
  2057	002652'	606400	001510*		TRNN	T3,ATMMWC		;% MAKE SURE IT DIDN'T TO TO ZERO (OVERFLOW)
  2058	002653'	256000	000000'		 STOPCD (SLO)
  2059				           	;;WRTOK2+5
  2060	002654'	350357	001516*		AOS	T2,DRBCNT(P4)		;% COUNT ONE MORE IN UFB IN CASE CLOSE IN
  2061	002655'	602340	001517*		TRNE	T2,DRPMXC		;% OVERFLOW?
  2062	002656'	256000	000000'		 STOPCD (SLO)
  2063					        	;;WRTOK2+10
  2064	002657'	260040	002263*		PUSHJ	P,GIVCBR		;% NOW ALL FINISHED WITH CB
  2065	002660'	205300	000000*		MOVSI	T1,ATMUFP-ATPALC-ATPPID	;ZERO PRIV UFD BITS
  2066	002661'	412315	002514*		ANDCAM	T1,ATBLCW(P2)
  2067	002662'	260040	002550'		PUSHJ	P,SAVLIC		;GET LIC HE CAN STILL HAVE
  2068	002663'	542315	002554*		HRRM	T1,ATBLIC(P2)		;AND SAVE IT
  2069	002664'	200300	002463*		MOVE	T1,THSDAT
  2070	002665'	137300	002464*		DPB	T1,ATYADT		;UPDATE ACCESS DATE
  2071	002666'	607540	200000		TLNN	M,EXTUUO		;NO. EXTENDED ENTER?
  2072	002667'	254000	002727'		  JRST	UPDEN3			;NO
  2073	002670'	305600	000004		CAIGE	P1,UUXPRV
  2074	002671'	254000	002736'		  JRST	UPNSDT			;NOT SETTING DATE
  2075	002672'	704313	000004		UMOVE	T1,UUXPRV(M)
  2076	002673'	704353	000003		UMOVE	T2,UUXEXT(M)		;GET EXTENSION WORD
  2077	002674'	606340	140000		TRNN	T2,140000		;TO SEE IF EXTENDED DATE INFO
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 43-2
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2078	002675'	612300	006135'		  TDNE	T1,[37,,-1]		;SEE IF DATE, TIME GIVEN
  2079	002676'	334000	000000		 SKIPA	
  2080	002677'	254000	002736'		  JRST	UPNSDT
  2081	002700'	137300	001640*		DPB	T1,ATYCDT
  2082	002701'	242300	777764		LSH	T1,-^D12
  2083	002702'	137300	001645*		DPB	T1,ATYCTM
  2084	002703'	201300	000000		MOVEI	T1,0
  2085	002704'	137300	002415*		DPB	T1,ATYCSC		;IF HE SETS IT LATTER OK
  2086	002705'	242340	777762		LSH	T2,-^D14
  2087	002706'	137340	002470*		DPB	T2,ATYXCD		;SAVE EXTENDED DATE INFO
  2088	002707'	200315	002512*	UPDTDN:	MOVE	T1,ATBPVW(P2)
  2089	002710'	301600	000004		CAIL	P1,UUXPRV
  2090	002711'	705313	000004		 UMOVEM	T1,UUXPRV(M)		;TELL THE USER
  2091	002712'	554315	002525*		HLRZ	T1,ATBMSC(P2)
  2092	002713'	256200	006131'		XCTBU	<HRRM T1,UUXEXT(M)>
  2093	002714'	305600	000005		CAIGE	P1,UUXSIZ
  2094	002715'	254000	002722'		  JRST	UPDTD2			;CAN NOT POSSIBLE WANT SIZE BACK
  2095	002716'	200315	002541*		MOVE	T1,ATBSIZ(P2)
  2096	002717'	602300	000177		TRNE	T1,177
  2097	002720'	275300	000200		  SUBI	T1,200			;ADJUST TO WORDS
  2098	002721'	705313	000005		UMOVEM	T1,UUXSIZ(M)		;AND GIVE IT TO USER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 44
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2099	002722'	305600	000011	UPDTD2:	CAIGE	P1,UUXALC		;SPECIFYING ALLOCATION?
  2100	002723'	254000	003006'		  JRST	UPDEND			;NO. TAKE GOOD RETURN.
  2101	002724'	260040	002755'		PUSHJ	P,ALCCHK		;MAYBE.
  2102	002725'	254000	003006'		  JRST	UPDEND			;NO.
  2103	002726'	254000	002773'		JRST	DELGRP			;YES.
  2104
  2105				;HERE ON 4-WORD UPDATE   SET UP SIZE IN E+3
  2106	002727'	200315	002716*	UPDEN3:	MOVE	T1,ATBSIZ(P2)		;GET NUMBER OF WORDS IN FILE
  2107	002730'	602300	000177		TRNE	T1,177
  2108	002731'	275300	000200		  SUBI	T1,200
  2109	002732'	307300	400000		CAIG	T1,400000
  2110					  JRST	[MOVNS T1
  2111	002733'	254000	006146'			 JRST  UPDEN4]
  2112	002734'	242300	777771		LSH	T1,W2BLSH
  2113	002735'	256200	006127'	UPDEN4: XCTBU <HRLZM T1,UUNPPN(M)>	;IN LH (E+3)
  2114	002736'	260040	002411*	UPNSDT:	PUSHJ	P,GETGMT		;GET T1/TIME T2/DATE
  2115	002737'	137340	002700*		DPB 	T2,ATYCDT		;UPDATE 'CREATION' TIME
  2116	002740'	242340	777764		LSH 	T2,-^D12
  2117	002741'	137340	002706*		DPB 	T2,ATYXCD
  2118	002742'	230300	002413*		IDIV 	T1,JFYSEC
  2119	002743'	231300	000074		IDIVI 	T1,^D60
  2120	002744'	137300	002702*		DPB 	T1,ATYCTM
  2121	002745'	137340	002704*		DPB 	T2,ATYCSC
  2122	002746'	603540	200000		TLNE	M,EXTUUO
  2123	002747'	254000	002707'		  JRST	UPDTDN
  2124	002750'	200315	002707*		MOVE	T1,ATBPVW(P2)
  2125	002751'	705313	000002		UMOVEM	T1,UUNATT(M)
  2126	002752'	554315	002712*		HLRZ	T1,ATBMSC(P2)
  2127	002753'	256200	006130'		XCTBU	<HRRM T1,UUNEXT(M)>
  2128	002754'	254000	003006'		JRST	UPDEND			;MUST GO CLEAR LICENSE.
  2129
  2130				;SMALL SUBR TO SEE IF A FILE SHOULD BE TRUNCATED.
  2131				;EXPECTS P2/ ATB ADDRESS.
  2132				;DESTROYS T2 AND T3.
  2133				;NON-SKIP RETURNS IF CHANGE OF ALLOCATION IS NOT REQUESTED OR
  2134				;IF REQUEST IS >= ACTUAL SIZE.  ELSE SKIP RETURNS WITH
  2135				;T2/ UUXALC IN UNITS OF WORDS.
  2136
  2137	002755'	704413	000000	ALCCHK:	UMOVE	T3,UUXNUM(M)		;IS TRUNCATION
  2138	002756'	256200	006150'		XCTFU	<SKIPN T2,UUXALC(M)>	;BEING
  2139	002757'	602400	200000		TRNE	T3,UUPWDS		;REQUESTED?
  2140	002760'	254000	002762'		  JRST	.+2			;YES.
  2141	002761'	263040	000000		 POPJ	P,			;NO.
  2142	002762'	321340	000102*		JUMPL	T2,CPOPJ		;
  2143	002763'	606400	200000		TRNN	T3,UUPWDS		;IS UUXALC IN WORDS?
  2144					  JRST	[CAMLE T2,[XWD 1777,-1] ;NO, SO WE MUST
  2145						  POPJ P,		;CONVERT IT FROM BLOCKS.
  2146						 LSH   T2,B2WLSH	;(WON'T OVERFLOW, SINCE WE
  2147	002764'	254000	006152'			 JRST  .+1]		;JUST CHECKED FOR THAT.).
  2148	002765'	200415	002727*		MOVE	T3,ATBSIZ(P2)		;GET THE ACTUAL FILE
  2149	002766'	602400	000177		TRNE	T3,177			;SIZE IN
  2150	002767'	275400	000200		  SUBI	T3,200			;WORDS.
  2151	002770'	315340	000010		CAMGE	T2,T3			;ACTUALLY WANT TO TRUNCATE?
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 44-2
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2152	002771'	350001	000000		  AOS	(P)			;YES.
  2153	002772'	263040	000000		POPJ	P,			;NO.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 45
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2154	002773'	201300	000000*	DELGRP:	MOVEI	T1,FNCTRN		;CAN WE TRUNCATE?
  2155	002774'	260040	002623*		PUSHJ	P,CHKPRV
  2156	002775'	254000	003006'		  JRST	UPDEND			;NO
  2157	002776'	704353	000011		UMOVE	T2,UUXALC(M)		;GET
  2158	002777'	704313	000000		UMOVE	T1,UUXNUM(M)		;T2
  2159	003000'	606300	200000		TRNN	T1,UUPWDS		;IN
  2160	003001'	242340	000007		  LSH	T2,B2WLSH		;WORDS.
  2161	003002'	661540	040000		TLO	M,UUOENT		;DELETE THINGS FROM RIB.
  2162	003003'	260040	000000*		PUSHJ	P,DLTTRC		;FLAG SO WE NEED RB2DDB NEEDED.
  2163	003004'	254000	003035'		  JRST	UPDND3			;ERROR ON TRUNCATION, BAD FILE NOW.
  2164	003005'	254000	003013'		JRST	UPDEN2			;NOW HAVE PRIME RIB IN CORE, FINISH UP
  2165
  2166	003006'	260040	001241*	UPDEND:	PUSHJ	P,RIBWTL
  2167	003007'	254000	003035'		  JRST	UPDND3
  2168	003010'	201300	000000*		MOVEI	T1,FNCCAT		;CAN HE CHANGE ATTRIBUTES?
  2169	003011'	260040	002774*		PUSHJ	P,CHKPRV
  2170	003012'	400600	000000		  SETZ	P1,			;CAN'T TOUCH ATTRIBUTES, MAKE SETVAL DO NOTHING.
  2171	003013'	402015	002370*	UPDEN2:	SETZM	ATBPID(P2)		;CLEAR PID AND BIT THAT SAYS THERE IS ONE
  2172	003014'	402000	376000*		SETZM	%RIB+RIBPID		;IN CASE NO VALID PID SPECIFIED.
  2173	003015'	205300	001655*		MOVSI	T1,ATPPID		;CLEAR BIT THAT SAYS THERE'S A PID
  2174	003016'	413315	002661*		ANDCAB	T1,ATBLCW(P2)		;STORE LICENSE NOW SO THAT SOMEONE DOESN'T
  2175									; CHANGE CONTENTS OF LICENSED FILE WHILE
  2176									; ITS BEING UPDATED AND STILL HAVE LICENSE
  2177									; UNTIL CLOSE. (ALSO STORE ATPPID=RIPPID)
  2178	003017'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  2179					TLNE	M,EXTUUO		;IF EXTENDED UUO, CALL SETVAL. (ELSE ALL DONE SETTING T
  2180	003020'	603540	200000	HINGS.)
  2181	003021'	260040	004427'		  PUSHJ	P,SETVAL
  2182	003022'	603540	040000		TLNE	M,UUOENT
  2183	003023'	260040	002175*		  PUSHJ	P,INVDDB		;NEEDED IF PAGES DELETED
  2184	003024'	260040	002547*	UPDEN5:	PUSHJ	P,RELLOK		;NOW RELEASE RIB
  2185	003025'	350001	000000	UPDND4:	AOS	(P)			;AND FALL INTO SETAPN
  2186	003026'	201300	000002		MOVEI	T1,DECUPD
  2187	003027'	137300	002631*		DPB	T1,DEYSTC
  2188	003030'	202004	000002		MOVEM	S,DEVIOS(F)
  2189
  2190	003031'	135300	002240*	SETAPN:	LDB	T1,ATYBLK		;GET BLOCKS CURRENTLY IN FILE
  2191	003032'	550355	002647*		HRRZ	T2,ATBFNB(P2)
  2192	003033'	202307	000000*		MOVEM	T1,FNBAPD(T2)		;AND STORE IN CASE APPEND ONLY
  2193	003034'	263040	000000		POPJ	P,
  2194
  2195	003035'	603540	040000	UPDND3:	TLNE	M,UUOENT
  2196	003036'	260040	003023*		  PUSHJ	P,INVDDB		;INVALIDATE THE DDB, SET FILE LOC TO START.
  2197	003037'	254000	003025'		 JRST	UPDND4			;COULD NOT GET RIB TO UPDATE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 46
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2198				;CHECK ARGUMENT LIST AND TAKE CARE OF USER NAME INSTEAD OF PPN
  2199
  2200	003040'	205000	000000*	CHKARG:	MOVSI	S,IOSERR		;RESET SOME EXTRA BITS
  2201	003041'	413004	000002		ANDCAB	S,DEVIOS(F)
  2202	003042'	334340	006156'		SKIPA	T2,[<NORED!NOWRT!PIDACC>,,0] ;BITS TO CLEAR IN DEVIAD
  2203	003043'	205340	000000*	CHKAG1:	MOVSI	T2,PIDACC
  2204	003044'	412344	000007		ANDCAM	T2,DEVIAD(F)
  2205	003045'	621540	777777		TLZ	M,UUOMSK
  2206	003046'	704613	000000		UMOVE	P1,(M)			;GET COUNT OR NAME
  2207	003047'	607600	777777		TLNN	P1,-1			;SEE IF EXTENDED
  2208	003050'	254000	003065'		  JRST	CHKAGX			;YES
  2209	003051'	261040	000013		PUSH	P,M			;SAVE ARG POINTER (IN CASE EXTENDED)
  2210	003052'	256200	006157'	CHKPPN:	XCTBU	<MOVES T1,UUNPPN(M)>	;MAKE SURE CAN WRITE IN THIS
  2211					JUMPLE	T1,[LDB  T3,PJOBN
  2212						    MOVE T1,JBTPPN(T3)	;USE JOBS IF 0 OR NEG
  2213	003053'	323300	006160'			    JRST CHKPP1]
  2214	003054'	607300	777777		TLNN	T1,-1			;IS IT USER NAME?
  2215	003055'	260040	003242'		  PUSHJ	P,LOKLUD
  2216	003056'	607200	000100	CHKPP1:	TLNN	F,SYSDEV		;SYS?
  2217	003057'	254000	003062'		  JRST	CHKPP2			;NO
  2218				PRINTF(<[Including HACK at CHKPP1 that makes SYS:[1,1] work for accounting]>)
  2219	003060'	312300	002053*		CAME	T1,MFDPPN		;*HACK* for dumb accounting programs (no source!)
  2220	003061'	200300	000174*		MOVE	T1,SYSPPN		;USE SYS PPN UNLESS MFD PPN
  2221	003062'	705313	000003	CHKPP2:	UMOVEM	T1,UUNPPN(M)		;SAVE FOR USER
  2222	003063'	262040	000013		POP	P,M
  2223	003064'	254000	002204*		JRST	CPOPJ1
  2224
  2225	003065'	205300	003043*	CHKAGX:	MOVSI	T1,PIDACC		;GET READY TO SET
  2226	003066'	602600	100000		TRNE	P1,UUPPID		;CALLER ASKING FOR PID ACCESS?
  2227	003067'	436304	000007		  IORM	T1,DEVIAD(F)		;YES, SET BIT FOR CHKPRV
  2228	003070'	405600	000777		ANDI	P1,777			;MASK TO COUNT FIELD
  2229	003071'	303600	000040		CAILE	P1,UUXENT
  2230	003072'	201600	000040		  MOVEI	P1,UUXENT		;MUST NOT BE TOO BIG
  2231	003073'	322600	003064*		JUMPE	P1,CPOPJ1		;NOT REALLY EXTENDED, JUST 0 NAME
  2232	003074'	661540	200000		TLO	M,EXTUUO		;MARK EXTENDED UNLESS 0 NAME
  2233	003075'	305600	000003		CAIGE	P1,3			;BUT MUST BE AT LEAST 3
  2234	003076'	263040	000000		  POPJ	P,			;OR ERROR
  2235	003077'	550300	000013		HRRZ	T1,M
  2236	003100'	270300	000014		ADD	T1,P1
  2237	003101'	256200	006163'		XCTBU	<MOVES (M)>		;MAKE SURE CAN WRITE IN FIRST AND LAST
  2238	003102'	256200	006164'		XCTFU	<MOVES (T1)>		;WORDS (ASSUMES LOOKUP BLOCK LESS THAN 1 PAGE LONG)
  2239	003103'	261040	000013		PUSH	P,M			;SAVE ARG
  2240	003104'	275540	000002		SUBI	M,UUNPPN-UUXPPN		;CORRECT M FOR EXTENDED PPN
  2241	003105'	254000	003052'		JRST	CHKPPN			;AND GO TAKE CARE OF IT
  2242
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 47
FILUUO.MAC	19-SEP-89 19:52		ENTER

  2243				;ROUTINES TO GET THE VARIOUS ARGS
  2244
  2245	003106'	607540	200000	GETNAM:	TLNN	M,EXTUUO
  2246	003107'	256200	006165'		  XCTFU	<SKIPA T1,UUNNAM(M)>
  2247	003110'	704313	000002		UMOVE	T1,UUXNAM(M)
  2248	003111'	263040	000000		POPJ	P,			;NAME
  2249
  2250	003112'	607540	200000	GETEXT:	TLNN	M,EXTUUO
  2251	003113'	256200	006166'		  XCTFU	<SKIPA T1,UUNEXT(M)>
  2252	003114'	704313	000003		UMOVE	T1,UUXEXT(M)
  2253	003115'	263040	000000		POPJ	P,
  2254
  2255	003116'	607540	200000	GETPPN:	TLNN	M,EXTUUO
  2256	003117'	256200	006167'		  XCTFU	<SKIPA T1,UUNPPN(M)>
  2257	003120'	704313	000001		UMOVE	T1,UUXPPN(M)
  2258	003121'	263040	000000		POPJ	P,
  2259
  2260				;SET UF DEVFIL, DEVEXT, DEVPPN, LEAVE PPN IN T1
  2261
  2262	003122'	260040	003106'	SETFIL:	PUSHJ	P,GETNAM
  2263	003123'	322300	002762*		JUMPE	T1,CPOPJ		;GERROR IF NAME 0
  2264	003124'	202304	000015		MOVEM	T1,DEVFIL(F)
  2265	003125'	260040	003112'		PUSHJ	P,GETEXT
  2266	003126'	502304	000016		HLLM	T1,DEVEXT(F)
  2267	003127'	260040	003116'		PUSHJ	P,GETPPN
  2268	003130'	202304	000017		MOVEM	T1,DEVPPN(F)
  2269	003131'	254000	003073*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 48
FILUUO.MAC	19-SEP-89 19:52		PPNUSR - Translate PPN to USERNAME using only in-core tables

  2270				SUBTTL	PPNUSR - Translate PPN to USERNAME using only in-core tables
  2271				;Call:	MOVE	T1,[PPN]
  2272				;	PUSHJ	P,PPNUSR
  2273				;	  error return	;Need to read DUL.SYS
  2274				;	success return	;USERNAME in T2 and T3
  2275
  2276	003132'	316300	003061*	PPNUSR::CAMN	T1,SYSPPN##	;Is it [1,4]
  2277					 JRST	[MOVSI T2,'SYS'	;Yes
  2278						 SETZ  T3,
  2279	003133'	254000	006170'			 JRST  CPOPJ1]	;[1,4]=(SYS)
  2280	003134'	200400	000757*		MOVE	T3,HIGHJB	;Search the JBT tables
  2281	003135'	312310	002503*	PPNUS1:	CAME	T1,JBTAUN(T3)	;Check if Accounting User Number matches
  2282	003136'	254000	003143'		 JRST	PPNUS2
  2283	003137'	200350	000000*		MOVE	T2,JBTUNM(T3)	;Get USERNAME for this AUN
  2284	003140'	322340	003143'		JUMPE	T2,PPNUS2
  2285	003141'	200410	000000*		MOVE	T3,JBTUN1(T3)
  2286	003142'	254000	003131*		JRST	CPOPJ1		;Success
  2287	003143'	367400	003135'	PPNUS2:	SOJG	T3,PPNUS1
  2288
  2289				;No one logged in by that PPN, check if anyone is GFD'd to that directory
  2290
  2291	003144'	200400	003134*		MOVE	T3,HIGHJB	;Search the JBT tables
  2292	003145'	312310	002552*	PPNUS3:	CAME	T1,JBTPPN(T3)	;Check if PPN matches
  2293	003146'	254000	003153'		 JRST	PPNUS4
  2294	003147'	200350	001004*		MOVE	T2,JBTNM1(T3)	;Get USERNAME for this PPN
  2295	003150'	322340	003153'		JUMPE	T2,PPNUS4
  2296	003151'	200410	001005*		MOVE	T3,JBTNM2(T3)
  2297	003152'	254000	003142*		JRST	CPOPJ1		;Success
  2298	003153'	367400	003145'	PPNUS4:	SOJG	T3,PPNUS3
  2299
  2300	003154'	331000	000000*		SKIPL	.CPDWD##	;Processing a stopcode?
  2301	003155'	263040	000000		 POPJ	P,		;Yes, can't trust DRB's, give error return
  2302	003156'	261040	002017*		PUSH	P,JOB
  2303	003157'	202100	003156*		MOVEM	J,JOB
  2304	003160'	260040	002572*		PUSHJ	P,GETCBR	;Not found, need to search core blocks
  2305	003161'	201400	000000*		MOVEI	T3,SYSDRB-DRBLNK;Pointer to first place
  2306	003162'	254000	003172'		JRST	PPNUS6		;Jump into loop
  2307
  2308				;Check for USERNAME/PPN correlation in the PPBs
  2309
  2310	003163'	312310	000000*	PPNUS5:	CAME	T1,DRBNAM(T3)	;Check if PPN matches
  2311	003164'	254000	003172'		 JRST	PPNUS6
  2312	003165'	200350	000000*		MOVE	T2,DRBUNM(T3)	;Get USERNAME
  2313	003166'	200410	000000*		MOVE	T3,DRBUN1(T3)
  2314	003167'	260040	002657*		PUSHJ	P,GIVCBR
  2315	003170'	262040	003157*		POP	P,JOB
  2316	003171'	254000	003152*		JRST	CPOPJ1		;Success
  2317	003172'	554410	000000*	PPNUS6:	HLRZ	T3,DRBLNK(T3)
  2318	003173'	326400	003163'		JUMPN	T3,PPNUS5	;Follow pointer to next one
  2319	003174'	260040	003167*		PUSHJ	P,GIVCBR	;No more pointers, error return
  2320	003175'	262040	003170*		POP	P,JOB
  2321	003176'	263040	000000		POPJ	P,		;Give error return
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 49
FILUUO.MAC	19-SEP-89 19:52		USRPPN - Translate USERNAME to PPN using only in-core tables

  2322				SUBTTL	USRPPN - Translate USERNAME to PPN using only in-core tables
  2323				;Call:	DMOVE	T2,[SIXBIT/USERNAME/]
  2324				;	PUSHJ	P,USRPPN
  2325				;	  error return	;Need to read LUD.SYS
  2326				;	success return	;PPN in T1
  2327
  2328	003177'	316340	006173'	USRPPN::CAMN	T2,[SIXBIT/SYS/];Is it (SYS)
  2329					 JUMPE	T3,[MOVE T1,SYSPPN##
  2330	003200'	322400	006174'			    JRST CPOPJ1];(SYS)=[1,4]
  2331	003201'	200300	003144*		MOVE	T1,HIGHJB	;Search the JBT tables
  2332	003202'	316346	003137*	USRPP1:	CAMN	T2,JBTUNM(T1)	;Check if username matches
  2333	003203'	312406	003141*		CAME	T3,JBTUN1(T1)	; (in the AUN tables)
  2334	003204'	254000	003207'		 JRST	USRPP2
  2335	003205'	200306	003135*		MOVE	T1,JBTAUN(T1)	;Get Accounting User Number for this name
  2336	003206'	254000	003171*		JRST	CPOPJ1		;Success
  2337	003207'	367300	003202'	USRPP2:	SOJG	T1,USRPP1
  2338
  2339				;No one logged in by that name, check if anyone is GFD'd to that directory
  2340
  2341	003210'	200300	003201*		MOVE	T1,HIGHJB	;Search the JBT tables
  2342	003211'	316346	003147*	USRPP3:	CAMN	T2,JBTNM1(T1)	;Check if username matches
  2343	003212'	312406	003151*		CAME	T3,JBTNM2(T1)
  2344	003213'	254000	003216'		 JRST	USRPP4
  2345	003214'	200306	003145*		MOVE	T1,JBTPPN(T1)	;Get PPN for this username
  2346	003215'	254000	003206*		JRST	CPOPJ1		;Success
  2347	003216'	367300	003211'	USRPP4:	SOJG	T1,USRPP3
  2348
  2349	003217'	331000	003154*		SKIPL	.CPDWD##	;Processing a stopcode?
  2350	003220'	263040	000000		 POPJ	P,		;Yes, can't trust DRB's, give error return
  2351	003221'	261040	003175*		PUSH	P,JOB
  2352	003222'	202100	003221*		MOVEM	J,JOB
  2353	003223'	260040	003160*		PUSHJ	P,GETCBR	;Not found, need to search core blocks
  2354	003224'	201300	000000*		MOVEI	T1,SYSDRB-DRBLNK;Pointer to first place
  2355	003225'	254000	003235'		JRST	USRPP6		;Jump into loop
  2356
  2357				;Check for USERNAME/PPN correlation in the PPBs
  2358
  2359	003226'	316346	003165*	USRPP5:	CAMN	T2,DRBUNM(T1)	;Check if username matches
  2360	003227'	312406	003166*		CAME	T3,DRBUN1(T1)
  2361	003230'	254000	003235'		 JRST	USRPP6
  2362	003231'	200306	003163*		MOVE	T1,DRBNAM(T1)	;Get PPN
  2363	003232'	260040	003174*		PUSHJ	P,GIVCBR
  2364	003233'	262040	003222*		POP	P,JOB
  2365	003234'	254000	003215*		JRST	CPOPJ1		;Success
  2366	003235'	554306	003172*	USRPP6:	HLRZ	T1,DRBLNK(T1)
  2367	003236'	326300	003226'		JUMPN	T1,USRPP5	;Follow pointer to next one
  2368	003237'	260040	003232*		PUSHJ	P,GIVCBR	;No more pointers
  2369	003240'	262040	003233*		POP	P,JOB
  2370	003241'	263040	000000		POPJ	P,		;Give error return
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 50
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2371				SUBTTL	LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN
  2372
  2373	003242'	261040	000006	LOKLUD:	PUSH	P,T1		;Save pointer (return it in T2)
  2374	003243'	261040	000013		PUSH	P,M
  2375	003244'	256200	006176'		XCTBU	<DMOVE T2,(T1)>	;GET USER NAME
  2376	003245'	260040	003177'		PUSHJ	P,USRPPN	;See if USERNAME and PPN is in memory
  2377	003246'	254000	003252'		  JRST	LOKLL5		;Its not, have to read LUD.SYS
  2378	003247'	262040	000013		POP	P,M
  2379	003250'	262040	000007		POP	P,T2
  2380	003251'	263040	000000		POPJ	P,
  2381
  2382				;LOKLUD continued - Go read SYS:LUD.SYS
  2383	003252'	261040	000004	LOKLL5:	PUSH P,F
  2384	003253'	202004	000002		MOVEM S,DEVIOS(F)	;MAKE SURE THIS STAYS AROUND
  2385	003254'	201200	000661*		MOVEI F,DSKDDB	;GET A DDB
  2386	003255'	205300	446353		MOVSI T1,'DSK'
  2387	003256'	260040	000627'		PUSHJ P,SETDDB
  2388	003257'	254000	003500'		 JRST LUDER2		;CAN NOT GET DDB
  2389	003260'	200300	003240*		MOVE T1,JOB
  2390	003261'	137300	002550*		DPB T1,PJOBN
  2391	003262'	201300	200000		MOVEI T1,ASSPRG
  2392	003263'	436304	000004		IORM T1,DEVMOD(F)
  2393	003264'	261052	000000*		PUSH P,%UPT+UPTJDA(W)	;REPLACE HIS POINTER
  2394	003265'	202212	000000*		MOVEM F,%UPT+UPTJDA(W)
  2395	003266'	205340	546544		MOVSI T2,'LUD'
  2396	003267'	202344	000015		MOVEM T2,DEVFIL(F)
  2397	003270'	201340	637163		MOVEI T2,'SYS'
  2398	003271'	506344	000016		HRLM T2,DEVEXT(F)
  2399	003272'	205540	400000		MOVSI M,UUOLUK
  2400	003273'	200300	003132*		MOVE T1,SYSPPN		;Read from SYS:(SYS)[1,4]
  2401	003274'	202304	000017		MOVEM T1,DEVPPN(F)
  2402	003275'	476004	002612*		SETOM	DEVFLO(F)
  2403	003276'	260040	002313*		PUSHJ	P,SRCFIL	;DO A LOOKUP ON LUD.SYS
  2404	003277'	254000	003467'		  JRST	LUDER0
  2405	003300'	623000	002073*		TLZE S,IOSRIB
  2406	003301'	260040	003024*		PUSHJ P,RELLOK	;MAKE SURE WE DON'T HAVE RIB
  2407	003302'	200300	006177'		MOVE T1,[555555555555]
  2408	003303'	202300	003503'		MOVEM T1,X
  2409	003304'	200300	006200'		MOVE T1,[361275431652]
  2410	003305'	202300	003504'		MOVEM T1,X+1
  2411	003306'	200300	006201'		MOVE T1,[612754316523]
  2412	003307'	202300	003505'		MOVEM T1,X+2
  2413	003310'	200401	777775		MOVE T3,-3(P)	;Get pointer to name block
  2414	003311'	704310	000000		UMOVE T1,(T3)
  2415	003312'	202300	003506'		MOVEM T1,N
  2416	003313'	704310	000001		UMOVE T1,1(T3)
  2417	003314'	202300	003507'		MOVEM T1,N+1	;GET USER NAME
  2418	003315'	201400	000000		MOVEI T3,0
  2419					REPEAT 4,<PUSHJ P,RND>
  2420	003316'	260040	003335'
  2421	003317'	260040	003335'
  2422	003320'	260040	003335'
  2423	003321'	260040	003335'
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 50-2
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2424	003322'	200300	003505'		MOVE T1,X+2
  2425	003323'	430300	003504'		XOR T1,X+1
  2426	003324'	200340	003503'		MOVE T2,X
  2427	003325'	430340	000006		XOR T2,T1
  2428	003326'	261040	000014		PUSH P,P1	;PRESERVE P1
  2429	003327'	261040	000007		PUSH P,T2	;THE HASHED USER NAME
  2430	003330'	621000	000000*		TLZ S,IOSRIB!IOSRBE!IO
  2431	003331'	201600	000100		MOVEI P1,100	;DO NOT LINK FOREVER
  2432	003332'	621300	400000		TLZ T1,400000
  2433	003333'	231300	001567		IDIVI T1,LUDHSH	;T2 gets block # within file (starting at 0).
  2434							;NOTE: programs doing USETI need "ADDI T2,1" here.
  2435	003334'	254000	003362'		JRST USRUSI	;(we don't because we are going to fake a USETI.)
  2436
  2437	003335'	200300	003506'	RND:	MOVE T1,N
  2438	003336'	200340	003507'		MOVE T2,N+1
  2439	003337'	272300	003504'		ADDM T1,X+1
  2440	003340'	245300	777756		ROTC T1,-22
  2441	003341'	202300	003506'		MOVEM T1,N
  2442	003342'	202340	003507'		MOVEM T2,N+1
  2443	003343'	201440	000005		MOVEI T4,5
  2444	003344'	200310	003504'	RND1:	MOVE T1,X+1(T3)
  2445	003345'	224300	006202'		MUL T1,[5*5*5*5*5*5*5*5*5*5*5*5*5*5*5]
  2446	003346'	272350	003505'		ADDM T2,X+2(T3)
  2447	003347'	342400	003360'		AOJE T3,RND2
  2448	003350'	211400	000001		MOVNI T3,1
  2449	003351'	200300	003504'		MOVE T1,X+1
  2450	003352'	602300	000001		TRNE T1,1
  2451	003353'	331000	003505'		SKIPL X+2
  2452	003354'	201400	000000		MOVEI T3,0
  2453	003355'	200300	003503'		MOVE T1,X
  2454	003356'	250300	003505'		EXCH T1,X+2
  2455	003357'	202300	003503'		MOVEM T1,X
  2456	003360'	367440	003344'	RND2:	SOJG T4,RND1
  2457	003361'	263040	000000		POPJ P,
  2458
  2459			001567	LUDHSH==^D887
  2460			000004	LHUN==4		;RELATIVE LOC OF HASHED USER NAME
  2461			000000	LPPN==0		;PPN
  2462			000002	LLINK==2	;SIZE OF ENTRY
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 51
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2463				EXTERN PE.NER
  2464
  2465			000035	MAPID==35	;CHANIO VMAP FUNCTION NO.
  2466				EXTERN FALHOL,FALPHP,PE.NER
  2467
  2468				;Call with zero-based block number in T2 and username hash on top of stack
  2469	003362'	661200	040000	USRUSI:	TLO	F,LOOKB		;FOOL MAP.
  2470	003363'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2471	003364'	261040	000007		PUSH	P,T2		;SAVE DESIRED BLOCK NUMBER.
  2472	003365'	200300	006203'		MOVE	T1,[<CPRRED>B7+1B17+%COW.N+<CNVVPN>]
  2473	003366'	242340	777776		LSH	T2,B2PLSH	;MAP IN THAT
  2474	003367'	201347	000001		MOVEI	T2,1(T2)	;[P035/E01] Clear LH, add one for CHANIO
  2475	003370'	551412	000000		HRRZI	T3,(W)		;PAGE OF
  2476	003371'	505400	000035		HRLI	T3,MAPID	;THE
  2477	003372'	043400	000006		CHANIO	T3,T1		;FILE.
  2478	003373'	254000	003375'		  JRST	.+2		;LOST.
  2479	003374'	254000	003405'		JRST	USRUS2		;WON.
  2480	003375'	621200	040000		TLZ	F,LOOKB		;
  2481	003376'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2482	003377'	262040	000006		POP	P,T1		;DUMP BLOCK NUMBER
  2483	003400'	551410	000000		HRRZI	T3,(T3)		;GET T3/ ERROR CODE.
  2484	003401'	302400	000000*		CAIE	T3,FALHOL	;
  2485	003402'	306400	000000*		CAIN	T3,FALPHP	;
  2486	003403'	254000	003474'		JRST	LUDER1		;
  2487	003404'	256000	006204'		 STOPCD (LUDER1,DEBUG,USRUS1,PRTT3##,<Unexpected CHANIO error in USETI>);;USRUSI+22
  2488	003405'	200300	006210'	USRUS2:	MOVE	T1,[PE.NER+1,,%COW.N+CNVVPN] ;SET IGNORE ERROR BIT
  2489	003406'	047300	777706		PERSET	T1,		; (OLD PCB CODE IGNORED ERRORS TOO)
  2490	003407'	256000	000000'		 STOPCD (SLO)
  2491						;;USRUS2+2
  2492	003410'	621200	040000		TLZ	F,LOOKB		;
  2493	003411'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2494	003412'	262040	000006		POP	P,T1		;REQUESTED BLOCK NUMBER
  2495	003413'	405300	000003		ANDI	T1,3		;BLOCK WITHIN PAGE
  2496	003414'	242300	000007		LSH	T1,B2WLSH
  2497	003415'	505300	777600		HRLI	T1,-200
  2498	003416'	200346	000004*	SRUSR:	MOVE	T2,%COW+LHUN(T1) ;GET THIS USERS'S HASH
  2499	003417'	316341	000000		CAMN	T2,(P)		;CHECK WITH HASHED USERNAME
  2500	003420'	254000	003442'		 JRST	FUNM		;FOUND IT.
  2501	003421'	337346	000000*		SKIPG	T2,%COW+LPPN(T1)
  2502	003422'	254000	003434'		 JRST	BLKLNK		;END OR A LINK.
  2503	003423'	200346	000002*		MOVE	T2,%COW+LLINK(T1)
  2504	003424'	405340	000177		ANDI	T2,177
  2505	003425'	507000	000007		HRLS	T2
  2506	003426'	270300	000007		ADD	T1,T2
  2507	003427'	321300	003416'		JUMPL	T1,SRUSR
  2508	003430'	200300	006211'		MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2509	003431'	047300	777713		VREMOV	T1,
  2510	003432'	256000	000000'		  STOPCD (SLO)
  2511				           ;;SRUSR+14
  2512	003433'	254000	003474'		JRST	LUDER1		;RAN OUT OF BUFFER.
  2513
  2514	003434'	200300	006211'	BLKLNK:	MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2515	003435'	047300	777713		VREMOV	T1,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 51-2
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2516	003436'	256000	000000'		  STOPCD (SLO)
  2517				           ;;BLKLNK+2
  2518	003437'	322340	003474'		JUMPE	T2,LUDER1	;0=END OF CHAIN, NEG=NEXT BLOCK # IN RH
  2519	003440'	361600	003474'		SOJL	P1,LUDER1	;MAKE SURE WE ARE NOT LOOPING.
  2520	003441'	364340	003362'		SOJA	T2,USRUSI	;[P035/E01] Make zero-based block number
  2521
  2522	003442'	262040	000007	FUNM:	POP	P,T2		;HASHED USER NAME
  2523	003443'	262040	000014		POP	P,P1		;PRESERVED P1
  2524	003444'	200546	003421*		MOVE	M,%COW+LPPN(T1)
  2525	003445'	260040	000335*		PUSHJ	P,UNLFIL	;
  2526	003446'	200300	006211'		MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2527	003447'	047300	777713		VREMOV	T1,
  2528	003450'	256000	000000'		 STOPCD (SLO)
  2529				           ;;FUNM+6
  2530	003451'	260040	003223*		PUSHJ	P,GETCBR		;% NOW NEED TO ADD TO LIST
  2531	003452'	554340	002251*		HLRZ	T2,SYSDRB		;%
  2532	003453'	201400	000000*		MOVEI	T3,SYSDRB-DRBLNK 	;% SET TO SEARCH DRB
  2533	003454'	200300	000013		MOVE	T1,M			;% GET PPN
  2534	003455'	260040	002253*		PUSHJ	P,SRCNAM		;%
  2535					JUMPLE	T2,[MOVEM M,-3(P)	;% NO CORE
  2536	003456'	323340	006212'			JRST FUNM1]
  2537	003457'	250541	777775		EXCH	M,-3(P)			;% ADDRESS OF USER NAME
  2538	003460'	256200	006214'		XCTBU	<DMOVE T3,(M)>		;%
  2539	003461'	124407	003226*		DMOVEM	T3,DRBUNM(T2)		;%
  2540	003462'	260040	003237*	FUNM1:	PUSHJ	P,GIVCBR		;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 52
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2541	003463'	201540	000000	LUDERR:	MOVEI	M,0
  2542	003464'	661200	050000		TLO	F,INPB!LOOKB		;FLAG SO A.T. NOT DELETED
  2543	003465'	260040	001007'		PUSHJ	P,CLOSIN
  2544	003466'	260040	000661'		PUSHJ	P,CLRDDB
  2545	003467'	262052	000000*	LUDER0:	POP	P,%UPT+UPTJDA(W)	;THE PUSHED UPTJDA WORD
  2546	003470'	262040	000004		POP	P,F
  2547	003471'	200004	000002		MOVE	S,DEVIOS(F)		;RESTORE IOS
  2548	003472'	262040	000013		POP	P,M
  2549	003473'	324740	002030*		PJRST	TPOPJ
  2550
  2551	003474'	260040	003445*	LUDER1:	PUSHJ	P,UNLFIL	;
  2552	003475'	262040	000006		POP	P,T1		;DUMP HASHED USER NAME
  2553	003476'	262040	000014		POP	P,P1		;RESTORE P1
  2554	003477'	254000	003463'		JRST	LUDERR
  2555
  2556	003500'	262040	000004	LUDER2:	POP	P,F
  2557	003501'	262040	000013		POP	P,M
  2558	003502'	324740	003473*		PJRST	TPOPJ
  2559
  2560	003503'			X:	BLOCK	3
  2561	003506'			N:	BLOCK	2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 53
FILUUO.MAC	19-SEP-89 19:52		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2562				;ROUTINE TO CHARGE FOR 1 LOOKUP-ENTER
  2563
  2564				EXTERN GTCGSZ
  2565	003510'	135100	003261*	LKSET:	LDB	J,PJOBN
  2566	003511'	260040	000352*		PUSHJ	P,GTCGSZ	;GET CHARGING SIZE OF JOB.
  2567	003512'	350002	000000*		AOS	JBTDLK(J)
  2568	003513'	350000	003512*		AOS	JBTDLK		;ACCUMULATE TOTAL IN JOB 0
  2569	003514'	272302	000000*		ADDM	T1,JBTSLK(J)
  2570	003515'	272300	003514*		ADDM	T1,JBTSLK
  2571	003516'	263040	000000		POPJ	P,
  2572
  2573				;SIMILAR ROUTINE TO CHARGE FOR USETI'S, AND USETO'S
  2574
  2575	003517'	135100	003510*	ERNSET:	LDB	J,PJOBN
  2576	003520'	260040	003511*		PUSHJ	P,GTCGSZ
  2577	003521'	350002	000000*		AOS	JBTERN(J)
  2578	003522'	350000	003521*		AOS	JBTERN
  2579	003523'	272302	000000*		ADDM	T1,JBTSER(J)
  2580	003524'	272300	003523*		ADDM	T1,JBTSER
  2581	003525'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 54
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2582				SUBTTL	RENAME
  2583
  2584	003526'	260040	002556*	RENAM:	NOCHARGE
  2585	003527'	260040	002571*		PUSHJ	P,WAIT1	;WAIT FOR I/O TO STOP
  2586	003530'	260040	002012'		PUSHJ	P,TSTRES
  2587	003531'	603000	002276*		TLNE	S,IOSUPR
  2588	003532'	254000	005112'		  JRST	LUKER1
  2589	003533'	260040	003517'		PUSHJ	P,ERNSET		;CHARGE 1 RENAME
  2590	003534'	621000	003300*		TLZ	S,IOSRIB
  2591	003535'	260040	003043'		PUSHJ	P,CHKAG1		;CHECK ARGUMENTS
  2592	003536'	254000	005110'		  JRST	ILNMER			;BAD COUNT FOR EXTENDED
  2593	003537'	336004	000015		SKIPN	DEVFIL(F)		;IS THERE AN OPEN FILE?
  2594	003540'	254000	005117'		  JRST	RENER0			;NO. ERROR RETURN
  2595	003541'	603200	020000		TLNE	F,ENTRB			;IS IT OPEN FOR OUTPUT
  2596	003542'	603200	001000		  TLNE	F,OCLOSB
  2597	003543'	254000	003550'		 JRST	RECLSD			;NO
  2598	003544'	261040	000013		PUSH	P,M
  2599	003545'	541540	000002		HRRI	M,CLSIN			;CLOSE ONLY OUTPUT
  2600	003546'	260040	000000*		PUSHJ	P,CLOSE1		;YES, CLOSE IT
  2601	003547'	262040	000013		POP	P,M
  2602	003550'	621000	003534*	RECLSD:	TLZ	S,IOSRIB		;JUST TO MAKE SURE
  2603	003551'	550644	002606*		HRRZ	P2,DEVATB(F)		;LOC OF ACCES BLOCK
  2604	003552'	326640	003574'		JUMPN	P2,RENAM1		;DONT HAVE TO LOOKUP IF THERE
  2605	003553'	661540	400000		TLO	M,UUOLUK		;INDICATE LOOKUP FOR FNDFIL
  2606	003554'	260040	003106'		PUSHJ	P,GETNAM		;GET FILE NAME RENAMING TO
  2607	003555'	336000	000006		SKIPN	T1			;IF TRYING TO DELETE,
  2608					  TLO	M,UUOIRE		;THEN IGNORE RIB ERROR, USE INFO FROM UFD FOR ACCESS CH
  2609	003556'	661540	002000	ECKING.
  2610									; (SRCFIL WILL GIVE SKIP RETURN FOR RIB ERRORS TOO WHEN
  2611				 THIS IS ON.)
  2612	003557'	201300	000005		MOVEI	T1,DECSTP
  2613	003560'	137300	003027*		DPB	T1,DEYSTC
  2614	003561'	260040	003276*		PUSHJ	P,SRCFIL		;SET UP AN ACCESS BLOCK FOR IT
  2615	003562'	254000	005165'		  JRST	STRERR			;ERROR - RETURN
  2616	003563'	623000	003550*		TLZE	S,IOSRIB		;GIVE IT BACK IN CASE RETURNED WITH IT
  2617	003564'	260040	003301*		PUSHJ	P,RELLOK
  2618	003565'	621540	577777		TLZ	M,UUOMSK-EXTUUO		;RESET ALL BITS BUT EXTENDED UUO
  2619	003566'	260040	003571'		PUSHJ	P,RENAM0		;GO DO REST OF RENAME
  2620	003567'	324740	001007'		  PJRST	CLOSIN			;ERROR - FIX UP ACCESS TABLE
  2621									;(UUOCON WONT DO A CLOSE SINCE THE RENAME FAILED)
  2622	003570'	324740	003234*		PJRST	CPOPJ1			;GOOD RETURN
  2623	003571'	661200	040000	RENAM0:	TLO	F,LOOKB			;SET SO CLOSE INPUT WILL HAPPEN
  2624	003572'	621200	003000		TLZ	F,OCLOSB+ICLOSB
  2625	003573'	550644	003551*		HRRZ	P2,DEVATB(F)		;LOC OF A.T. INTO P2
  2626
  2627	003574'	260040	003451*	RENAM1:	PUSHJ	P,GETCBR		;%
  2628	003575'	200315	002610*		MOVE	T1,ATBRIB(P2)		;%
  2629	003576'	202304	002611*		MOVEM	T1,DEVRIB(F)		;%
  2630	003577'	200315	002646*		MOVE	T1,ATBSTS(P2)
  2631	003600'	602300	002615*		TRNE	T1,ATPNDL
  2632	003601'	254000	005124'		  JRST	UPDER2			;% CAN NOT BE DELETED
  2633	003602'	661540	010000		TLO	M,UUOREN	 	;% LIGHT UUOREN
  2634	003603'	260040	003106'		PUSHJ	P,GETNAM		;% GET FILE NAME
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 54-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2635	003604'	326300	003667'		JUMPN	T1,RENAM3		;% NON-ZERO, DO NOT DELETE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 55
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2636				;HERE WHEN RENAMING A FILE TO 0 (DELETING)
  2637	003605'	554744	002607*	RENAM2:	HLRZ	P4,DEVDRB(F)
  2638	003606'	201300	000000*		MOVEI	T1,FNCDEL
  2639	003607'	260040	003011*		PUSHJ	P,CHKPRV
  2640	003610'	254000	005124'		   JRST UPDER2			;% NO. ERROR RETURN
  2641	003611'	260040	002643*		PUSHJ	P,TSTWRT		;DO NOT ALLOW IF SOMEONE WRITING
  2642	003612'	254000	005126'		  JRST UPDER3			;% BEING UPDATED, ERROR
  2643	003613'	201300	000005		MOVEI	T1,DECSTP
  2644	003614'	137300	003560*		DPB	T1,DEYSTC
  2645	003615'	200315	003577*		MOVE	T1,ATBSTS(P2)
  2646	003616'	606300	002360*		TRNN	T1,ATPDIR		;% DIRECTORY IS SPECIAL
  2647	003617'	254000	003632'		  JRST	RENM2A
  2648	003620'	200304	000015		MOVE	T1,DEVFIL(F)
  2649	003621'	260040	001456*		PUSHJ	P,FNDDRB		;% FIND THIS DIRECTORY BLOCK
  2650	003622'	254000	003631'		  JRST RENM2B			;% NOT THERE
  2651	003623'	200307	002654*		MOVE	T1,DRBCNT(T2)
  2652	003624'	602300	000000*		TRNE	T1,DRMCNT		;% IS COUNT UP?
  2653	003625'	254000	005126'		  JRST	UPDER3			;% YES, CAN NOT DELETE
  2654	003626'	402007	002255*		SETZM	DRBRIB(T2)
  2655	003627'	201300	001461*		MOVEI	T1,DRPNX
  2656	003630'	436307	001462*		IORM	T1,DRBNX(T2)		;% AND FLAG NOT THERE
  2657	003631'	200315	003615*	RENM2B:	MOVE	T1,ATBSTS(P2)
  2658	003632'	621200	040000	RENM2A:	TLZ	F,LOOKB			;% ZERO LOOKB SO A FOLLOWING ENTER WILL SUCCEED
  2659	003633'	502212	000000*		HLLM	F,%UPT+UPTJDA(W)	;% UUOCON WONT SAVE LH(F)
  2660	003634'	602300	002633*		TRNE	T1,ATPDEL		;% IF ALREADY MARKED FOR DELETE,
  2661	003635'	254000	003655'		  JRST	RENM2C			;% GO DO INPUT CLOSE, ETC.
  2662	003636'	660300	001512*		TRO	T1,ATPUPD		;%SET UPD SO NO ONE ELSE CAN MODIFY, JUST READ
  2663	003637'	202315	003631*		MOVEM	T1,ATBSTS(P2)
  2664	003640'	550715	003032*		HRRZ	P3,ATBFNB(P2)		;% GET FNB ADDRESS FOR DLTNAM
  2665	003641'	260040	003462*		PUSHJ	P,GIVCBR
  2666					PUSHJ	P,SETACH		;SET CHANGED BIT IN CASE UFD PAGE DOESN'T MAKE IT OUT B
  2667	003642'	260040	001663'	EFORE SYSTEM CRASH
  2668	003643'	260040	000000*		PUSHJ	P,DLTNAM		;REMOVE NAME FROM UFD
  2669	003644'	513000	000013		HLLZS	M			;NO ONE ELSE CAN MAKE NEW UFD ENTRY SINCE ATPUPD IS ON
  2670	003645'	260040	002000*		PUSHJ	P,SIMRLS		;EXPECTS F,S,W; CLEAN UP SIMIO DATABASE
  2671									;MAY SET IODTER IF VREMOV FAILURE,OUTPUT
  2672	003646'	260040	003574*		PUSHJ	P,GETCBR		;%
  2673	003647'	205300	001477*		MOVSI	T1,FNPNX		;%
  2674	003650'	436316	001500*		IORM	T1,FNBNX(P3)		;% TELL WORLD IT DOESN'T EXIST NOW.
  2675	003651'	402016	001770*		SETZM	FNBRIB(P3)		;% CLEAR SO HAS TO SCAN UFD AGAIN.
  2676	003652'	201300	000000*		MOVEI	T1,ATPDEL!ATPUPD
  2677									;% (DEL CAN'T GO ON SINCE UPD IS ON.)
  2678	003653'	433315	003637*		XORB	T1,ATBSTS(P2)		;% TURN ON DEL, TURN OFF UPD
  2679	003654'	254000	003660'		JRST	RENM2D
  2680	003655'	260040	003641*	RENM2C:	PUSHJ	P,GIVCBR
  2681	003656'	260040	003645*		PUSHJ	P,SIMRLS		;CLEAN UP SIMIO DATABASE
  2682	003657'	260040	003646*		PUSHJ	P,GETCBR
  2683	003660'	350001	000000	RENM2D:	AOS	(P)			;% GIVE SKIP RETURN TO THE RENAME UUO
  2684	003661'	607000	000000*		TLNN	S,IOSRBE		;% IF RIB ERROR, BETTER CHECK FOR OTHER USER
  2685	003662'	324740	001030'		  PJRST	CLOSRN			;% JUMP INTO THE CLOSE CODE TO FINISH UP
  2686									;% ASSUME IF THERE IS A RIB ERROR THAT CLOSE WILL IGNOR
  2687				E IT - WHICH RESULTS IN LOST PAGES.
  2688	003663'	602300	777777*		TRNE	T1,ATMCNT-1		;% IF LAST READER, NO NEW ONES CAN COME,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 55-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2689	003664'	254000	001141'		  JRST	CLSIN3			;% WE KNOW ATPDEL SET AND OTHER USERS, SO
  2690									;% GO DO NORMAL CLOSE, LAST USER WILL DELETE THE FILE I
  2691				N INPUT CLOSE
  2692									;% (ATBRIB HAS TO BE NON-ZERO IF OTHER USER?
  2693	003665'	260040	003655*		PUSHJ	P,GIVCBR 		;% SO GIVE BACK CB AND
  2694	003666'	254000	001053'		JRST	CLIBDR			;GET RID OF ATB IF NO MAPPERS.
  2695									; NOTE THAT WE SKIP AROUND TRYING TO GET RIB IN CLOSE.
  2696									; NOTE THAT ATBRIB CAN BE ZERO IN RIB ERROR CASE!
  2697									; CODE THAT WE CALL HERE IN CLOSE HAD BETTER
  2698									; NOT CALL ANYTHING THAT NEEDS ATBRIB.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 56
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2699				;HERE TO RENAME A FILE TO SOMETHING (NOT DELETE)
  2700	003667'	200415	003653*	RENAM3:	MOVE	T3,ATBSTS(P2)
  2701	003670'	606400	003634*		TRNN	T3,ATPDEL		;% MUST NOT BE MARKED FOR DEL
  2702	003671'	260040	003611*		PUSHJ	P,TSTWRT
  2703	003672'	254000	005126'		  JRST	UPDER3			;% BEING WRITTEN
  2704	003673'	201300	000005		MOVEI	T1,DECSTP
  2705	003674'	137300	003614*		DPB	T1,DEYSTC
  2706	003675'	201300	001133*		MOVEI	T1,ATPREN
  2707	003676'	436315	003667*		IORM	T1,ATBSTS(P2)		;% SET RENAME
  2708	003677'	554744	003605*		HLRZ	P4,DEVDRB(F)
  2709	003700'	350357	003623*		AOS	T2,DRBCNT(P4)		;% ONE EXTR COUNT
  2710	003701'	602340	002655*		TRNE	T2,DRPMXC
  2711	003702'	256000	000000'		 STOPCD (SLO)
  2712							;;RENAM3+13
  2713	003703'	260040	003116'		PUSHJ	P,GETPPN
  2714	003704'	312304	000017		CAME	T1,DEVPPN(F)		;% YES. CHANGING PPN?
  2715	003705'	254000	003717'		  JRST	RENM4B			;% YES.
  2716	003706'	260040	003106'		PUSHJ	P,GETNAM
  2717	003707'	312304	000015		CAME	T1,DEVFIL(F)		;% RENAMING TO SAME NAME?
  2718	003710'	254000	003716'		  JRST	RENAM4			;% NO
  2719	003711'	260040	003112'		PUSHJ	P,GETEXT
  2720	003712'	513000	000006		HLLZS	T1
  2721	003713'	510344	000016		HLLZ	T2,DEVEXT(F)		;% OLD EXTENSION
  2722	003714'	316300	000007		CAMN	T1,T2			;% SAME?
  2723	003715'	254000	004144'		  JRST	RENAM6			;% YES
  2724
  2725	003716'	334300	006215'	RENAM4:	SKIPA	T1,[FNCCNM]
  2726	003717'	201300	003606*	RENM4B:	MOVEI	T1,FNCDEL		;% CHANGING DIRECTORIES
  2727	003720'	260040	003607*		PUSHJ	P,CHKPRV		;%
  2728	003721'	254000	005200'		  JRST	RENER7			;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 57
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2729				;% HERE WHEN RENAME HAS BEEN CHECKED (IF CHANGING DIRECTORIES)
  2730	003722'	260040	003122'	RENM4A:	PUSHJ	P,SETFIL		;% SET NAME INTO DEVFIL ETC
  2731	003723'	256000	000000'		 STOPCD (SLO)
  2732							;;RENM4A+1  ;% ALREADY KNOW NAME NON-ZERO
  2733	003724'	260040	003665*		PUSHJ	P,GIVCBR		;%
  2734	003725'	260040	003561*		PUSHJ	P,SRCFIL		;CHECK THAT NEW FILE NAME DOESN'T EXIST
  2735	003726'	254000	005172'		  JRST	RENER9			;NEW FILE NAME ALREADY EXISTS
  2736	003727'	661540	040000		TLO	M,UUOENT		;FLAG THIS SO WE KNOW NAME CHANGE
  2737	003730'	554304	003677*		HLRZ	T1,DEVDRB(F)
  2738	003731'	312300	000017		CAME	T1,P4
  2739	003732'	621540	010000		  TLZ	M,UUOREN		;REN ON IF NO DIR CHANGE
  2740	003733'	260040	004134'		PUSHJ	P,RENNMR
  2741	003734'	550304	003573*		HRRZ	T1,DEVATB(F)		;NEW ATB
  2742	003735'	542644	003734*		HRRM	P2,DEVATB(F)		;PUT BACK OLD
  2743	003736'	500304	003730*		HLL	T1,DEVDRB(F)
  2744	003737'	506744	003736*		HRLM	P4,DEVDRB(F)
  2745	003740'	202315	001413*		MOVEM	T1,ATBDOR(P2)		;CROSS LINK THROUGH ATBDOR
  2746	003741'	542646	003740*		HRRM	P2,ATBDOR(T1)
  2747	003742'	506746	003741*		HRLM	P4,ATBDOR(T1)
  2748	003743'	260040	003006*		PUSHJ	P,RIBWTL
  2749	003744'	254000	005214'		 JRST	RENRR2			;ERROR READING RIB
  2750	003745'	603540	010000		TLNE	M,UUOREN
  2751	003746'	254000	004001'		  JRST	RENAM7			;NOT CHANGING DIRECTORY
  2752	003747'	554755	003742*		HLRZ	P4,ATBDOR(P2)
  2753	003750'	550655	003747*		HRRZ	P2,ATBDOR(P2)
  2754	003751'	260040	004134'		PUSHJ	P,RENNMR
  2755	003752'	201300	002320*		MOVEI	T1,FNCCRE
  2756	003753'	260040	003720*		PUSHJ	P,CHKPRV		;CAN WE CREATE IN NEW DIRECTORY?
  2757	003754'	254000	005234'		  JRST	RENRR1			;NO
  2758	003755'	550644	003735*		HRRZ	P2,DEVATB(F)
  2759	003756'	554744	003737*		HLRZ	P4,DEVDRB(F)
  2760	003757'	260040	004134'		PUSHJ	P,RENNMR
  2761	003760'	554315	003750*		HLRZ	T1,ATBDOR(P2)
  2762	003761'	210355	002336*		MOVN	T2,ATBALP(P2)		;FILE SIZE
  2763	003762'	270346	002326*		ADD	T2,DRBALC(T1)
  2764				PRINTF(<[RENM4A++ STROVR check for room in dir, must check file STR+STROVR]>)
  2765	003763'	315340	000000*		CAMGE	T2,STRDDB+STROVR
  2766	003764'	254000	005240'		  JRST	RENRR0			;NO ROOM IN NEW DIRECTORY
  2767	003765'	202346	003762*		MOVEM	T2,DRBALC(T1)
  2768	003766'	315346	002260*		CAMGE	T2,DRBMXA(T1)
  2769	003767'	202346	003766*		  MOVEM	T2,DRBMXA(T1)
  2770	003770'	200315	003761*		MOVE	T1,ATBALP(P2)
  2771	003771'	270317	003765*		ADD	T1,DRBALC(P4)
  2772	003772'	331017	003771*		SKIPL	DRBALC(P4)		;DO NOT LET IT OVERFLOW
  2773	003773'	331000	000006		  SKIPL	T1
  2774	003774'	202317	003772*		 MOVEM	T1,DRBALC(P4)
  2775	003775'	260040	002550'		PUSHJ	P,SAVLIC
  2776	003776'	542315	002663*		HRRM	T1,ATBLIC(P2)
  2777	003777'	525300	000000*		HRLOI	T1,ATMUFP!ATMCSC	;SAVE UNPROTECTED PART OF UFD BITS
  2778	004000'	406315	003016*		ANDM	T1,ATBLCW(P2)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 58
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2779				;NOW INTERCHANGE THE ATB ETC
  2780	004001'	260040	003657*	RENAM7:	PUSHJ	P,GETCBR		;%
  2781	004002'	135300	000000*		LDB	T1,ATYCNT		;% GET COUNT IN OLD ATB
  2782	004003'	205340	001264*		MOVSI	T2,ATMUMC		;% IF UMC IS NON-ZERO, THEN DRBCNT
  2783	004004'	612355	000000*		TDNE	T2,ATBUMC(P2)		;% WAS INCREMENTED ONCE FOR IT
  2784					  ADDI	T1,1			;% SO CAUSE DRBCNT TO GET INCREMENTED AND DECREMENTED C
  2785	004005'	271300	000001	ORRECTLY
  2786	004006'	554355	003760*		HLRZ	T2,ATBDOR(P2)		;% NEW DRB
  2787	004007'	200400	000006		MOVE	T3,T1
  2788	004010'	273407	003700*		ADDB	T3,DRBCNT(T2)
  2789	004011'	602400	003701*		TRNE	T3,DRPMXC
  2790	004012'	256000	000000'		 STOPCD (SLO)
  2791							;;RENAM7+11
  2792	004013'	213000	000006		MOVNS	T1
  2793	004014'	273317	004010*		ADDB	T1,DRBCNT(P4)		;% DECREMENT OLDCOUNT
  2794	004015'	602300	004011*		TRNE	T1,DRPMXC
  2795	004016'	256000	000000'		 STOPCD (SLO)
  2796							;;RENAM7+15
  2797	004017'	550455	004006*		HRRZ	T4,ATBDOR(P2)
  2798	004020'	500315	001421*		HLL	T1,ATBLNK(P2)		;% OLD LINK
  2799	004021'	500351	004020*		HLL	T2,ATBLNK(T4)		;% NEW LINK
  2800	004022'	502311	004021*		HLLM	T1,ATBLNK(T4)
  2801	004023'	502355	004022*		HLLM	T2,ATBLNK(P2)		;% INTERCHANGE
  2802	004024'	550311	003640*		HRRZ	T1,ATBFNB(T4)		;% GET OLD FNB ADDRESS
  2803	004025'	200306	001773*		MOVE	T1,FNBALT(T1)		;% GET OLD ALT
  2804	004026'	202316	004025*		MOVEM	T1,FNBALT(P3)		;% AND PUT IT INTO NEW FNB
  2805	004027'	120315	002765*		DMOVE	T1,ATBSIZ(P2)
  2806	004030'	124311	004027*		DMOVEM	T1,ATBSIZ(T4)		;% MOVE SOME INFORMATION
  2807	004031'	200315	003770*		MOVE	T1,ATBALP(P2)
  2808	004032'	202311	004031*		MOVEM	T1,ATBALP(T4)
  2809	004033'	200315	004000*		MOVE	T1,ATBLCW(P2)
  2810	004034'	202311	004033*		MOVEM	T1,ATBLCW(T4)
  2811	004035'	500315	002752*		HLL	T1,ATBMSC(P2)
  2812	004036'	502311	004035*		HLLM	T1,ATBMSC(T4)
  2813	004037'	201316	000000*		MOVEI	T1,FNBATB-ATBLNK(P3)
  2814	004040'	554346	004023*	RNM7A:	HLRZ	T2,ATBLNK(T1)
  2815	004041'	336000	000007		SKIPN	T2
  2816	004042'	256000	000000'		 STOPCD (SLO)
  2817							;;RNM7A+2
  2818	004043'	302355	000000		CAIE	T2,(P2)			;% FOUND POINTER TO CURRENT?
  2819	004044'	254000	004040'		  JRST	RNM7A
  2820	004045'	506446	004040*		HRLM	T4,ATBLNK(T1)		;% POINT TO NEW
  2821	004046'	550311	004024*		HRRZ	T1,ATBFNB(T4)
  2822	004047'	542315	004046*		HRRM	T1,ATBFNB(P2)		;% REPLACE BACK POINTER WHILE WE HAVE IT
  2823	004050'	201306	000000*		MOVEI	T1,FNBATB-ATBLNK(T1)
  2824	004051'	554346	004045*	RNM7B:	HLRZ	T2,ATBLNK(T1)
  2825	004052'	336000	000007		SKIPN	T2
  2826	004053'	256000	000000'		 STOPCD (SLO)
  2827							;;RNM7B+2
  2828	004054'	302351	000000		CAIE	T2,(T4)
  2829	004055'	254000	004051'		  JRST	RNM7B
  2830	004056'	506646	004051*		HRLM	P2,ATBLNK(T1)
  2831	004057'	542711	004047*		HRRM	P3,ATBFNB(T4)		;% AND OTHER BACK POINTER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 58-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2832	004060'	504440	000017		HRL	T4,P4
  2833	004061'	554755	004017*		HLRZ	P4,ATBDOR(P2)
  2834	004062'	502455	004061*		HLLM	T4,ATBDOR(P2)		;% NOW NEED TO RESET ATBDOR LINKS
  2835	004063'	506751	004062*		HRLM	P4,ATBDOR(T4)		;% ALSO
  2836	004064'	542644	003755*		HRRM	P2,DEVATB(F)
  2837	004065'	506744	004064*		HRLM	P4,DEVATB(F)		;% NOW HAVE THE NEW ONE
  2838	004066'	550715	004057*		HRRZ	P3,ATBFNB(P2)
  2839	004067'	200316	000000*		MOVE	T1,FNBNAM(P3)
  2840	004070'	202304	000015		MOVEM	T1,DEVFIL(F)
  2841	004071'	202300	376000*		MOVEM	T1,%RIB+RIBNAM
  2842	004072'	200316	000000*		MOVE	T1,FNBEXT(P3)
  2843	004073'	506304	000016		HRLM	T1,DEVEXT(F)
  2844	004074'	506300	376000*		HRLM	T1,%RIB+RIBEXT
  2845	004075'	200317	003231*		MOVE	T1,DRBNAM(P4)		;% RESET ALL NAMES
  2846	004076'	202304	000017		MOVEM	T1,DEVPPN(F)
  2847	004077'	202300	376000*		MOVEM	T1,%RIB+RIBPPN
  2848	004100'	550415	004063*		HRRZ	T3,ATBDOR(P2)		;% GET OLD FNB
  2849	004101'	550410	004066*		HRRZ	T3,ATBFNB(T3)
  2850	004102'	201310	000000*		MOVEI	T1,FNBDBL-DEVDBL(T3)	;% GET SET TO RELINK DDBS
  2851	004103'	550410	000000*		HRRZ	T3,FNBDBL(T3)
  2852	004104'	550350	004065*	DBRLP:	HRRZ	T2,DEVATB(T3)
  2853	004105'	302355	000000		CAIE	T2,(P2)			;% IF IT POINTS TO THIS ACCESS TABLE
  2854	004106'	254000	004124'		  JRST	DBRNXT			;% (IF NOT IGNORE IT)
  2855	004107'	550350	000000*		HRRZ	T2,DEVDBL(T3)		;% THEN LINK AROUND
  2856	004110'	542346	004107*		HRRM	T2,DEVDBL(T1)
  2857	004111'	550356	004103*		HRRZ	T2,FNBDBL(P3)
  2858	004112'	542350	004110*		HRRM	T2,DEVDBL(T3)		;% AND LINKK INTO NEW
  2859	004113'	542416	004111*		HRRM	T3,FNBDBL(P3)
  2860	004114'	261040	000006		PUSH	P,T1			;% SAVE BACK POINTER
  2861	004115'	120304	000015		DMOVE	T1,DEVFIL(F)
  2862	004116'	202310	000015		MOVEM	T1,DEVFIL(T3)
  2863	004117'	502350	000016		HLLM	T2,DEVEXT(T3)
  2864	004120'	200304	000017		MOVE	T1,DEVPPN(F)
  2865	004121'	202310	000017		MOVEM	T1,DEVPPN(T3)		;% RESET NAME
  2866	004122'	506750	003756*		HRLM	P4,DEVDRB(T3)
  2867	004123'	262040	000010		POP	P,T3			;% USE OLD BACK POINTER TO COUNTINUE
  2868	004124'	200300	000010	DBRNXT:	MOVE	T1,T3			;% REMEMBER BACK POINTER
  2869	004125'	550410	004112*		HRRZ	T3,DEVDBL(T3)
  2870	004126'	326400	004104'		JUMPN	T3,DBRLP
  2871	004127'	260040	003724*		PUSHJ	P,GIVCBR		;% FINISHED RESETTING
  2872	004130'	254000	004152'		JRST	RENAM8
  2873
  2874	004131'	200655	004100*	RENNXR:	MOVE	P2,ATBDOR(P2)
  2875	004132'	202644	004104*		MOVEM	P2,DEVATB(F)
  2876	004133'	554740	000015		HLRZ	P4,P2			;% RESET ATB, DRB POINTERS ALSO
  2877
  2878	004134'	550715	004101*	RENNMR:	HRRZ	P3,ATBFNB(P2)
  2879	004135'	200316	004067*		MOVE	T1,FNBNAM(P3)
  2880	004136'	202304	000015		MOVEM	T1,DEVFIL(F)		;% PUT BACK OLD NAME BEFORE READING RIB
  2881	004137'	550316	004072*		HRRZ	T1,FNBEXT(P3)
  2882	004140'	506304	000016		HRLM	T1,DEVEXT(F)
  2883	004141'	200317	004075*		MOVE	T1,DRBNAM(P4)
  2884	004142'	202304	000017		MOVEM	T1,DEVPPN(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 58-3
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2885	004143'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 59
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2886
  2887	004144'	260040	004127*	RENAM6:	PUSHJ	P,GIVCBR		;%
  2888	004145'	201300	000000*		MOVEI	T1,FNCCPR		;CAN HE MODIFY FILE
  2889	004146'	260040	003753*		PUSHJ	P,CHKPRV
  2890	004147'	254000	005201'		  JRST	RENRR3
  2891	004150'	260040	003743*		PUSHJ	P,RIBWTL
  2892	004151'	254000	005212'		  JRST	RENRR4
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 60
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2893				;HERE WITH THE RIB IN THE MON BUF, M POINTING TO PPN WORD
  2894	004152'			RENAM8:	;;TLZ S,IOSRIB		;MAKE SURE WE DON'T CONFUCE DIR ROUTINES
  2895					;;This was moved to RENSTS+1 so DLTTRC can't botch it up/WRS
  2896	004152'	205300	000000*		MOVSI	T1,ATPPID!ATPDMP	;CLEAR BIT THAT SAYS THERE
  2897									; IS A PID AND FILE DUMPED BIT
  2898	004153'	412315	004034*		ANDCAM	T1,ATBLCW(P2)		;GETS STORED INTO RIB AT RENDEA
  2899	004154'	402015	003013*		SETZM	ATBPID(P2)		;ZERO PID IN ATB AND
  2900	004155'	402000	376000*		SETZM	%RIB+RIBPID		; RIB.
  2901	004156'	607540	200000		TLNN	M,EXTUUO		;EXTENDED M?
  2902	004157'	254000	004163'		  JRST	RENM8A			;NO. POINT TO ATT WORD
  2903	004160'	305600	000004		CAIGE	P1,UUXPRV		;SPECIFYING ATTRIBUTES?
  2904	004161'	254000	004255'		  JRST	RENDEA			;NO
  2905	004162'	256200	006216'		XCTFU	<SKIPA P3,UUXPRV(M)>
  2906	004163'	704713	000002	RENM8A:	  UMOVE	P3,UUNATT(M)		;GET ATTRIBUTES WORD
  2907	004164'	322700	004235'		JUMPE	P3,RENAM9		;NO CHANGE
  2908	004165'	200340	000016		MOVE	T2,P3
  2909	004166'	430355	002750*		XOR	T2,ATBPVW(P2)		;COMPARE WITH RIB ATTR. WORD
  2910	004167'	260040	003112'		PUSHJ	P,GETEXT		;GET EXTENSION WORD
  2911	004170'	554415	004036*		HLRZ	T3,ATBMSC(P2)
  2912	004171'	430300	000010		XOR	T1,T3
  2913	004172'	606300	140000		TRNN	T1,140000		;SEE IF EXTENDED DATE CHANGING
  2914	004173'	322340	004235'		  JUMPE	T2,RENAM9		;SAME IF 0
  2915	004174'	525400	000037		HRLOI	T3,37			;SET UP MASK FOR PRIVS, MODE
  2916	004175'	406415	004166*		ANDM	T3,ATBPVW(P2)		;TAKE PRIVS, MODE OUT OF RIB
  2917	004176'	410400	000016		ANDCA	T3,P3			;GET PRIVS FROM USER
  2918	004177'	436415	004175*		IORM	T3,ATBPVW(P2)		;AND SET THEM IN RIB WORD
  2919	004200'	201300	003616*		MOVEI	T1,ATPDIR
  2920	004201'	612315	003676*		TDNE	T1,ATBSTS(P2)
  2921	004202'	607340	777000		  TLNN	T2,777000
  2922	004203'	254000	004215'		 JRST	RENM9B			;ARE WE CHANGING PROT OF A UFD?
  2923	004204'	260040	004001*		PUSHJ	P,GETCBR		;% YES!
  2924	004205'	200304	000015		MOVE	T1,DEVFIL(F)		;%
  2925	004206'	260040	003621*		PUSHJ	P,FNDDRB		;% SEE IF A DRB BLOCK FOR IT
  2926	004207'	254000	004214'		  JRST	RENM9A			;%
  2927	004210'	135300	001634*		LDB	T1,ATYPRV		;%
  2928	004211'	250740	000007		EXCH	P4,T2			;%
  2929	004212'	137300	000000*		DPB	T1,DRYPRV		;%
  2930	004213'	200740	000007		MOVE	P4,T2			;%
  2931	004214'	260040	004144*	RENM9A:	PUSHJ	P,GIVCBR		;% AND RETURN CB RESOURCE
  2932	004215'	260040	003112'	RENM9B:	PUSHJ	P,GETEXT
  2933	004216'	606300	140000		TRNN	T1,140000		;IS ANYTHING BUT PROTECTION
  2934	004217'	612700	006135'		  TDNE	P3,[37,,-1]		;NON-ZERO
  2935	004220'	334000	000000		 SKIPA				;YES
  2936	004221'	254000	004227'		  JRST	RENM9C			;NO, DO NOT CHANGE IT
  2937	004222'	242300	777762		LSH	T1,-^D14
  2938	004223'	137300	002741*		DPB	T1,ATYXCD
  2939	004224'	137700	000000*		DPB	P3,ATYCTD
  2940	004225'	200315	004170*		MOVE	T1,ATBMSC(P2)
  2941	004226'	546300	376000*		HLRM	T1,%RIB+RIBEXT		;NOW UPDATE RIB
  2942	004227'	200315	004177*	RENM9C:	MOVE	T1,ATBPVW(P2)
  2943	004230'	202300	376000*		MOVEM	T1,%RIB+RIBPVW
  2944	004231'	607540	200000		TLNN	M,EXTUUO
  2945					  JRST	[UMOVEM T1,UUNATT(M)	;GIVE IT TO USER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 60-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2946	004232'	254000	006217'			 JRST   RENDEA]
  2947	004233'	301600	000004		CAIL	P1,UUXPRV
  2948	004234'	705313	000004		 UMOVEM	T1,UUXPRV(M)	;USER WANTS IT
  2949	004235'	607540	200000	RENAM9:	TLNN	M,EXTUUO	;
  2950	004236'	254000	004255'		  JRST	RENDEA		;
  2951	004237'	305600	000011		CAIGE	P1,UUXALC	;
  2952	004240'	254000	004254'		  JRST	RENRIB		;NOT CHANGING ALLOC.
  2953	004241'	260040	002755'		PUSHJ	P,ALCCHK	;CHANGING ALLOCATION?
  2954	004242'	254000	004254'		  JRST	RENRIB		;NO.
  2955	004243'	260040	003003*		PUSHJ	P,DLTTRC	;AND REMOVE PAGES
  2956	004244'	254000	004246'		  JRST	.+2		;ERR ON TRUNC, BAD FILE NOW.
  2957	004245'	254000	004250'		 JRST	RENM9D		;SUCCESS.
  2958	004246'	260040	004150*		PUSHJ	P,RIBWTL	;MOST UNGRACEFUL ERROR HANDLING.
  2959	004247'	256000	000000'		 STOPCD (SLO)
  2960				           ;;RENAM9+12
  2961	004250'	550315	004134*	RENM9D:	HRRZ	T1,ATBFNB(P2)	;GET FNB ADDRESS
  2962	004251'	200340	001771*		MOVE	T2,PCDTIM	;GET CURRENT PCB TIMER
  2963	004252'	202346	004026*		MOVEM	T2,FNBALT(T1)	;SET IN FNB AND
  2964	004253'	202340	376000*		MOVEM	T2,%RIB+RIBALT	;RIB.
  2965
  2966				;FALL INTO RENRIB
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 61
FILUUO.MAC	19-SEP-89 19:52		RENAME

  2967	004254'	260040	004427'	RENRIB:	PUSHJ	P,SETVAL		;STORE ARGUMENTS FROM USER IN RIB
  2968
  2969	004255'	200315	004153*	RENDEA:	MOVE	T1,ATBLCW(P2)
  2970	004256'	200340	376000*		MOVE	T2,%RIB+RIBSTS
  2971	004257'	606340	000000*		TRNN	T2,RIPHWE!RIPHRE!RIPBDA!RIPBFS!RIPBDR
  2972	004260'	625300	001337*		  TLZA	T1,ATPUFE
  2973	004261'	661300	004260*		 TLO	T1,ATPUFE		;KEEP ERROR BIT CORRECT
  2974	004262'	202315	004255*		MOVEM	T1,ATBLCW(P2)
  2975	004263'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  2976	004264'	135300	003517*		LDB	T1,PJOBN
  2977	004265'	500306	002551*		HLL	T1,JBTLIC(T1)		; KEEP JOB# IN RH FOR LATER
  2978	004266'	603300	000002		TLNE	T1,LICWFL		; LET USER SET RIPSPP IF HAS WF
  2979	004267'	254000	004274'		 JRST	RENSTS
  2980	004270'	200306	003214*		MOVE	T1,JBTPPN(T1)
  2981	004271'	312304	000017		CAME	T1,DEVPPN(F)		;IS IT THE SAME
  2982	004272'	624340	002352*		  TRZA	T2,RIPSPP		;NO RESET
  2983	004273'	660340	004272*		 TRO	T2,RIPSPP		;OR SET
  2984	004274'	202340	376000*	RENSTS:	MOVEM	T2,%RIB+RIBSTS
  2985	004275'	260040	003564*		PUSHJ	P,RELLOK		;ALL DONE
  2986	004276'	621000	003563*		TLZ	S,IOSRIB		;DIR### routines die if they think its there
  2987	004277'	603540	040000		TLNE	M,UUOENT		;IS THERE A NAME CHANGE?
  2988	004300'	254000	004326'		  JRST	RENNMC			;YES, DO IT
  2989	004301'	260040	001732*		PUSHJ	P,RIBDIR
  2990	004302'	254000	004314'		  JRST	RENR7A			;CAN NOT GET IT
  2991	004303'	550715	004250*		HRRZ	P3,ATBFNB(P2)
  2992	004304'	135300	001736*		LDB	T1,FNYUFP
  2993	004305'	661000	000020		TLO	S,IO			;WANT UFD PAGE WRITEABLE.
  2994	004306'	260040	001741*		PUSHJ	P,DIRBLK
  2995	004307'	254000	004315'		  JRST	RENRR7			;CAN NOT GET IT
  2996	004310'	260040	001743*		PUSHJ	P,DIRSRC
  2997	004311'	334000	000000		  SKIPA				;FOUND IT
  2998	004312'	256000	001750'		 STOPCD (,XCT,UFDER1)
  2999						;UFD error return from DIRSRC ;;RENSTS+16
  3000	004313'	260040	001545'		PUSHJ	P,CREUFD		;UPDATE UFD WITH NEW VALUES
  3001	004314'	260040	004275*	RENR7A:	PUSHJ	P,RELLOK		;DONE WITH UFD BLOCK
  3002	004315'	201300	003675*	RENRR7:	MOVEI	T1,ATPREN
  3003	004316'	412315	004201*		ANDCAM	T1,ATBSTS(P2)		;RESET FLAG
  3004	004317'	370317	004014*	RENECM:	SOS	T1,DRBCNT(P4)
  3005	004320'	602300	004015*		TRNE	T1,DRPMXC
  3006	004321'	256000	000000'		 STOPCD (SLO)
  3007							;;RENECM+2
  3008	004322'	350001	000000		AOS	(P)
  3009	004323'	260040	001703*		PUSHJ	P,WATPCB		;WAIT FOR THE RIB PCBS TO BE VAIDATED.
  3010	004324'	201540	000010		MOVEI	M,CLSACC		;NO ACCESS DATE UPDATE ON FORCED CLOSE
  3011	004325'	324740	003546*		PJRST	CLOSE1			;FINISH UP
  3012
  3013	004326'	607540	010000	RENNMC:	TLNN	M,UUOREN		;NAME CHANGE, DIRECTORY ALSO?
  3014	004327'	254000	004364'		  JRST	RENDCR			;YES, MUST DELETE OLD AND CREATE NEW
  3015	004330'	550315	004131*		HRRZ	T1,ATBDOR(P2)
  3016	004331'	550306	004303*		HRRZ	T1,ATBFNB(T1)
  3017	004332'	200306	004135*		MOVE	T1,FNBNAM(T1)		;GET OLD NAME
  3018	004333'	621300	400000		TLZ	T1,(1B0)
  3019	004334'	200344	000015		MOVE	T2,DEVFIL(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 61-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3020	004335'	621340	400000		TLZ	T2,(1B0)
  3021	004336'	274300	000007		SUB	T1,T2
  3022	004337'	550340	000000*		HRRZ	T2,STRDDB+STRHSH
  3023	004340'	231307	000000		IDIVI	T1,(T2)
  3024	004341'	326340	004364'		JUMPN	T2,RENDCR		;DIFFERENT NAME FORCES DELETE AND CREATE
  3025	004342'	260040	004131'		PUSHJ	P,RENNXR		;GET READY TO FIND OLD NAME
  3026	004343'	550715	004331*		HRRZ	P3,ATBFNB(P2)
  3027	004344'	260040	004301*		PUSHJ	P,RIBDIR
  3028					 JRST	[PUSHJ	P,RELLOK
  3029	004345'	254000	006221'			 JRST	RENZAP]		;CAN NOT READ UFD
  3030	004346'	135300	004304*		LDB	T1,FNYUFP
  3031	004347'	260040	004306*		PUSHJ	P,DIRBLK
  3032	004350'	254000	004370'		  JRST	RENZAP
  3033	004351'	260040	004310*		PUSHJ	P,DIRSRC		;SEARCH THIS PAGE.
  3034	004352'	334000	000000		  SKIPA	
  3035	004353'	256000	001750'		 STOPCD (,XCT,UFDER1)
  3036						;UFD error return from DIRSRC ;;RENNMC+24
  3037	004354'	261040	000007		PUSH	P,T2			;SAVE LOCATION
  3038	004355'	135300	004346*		LDB	T1,FNYUFP		;SAVE THIS
  3039	004356'	261040	000006		PUSH	P,T1			;FOR OTHER ENTRY.
  3040	004357'	260040	004131'		PUSHJ	P,RENNXR		;GET NEW NAME BACK
  3041	004360'	262040	000007		POP	P,T2			;GET OLD FNYUFP BACK.
  3042	004361'	137340	004355*		DPB	T2,FNYUFP
  3043	004362'	262040	000007		POP	P,T2
  3044	004363'	254000	004376'		JRST	RENFL1			;AND DO IT LIKE CREATE
  3045
  3046	004364'	260040	004131'	RENDCR:	PUSHJ	P,RENNXR		;GET SET TO DELETE OLD NAME
  3047	004365'	260040	003643*		PUSHJ	P,DLTNAM
  3048	004366'	607540	010000		TLNN	M,UUOREN		;CHANGE OF DIR OR JUST NAME
  3049	004367'	260040	001527'		  PUSHJ	P,LOGTST		;DIR, REWRITE IF NEEDED
  3050	004370'	260040	004131'	RENZAP:	PUSHJ	P,RENNXR		;NOW TRY TO CREATE NEW
  3051	004371'	607540	010000		TLNN	M,UUOREN
  3052	004372'	260040	001527'		  PUSHJ	P,LOGTST
  3053	004373'	400340	000000		SETZ	T2,			;FLAG NO RET PNTR FOR INSNAM.
  3054	004374'	260040	001445*		PUSHJ	P,INSNAM
  3055	004375'	254000	004400'		  JRST	RENFL2			;COULD NOT(ALLOC FAIL/RIB ERR/DIR FULL).
  3056	004376'	260040	001545'	RENFL1:	PUSHJ	P,CREUFD		;STORE INFORMATION
  3057	004377'	260040	004314*		PUSHJ	P,RELLOK
  3058	004400'	550715	004343*	RENFL2:	HRRZ	P3,ATBFNB(P2)
  3059	004401'	260040	004204*		PUSHJ	P,GETCBR		;%
  3060	004402'	205300	003647*		MOVSI	T1,FNPNX		;%
  3061	004403'	412316	003650*		ANDCAM	T1,FNBNX(P3)		;% RESET FOR NEW NAME
  3062	004404'	200315	003575*		MOVE	T1,ATBRIB(P2)		;%
  3063	004405'	202316	003651*		MOVEM	T1,FNBRIB(P3)		;%
  3064	004406'	201340	004315*		MOVEI	T2,ATPREN		;%
  3065	004407'	412355	004316*		ANDCAM	T2,ATBSTS(P2)		;%
  3066	004410'	370317	004317*		SOS	T1,DRBCNT(P4)		;%
  3067	004411'	602300	004320*		TRNE	T1,DRPMXC		;%
  3068	004412'	256000	000000'		 STOPCD (SLO)
  3069							;;RENFL2+12
  3070	004413'	201300	000000		MOVEI	T1,0			;%
  3071	004414'	250315	004330*		EXCH	T1,ATBDOR(P2)		;%
  3072	004415'	402006	004414*		SETZM	ATBDOR(T1)		;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 61-3
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3073	004416'	550640	000006		HRRZ	P2,T1			;%
  3074	004417'	554740	000006		HLRZ	P4,T1			;%
  3075	004420'	550715	004400*		HRRZ	P3,ATBFNB(P2)		;%
  3076	004421'	260040	001271*		PUSHJ	P,FREATB		;% GET RID OF ATB NOW ATTACHED TO OLD FNB
  3077	004422'	205300	004402*		MOVSI	T1,FNPNX		;%
  3078	004423'	436316	004403*		IORM	T1,FNBNX(P3)		;%
  3079	004424'	402016	004405*		SETZM	FNBRIB(P3)		;%
  3080	004425'	260040	004214*		PUSHJ	P,GIVCBR		;%
  3081	004426'	254000	004317'		JRST	RENECM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 62
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3082				;SUBROUTINE TO STORE USER-SUPPLIED ARGUMENTS IN THE RIB BLOCK
  3083				;CALLED BY ENTER AND RENAME
  3084				;ENTER WITH P1=NUMBER OF ARGS
  3085
  3086				;-SEP 76 AAA. ADDITIONS FOR PROJ CODES. WF USER CAN SET PJC AT WILL.
  3087				;-	WPJ USER CAN SET PJC ON RENAME OR UPDATE
  3088	004427'	305600	000006	SETVAL:	CAIGE	P1,UUXVER	;Check for extended ENTER block past .RBSIZ
  3089	004430'	263040	000000		 POPJ	P,		;NOT ENOUGH TO WORRY ABOUT
  3090	004431'	200440	004717'		MOVE	T4,UNPARG	;CAN ALWAYS SET UN-PRIV'D ARGS
  3091	004432'	261040	000002		PUSH	P,J
  3092	004433'	135100	004264*		LDB	J,PJOBN
  3093	004434'	135340	000602*		LDB	T2,JBYWPT	;GET LICENSE
  3094	004435'	303340	000001		CAILE	T2,1		;CHECK FOR WRITE-FILES OR WRITE-ABSOLUTE
  3095	004436'	434440	004720'		 IOR	T4,WRTARG	;CAN SET THESE IF WRITE FILES
  3096	004437'	205340	001000		MOVSI	T2,LICJAL
  3097	004440'	612342	004265*		TDNE	T2,JBTLIC(J)
  3098	004441'	434440	004721'		 IOR	T4,JALARG	;CAN SET THESE IF JACCT-LOGIN
  3099	004442'	205340	000001		MOVSI	T2,LICWPJ	;CHECK WRITE PROJECT
  3100	004443'	616342	004440*		TDNN	T2,JBTLIC(J)	;-
  3101	004444'	254000	004450'		 JRST	SETVL0		;-
  3102	004445'	201340	000000*		MOVEI	T2,ATPCRE!ATPSUP;-FOR RENAME OR UPDATE,
  3103	004446'	616355	004407*		TDNN	T2,ATBSTS(P2)	;-(SKIP IF NEITHER)
  3104	004447'	434440	004723'		 IOR	T4,WPJARG	;-LICWPJ USER CAN SET THESE
  3105	004450'	262040	000002	SETVL0:	POP	P,J
  3106	004451'	201340	004200*		MOVEI	T2,ATPDIR
  3107	004452'	616355	004446*		TDNN	T2,ATBSTS(P2)
  3108	004453'	434440	004722'		 IOR	T4,NONUA	;AND CAN SET THESE IF NOT A UFD
  3109	004454'	275600	000005		SUBI	P1,UUXVER-1	;NUMBER WE WANT TO SET
  3110	004455'	213000	000014		MOVNS	P1
  3111	004456'	507000	000014		HRLS	P1		;Make AOBJN pointer
  3112	004457'	541600	000006		HRRI	P1,UUXVER	;Start from .RBVER
  3113	004460'	665540	000014		TLOA	M,P1		;So "@M" uses P1 for indexing
  3114	004461'	242440	000001	SETVL1:	LSH	T4,1		;Get next bit to set
  3115	004462'	325440	004467'		JUMPGE	T4,SETVTU	;Zero bit means user cannot set this word
  3116	004463'	704320	000013		UMOVE	T1,@M		;Get arg from user
  3117	004464'	256014	004465'		XCT FUTAB-UUXVER(P1)	;Store in %RIB or else PUSHJ to routine
  3118	004465'	253600	004461'		AOBJN	P1,SETVL1
  3119	004466'	263040	000000		POPJ	P,		;DONE
  3120
  3121	004467'	256014	002177'	SETVTU:	XCT TUTAB-UUXVER(P1)	;For those args user cannot set,
  3122	004470'	705320	000013		UMOVEM	T1,@M		; return current value to him
  3123	004471'	253600	004461'		AOBJN	P1,SETVL1
  3124	004472'	263040	000000		POPJ	P,
  3125
  3126				;From User to RIB (ENTER), TUTAB is To User (LOOKUP)
  3127	004473'	202300	376000*	FUTAB:	MOVEM T1,%RIB+RIBVER	;06.RBVER Version number
  3128	004474'	202300	376000*		MOVEM T1,%RIB+RIBFUT	;07.RBFUT (.RBSPL Spooling name on ENTER)
  3129	004475'	202300	376000*		MOVEM T1,%RIB+RIBEST	;10.RBEST Estimated size
  3130	004476'	260040	004527'		PUSHJ P,CLFALC		;11.RBALC Allocated size
  3131	004477'	202300	376000*		MOVEM T1,%RIB+RIBPOS	;12.RBPOS Absolute disk position
  3132	004500'	202300	376000*		MOVEM T1,%RIB+RIBFT1	;13.RBFT1 unused (DEC .RBUFW)
  3133	004501'	260040	004724'		PUSHJ P,CLFLIC		;14.RBLIC Check on license he can set
  3134	004502'	202300	376000*		MOVEM T1,%RIB+RIBMTA	;15.RBMTA Tape ID used in last all-files BACKUP
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 62-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3135	004503'	202300	376000*		MOVEM T1,%RIB+RIBDEV	;16.RBDEV Device name
  3136	004504'	260040	004547'		PUSHJ P,CLFSTS		;17.RBSTS File/UFD status bits
  3137	004505'	255000	000000		JFCL			;20.RBELB Disk address of bad page
  3138	004506'	255000	000000		JFCL			;21.RBXT1 unused (DEC .RBEUN)
  3139	004507'	260040	004562'		PUSHJ P,CLFQTF		;22.RBQTF Quota in (check with DRBMXA+DRBALC)
  3140	004510'	202300	376000*		MOVEM T1,%RIB+RIBQTO	;23.RBQTO Quota out (UFDs only)
  3141	004511'	260040	004647'		PUSHJ P,CLFMXA		;24.RBQTR Quota reserved (max used last time)
  3142	004512'	260040	004624'		PUSHJ P,CLFUSD		;25.RBUSD Pages used
  3143	004513'	202300	376000*		MOVEM T1,%RIB+RIBAUT	;26.RBAUT Author
  3144	004514'	260040	004612'		PUSHJ P,CLFUNM		;27.RBUNM Username 1st half
  3145	004515'	260040	004620'		PUSHJ P,CLFUN1		;30.RBUN1 Username 2nd half
  3146	004516'	202300	376000*		MOVEM T1,%RIB+RIBTRU	;31.RBTRU UFD TRU limit
  3147	004517'	202300	376000*		MOVEM T1,%RIB+RIBXT2	;32.RBXT2 ???
  3148	004520'	255000	000000		JFCL			;33.RBALP Allocated pages
  3149	004521'	255000	000000		JFCL			;34.RBSNM Number spare RIBs
  3150	004522'	202300	376000*		MOVEM T1,%RIB+RIBPJC	;35.RBPJC Project code 1-5
  3151	004523'	202300	376000*		MOVEM T1,%RIB+RIBPJ1	;36.RBPJ1 Project code 6-10
  3152	004524'	202300	376000*		MOVEM T1,%RIB+RIBPJ2	;37.RBPJ2 Project code 11-12
  3153	004525'	260040	004674'		PUSHJ P,CLFPID		;40.RBPID Set or clear PID
  3154	004526'	255000	000000		JFCL			;41.RBACT Can never set ACCT from ENTER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 63
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3155
  3156	004527'	704353	000000	CLFALC:	UMOVE	T2,UUXNUM(M)	;ARG IN UNITS OF
  3157	004530'	602340	200000		TRNE	T2,UUPWDS	;WORDS?
  3158	004531'	254000	004542'		  JRST	CLFAL2		;YES.
  3159	004532'	315300	376000*	CLFAL1:	CAMGE	T1,%RIB+RIBEST	;NO. SO WE CAN SIMULATE EST SIZE
  3160	004533'	200300	376000*		  MOVE	T1,%RIB+RIBEST
  3161	004534'	202300	376000*		MOVEM	T1,%RIB+RIBALC
  3162	004535'	135340	003031*		LDB	T2,ATYBLK
  3163	004536'	313340	000006		CAMLE	T2,T1
  3164	004537'	200300	000007		  MOVE	T1,T2
  3165	004540'	705313	000011		UMOVEM	T1,UUXALC(M)	;GIVE USER A FAKE NUMBER
  3166	004541'	263040	000000		POPJ	P,		;SO LOOKS LIKE ALLOC SUCCEDED
  3167	004542'	200340	000006	CLFAL2:	MOVE	T2,T1		;CONVERT THE ARG
  3168	004543'	242300	777771		LSH	T1,W2BLSH	;TO
  3169	004544'	602340	000177		TRNE	T2,177		;BLOCKS, WATCHING OUT FOR
  3170	004545'	344300	004532'		  AOJA	T1,CLFAL1	;OVERFLOW.
  3171	004546'	254000	004532'		JRST	CLFAL1		;
  3172
  3173					DEFINE TXXGEN (AC,NUM,TYP)
  3174				<IFE NUM&777777,<TL'TYP AC,(NUM)>
  3175				 IFN NUM&777777,<
  3176					IFE NUM&777777000000,<TR'TYP AC,NUM>
  3177					IFN NUM&777777000000,<TD'TYP AC,[NUM]>>>
  3178
  3179	004547'	606440	200000	CLFSTS:	TXXGEN (T4,<1B0_<^L<ARGSTS>-^L<ARGPVS>>>,NN)
  3180	004550'	254000	004556'		  JRST	CLFNPS		;NO.
  3181	004551'	201340	002522*		MOVEI	T2,RIPDIR	;DO NOT LET DIR GET SET
  3182	004552'	406340	376000*		ANDM	T2,%RIB+RIBSTS	;JUST THAT BIT
  3183	004553'	620300	004551*		TRZ	T1,RIPDIR
  3184	004554'	436300	376000*		IORM	T1,%RIB+RIBSTS	;PRIV CALL, SET STATUS
  3185	004555'	263040	000000		POPJ	P,
  3186
  3187	004556'	465300	000000*	CLFNPS:	ORCMI	T1,RIPBDA!RIPBFS!RIPHWE!RIPHRE ;SET TO 1
  3188								;ALL BITS BUT ONES WANTED CLEARED.
  3189	004557'	407300	376000*		ANDB	T1,%RIB+RIBSTS	;(DON'T LET CLR RIPBDR.).
  3190	004560'	705313	000017		UMOVEM	T1,UUXSTS(M)	;TELL USER
  3191	004561'	263040	000000		POPJ	P,
  3192
  3193	004562'	201340	004451*	CLFQTF:	MOVEI	T2,ATPDIR
  3194	004563'	616355	004452*		TDNN	T2,ATBSTS(P2)
  3195	004564'	254000	004607'		  JRST	CLFQT1		;NOT A DIRECTORY
  3196	004565'	260040	004401*		PUSHJ	P,GETCBR	;% TRY TO FIND DRB
  3197	004566'	261040	000006		PUSH	P,T1		;%
  3198	004567'	200304	000015		MOVE	T1,DEVFIL(F)	;%
  3199	004570'	260040	004206*		PUSHJ	P,FNDDRB	;%
  3200	004571'	254000	004604'		  JRST	CLFQT2		;% NOT THERE
  3201	004572'	336007	003626*		SKIPN	DRBRIB(T2)	;%
  3202	004573'	254000	004604'		  JRST	CLFQT2		;% NOT REALLY READ YET
  3203	004574'	200700	000007		MOVE	P3,T2		;% SAVE FOR LATER ARGUMENTS
  3204	004575'	262040	000006		POP	P,T1		;%
  3205	004576'	260040	004425*		PUSHJ	P,GIVCBR	;%
  3206	004577'	200340	000006		MOVE	T2,T1
  3207	004600'	274340	376000*		SUB	T2,%RIB+RIBQTF
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 63-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3208	004601'	272356	003767*		ADDM	T2,DRBMXA(P3)
  3209	004602'	272356	003774*		ADDM	T2,DRBALC(P3)
  3210	004603'	254000	004610'		JRST	CLFQT3		;AND GO
  3211
  3212	004604'	260040	004576*	CLFQT2:	PUSHJ	P,GIVCBR	;%
  3213	004605'	262040	000006		POP	P,T1
  3214	004606'	634700	000016		TDZA	P3,P3		;SET 0 AS FLAG FOR LATER ARGS
  3215	004607'	211700	000001	CLFQT1:	  MOVNI	P3,1		;NEGATIVE AS FLAG THAT NOT DIR
  3216	004610'	202300	376000*	CLFQT3:	MOVEM	T1,%RIB+RIBQTF
  3217	004611'	263040	000000		POPJ	P,
  3218
  3219	004612'	323700	004616'	CLFUNM:	JUMPLE	P3,CLFUM1
  3220	004613'	202316	003461*		MOVEM	T1,DRBUNM(P3)	;STORE IT IN DRB IF CHANGING
  3221	004614'	402016	003227*		SETZM	DRBUN1(P3)	;JUST IN CASE
  3222	004615'	402000	376000*		SETZM	%RIB+RIBUN1
  3223	004616'	202300	376000*	CLFUM1:	MOVEM	T1,%RIB+RIBUNM
  3224	004617'	263040	000000		POPJ	P,
  3225
  3226	004620'	333000	000016	CLFUN1:	SKIPLE	P3
  3227	004621'	202316	004614*		  MOVEM	T1,DRBUN1(P3)
  3228	004622'	202300	376000*		MOVEM	T1,%RIB+RIBUN1
  3229	004623'	263040	000000		POPJ	P,
  3230
  3231				EXTERNAL JBTNAM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 64
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3232
  3233	004624'	321700	004634'	CLFUSD:	JUMPL	P3,CLFUS1	;NOT A UFD
  3234	004625'	321300	004641'		JUMPL	T1,CLFUS2	;DOES NOT WANT CHANGED
  3235	004626'	322700	004636'		JUMPE	P3,CLFUS3	;NO DRB, JUST CHANGE RIB
  3236	004627'	200340	376000*		MOVE	T2,%RIB+RIBQTF
  3237	004630'	274340	000006		SUB	T2,T1		;HAVE A DRB, CHANGE FOR NEW USD
  3238	004631'	202356	004602*		MOVEM	T2,DRBALC(P3)
  3239	004632'	315356	004601*		CAMGE	T2,DRBMXA(P3)
  3240	004633'	202356	004632*		  MOVEM	T2,DRBMXA(P3)	;AND THIS IF CHANGED
  3241	004634'	202300	376000*	CLFUS1:	MOVEM	T1,%RIB+RIBUSD
  3242	004635'	263040	000000		POPJ	P,
  3243
  3244	004636'	313300	376000*	CLFUS3:	CAMLE	T1,%RIB+RIBMXA	;MAY HAVE TO CHANGE THIS TOO
  3245	004637'	202300	376000*		  MOVEM	T1,%RIB+RIBMXA
  3246	004640'	254000	004634'		JRST	CLFUS1
  3247
  3248	004641'	332000	000016	CLFUS2:	SKIPE	P3
  3249	004642'	334300	376000*		  SKIPA	T1,%RIB+RIBQTF	;IF WE HAVE DRB, RETURN QTF-ALC
  3250	004643'	334300	376000*		 SKIPA	T1,%RIB+RIBUSD	;ELSE USD FROM RIB
  3251	004644'	274316	004631*		SUB	T1,DRBALC(P3)
  3252	004645'	705313	000025		UMOVEM	T1,UUXUSD(M)
  3253	004646'	263040	000000		POPJ	P,
  3254
  3255	004647'	321700	004664'	CLFMXA:	JUMPL	P3,CLFMX1	;NOT A UFD, JUST ANOTHER ARG
  3256	004650'	321300	004666'		JUMPL	T1,CLFMX2	;DO NOT WANT IT CHANGED
  3257	004651'	322700	004657'		JUMPE	P3,CLFMX3	;CHANGE TO CURRENT USD AND REPORT OLD
  3258	004652'	200356	004644*		MOVE	T2,DRBALC(P3)	;IF HAVE DRB, GET CURRENT
  3259	004653'	250356	004633*		EXCH	T2,DRBMXA(P3)	;AND STORE FOR MAX. GET OLD
  3260	004654'	274340	376000*		SUB	T2,%RIB+RIBQTF	;NOW OLD MAX-QUOTA
  3261	004655'	212340	376000*		MOVNM	T2,%RIB+RIBMXA	;TEMP STORE OLD MAX
  3262	004656'	334300	376000*		SKIPA	T1,%RIB+RIBQTF	;GET QUOTA
  3263	004657'	334300	376000*	CLFMX3:	  SKIPA	T1,%RIB+RIBUSD	;IF NO DRB, GET CURRENT USED
  3264	004660'	274316	004652*		SUB	T1,DRBALC(P3)	;IF DRB QUOTA-CURRENT QUOTA LEFT
  3265	004661'	250300	376000*		EXCH	T1,%RIB+RIBMXA	;SET RIBMXA TO CURRENT USED, GET OLD
  3266	004662'	705313	000024		UMOVEM	T1,UUXMXA(M)
  3267	004663'	263040	000000		POPJ	P,
  3268
  3269	004664'	202300	376000*	CLFMX1:	MOVEM	T1,%RIB+RIBMXA
  3270	004665'	263040	000000		POPJ	P,
  3271
  3272	004666'	332000	000016	CLFMX2:	SKIPE	P3		;IS THERE A DRB
  3273	004667'	334300	376000*		  SKIPA	T1,%RIB+RIBQTF	;YES
  3274	004670'	334300	376000*		 SKIPA	T1,%RIB+RIBMXA	;NO
  3275	004671'	274316	004653*		SUB	T1,DRBMXA(P3)	;NOW HAVE CURRENT MAX
  3276	004672'	705313	000024		UMOVEM	T1,UUXMXA(M)
  3277	004673'	263040	000000		POPJ	P,
  3278
  3279	004674'	325700	003123*	CLFPID:	JUMPGE	P3,CPOPJ	;FORGET IT FOR UFDS
  3280	004675'	322300	004714'		JUMPE	T1,CLFPIZ	;ZEROING PID IS ALWAYS OK
  3281					MOVS	T2,T1		;GET SWAPPED COPY OF NEW PID IN T2 (UUN IN RH INSTEAD OF LEFT H
  3282	004676'	204340	000006	ALF)
  3283	004677'	430342	003205*		XOR	T2,JBTAUN(J)	;SEE IF PID UUN MATCHES JOB'S AUN UUN
  3284	004700'	606340	777777		TRNN	T2,-1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 64-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3285	004701'	254000	004707'		  JRST	CLFPIO		;OK TO GIVE OUT THIS PID
  3286	004702'	135340	004434*		LDB	T2,JBYWPT
  3287	004703'	303340	000001		CAILE	T2,1		;IF HAS WF OR WA,
  3288	004704'	254000	004707'		  JRST	CLFPIO		;OK TO GIVE PID OUT
  3289	004705'	312300	000000*		CAME	T1,%UPT+UPTPID	;PROGRAM TRYING TO GIVE OUT ITS OWN PID?
  3290	004706'	263040	000000		  POPJ	P,		;NO, WAS HIS LAST CHANCE, NO PID.
  3291	004707'	205340	003015*	CLFPIO:	MOVSI	T2,ATPPID
  3292	004710'	436355	004262*		IORM	T2,ATBLCW(P2)	;SET TO GOES INTO UFD ENTRY AND RIBLCW
  3293	004711'	202300	376000*	CLFPIS:	MOVEM	T1,%RIB+RIBPID	;OK, STORE IN RIB AND IN
  3294	004712'	202315	004154*		MOVEM	T1,ATBPID(P2)	;ATB
  3295	004713'	263040	000000		POPJ	P,
  3296	004714'	205340	004707*	CLFPIZ:	MOVSI	T2,ATPPID
  3297	004715'	412355	004710*		ANDCAM	T2,ATBLCW(P2)
  3298	004716'	254000	004711'		JRST	CLFPIS
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 65
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3299					DEFINE XA (A)
  3300				<	A==%%Z
  3301					%%Z==%%Z_-1>
  3302		400000	000000		%%Z==400000,,0
  3303
  3304				;DEFINE 'ALLOWED TO CHANGE' BIT NAMES
  3305
  3306		200000	000000	XA ARGVER
  3307		100000	000000	XA ARGFUT
  3308		040000	000000	XA ARGEST
  3309		020000	000000	XA ARGALC
  3310		010000	000000	XA ARGPOS
  3311		004000	000000	XA ARGFT1
  3312		002000	000000	XA ARGLIC
  3313		001000	000000	XA ARGMTA
  3314		000400	000000	XA ARGDEV
  3315		000200	000000	XA ARGSTS
  3316		000100	000000	XA ARGELB
  3317		000040	000000	XA ARGEUN
  3318		000020	000000	XA ARGQTF
  3319		000010	000000	XA ARGQTO
  3320		000004	000000	XA ARGMXA
  3321		000002	000000	XA ARGUSD
  3322		000001	000000	XA ARGAUT
  3323			400000	XA ARGUNM
  3324			200000	XA ARGUN1
  3325			100000	XA ARGTRU
  3326			040000	XA ARGUFD
  3327			020000	XA ARGALP
  3328			010000	XA ARGSNM
  3329			004000	XA (ARGPJ0)	;-
  3330			002000	XA (ARGPJ1)	;-
  3331			001000	XA (ARGPJ2)	;-
  3332			000400	XA ARGPID
  3333			000200	XA ARGALT
  3334			000100	XA (ARGPVS)	;FAKE TO REMEMBER STATUS PRIV
  3335
  3336				;NOW THE WORDS DEFINING BITS ALLOWED TO CHANGE
  3337
  3338	004717'	774400	101000	UNPARG:	ARGVER+ARGFUT+ARGEST+ARGALC+ARGPOS+ARGFT1+ARGLIC+ARGUFD+ARGSTS+ARGPID
  3339	004720'	002002	016200	WRTARG:	ARGMTA+ARGAUT+ARGPVS+ARGPJ0+ARGPJ1+ARGPJ2	;-
  3340	004721'	000075	600200	JALARG:	ARGQTF+ARGQTO+ARGMXA+ARGUSD+ARGUNM+ARGUN1+ARGTRU+ARGPVS
  3341	004722'	000075	600000	NONUA:	ARGUNM+ARGUN1+ARGTRU+ARGQTF+ARGQTO+ARGMXA+ARGUSD
  3342	004723'	000000	016000	WPJARG:	ARGPJ0+ARGPJ1+ARGPJ2	;-NEW FOR PJC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 66
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3343
  3344	004724'	200355	004715*	CLFLIC:	MOVE	T2,ATBLCW(P2)		;GET CURRENT VALUE
  3345	004725'	261040	000011		PUSH	P,T4
  3346	004726'	603300	000077		TLNE	T1,77			;SPECIFYING SECONDS?
  3347	004727'	665340	000077		  TLOA	T2,77			;YES, VOID OLD FOR MERGE
  3348	004730'	661300	000077		 TLO	T1,77			;NO, VOID NEW FOR MERGE
  3349	004731'	135440	004433*		LDB	T4,PJOBN
  3350	004732'	205400	001002		MOVSI	T3,LICJAL+LICWFL
  3351	004733'	612411	004443*		TDNE	T3,JBTLIC(T4)
  3352	004734'	665340	000000*		  TLOA	T2,ATMUFP!ATMUFU	;LET HIM SET SPECIAL BITS
  3353	004735'	661340	000000*		 TLO	T2,ATMUFU		;JUST THE USUAL ONES
  3354	004736'	520400	000007		HLLO	T3,T2
  3355	004737'	404300	000010		AND	T1,T3			;ADJUST LEFT HALF
  3356	004740'	500351	004733*		HLL	T2,JBTLIC(T4)
  3357	004741'	603340	000002		TLNE	T2,LICWFL		;FIND OUT IF HE HAS WA
  3358	004742'	607340	000001		TLNN	T2,LICWPJ		;
  3359	004743'	625300	000000*		  TLZA	T1,ATPPID!ATPALC	;NO. IGNORE HIS ATPPID AND ATPALC ARGS.
  3360	004744'	254000	004750'		 JRST	CLFLC1			;YES.
  3361	004745'	200415	004724*		MOVE	T3,ATBLCW(P2)		;DOESN'T HAVE WA. DON'T LET HIM CLEAR
  3362	004746'	621400	000000*		TLZ	T3,-<ATPPID!ATPALC>-1	;ATPPID OR ALC
  3363	004747'	434300	000010		IOR	T1,T3
  3364	004750'	200411	004270*	CLFLC1:	MOVE	T3,JBTPPN(T4)
  3365	004751'	430404	000017		XOR	T3,DEVPPN(F)
  3366	004752'	260040	004757'		PUSHJ	P,FILLIC
  3367	004753'	705313	000014		UMOVEM	T1,UUXLCW(M)
  3368	004754'	202315	004745*		MOVEM	T1,ATBLCW(P2)
  3369	004755'	262040	000011		POP	P,T4
  3370	004756'	263040	000000		POPJ	P,
  3371
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 67
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3372
  3373	004757'	621340	002040	FILLIC::TLZ	T2,LICRMT!LICHR		;DON'T LOOK AT THESE (HF + HR)
  3374	004760'	261040	000010		PUSH	P,T3
  3375	004761'	260040	005015'		PUSHJ	P,MAXLIC
  3376	004762'	262040	000010		POP	P,T3
  3377	004763'	607400	777777		TLNN	T3,-1			;SAME PROJ??
  3378	004764'	254000	005002'		  JRST	LICSPJ			;YES
  3379	004765'	606300	000002		TRNN	T1,LICWFL		;CAN NOT SET WRIT PROJ UNLESS
  3380	004766'	602340	000002		TRNE	T2,LICWFL		;SOMEONE HAS WRITE FILE
  3381	004767'	334000	000000		  SKIPA	
  3382	004770'	620300	000001		TRZ	T1,LICWPJ
  3383	004771'	606300	000010		TRNN	T1,LICRFL
  3384	004772'	602340	000010		TRNE	T2,LICRFL
  3385	004773'	334000	000000		  SKIPA	
  3386	004774'	620300	000004		TRZ	T1,LICRPJ
  3387	004775'	606340	002002		TRNN	T2,LICRMT!LICWFL	;SOME ONE MUST HAVE WF OR HF
  3388	004776'	620300	002000		  TRZ	T1,LICRMT		; TO SET HF ON A FILE
  3389	004777'	606340	002052		TRNN	T2,LICRMT!LICHR!LICWFL!LICRFL	;NEED WF,RF OR HF,HR
  3390	005000'	620300	000040		  TRZ	T1,LICHR		; TO SET HR ON A FILE
  3391	005001'	254000	005010'		JRST	LICSPG
  3392
  3393	005002'	616400	006223'	LICSPJ:	TDNN	T3,[XWD INDPPN,-1]
  3394	005003'	254000	005010'		  JRST	LICSPG
  3395	005004'	606340	002003		TRNN	T2,LICRMT!LICWFL!LICWPJ	;NEED HF,WF OR WP
  3396	005005'	620300	002000		  TRZ	T1,LICRMT		; TO SET HF ON A FILE
  3397	005006'	606340	002057		TRNN	T2,LICRMT!LICHR!LICWFL!LICRFL!LICWPJ!LICRPJ
  3398	005007'	620300	000040		  TRZ	T1,LICHR		;NEED ABOVE OR HR,RF OR RP TO SET HR
  3399
  3400	005010'	660340	002040	LICSPG:	TRO	T2,LICRMT!LICHR		;OK TO SET HF OR HR
  3401	005011'	504340	000006		HRL	T2,T1			;  NOT OK TO ASK IF UNABLE TO SET
  3402	005012'	260040	005034'		PUSHJ	P,LICMSK
  3403	005013'	542340	000006		HRRM	T2,T1
  3404	005014'	263040	000000		POPJ	P,
  3405
  3406
  3407				;SET MAX LICENSE OF LEFT HALF OF T2 AND RIGHT HALF OF T2
  3408	005015'	135400	006224'	MAXLIC::LDB	T3,[POINT 2,T2,LICWPS]	;MAX OF WRITE PRVS
  3409	005016'	135440	006225'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3410	005017'	315440	000010		CAMGE	T4,T3
  3411	005020'	200440	000010		  MOVE	T4,T3
  3412	005021'	137440	006225'		DPB	T4,[POINT 2,T2,LICWPS+^D18]
  3413	005022'	135400	006226'		LDB	T3,[POINT 2,T2,LICRPS]	;READ IS MAX OF READ
  3414	005023'	315400	000011		CAMGE	T3,T4			;WRITE PRV. IMPLIES READ SO INCLUDE
  3415	005024'	200400	000011		  MOVE	T3,T4
  3416	005025'	135440	006227'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3417	005026'	315440	000010		CAMGE	T4,T3
  3418	005027'	137400	006227'		  DPB	T3,[POINT 2,T2,LICRPS+^D18]
  3419	005030'	554400	000007		HLRZ	T3,T2
  3420	005031'	620400	000017		TRZ	T3,LICFMK		;TURN OFF ALL READ AND WRITE DSK BITS
  3421	005032'	434340	000010		IOR	T2,T3
  3422	005033'	263040	000000		POPJ	P,
  3423
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 68
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3424
  3425				;SETS LICENSE BY MASKING. LEFT HALF OF T2 IS THE REQUESTED
  3426				;LICENSE. RIGHT HALF IS WHAT HE CAN HAVE
  3427
  3428	005034'	135400	006224'	LICMSK::LDB	T3,[POINT 2,T2,LICWPS]
  3429	005035'	135440	006225'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3430	005036'	315440	000010		CAMGE	T4,T3
  3431	005037'	137440	006224'		  DPB	T4,[POINT 2,T2,LICWPS]
  3432	005040'	135400	006226'		LDB	T3,[POINT 2,T2,LICRPS]
  3433	005041'	135440	006227'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3434	005042'	315440	000010		CAMGE	T4,T3
  3435	005043'	137440	006226'		  DPB	T4,[POINT 2,T2,LICRPS]
  3436	005044'	554400	000007		HLRZ	T3,T2
  3437	005045'	602340	002000		TRNE	T2,LICRMT		;IF HF OK BUT HR UNSPECIFIED
  3438	005046'	660340	000040		  TRO	T2,LICHR		; THEN MAKE HR OK ALSO
  3439	005047'	660340	000017		TRO	T2,LICFMK
  3440	005050'	404340	000010		AND	T2,T3
  3441	005051'	620340	000020		TRZ	T2,LICUNU		;TURN OFF UNUSED BITS JUST IN CASE
  3442	005052'	263040	000000		POPJ	P,
  3443
  3444				COMMENT ! LICSAM
  3445				EXPECTS: T2/ LICENSE (FROM HIGH FILE),,LICENSE(FROM LOW FILE)
  3446				FUNCTION: RETURN T2/ 0,,LICENSES COMMON TO BOTH HALVES
  3447				DESTROY: T3,T4
  3448				NOTE: VIRTUALLY IDENTICAL TO LICMSK. USED BY SEGCON
  3449				!
  3450	005053'	135400	006224'	LICSAM::LDB	T3,[POINT 2,T2,LICWPS]
  3451	005054'	135440	006225'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3452	005055'	312440	000010		CAME	T4,T3
  3453	005056'	621340	000003		  TLZ	T2,3B<LICWPS+^D18>	;DIFFERENT. ZAP WRITE PRIVS
  3454	005057'	135400	006226'		LDB	T3,[POINT 2,T2,LICRPS]
  3455	005060'	135440	006227'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3456	005061'	312440	000010		CAME	T4,T3
  3457	005062'	621340	000014		  TLZ	T2,3B<LICRPS+^D18>	;DIFFERENT. ZAP READ PRIVS
  3458	005063'	554400	000007		HLRZ	T3,T2			;T3/0,,LICS (READ,WRITE PRIVS FIXED)
  3459	005064'	660340	000017		TRO	T2,LICFMK		;R/W PRIV MASK
  3460	005065'	404340	000010		AND	T2,T3			;T2/0,,LICS(ANDED)+R/W PRIVS, FIXED
  3461	005066'	620340	000020		TRZ	T2,LICUNU
  3462	005067'	263040	000000		POPJ	P,
  3463
  3464				;GET LICENSE FROM CORE TABLES. F IS SET UP. RETURN IN T1
  3465				;NON-SKIP RETURN IF NOT DISK. USED BY SEGCON
  3466
  3467	005070'	200304	000004	GETLIC::MOVE	T1,DEVMOD(F)
  3468	005071'	603200	000010		TLNE	F,GETB			;IF OFF A GETSEG, NO LICENSE
  3469	005072'	607300	200000		TLNN	T1,DVDSK
  3470	005073'	254000	003570*		  JRST	CPOPJ1
  3471	005074'	550304	004132*	GETLI1::HRRZ	T1,DEVATB(F)		;ENTERED HERE FROM SEGCON
  3472	005075'	550306	003776*		HRRZ	T1,ATBLIC(T1)
  3473	005076'	200340	003260*		MOVE	T2,JOB
  3474	005077'	200347	004750*		MOVE	T2,JBTPPN(T2)
  3475	005100'	430344	000017		XOR	T2,DEVPPN(F)		;SEE IF IN SAME PROJECT
  3476	005101'	607340	777777		TLNN	T2,-1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 68-2
FILUUO.MAC	19-SEP-89 19:52		RENAME

  3477	005102'	263040	000000		  POPJ	P,			;YES
  3478	005103'	606300	000002		TRNN	T1,LICWFL
  3479	005104'	620300	000001		  TRZ	T1,LICWPJ		;RESET PROJECT READ AND WRITES
  3480	005105'	606300	000010		TRNN	T1,LICRFL		;FROM OTHER PROJECTS
  3481	005106'	620300	000004		  TRZ	T1,LICRPJ
  3482	005107'	263040	000000		POPJ	P,
  3483
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 69
FILUUO.MAC	19-SEP-89 19:52		ERROR RETURNS

  3484					SUBTTL ERROR RETURNS
  3485
  3486	005110'	201300	000000	ILNMER:	MOVEI	T1,FNFERR
  3487	005111'	254000	005165'		JRST	STRERR
  3488
  3489	005112'	621540	200000	LUKER1:	TLZ	M,EXTUUO
  3490	005113'	256200	006230'		XCTFU	<SKIPN T2,(M)>		;DO NOT KNOW YET IF EXTENDED
  3491	005114'	254000	005117'		  JRST	RENER0
  3492	005115'	607340	777777		TLNN	T2,-1
  3493	005116'	661540	200000		  TLO	M,EXTUUO		;IT IS EXTENDED
  3494	005117'	201300	000005	RENER0:	MOVEI	T1,ISUERR
  3495	005120'	254000	005165'		JRST	STRERR
  3496	005121'	201300	000004	UILNMD:	MOVEI	T1,AEFERR		;%
  3497	005122'	260040	004604*	UPDERC:	PUSHJ	P,GIVCBR
  3498	005123'	254000	005165'		JRST	STRERR
  3499
  3500	005124'	201300	000002	UPDER2:	MOVEI	T1,PRTERR		;%
  3501	005125'	254000	005122'		JRST	UPDERC
  3502
  3503	005126'	201300	000003	UPDER3:	MOVEI	T1,FBMERR		;%
  3504	005127'	254000	005122'		JRST	UPDERC
  3505
  3506	005130'	260040	004565*	CLRENT:	PUSHJ	P,GETCBR		;% GET RESOURCE
  3507	005131'	201300	000000*		MOVEI	T1,ATPCRE!ATPSUP	;%
  3508	005132'	413315	004563*	CLRNT1:	ANDCAB	T1,ATBSTS(P2)		;%
  3509	005133'	550715	004420*	CLRCOM:	HRRZ	P3,ATBFNB(P2)		;% IN CASE WE NEED IT (FNB)
  3510	005134'	616300	006231'		TDNN	T1,[ATMUMC,,ATMCNT!ATPREN!ATPUPD!ATPSUP!ATPCRE!ATPMXU]
  3511					  JRST	[PUSHJ  P,FREATB	;%
  3512						 HLLZS  DEVATB(F)	;%
  3513	005135'	254000	006232'			 JRST   .+1]		;%
  3514	005136'	370317	004410*		SOS	T1,DRBCNT(P4)		;%
  3515	005137'	602300	004411*		TRNE	T1,DRPMXC		;%
  3516	005140'	256000	006235'		 STOPCD (.,DISK,CLRCM1,,<CLRCOM decremented DRBCNT too far>);;CLRCOM+5
  3517	005141'	260040	001523*		PUSHJ	P,ULKDBL		;%
  3518	005142'	324740	005122*		PJRST	GIVCBR			; Free CB resource
  3519
  3520	005143'	260040	002177*	LKER1:	PUSHJ	P,RELRIB		;GET RID OF RIB IF WE HAVE IT.
  3521	005144'	201300	000002		MOVEI	T1,PRTERR
  3522	005145'	260040	005165'		PUSHJ	P,STRERR		;SET FLAG
  3523	005146'	260040	005130*		PUSHJ	P,GETCBR		;%
  3524	005147'	200315	000141*		MOVE	T1,ATBCNT(P2)		;% SET ARGUMENT
  3525	005150'	201540	000011		MOVEI	M,CLSACC!CLSOUT		;% MAKE LOOK LIKE A CLOSE
  3526	005151'	324740	001030'		PJRST	CLOSRN			;% IN CASE ATPDEL IS SET (SUPERCEDE)
  3527
  3528	005152'	260040	005130'	ENTER1:	PUSHJ	P,CLRENT
  3529	005153'	201300	000002		MOVEI	T1,PRTERR
  3530	005154'	254000	005163'		JRST	STRERZ
  3531
  3532	005155'	260040	005130'	ENTER2:	PUSHJ	P,CLRENT		;Here when RIB page cannot be allocated
  3533	005156'	201300	000014		MOVEI	T1,NRMERR		;"No room"
  3534	005157'	254000	005163'		JRST	STRERZ
  3535
  3536	005160'	201300	000022	ERRLKM:	MOVEI	T1,LKMERR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 69-2
FILUUO.MAC	19-SEP-89 19:52		ERROR RETURNS

  3537	005161'	254000	005165'		JRST	STRERR
  3538
  3539	005162'	201300	000016	ERRNET:	MOVEI	T1,NETERR
  3540	005163'	201340	000000	STRERZ:	MOVEI	T2,0
  3541	005164'	137340	003674*		DPB	T2,DEYSTC
  3542	005165'	607540	200000	STRERR:	TLNN	M,EXTUUO
  3543	005166'	256200	006130'		  XCTBU	<HRRM T1,UUNEXT(M)>
  3544	005167'	603540	200000		TLNE	M,EXTUUO
  3545	005170'	256200	006131'		  XCTBU	<HRRM T1,UUXEXT(M)>
  3546	005171'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 70
FILUUO.MAC	19-SEP-89 19:52		ERROR RETURNS

  3547	005172'	542644	005074*	RENER9:	HRRM	P2,DEVATB(F)		;PUT THINGS BACK
  3548	005173'	506744	004122*		HRLM	P4,DEVDRB(F)
  3549	005174'	261040	000006		PUSH	P,T1			;SAVE ERROR CODE
  3550	005175'	260040	004134'		PUSHJ	P,RENNMR		;RESTORE OLD NAME
  3551	005176'	262040	000006		POP	P,T1
  3552	005177'	254000	005202'		JRST	RENRCM			;AND GIVE ERROR
  3553
  3554	005200'	260040	005142*	RENER7:	PUSHJ	P,GIVCBR		;%
  3555	005201'	201300	000002	RENRR3:	MOVEI	T1,PRTERR
  3556	005202'	201340	004406*	RENRCM:	MOVEI	T2,ATPREN
  3557	005203'	412355	005132*		ANDCAM	T2,ATBSTS(P2)
  3558	005204'	370357	005136*		SOS	T2,DRBCNT(P4)
  3559	005205'	602340	005137*		TRNE	T2,DRPMXC
  3560	005206'	256000	000000'		 STOPCD (SLO)
  3561							;;RENRCM+4
  3562	005207'	201340	000001		MOVEI	T2,DECLUK
  3563	005210'	137340	005164*		DPB	T2,DEYSTC		;RESET, LOOKUP WAS IN FORCE AND IS AGAIN
  3564	005211'	254000	005165'		JRST	STRERR
  3565
  3566	005212'	201300	000006	RENRR4:	MOVEI	T1,TRNERR
  3567	005213'	254000	005202'		JRST	RENRCM
  3568
  3569	005214'	201300	000006	RENRR2:	MOVEI	T1,TRNERR
  3570	005215'	261040	000006	RENCLR:	PUSH	P,T1			;SAVE IT
  3571	005216'	554755	004415*		HLRZ	P4,ATBDOR(P2)		;OLD DRB
  3572	005217'	550655	005216*		HRRZ	P2,ATBDOR(P2)
  3573	005220'	260040	005146*		PUSHJ	P,GETCBR
  3574	005221'	550715	005133*		HRRZ	P3,ATBFNB(P2)		;%
  3575	005222'	260040	004421*		PUSHJ	P,FREATB		;% GIVE BACK ATB (NEW)
  3576	005223'	370317	005204*		SOS	T1,DRBCNT(P4)		;%
  3577	005224'	602300	005205*		TRNE	T1,DRPMXC		;%
  3578	005225'	256000	000000'		 STOPCD (SLO)
  3579							;;RENCLR+8
  3580	005226'	260040	005200*		PUSHJ	P,GIVCBR		;%
  3581	005227'	550644	005172*		HRRZ	P2,DEVATB(F)
  3582	005230'	554744	005173*		HLRZ	P4,DEVDRB(F)
  3583	005231'	402015	005217*		SETZM	ATBDOR(P2)		;REMOVE LINK
  3584	005232'	262040	000006		POP	P,T1
  3585	005233'	254000	005202'		JRST	RENRCM			;AND GO
  3586
  3587	005234'	260040	004377*	RENRR1:	PUSHJ	P,RELLOK
  3588	005235'	260040	004131'		PUSHJ	P,RENNXR
  3589	005236'	201300	000002		MOVEI	T1,PRTERR
  3590	005237'	254000	005215'		JRST	RENCLR
  3591
  3592	005240'	260040	005234*	RENRR0:	PUSHJ	P,RELLOK
  3593	005241'	201300	000014		MOVEI	T1,NRMERR
  3594	005242'	254000	005215'		JRST	RENCLR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 71
FILUUO.MAC	19-SEP-89 19:52		ERROR RETURNS

  3595				;THIS IS PART OF THE SYSDEV UUO
  3596
  3597	005243'	541553	000001	SYDUNI::HRRI	M,1(M)			;GET THE UNIT NAME SPECIFIED BY USER
  3598	005244'	704313	000000		UMOVE	T1,(M)
  3599	005245'	554240	000000*		HLRZ	U,SYSUNI		;START OF UNIT CHAIN
  3600	005246'	322300	005256'		JUMPE	T1,SYDUN1		;USER SPECIFIED 0, FIRST UNIT
  3601	005247'	316305	000000*	SYDUN3:	CAMN	T1,UNINAM(U)
  3602	005250'	254000	005254'		  JRST	SYDUN2			;FOUND UNIT SPECIFIED
  3603	005251'	554245	000000*		HLRZ	U,UNISYS(U)		;NEXT UNIT
  3604	005252'	326240	005247'		JUMPN	U,SYDUN3		;MORE LEFT?
  3605	005253'	263040	000000		POPJ	P,			;NO, NAME SPECIFIED NOT UNIT, ERROR RET
  3606
  3607	005254'	554245	005251*	SYDUN2:	HLRZ	U,UNISYS(U)		;GET NEXT UNIT
  3608	005255'	322240	000000*		JUMPE	U,SYDNM4		;RETURN A 0 FOR END OF LIST
  3609	005256'	135300	000000*	SYDUN1:	LDB	T1,UNYSIZ		;GET THE SIZE WE CAN GIVE HIM
  3610	005257'	200345	005247*		MOVE	T2,UNINAM(U)
  3611	005260'	705353	000000	SYDUN4:	UMOVEM	T2,(M)			;GIVE HIM THE NAME OF THIS ONE
  3612	005261'	205340	240000		MOVSI	T2,LICSYS!LICSPY	;SEE IF HE CAN HAVE MORE
  3613	005262'	616342	004740*		TDNN	T2,JBTLIC(J)
  3614	005263'	254000	005073*		  JRST	CPOPJ1			;NO
  3615	005264'	363600	005263*		SOJLE	P1,CPOPJ1		;OR MAYBE DOES NOT WANT MORE
  3616	005265'	541553	000001		HRRI	M,1(M)
  3617	005266'	254000	000000*		JRST	SYDCOM
  3618
  3619
  3620	005267'	541553	000001	SYDSTR::HRRI	M,1(M)			;Addr of user block + 1
  3621	005270'	704313	000000		UMOVE	T1,(M)
  3622	005271'	322300	005303'		JUMPE	T1,SYDST3		;FIRST STRUCTURE REQUESTED
  3623	005272'	201240	000000*		MOVEI	U,STRDDB		;NO, CHECK LIST FOR POSITION
  3624	005273'	312305	000000*	SYDST1:	CAME	T1,STRNAM(U)		;IS THIS THE CURRENT ONE?
  3625	005274'	254000	005300'		  JRST	SYDST2			;NO, TRY NEXT ONE
  3626	005275'	554245	000000*		HLRZ	U,STRNXT(U)		;YES, GET NEXT
  3627	005276'	326240	005304'		JUMPN	U,SYDST4		;ANOTHER STR, GIVE IT TO HIM
  3628	005277'	254000	005255*		JRST	SYDNM4			;SAY NOTHING MORE
  3629
  3630	005300'	554245	005275*	SYDST2:	HLRZ	U,STRNXT(U)		;TRY FOR ANOTHER ONE
  3631	005301'	326240	005273'		JUMPN	U,SYDST1		;YES, KEEP LOOKING FOR A MATCH
  3632	005302'	263040	000000		  POPJ	P,			;NO MATCH, BAD ARGUMENT
  3633
  3634	005303'	201240	005272*	SYDST3:	MOVEI	U,STRDDB		;STR DATA FROM COMMOD
  3635	005304'	201300	000000*	SYDST4:	MOVEI	T1,STRLEN
  3636	005305'	200345	005273*		MOVE	T2,STRNAM(U)		;NAME FROM STR BLOCK
  3637	005306'	254000	005260'		JRST	SYDUN4
  3638
  3639				EXTERNAL SYDCOM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 72
FILUUO.MAC	19-SEP-89 19:52		F.S. UUO FUNCTION AND ERROR RETURN CODES

  3640				SUBTTL  F.S. UUO FUNCTION AND ERROR RETURN CODES
  3641
  3642				;STRUUO FUNCTION CODES
  3643
  3644			000000	XP .FSSRC,0	;DEFINE NEW SEARCH LIST (UNPRIVILEGED)
  3645			000001	XP .FSDSL,1	;DEFINE NEW SEARCH LIST (PRIVILEGED)
  3646			000002	XP .FSDEF,2	;DEFINE NEW FILE STRUCTURE
  3647			000003	XP .FSRDF,3	;REDEFINE FILE STRUCTURE STATUS
  3648			000004	XP .FSLOK,4	;LOCK OUT NEW INITS,ENTERS,LOOKUPS
  3649			000005	XP .FSREM,5	;REMOVE FILE STRUCTURE FROM SYSTEM
  3650
  3651				;STRUUO & GOBSTR ERROR CODES
  3652
  3653			000000	XP .ERILF,0	;ILLEGAL FUNCTION CODE
  3654			000001	XP .ERSNF,1	;1 OR MORE FILE STRUCTURES NOT FOUND
  3655			000002	XP .ERSSA,2	;1 OR MORE FILE STRUCTURES SINGLE ACCESS ONLY
  3656			000003	XP .ERILE,3	;1 OR MORE ILLEGAL ENTRIES IN ARG. LIST
  3657			000004	XP .ERTME,4	;TOO MANY ENTRIES IN SEARCH LIST
  3658			000005	XP .ERUNA,5	;1 OR MORE UNITS NOT AVAILABLE
  3659			000006	XP .ERPPN,6	;JOB # , PP # DO NOT MATCH
  3660			000007	XP .ERMCN,7	;MOUNT COUNT NOT 0
  3661			000010	XP .ERNPV,10	;NOT PRIVILEGED USER
  3662			000011	XP .ERFSA,11	;F.S. ALREADY EXISTS
  3663			000012	XP .ERILL,12	;ILLEGAL ARG. LIST LENGTH (LH UUO AC)
  3664			000013	XP .ERUNC,13	;UNABLE TO COMPLETE THE FUNCTION
  3665			000014	XP .ERNFS,14	;SYSTEM FULL OF FILE STRUCTURES
  3666			000015	XP .ERNCS,15	;NOT ENOUGH FREE CORE FOR DATA BLOCK
  3667			000016	XP .ERUNF,16	;ILLEGAL UNIT
  3668			000017	XP .ERRSL,17	;FILE STRUCTURE REPEATED IN SEARCH LIST DEFINITION
  3669
  3670				;MACRO TO ASSOCIATE SYMBOLIC ADDRESS AND ERROR CODE
  3671
  3672					DEFINE	ERCODE	(NAME,CODE)<
  3673				IFG <CODE-MXECOD>,<MXECOD==CODE>
  3674					NAME==ECOD'CODE>
  3675
  3676			000000	MXECOD==0	;NUMBER OF ERROR CODES TO GENERATE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 73
FILUUO.MAC	19-SEP-89 19:52		SYSSTR UUO

  3677				SUBTTL	SYSSTR UUO
  3678				;UUO TO RETURN NAME OF NEXT FILE STRUCTURE IN SYSTEM
  3679				;NOTE THAT ACCUMULATOR J IS J AND CONTAINS THE JOB NUMBER OF THE JOB
  3680				; EXECUTING THE UUO
  3681
  3682
  3683	005307'	322300	005313'	SYSTUU::JUMPE	T1,SYSTU1		;% JUMP IF 1ST STR DESIRED
  3684	005310'	312300	006033'		CAME	T1,[SIXBIT /DSKB/]	;ONLY LEGAL STR NAME
  3685	005311'	263040	000000		  POPJ	P,			;% NO, ERROR RETURN
  3686	005312'	634300	000006		TDZA	T1,T1			;AFTER DSKB IS END
  3687	005313'	200300	006033'	SYSTU1:	MOVE	T1,[SIXBIT /DSKB/]
  3688	005314'	254000	005472'		JRST	RETARG
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 74
FILUUO.MAC	19-SEP-89 19:52		SYSPHY UUO

  3689				SUBTTL	SYSPHY UUO
  3690				;CALLI AC,51
  3691				;UUO TO RETURN NAME OF NEXT PHYS.DEV. NAME IN SYSTEM
  3692				; CALLING SEQUENCE IS SIMILAR TO SYSSTR UUO
  3693
  3694
  3695	005315'	554240	005245*	SYSPHY::HLRZ	U,SYSUNI	;U=ADDRESS 1ST UNIT D.B.
  3696	005316'	322300	005327'		JUMPE	T1,SYSPH4	;IF USER AC=0: RETURN 1ST UNIT
  3697
  3698	005317'	316305	005257*	SYSPH2:	CAMN	T1,UNINAM(U)	;THIS UNIT PHYS.NAME = ARGUMENT?
  3699	005320'	254000	005324'		JRST	SYSPH3		;YES-GO RETURN NEXT PHYS.NAME
  3700	005321'	554245	005254*		HLRZ	U,UNISYS(U)	;NO--GET NEXT UNIT
  3701	005322'	326240	005317'		JUMPN	U,SYSPH2	;IF THIS IS LAST UNIT:
  3702	005323'	263040	000000		POPJ	P,		;   GIVE ERROR RETURN
  3703
  3704	005324'	400300	000000	SYSPH3:	SETZ	T1,		;RETURN 0 IN CASE IT WAS LAST UNIT
  3705	005325'	554245	005321*		HLRZ	U,UNISYS(U)	;GET NEXT UNIT D.B.
  3706	005326'	322240	005472'		JUMPE	U,RETARG	;IF THAT WAS LAST UNIT: RETURN 0
  3707	005327'	200305	005317*	SYSPH4:	MOVE	T1,UNINAM(U)	;OTHERWISE RETURN PHYS.NAME
  3708	005330'	254000	005472'		JRST	RETARG
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 75
FILUUO.MAC	19-SEP-89 19:52		GOBSTR M

  3709				SUBTTL GOBSTR M
  3710				; GENERALIZED JOBSTR M  -  CALLI AC,66
  3711
  3712
  3713				;ERROR RETURN CODES:
  3714
  3715			005477'	ERCODE GERIFS,\.ERILE	;1ST ARG. NOT VALID (-1 OR F.S. NAME IN JOBS SRCH LIST)
  3716			005502'	ERCODE GERPPN,\.ERPPN	;JOB# (1ST ARG) NO GOOD OR DOESNT MATCH PPN (2ND ARG)
  3717			005506'	ERCODE GERILL,\.ERILL	;ILLEGAL ARG.LIST LENGTH (LH OF M AC)
  3718				; ALSO .ERNPV		;(SUBROUT PRIVJ) NOT PRIVILEGED JOB
  3719
  3720				INTERN GOBSTR
  3721	005331'	265440	005575'	GOBSTR:	JSP	T4,PRIVJ		;PRIVILEGED JOB?
  3722	005332'	542300	000013		HRRM	T1,M		;RH M=ADDR. USERS ARG. LIST
  3723	005333'	554600	000006		HLRZ	P1,T1		;P1=LENGTH OF ARG. LIST
  3724	005334'	336000	000014		SKIPN	P1		;CONVERT 0 TO 3
  3725	005335'	201600	000003		MOVEI	P1,3
  3726	005336'	305600	000003		CAIGE	P1,3		;LENGTH 3 OR GREATER?
  3727	005337'	254000	005506'		JRST	GERILL		;NO--ERROR RETURN
  3728
  3729	005340'	260040	005547'		PUSHJ	P,CKJPPN	; JOB # MATCH PPN?
  3730	005341'	254000	005502'		  JRST	GERPPN		; NO--ERROR RETURN
  3731	005342'	271540	000002		ADDI M,2		; POSITION FOR THE JOBSTR ARG
  3732	005343'	260040	005352'		PUSHJ	P,JOBST0	; PUSHJ TO JOBSTR CODE SO I
  3733	005344'	254000	005477'		  JRST	GERIFS		;   CAN HANDLE MY OWN ERROR RETURN
  3734	005345'	254000	005264*		JRST	CPOPJ1		; GOOD RETURN--PASS IT ON
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 76
FILUUO.MAC	19-SEP-89 19:52		GOBSTR M

  3735				;UUO TO RETURN NEXT STR IN JOB'S OWN SEARCH LIST
  3736
  3737
  3738				;SO GOBSTR CAN USE THIS SAME CODE:
  3739				;   J HOLDS # OF JOB WHOSE SEARCH LIST IS TO BE SEARCHED (0 IS SYS SEARCH LIST)
  3740				;   P1=# OF ARGUMENTS
  3741
  3742	005346'	542300	000013	JOBSTR:	HRRM	T1,M		;ADDR OF USER'S ARGUMENT LIST
  3743	005347'	554600	000006		HLRZ	P1,T1		;P1=NUMBER OF ARGS DESIRED
  3744	005350'	336000	000014		SKIPN	P1
  3745	005351'	201600	000001		  MOVEI	P1,1		;CONVERT 0 TO 1
  3746
  3747	005352'			JOBST0:				; HERE FROM GOBSTR
  3748	005352'	704313	000000		UMOVE	T1,(M)		; GET 1ST ARG=STR NAME
  3749	005353'	342300	005362'		AOJE	T1,JOBST2	; JUMP IF BEGINNING DESIRED (-1)
  3750	005354'	366300	005357'		SOJN	T1,JOBST1	; JUMP IF NOT FENCE (0)
  3751	005355'	211640	000001		MOVNI	P2,1		; FENCE, NEXT IS END
  3752	005356'	254000	005363'		JRST	JOBST8
  3753
  3754	005357'	312300	006033'	JOBST1:	CAME	T1,[SIXBIT /DSKB/]
  3755	005360'	263040	000000		  POPJ	P,		; DSKB IS ONLY ALLOWED STR
  3756	005361'	634640	000015		TDZA	P2,P2		; FOLLOWED BY FENCE
  3757	005362'	200640	006033'	JOBST2:	MOVE P2,[SIXBIT /DSKB/]	; FIRST STR IS DSKB
  3758	005363'	705653	000000	JOBST8:	UMOVEM	P2,(M)		; STORE STR NAME
  3759	005364'	362600	005345*		SOJE	P1,CPOPJ1	; SKIP RETURN IF NO MORE ARGS DESIRED
  3760	005365'	256200	006240'		XCTBU	<SETZM 1(M)>	; ZERO FOR PPN WORD FOR NOW ***
  3761	005366'	362600	005364*		SOJE	P1,CPOPJ1	; SKIP RETURN IF NO MORE ARGS DESIRED
  3762	005367'	256200	006241'		XCTBU	<SETZM 2(M)>	; STORE 0 FOR STATUS BITS
  3763	005370'	254000	005366*		JRST	CPOPJ1		; SKIP RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 77
FILUUO.MAC	19-SEP-89 19:52		STRUUO M

  3764				SUBTTL	STRUUO M
  3765				;M TO PERFORM VARIOUS FUNCTIONS FOR FILE STRUCTURES
  3766				;NOTE THAT ACCUMULATOR J IS J AND CONTAINS THE JOB NUMBER OF THE JOB
  3767				; EXECUTING THE M
  3768
  3769				;ERROR CODES
  3770
  3771			005506'	ERCODE ILLERR,\.ERILL	;ILLEGAL ARG.LIST LENGTH (LH M AC)
  3772			005504'	ERCODE NPVERR,\.ERNPV	;NOT PRIVILEGED PROGRAM
  3773			005502'	ERCODE PPNERR,\.ERPPN	;JOB #--PPN MISMATCH
  3774			005475'	ERCODE SNFERR,\.ERSNF	;F.S. NOT FOUND (NONEXISTANT)
  3775				INTERNAL SNFERR
  3776			005474'	ERCODE ILFERR,\.ERILF	;ILLEGAL FUNCTION
  3777			005512'	ERCODE UNFERR,\.ERUNF	;NO SUCH UNIT
  3778			005511'	ERCODE NCSERR,\.ERNCS	;NOT ENOUGH FREE CORE
  3779				INTERNAL NCSERR
  3780			005507'	ERCODE UNCERR,\.ERUNC	;UNABLE TO COMPLETE THE FUNCTION
  3781
  3782
  3783				INTERN STRUUO
  3784	005371'	265440	000100*	STRUUO:	JSP	T4,SAVE4	;SAVE ALL 4 GLOBAL ACCUMULATORS
  3785	005372'	200740	000006		MOVE	P4,T1		;SAVE T1 IN P4
  3786	005373'	542300	000013		HRRM	T1,M		;ADDRESS OF ARGUMENT LIST
  3787	005374'	704313	000000		UMOVE	T1,(M)		;GET FIRST ARGUMENT = FUNCTION
  3788	005375'	321300	005474'		JUMPL	T1,ILFERR	;ILLEGAL IF NEGATIVE
  3789	005376'	301300	000012		CAIL	T1,STRFNN	;SEE IF LEGAL FUNCTION
  3790	005377'	254000	005474'		JRST	ILFERR		;WELL, NO
  3791	005400'	344566	005401'		AOJA	M,@STRFNC(T1)
  3792	005401'	000000	005413'	STRFNC:	XWD	ZERO5,SRCSTR	;(0) DEFINE NEW SEARCH LIST (UNPRIVILEGED)
  3793	005402'	000000	005415'		XWD	ZERO5,DSLSTR	;(1) DEFINE NEW SEARCH LIST (PRIVILEGED)
  3794	005403'	000000	005474'		XWD	ZERO5,ILFERR	;(2) DEFINE NEW FILE STRUCTURE
  3795	005404'	000000	005474'		XWD	ZERO5,ILFERR	;(3) REDEFINE FILE STRUCTURE (CHANGE BITS)
  3796	005405'	000000	005474'		XWD	ZERO5,ILFERR	;(4) LOCK OUT NEW INIT'S, ENTER'S ,ETC.
  3797	005406'	000000	005474'		XWD	ZERO5,ILFERR	;(5) REMOVE FILE STRUCTURE FROM SYSTEM
  3798	005407'	000000	005440'		XWD	ZERO5,ULKSTR	;(6) TEST/SET UFD INTERLOCK FOR LOGIN, LOGOUT, ETC
  3799	005410'	000000	005441'		XWD	ZERO5,UCLSTR	;(7) CLEAR UFD INTERLOCK
  3800	005411'	000000	005453'		XWD ZERO5,ETSSTR	;(10 ERROR TEST M (SIMULATE ERRORS) .FSETS
  3801	005412'	000000	005533'		RRSET			;(11) READ AND RESET BUFFERED LOG FOR 3330'S
  3802			000012	STRFNN==.-STRFNC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 78
FILUUO.MAC	19-SEP-89 19:52		STRUUO M - DEFINE NEW SEARCH LIST

  3803				SUBTTL STRUUO M - DEFINE NEW SEARCH LIST
  3804				;FUNCTIONS TO DECLARE NEW SEARCH LISTS
  3805
  3806				;FOR THIS JOB (UNPRIVILEGED)
  3807
  3808	005413'	554700	000017	SRCSTR:	HLRZ	P3,P4		; P3=ARG.LIST LENGTH - 1
  3809	005414'	364700	005423'		SOJA	P3,SLSTRR
  3810
  3811				;FOR ANY JOB (PRIVILEGED)
  3812
  3813	005415'	265440	005575'	DSLSTR:	JSP	T4,PRIVJ		;PRIVILEGED JOB?
  3814	005416'	260040	005547'		PUSHJ	P,CKJPPN	; JOB # MATCH PPN?
  3815	005417'	254000	005502'		  JRST	PPNERR		; NO--ERROR RETURN
  3816	005420'	554700	000017		HLRZ	P3,P4		; P3=ARG.LIST LENGTH - 4
  3817	005421'	275700	000004		SUBI	P3,4
  3818	005422'	271540	000003		ADDI M,3		; FOR CKJPPN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 79
FILUUO.MAC	19-SEP-89 19:52		STRUUO M - DEFINE NEW SEARCH LIST

  3819				; RH(J)=# OF JOB WHOSE SEARCH LIST IS TO BE DEFINED
  3820				; P3=ARG.LIST LENGTH (EXCLUDING INITIAL STUFF LIKE FUNCTION NO.)
  3821
  3822				; FALL OR SKIP INTO HERE FROM DSLSTR CODE
  3823
  3824	005423'	323700	005370*	SLSTRR:	JUMPLE	P3,CPOPJ1	; IF NO F.S. GIVEN, TREAT AS ERROR
  3825	005424'	704313	000000	SLSTR0:	UMOVE	T1,(M)		; GET NEXT F.S. NAME
  3826	005425'	322300	005504'		JUMPE	T1,NPVERR	; NOT ALLOWED TO HAVE EMPTY LIST
  3827	005426'	316300	006033'		CAMN T1,[SIXBIT /DSKB/]	;NOT ALLOWED ANY BUT DSKB
  3828	005427'	256200	006242'		  XCTBU	<SKIPE 2(M)>	;NO SPECIAL STATUS ALLOWED
  3829	005430'	254000	005475'		 JRST	SNFERR
  3830	005431'	271540	000003		ADDI	M,3
  3831	005432'	275700	000003		SUBI	P3,3
  3832	005433'	323700	005423*		JUMPLE	P3,CPOPJ1	;FINISHED (ASSUME FENCE)
  3833	005434'	256200	006243'		XCTBU	<SKIPN 2(M)>	;ALLOW A FENCE
  3834	005435'	303700	000003		CAILE	P3,3		;BUT THAT MUST BE END OF LIST
  3835	005436'	254000	005475'		  JRST	SNFERR
  3836	005437'	254000	005433*		JRST CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 80
FILUUO.MAC	19-SEP-89 19:52		STRUUO - UFD INTERLOCK

  3837				SUBTTL	STRUUO - UFD INTERLOCK
  3838			000003	LKCLNA==3			;MUST HAVE 3 ARGS INCLUDING FUNCTION CODE
  3839	005440'	634700	000016	ULKSTR:	TDZA	P3,P3		;CLEAR P3 AND SKIP
  3840	005441'	474700	000000	UCLSTR:	SETO	P3,		;SET P3 NON-0
  3841	005442'	265440	005575'		JSP	T4,PRIVJ	;ONLY RETURN IF PRIVILEGED JOB
  3842	005443'	554300	000017		HLRZ	T1,P4		;T1=NUMBER OF ARGS
  3843	005444'	305300	000003		CAIGE	T1,LKCLNA	;MUST HAVE ENOUGH ARGS
  3844	005445'	324740	005506'		PJRST	ILLERR		;NOT ENOUGH ARGUMENTS
  3845	005446'	704613	000000		UMOVE P1,(M)		;GET STR NAME IN P1 FOR LOKPPB
  3846	005447'	704653	000001		UMOVE P2,1(M)		;AND PPN IN P2
  3847	005450'	322700	000000*		PJUMPE	P3,LOKPPB	;IF ILK, CALL LOKPPB TO TEST/SET
  3848	005451'	260040	000000*		PUSHJ	P,NLKPPB	;ELSE CALL NLKPPB TO CLEAR
  3849	005452'	324740	005437*		PJRST	CPOPJ1		;AND RETURN OK
  3850
  3851				SUBTTL STRUUO - .FSETS ERROR TESTING
  3852
  3853				;.FSET-ERROR TESTING-FUNCTION TO FORCE CONI AND DATAI ERRORS ON A UNIT
  3854				;PART OF STRUUO.
  3855				;ARGS ARE FUNCTION, UNIT NAME, ETC. SEE COMMOD FOR
  3856				;TABLE OF ARGS-ETSTAB.
  3857				;USER MUST BE PRIVILEGED
  3858				; ERROR RETURN IF SOME UNIT IS ALREADY BEING ERROR TESTED (.ERUNC)
  3859				; UNIT NOT FOUND (.ERFUNF)
  3860
  3861	005453'	265440	005575'	ETSSTR:	JSP	T4,PRIVJ	;CHECK FOR PRIVILEGED JOB
  3862	005454'	704313	000000		UMOVE T1,(M)		;GET UNIT NAME
  3863	005455'	332000	000000*		SKIPE	ETSUNI		;ALREADY TESTING ERRORS ON SOME UNIT?
  3864	005456'	254000	005507'		JRST	UNCERR		;YES, GIVE ERROR RETURN SO TWO
  3865								; USER'S DO NOT CONFUSE EACH OTHER
  3866	005457'	476000	000007		SETOM	T2		;SET UNIT NAME MASK TO -1
  3867	005460'	260040	005766'		PUSHJ	P,SRUNI		;SEARCH FOR UNIT NAME
  3868	005461'	254000	005512'		  JRST	UNFERR		;UNIT NOT FOUND
  3869	005462'	255000	000000		  JFCL			;LOGICAL UNIT NAME
  3870	005463'	205600	000000*		MOVSI	P1,METSLN	;-LENGTH OF ARG PICKUP
  3871	005464'	271540	000001	ETSLUP:	ADDI M,1		;GET NEXT USER ARG
  3872	005465'	704313	000000		UMOVE T1,(M)
  3873	005466'	202314	000000*		MOVEM	T1,ETSTAB(P1)	;STORE
  3874	005467'	253600	005464'		AOBJN	P1,ETSLUP	;MORE?
  3875	005470'	202240	005455*		MOVEM	U,ETSUNI	;NOW SET UNIT ADDRESS WHICH
  3876								;ENABLES FAKE ERROR TESTING
  3877	005471'	254000	005452*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 81
FILUUO.MAC	19-SEP-89 19:52		M RETURNS AND ERROR CODES

  3878				SUBTTL M RETURNS AND ERROR CODES
  3879
  3880				;HERE TO PUT T1 IN USERS M AC AND SKIP RETURN
  3881
  3882	005472'	705312	000000	RETARG:	UMOVEM T1,(W)
  3883	005473'	254000	005471*		JRST	CPOPJ1
  3884
  3885				;THESE RETURNS TO PUT ERROR CODE IN USERS M AC AND NO-SKIP RETURN
  3886
  3887					DEFINE XCOD(A)
  3888				<ECOD'A:	JSP T1,ECOD>
  3889
  3890			000000	%%XCOD==0
  3891					REPEAT MXECOD+1,<XCOD (\%%XCOD)
  3892				%%XCOD==%%XCOD+1>
  3893	005474'	265300	005513'
  3894	005475'	265300	005513'
  3895	005476'	265300	005513'
  3896	005477'	265300	005513'
  3897	005500'	265300	005513'
  3898	005501'	265300	005513'
  3899	005502'	265300	005513'
  3900	005503'	265300	005513'
  3901	005504'	265300	005513'
  3902	005505'	265300	005513'
  3903	005506'	265300	005513'
  3904	005507'	265300	005513'
  3905	005510'	265300	005513'
  3906	005511'	265300	005513'
  3907	005512'	265300	005513'
  3908	005513'	275300	005475'	ECOD:	SUBI	T1,ECOD0+1
  3909
  3910	005514'	705312	000000		UMOVEM T1,(W)
  3911	005515'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 82
FILUUO.MAC	19-SEP-89 19:52		M RETURNS AND ERROR CODES

  3912				;CODE FOR INTERLOCK
  3913
  3914				;	JSP	T4,LOCK
  3915				;	--WILL BE UNLOCKED BY MATCHING POPJ (OR CPOPJ1)--
  3916
  3917	005516'	260040	005220*	LOCK:	PUSHJ P,GETCBR
  3918	005517'	201200	005226*		MOVEI F,GIVCBR
  3919	005520'	261040	000002		PUSH P,J
  3920	005521'	200100	005076*		MOVE J,JOB
  3921	005522'	202202	000562*		MOVEM F,JBTABT(J)	;SET IN CASE OF ADDRESS ERROR
  3922	005523'	262040	000002		POP P,J
  3923	005524'	201200	000000		MOVEI F,0		;JUST IN CASE
  3924	005525'	260051	000000		PUSHJ P,(T4)
  3925	005526'	334000	000000		 SKIPA
  3926	005527'	350001	000000		AOS (P)
  3927	005530'	200100	005521*		MOVE J,JOB
  3928	005531'	402002	005522*		SETZM JBTABT(J)
  3929	005532'	324740	005517*		PJRST GIVCBR
  3930
  3931	005533'	205300	005000	RRSET:	MOVSI T1,LICSTR!LICJAL
  3932	005534'	616302	005262*		TDNN T1,JBTLIC(J)		;MUST HAVE ENOUGH LICENSE
  3933	005535'	254000	005504'		JRST NPVERR
  3934	005536'	704313	000000		UMOVE T1,(M)	;THIS IS THE UNIT NAME
  3935	005537'	211340	000001		MOVNI T2,1
  3936	005540'	260040	005766'		PUSHJ P,SRUNI
  3937	005541'	254000	005512'		 JRST UNFERR
  3938	005542'	254000	005512'		 JRST UNFERR	;DO NOT ACCEPT LOGICAL NAMES
  3939	005543'	550105	000000*		HRRZ J,UNIKON(U)
  3940	005544'	331002	000000*		SKIPL KONLTM(J)
  3941	005545'	254000	005507'		 JRST UNCERR	;ONLY FOR NON-CHANNEL DEVICES
  3942	005546'	254000	000000*		JRST RRSETB	;GO TO THE CODE IN FILIO
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 83
FILUUO.MAC	19-SEP-89 19:52		M RETURNS AND ERROR CODES

  3943				;% SUBROUTINE TO GET JOB # & PPN FROM ARG. LIST AND CK FOR A MATCH
  3944				;% CALL:		M=ADDRESS-1 OF JOB # ARG.
  3945				;% 		    PPN ARG. FOLLOWS
  3946				;% RETURN+0	IF RIDICULOUS JOB # OR DOESNT MATCH PPN
  3947				;% 		M & J ARE CHANGED
  3948				;% RETURN+1	IF JOB # ARG. MATCHES PPN ARG.: J=JOB # ARG.
  3949				;% 		IF JOB # ARG.=PPN ARG.=-1: J=J (CURRENT JOB #)
  3950
  3951	005547'	704313	000000	CKJPPN:	UMOVE T1,(M)		;% T1=JOB # (1ST ARG.)
  3952	005550'	326300	005556'		JUMPN T1,CKJPP2		;% NOT SYS
  3953	005551'	704313	000001		UMOVE T1,1(M)
  3954	005552'	312300	003273*		CAME T1,SYSPPN
  3955	005553'	263040	000000		POPJ P,			;% NO MATCH
  3956	005554'	201100	000000		MOVEI J,0		;% JOB=0 FOR SYS SEARCH LIST
  3957	005555'	254000	005473*		JRST CPOPJ1
  3958	005556'	337000	000006	CKJPP2:	SKIPG	T1		;% IF -1: USE CURRENT JOB #
  3959	005557'	200300	000002		MOVE	T1,J
  3960	005560'	333000	000006		SKIPLE	T1		;% IS IT GOOD JOB #?
  3961	005561'	313300	003210*		CAMLE	T1,HIGHJB
  3962	005562'	263040	000000		POPJ	P,		;% NO
  3963	005563'	200106	000000*		MOVE	J,JBTSTS(T1)	;% MAYBE  (CK JNA BIT)
  3964	005564'	607100	040000		TLNN	J,JNA
  3965	005565'	263040	000000		POPJ	P,		;% NO
  3966	005566'	200100	000006		MOVE	J,T1		;% YES--MAKE J=JOB #
  3967	005567'	704313	000001		UMOVE T1,1(M)		;% T1=PPN
  3968	005570'	337000	000006		SKIPG	T1		;% IF -1: USE CURRENT PPN
  3969	005571'	200302	005077*		MOVE	T1,JBTPPN(J)
  3970	005572'	312302	005571*		CAME	T1,JBTPPN(J)	;% IS PPN FOR THIS JOB #?
  3971	005573'	263040	000000		POPJ	P,		;% NO
  3972	005574'	254000	005555*		JRST	CPOPJ1		;% YES--GOOD MATCH
  3973
  3974
  3975				;SUBROUTINE TO CK FOR PRIVILEGED JOB (FAILSAFE PPN OR JACCT LIT)
  3976				;CALL:	JSP	T4,PRIVJ
  3977				;		J=JOB #
  3978				;		PRESERVES T1
  3979				;RETURNS IF PRIVILEGED OTHERWISE GOES TO NPVERR
  3980
  3981	005575'	205400	004000	PRIVJ:	MOVSI T3,LICSTR
  3982	005576'	612402	005534*		TDNE T3,JBTLIC(J)
  3983	005577'	254011	000000		JRST (T4)		;HE CAN DO IT
  3984	005600'	254000	005504'		JRST NPVERR	;NO- GIVE ERROR RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 84
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  3985				SUBTTL DSKCHR MUUO
  3986
  3987			000000	CODDSK==0		; generic DSK
  3988			000001	CODSFS==1		; file structure
  3989			000002	CODSTR==2		; structure name
  3990			000003	CODLUF==3		; logical unit in file structure
  3991			000004	CODKNC==4		; controller class
  3992			000005	CODKON==5		; controller name
  3993			000006	CODPUN==6		; logical unit of a controller
  3994
  3995	005601'	554400	000006	DSKCHR::HLRZ	T3,T1		;COMPUTE LAST ADDRESS OF TABLE
  3996	005602'	210100	000010		MOVN	J,T3
  3997	005603'	517000	000002		HRLZS	J
  3998	005604'	265440	005516'		JSP	T4,LOCK		;LOCK DATA SO IT CAN BE BELIEVED
  3999
  4000	005605'	540100	000006		HRR	J,T1		;% REMEMBER START OF ARG LIST
  4001	005606'	704306	000000		UMOVE	T1,(T1)		;% GET DISK NAME
  4002	005607'	322300	004674*		JUMPE	T1,CPOPJ	;% ERROR IF ARG. ZERO
  4003	005610'	205000	000000		MOVSI	S,CODDSK	;% PRESUME ARG. TO BE "DSK". SET CODE ACCORDINGLY
  4004	005611'	261040	000002		PUSH	P,J		;% SAVE J
  4005	005612'	200100	005530*		MOVE	J,JOB		;% SET J TO CURRENT JOB
  4006	005613'	260040	000000*		PUSHJ	P,DEVLG		;% SEARCH ALL LOGICAL NAMES IN SYSTEM FOR A MATCH
  4007	005614'	254000	005622'		  JRST	DSKCHK		;% NO MATCH - CHECK FOR "DSK"
  4008	005615'	205340	200000		MOVSI	T2,DVDSK
  4009	005616'	616344	000004		TDNN	T2,DEVMOD(F)	;% IS IT A DISK?
  4010	005617'	254000	003502*		  JRST	TPOPJ		;% NO - EXIT
  4011	005620'	200304	000000		MOVE	T1,DEVNAM(F)	;% PICK UP
  4012	005621'	201200	000000		MOVEI	F,0		;% JUST TO MAKE SURE 0 IN CASE ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 85
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4013				;% HERE TO SEE WHETHER C(T1) IS "DSK","DS" OR "D"
  4014
  4015	005622'	260040	005674'	DSKCHK:	PUSHJ	P,ALIASD	;% IS NAME AN ALIAS FOR "DSK"?
  4016	005623'	254000	005645'		  JRST	DSKFND		;% YES - FIND FIRST UNIT OF 1ST. STR FOR THIS JOB
  4017	005624'	205000	000002		MOVSI	S,CODSTR	;% PRESUME ARG. TO BE STR NAME
  4018	005625'	316300	006033'		CAMN T1,[SIXBIT /DSKB/]	;% ONLY STR ALLOWED
  4019	005626'	254000	005645'		  JRST	DSKFND		;% YES, USE FIRST UNIT
  4020	005627'	205000	000003		MOVSI	S,CODLUF	;%ASSUME LOG. UNIT IN STR
  4021	005630'	260040	005766'		PUSHJ	P,SRUNI		;% SCAN ALL PHYSICAL AND LOGICAL UNIT NAMES
  4022	005631'	254000	005617*		  JRST	TPOPJ		;% NO MATCH - EXIT
  4023	005632'	254000	005702'		  JRST	LOGCHK		;% MATCH ON LOGICAL NAME
  4024	005633'	450340	000000		SETCA	T2,0		;% MATCH ON PHYSICAL NAME
  4025	005634'	243340	005636'		JFFO	T2,.+2		;% DETERMINE # CHARS. IN ARG. FROM MASK
  4026					 STOPCD			;% ERROR - 6 CH. ARG. CAN'T MATCH WITH REMAINING NAME ;;DSKCHK+
  4027	005635'	256000	000000'	13
  4028	005636'	205000	000004		MOVSI	S,CODKNC	;% PRESUME KONTROLLER NAME
  4029	005637'	307400	000014		CAIG	T3,^D12		;% 1 OR 2 CHARS.?
  4030	005640'	254000	005704'		  JRST	FNDSTR		;% YES. SETUP USER AC
  4031	005641'	205000	000006		MOVSI	S,CODPUN	;% PRESUME PHYS. UNIT NAME
  4032	005642'	306400	000022		CAIN	T3,^D18		;% 3 CHARS.?
  4033	005643'	205000	000005		  MOVSI	S,CODKON	;% YES KONTROLLER NAME
  4034	005644'	254000	005704'		JRST	FNDSTR		;% DEPOSIT VALUE IN TABLE AND SETUP USER AC.
  4035
  4036				;HERE WHEN ARG. WAS OR IMPLIED "DSK" TO FIND FIRST UNIT OF JOB'S FIRST FILE STRUCTURE
  4037				PRINTF(<[DSKCHR @DSKFND setup P2 with default DSK structure, for this job.]>)
  4038	005645'	201640	005303*	DSKFND:	MOVEI	P2,STRDDB	;% DEFAULT (Only) STRUCTURE is DSKB
  4039	005646'	554255	000000*		HLRZ	U,STRUNI(P2)	;% USE FIRST UNIT IN STR FOR DSK OR DSKB
  4040	005647'	254000	005704'		JRST	FNDSTR		;% STR? found
  4041
  4042
  4043				;SUBR TO SEE IF SPECIAL UNIT IN STR IS DESIRED (CALLED BY INIT/OPEN).
  4044
  4045	005650'	200304	000004	TST1UN::MOVE	T1,DEVMOD(F)	;IS THIS A
  4046	005651'	607300	200000		TLNN	T1,DVDSK	;DISK?
  4047	005652'	263040	000000		  POPJ	P,		;NO.
  4048	005653'	200304	000000		MOVE	T1,DEVNAM(F)	;YES. IS IT DSK OR
  4049	005654'	260040	005674'		PUSHJ	P,ALIASD	;DS OR D?
  4050	005655'	263040	000000		  POPJ	P,		;YES.
  4051	005656'	316300	006033'		CAMN	T1,[SIXBIT/DSKB/] ;NO, DSKB?
  4052	005657'	263040	000000		  POPJ	P,		;YES.
  4053	005660'	201640	005645*		MOVEI	P2,STRDDB	;No, Check each unit on each STR
  4054	005661'	554255	005646*	TST1U0:	HLRZ	U,STRUNI(P2)	;NO, MAYBE A SPECIAL
  4055	005662'	312305	005327*	TST1U2:	CAME	T1,UNINAM(U)	;UNIT?
  4056	005663'	316305	000000*		CAMN	T1,UNILOG(U)	;
  4057	005664'	254000	005672'		  JRST	TST1U5		;YES.
  4058	005665'	554245	000071*		HLRZ	U,UNISTR(U)	;TRY AGAIN.
  4059	005666'	326240	005662'		JUMPN	U,TST1U2	;
  4060	005667'	554655	005300*		HLRZ	P2,STRNXT(P2)	; Go through all STRs (only 1) ***
  4061	005670'	326640	005661'		JUMPN	P2,TST1U0	; Next STR?
  4062	005671'	263040	000000		POPJ	P,		; No.
  4063				EXTERN DEV1UN
  4064	005672'	202244	002331*	TST1U5:	MOVEM	U,DEV1UN(F)	;SPECIAL UNIT.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 85-2
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4065	005673'	263040	000000		POPJ	P,
  4066
  4067
  4068				;SUBROUTINE TO TEST IF A NAME IS AN ALIAS FOR "DSK"
  4069				;ENTER WITH NAME IN T1
  4070				;EXIT NAME IN T1, MASK IN T2
  4071				;RETURN CPOPJ IF NAME IS AN ALIAS FOR "DSK", CPOPJ1 OTHERWISE
  4072
  4073	005674'	260040	005755'	ALIASD::PUSHJ	P,MSKUNI	;GENERATE MASK IN T2 FROM # OF CHARS. IN T1
  4074	005675'	205400	446353		MOVSI	T3,(SIXBIT .DSK.)
  4075	005676'	404400	000007		AND	T3,T2		;MASK OUT SUPERFLUOUS CHARS
  4076	005677'	312300	000010		CAME	T1,T3		;MATCH ON "D", "DS" OR "DSK"?
  4077	005700'	350001	000000		  AOS	(P)		;NO. SET FOR SKIP RETURN
  4078	005701'	263040	000000		POPJ	P,		;RETURN CPOPJ OR CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 86
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4079				;% HERE WHEN A MATCH IS FOUND BETWEEN LOGICAL NAME(UNILOG) & C(T1)
  4080
  4081	005702'	312305	005663*	LOGCHK:	CAME	T1,UNILOG(U)	;% EXACT MATCH WITH LOGICAL UNIT NAME?
  4082	005703'	201000	000001		  MOVEI	S,CODSFS	;% NO - MUST BE SUBSET OF STRS
  4083	005704'	200305	000000*	FNDSTR:	MOVE	T1,UNIDES(U)	;% LOAD UP BITS FOR USER AC.
  4084	005705'	621300	000377		TLZ	T1,377		;% GET RID OF UNIT BLOCK SIZE
  4085	005706'	434300	000000		IOR	T1,S		;% "OR" IN ARG. TYPE CODE.
  4086	005707'	262040	000002	FNDST1:	POP	P,J		;% RESTORE USER ARG
  4087	005710'	705312	000000		UMOVEM	T1,(W)		;% STORE BITS IN USER AC.
  4088	005711'	252100	005574*		AOBJP	J,CPOPJ1	;% IS LENGTH >1?
  4089	005712'	205300	777756		MOVSI	T1,MATLEN	;% SETUP LENGTH & INDEX INTO ARGTAB
  4090	005713'	550645	005665*		HRRZ	P2,UNISTR(U)	;% UP PTR TO STR DATA BLOCK =0 IF NOT IN STR
  4091	005714'	200600	006244'		MOVE	P1,[647210,,0]	;% BITS=1 FOR ARGS TO IGNORE IF NO FS
  4092	005715'	603600	400000	ARGLUP:	TLNE	P1,400000	;% HIGH ORDER BIT A 1, THEN CHECK STR
  4093	005716'	332000	000015		  SKIPE	P2		;% IGNORE IF NO FS
  4094	005717'	334000	000000		 SKIPA			;% ALWAYS RETURN OR IN FS
  4095	005720'	634340	000007		TDZA	T2,T2		;% IGNORE, RETURN 0
  4096	005721'	256006	005727'		  XCT	ARGTAB(T1)
  4097	005722'	242600	000001		LSH	P1,1		;% AND SHIFT FOR NEXT TEST
  4098	005723'	705342	000000		UMOVEM	T2,(J)		;% DEPOSIT IN TABLE
  4099	005724'	252100	005711*		AOBJP	J,CPOPJ1	;% FINISHED?
  4100	005725'	253300	005715'		AOBJN	T1,ARGLUP	;% NO INCREMENT INDEX
  4101	005726'	254000	005724*		JRST	CPOPJ1		;% RETURN
  4102
  4103	005727'	260040	000000*	ARGTAB:	PUSHJ	P,GUFBT			;LOC+1(.UFTAL)	UFD  QUOTA LEFT
  4104	005730'	200355	000000*		MOVE	T2,STRTAL(P2)		;LOC+2(.STTAL)	STR  SPACE LEFT
  4105	005731'	200345	002333*		MOVE	T2,UNITAL(U)		;LOC+3(.UNTAL)	UNIT SPACE LEFT
  4106	005732'	200355	005305*		MOVE	T2,STRNAM(P2)		;LOC+4(.STNAM)	STR  NAME
  4107	005733'	200345	000000*		MOVE	T2,UNICHR(U)		;LOC+5(.UNCHR)	UNIT CHARs
  4108	005734'	200345	000000*		MOVE	T2,UNIPPU(U)		;LOC+6(.UNPPU)	# PAGES on UNIT
  4109	005735'	201340	000000		MOVEI	T2,0			;LOC+7(.STMNT)	MOUNT COUNT
  4110	005736'	135340	000000*		LDB	T2,UNYWPS		;LOC+10(.UNWPS)	WORDS PER SAT
  4111	005737'	135340	000000*		LDB	T2,UNYSPU		;LOC+11(.UNSPU)	SATS PER UNIT
  4112	005740'	200345	000000*		MOVE	T2,UNIFEP(U)		;LOC+12(.UNFEP) FE FILE PAGES
  4113	005741'	201340	000000		MOVEI	T2,0			;LOC+13(.STJOB)	SINGLE ACCESS JOB
  4114	005742'	200345	005702*		MOVE	T2,UNILOG(U)		;LOC+14(.UNLOG)	STR LOGICAL UNIT
  4115	005743'	200345	005662*		MOVE	T2,UNINAM(U)		;LOC+15(.UNNAM) KON UNIT NAME
  4116	005744'	200345	000000*		MOVE	T2,UNIHID(U)		;LOC+16(.UNHID)	UNIT ID
  4117	005745'	201355	000000*		MOVEI	T2,STRSID(P2)		;LOC+17(.STSID) STR SET ID
  4118	005746'	200340	006245'		MOVE T2,[LPNHOM##,,LP2HOM##]	;LOC+20(.UNHA)	HOME ADDRESS
  4119	005747'	200340	006246'		MOVE T2,[LPNBAT##,,LP2BAT##]	;LOC+21(.UNBA)	BAT ADDRESS
  4120	005750'	260040	005751'	IFCPU (KS),<PUSHJ P,GETBSA>		; LOC+22(.UNBSA) BOOTS ADDRESS
  4121				IFNCPU(KS),<MOVE T2,[NBOOTP##,,FBOOTB##]>;LOC+22(.UNBSA) BOOTS ADDRESS
  4122		777777	777756	MATLEN==ARGTAB-.		;ADD NEW ENTRIES TO TABLE HERE
  4123
  4124				IFCPU (KS),<
  4125	005751'	336005	005740*	GETBSA:	SKIPN	UNIFEP##(U)		;Has the 8080 area been moved?
  4126	005752'	334340	006247'		 SKIPA	T2,[100,,10]		;No, give expected value to DSKCLN
  4127	005753'	200340	006250'		MOVE	T2,[NBOOTP##,,FBOOTB##]	;Yes, KS-BOOTS is now 3 starting at 3
  4128	005754'	263040	000000		POPJ	P,
  4129				>  ;End IFCPU(KS)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 87
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4130				;SUBROUTINE TO SET UP A SEARCH-MASK FOR A NAME
  4131				;ENTER WITH T1 =NAME
  4132				;EXIT WITH T1=NAME, T2=MASK
  4133
  4134	005755'	336340	000006	MSKUNI:	SKIPN	T2,T1		;GET NAME
  4135	005756'	263040	000000		  POPJ	P,		;NOT A NAME - RETURN MASK =0
  4136	005757'	205400	770000		MOVSI	T3,770000	;SET  UP MASK
  4137	005760'	676340	000010	UNIMS1:	TDON	T2,T3		;THIS CHARACTER 0?
  4138	005761'	254000	005764'		  JRST	UNIMS2		;YES. HAVE MASK
  4139	005762'	242400	777772		LSH	T3,-6		;NO, SHIFT AND TRY NEXT CHAR
  4140	005763'	326400	005760'		JUMPN	T3,UNIMS1
  4141	005764'	630340	000010	UNIMS2:	TDZ	T2,T3		;0 THE LAST BYTE
  4142	005765'	263040	000000		POPJ	P,		;AND RETURN WITH MASK IN T2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 88
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4143				;SUBROUTINE TO SEARCH UNIT DATA BLOCKS FOR A MATCH BETWEEN C(T1)
  4144				;AND AN EQUIVALENT NUMBER OF CHARACTERS OF UNILOG AND UNINAM
  4145				;CALL	MOVE	T2,MASK
  4146				;	MOVE	T1,SIXBIT NAME OF FILE STRUCTURE,UNIT,KONTROLLER, ETC.
  4147				;	PUSHJ	P,SRUNI
  4148				;	  NON MATCH RETURN	T1 & T2 ARE RESPECTED. U IS 0
  4149				;	  LOGICAL NAME MATCH	T1 & T2 ARE RESPECTED. U IS THE ADR. OF UNIT DATA BLOCK.
  4150				;	PHYSICAL NAME MATCH
  4151
  4152	005766'	554240	005315*	SRUNI::	HLRZ	U,SYSUNI	;GET ADR. OF FIRST UNIT IN SYSTEM
  4153	005767'	200405	005742*	LUPUNI:	MOVE	T3,UNILOG(U)	;GET LOGICAL UNIT NAME WITHIN STR
  4154	005770'	606340	007700		TRNN	T2,007700	;Don't stop at DSKB10 when looking for DSKB1
  4155	005771'	404400	000007		 AND	T3,T2		;MASK OUT UNWANTED CHARS.
  4156	005772'	316300	000010		CAMN	T1,T3		;MATCH?
  4157	005773'	254000	005726*		 JRST	CPOPJ1		;YES - FOUND A LOGICAL UNIT MATCH RETURN
  4158	005774'	200405	005743*		MOVE	T3,UNINAM(U)	;GET PHYSICAL UNIT NAME
  4159	005775'	606340	770000		TRNN	T2,770000	;Don's stop at BPA10 when looking for BPA1
  4160	005776'	404400	000007		 AND	T3,T2		;MASK
  4161	005777'	316300	000010		CAMN	T1,T3		;MATCH?
  4162	006000'	254000	000000*		 JRST	CPOPJ2		;YES - FOUND A PHYSICAL UNIT MATCH RETURN
  4163	006001'	554245	005325*		HLRZ	U,UNISYS(U)	;GET ADR. OF NEXT UNIT IN SYSTEM
  4164	006002'	326240	005767'		JUMPN	U,LUPUNI	;LAST ONE?
  4165	006003'	263040	000000		POPJ	P,		;YES - RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4166				;SUBROUTINE TO COMPUTE SIXBIT LOGICAL UNIT NUMBER WITHIN STR
  4167				; T1 HAS NUMBER WITHIN STR IN RH, LH GARBAGE.
  4168
  4169				INTERN CMPLOG
  4170	006004'	261040	000016	CMPLOG:	PUSH	P,P3
  4171	006005'	550700	000006		HRRZ	P3,T1
  4172	006006'	242700	777775		LSH	P3,-^D3
  4173	006007'	271700	000020		ADDI	P3,20
  4174	006010'	242700	000006		LSH	P3,^D6
  4175	006011'	405300	000007		ANDI	T1,7
  4176	006012'	271706	000020		ADDI	P3,20(T1)
  4177	006013'	200300	006033'		MOVE	T1,[SIXBIT /DSKB/]	; Needs thought, STR setup somewhere?
  4178	006014'	260040	005755'		PUSHJ	P,MSKUNI
  4179	006015'	450340	000000		SETCA	T2,0
  4180	006016'	243340	006020'		JFFO	T2,.+2
  4181	006017'	256000	000000'		 STOPCD (SLO)
  4182				           ;;CMPLOG+13
  4183	006020'	201340	000030		MOVEI	T2,^D24
  4184	006021'	602700	000700		TRNE	P3,700
  4185	006022'	254000	006025'		  JRST	INSUN2
  4186	006023'	620700	007700		TRZ	P3,7700
  4187	006024'	201340	000036		MOVEI	T2,^D30
  4188	006025'	274340	000010	INSUN2:	SUB	T2,T3
  4189	006026'	242707	000000		LSH	P3,(T2)
  4190	006027'	270300	000016		ADD	T1,P3
  4191	006030'	202305	005767*		MOVEM	T1,UNILOG(U)
  4192	006031'	262040	000016		POP	P,P3
  4193	006032'	263040	000000		POPJ	P,
  4194
  4195	006033'	446353	420000		$END	(FUU)

  4196	006034'	270400	000013

  4197	006035'	510653	000002

  4198	006036'	402013	000007

  4199	006037'	335013	000003

  4200	006040'	336313	000004

  4201	006041'	326700	000320'

  4202	006042'	200300	000017

  4203	006043'	621300	400000

  4204	006044'	550340	000000*

  4205	006045'	230300	000007

  4206	006046'	200300	000007

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-2
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4207	006047'	254000	000320'

  4208	006050'	000040	020000

  4209	006051'	260040	003474*

  4210	006052'	670000	006050'

  4211	006053'	324740	002011*

  4212	006054'	660000	100000

  4213	006055'	324740	006053*

  4214	006056'	554453	000006

  4215	006057'	262040	000016

  4216	006060'	262040	000017

  4217	006061'	254000	000551'

  4218	006062'	124711	777777

  4219	006063'	140200	000017

  4220	006064'	206311	000000

  4221	006065'	111000	000017

  4222	006066'	210400	000017

  4223	006067'	350013	000007

  4224	006070'	336013	000007

  4225	006071'	554300	000015

  4226	006072'	344300	000542'

  4227	006073'	124313	000005

  4228	006074'	000000	020000

  4229	006075'	120000	000000

  4230	006076'	211600	000001

  4231	006077'	201640	000000

  4232	006100'	263040	000000

  4233	006101'	030303	030303
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-3
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO


  4234	006102'	200100	000007

  4235	006103'	254000	000706*

  4236	006104'	000000*	000000*

  4237	006105'	260040	005240*

  4238	006106'	254000	001471'

  4239	006107'	000000	000001

  4240	006110'	000000*	000000*

  4241	006111'	262040	000016

  4242	006112'	254000	001760'

  4243	006113'	260040	000000*

  4244	006114'	654644	456221

  4245	006115'	000010	000000

  4246	006116'	260040	000000*

  4247	006117'	424144	654644

  4248	006120'	400005	000000

  4249	006121'	000000	000000*

  4250	006122'	260040	006113*

  4251	006123'	656557	706762

  4252	006124'	000010	000000

  4253	006125'	242300	777771

  4254	006126'	254000	002132'

  4255	006127'	516313	000003

  4256	006130'	542313	000001

  4257	006131'	542313	000003

  4258	006132'	376000	376001

  4259	006133'	000000*	376000*

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-4
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4260	006134'	334356	000000

  4261	006135'	000037	777777

  4262	006136'	141300	000007

  4263	006137'	270400	000007

  4264	006140'	001400	000007

  4265	006141'	140200	000006

  4266	006142'	550453	000003

  4267	006143'	160200	000011

  4268	006144'	542453	000003

  4269	006145'	542453	000001

  4270	006146'	213000	000006

  4271	006147'	254000	002735'

  4272	006150'	336353	000011

  4273	006151'	001777	777777

  4274	006152'	313340	006151'

  4275	006153'	263040	000000

  4276	006154'	242340	000007

  4277	006155'	254000	002765'

  4278	006156'	000000*	000000

  4279	006157'	203313	000003

  4280	006160'	135400	004731*

  4281	006161'	200310	005572*

  4282	006162'	254000	003056'

  4283	006163'	203013	000000

  4284	006164'	203006	000000

  4285	006165'	334313	000000

  4286	006166'	334313	000001
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-5
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO


  4287	006167'	334313	000003

  4288	006170'	205340	637163

  4289	006171'	400400	000000

  4290	006172'	254000	005773*

  4291	006173'	637163	000000

  4292	006174'	200300	005552*

  4293	006175'	254000	006172*

  4294	006176'	120346	000000

  4295	006177'	555555	555555

  4296	006200'	361275	431652

  4297	006201'	612754	316523

  4298	006202'	343277	244615

  4299	006203'	002001	001031

  4300	006204'	260040	006122*

  4301	006205'	656362	656321

  4302	006206'	400003	003474'

  4303	006207'	000000	000000*

  4304	006210'	000001*	001031

  4305	006211'	000001	001031

  4306	006212'	202541	777775

  4307	006213'	254000	003462'

  4308	006214'	120413	000000

  4309	006215'	000000	000000*

  4310	006216'	334713	000004

  4311	006217'	705313	000002

  4312	006220'	254000	004255'

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-6
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

  4313	006221'	260040	006105*

  4314	006222'	254000	004370'

  4315	006223'	000000*	777777

  4316	006224'	220200	000007

  4317	006225'	000200	000007

  4318	006226'	240200	000007

  4319	006227'	020200	000007

  4320	006230'	336353	000000

  4321	006231'	000000*	000000*

  4322	006232'	260040	005222*

  4323	006233'	513004	005227*

  4324	006234'	254000	005136'

  4325	006235'	260040	006204*

  4326	006236'	435462	435521

  4327	006237'	000010	000000

  4328	006240'	402013	000001

  4329	006241'	402013	000002

  4330	006242'	332013	000002

  4331	006243'	336013	000002

  4332	006244'	647210	000000

  4333	006245'	000000*	000000*

  4334	006246'	000000*	000000*

  4335	006247'	000100	000010

  4336	006250'	000000*	000000*

  4337						;End of FILUUO (FUULIT: FUUEND:)
  4338
NO ERRORS DETECTED
PROGRAM BREAK IS 006251
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 89-7
FILUUO.MAC	19-SEP-89 19:52		DSKCHR MUUO

10K CORE USED
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 90
FILUUO.MAC	19-SEP-89 19:52		SYMBOL TABLE

ADJMWS		000233'	EXT	ATMCNT		000000	EXT	CLFAL1		004532'		CLRNT1		005132'	
AEFERR		000004	SIN	ATMCSC		000000	EXT	CLFAL2		004542'		CLSACC		000010	SIN
ALCCHK		002755'		ATMMWC		002652'	EXT	CLFALC		004527'		CLSDMP		100000	SIN
ALIASD		005674'	INT	ATMUFP		000000	EXT	CLFLC1		004750'		CLSIN		000002	SIN
ARGALC	040000	000000	SPD	ATMUFU		004735'	EXT	CLFLIC		004724'		CLSIN2		001062'	
ARGALP		040000	SPD	ATMUMC		004003'	EXT	CLFMX1		004664'		CLSIN3		001141'	
ARGALT		000400	SPD	ATPALC		001722'	EXT	CLFMX2		004666'		CLSIN4		001167'	
ARGAUT	000002	000000	SPD	ATPCNT		001206'	EXT	CLFMX3		004657'		CLSIN5		001176'	
ARGDEV	001000	000000	SPD	ATPCRE		002466'	EXT	CLFMXA		004647'		CLSIN6		001175'	
ARGELB	000200	000000	SPD	ATPDEL		003670'	EXT	CLFNPS		004556'		CLSIN7		001077'	
ARGEST	100000	000000	SPD	ATPDIR		004562'	EXT	CLFPID		004674'		CLSIN8		001101'	
ARGEUN	000100	000000	SPD	ATPDMP		001107'	EXT	CLFPIO		004707'		CLSN2A		001131'	
ARGFT1	010000	000000	SPD	ATPMXU		002641'	EXT	CLFPIS		004711'		CLSN2B		001114'	
ARGFUT	200000	000000	SPD	ATPNDL		003600'	EXT	CLFPIZ		004714'		CLSN3A		001153'	
ARGLIC	004000	000000	SPD	ATPPID		004714'	EXT	CLFQT1		004607'		CLSN3B		001161'	
ARGLUP		005715'		ATPREN		005202'	EXT	CLFQT2		004604'		CLSOU0		001243'	
ARGMTA	002000	000000	SPD	ATPSUP		002424'	EXT	CLFQT3		004610'		CLSOU1		001241'	
ARGMXA	000010	000000	SPD	ATPUFE		004261'	EXT	CLFQTF		004562'		CLSOU2		001315'	
ARGPID		001000	SPD	ATPUPD		003636'	EXT	CLFSTS		004547'		CLSOU3		001363'	
ARGPJ0		010000	SPD	ATT1		000710'	EXT	CLFUM1		004616'		CLSOUT		000001	SIN
ARGPJ1		004000	SPD	ATYADT		002665'	EXT	CLFUN1		004620'		CLSRST		000040	SIN
ARGPJ2		002000	SPD	ATYBLK		004535'	EXT	CLFUNM		004612'		CLSXIT		001204'	
ARGPOS	020000	000000	SPD	ATYBSZ		000326'	EXT	CLFUS1		004634'		CLSXT1		001200'	
ARGPVS		000200	SPD	ATYCDT		002737'	EXT	CLFUS2		004641'		CLSXT2		001210'	
ARGQTF	000040	000000	SPD	ATYCNT		004002'	EXT	CLFUS3		004636'		CMBLNK		001173'	EXT
ARGQTO	000020	000000	SPD	ATYCSC		002745'	EXT	CLFUSD		004624'		CMPLOG		006004'	INT
ARGSNM		020000	SPD	ATYCTD		004224'	EXT	CLIBDR		001053'		CNVVPN		000440	SIN
ARGSTS	000400	000000	SPD	ATYCTM		002744'	EXT	CLIDEL		001033'		CODDSK		000000	SPD
ARGTAB		005727'		ATYPRV		004210'	EXT	CLOCM1		001513'		CODKNC		000004	SPD
ARGTRU		200000	SPD	ATYUF1		001650'	EXT	CLOCM2		001525'		CODKON		000005	SPD
ARGUFD		100000	SPD	ATYUF2		001636'	EXT	CLOCOM		001471'		CODLUF		000003	SPD
ARGUN1		400000	SPD	ATYXCD		004223'	EXT	CLORS1		001257'		CODPUN		000006	SPD
ARGUNM	000001	000000	SPD	B2PLSH	777777	777776	SPD	CLORS2		001271'		CODRIB		002506'	EXT
ARGUSD	000004	000000	SPD	B2WLSH		000007	SPD	CLORS3		001272'		CODSFS		000001	SPD
ARGVER	400000	000000	SPD	BADUFD		001762'	INT	CLORST		001307'		CODSTR		000002	SPD
ASSCON		400000	SIN	BLKLNK		003434'		CLOSCR		001444'		COMERA		006103'	EXT
ASSPRG		200000	SIN	CBUSER		002020'	EXT	CLOSE1		004325'	EXT	CPOPJ		005607'	EXT
ATBALP		004032'	EXT	CHANIO	043000	000000		CLOSIN		001007'		CPOPJ1		006175'	EXT
ATBCNT		005147'	EXT	CHGNAM		001001'	INT	CLOSOU		001216'		CPOPJ2		006000'	EXT
ATBDOR		005231'	EXT	CHGPPN		000766'	INT	CLOSRN		001030'		CPRRED		000001	SIN
ATBFNB		005221'	EXT	CHKAG1		003043'		CLOSU1		001406'		CPUKS		000003	SPD
ATBLCW		004754'	EXT	CHKAGX		003065'		CLOSU2		001421'		CPUTYP		000003	SPD
ATBLIC		005075'	EXT	CHKARG		003040'		CLOSU3		001437'		CPZZ		000001	SPD
ATBLNK		004056'	EXT	CHKPP1		003056'		CLOSU4		001423'		CRBRWL		001430'	EXT
ATBMSC		004225'	EXT	CHKPP2		003062'		CLOUF1		001463'		CREUFD		001545'	
ATBMWC		002651'	EXT	CHKPPN		003052'		CLOUPD		001465'		CRLF		000743'	EXT
ATBPID		004712'	EXT	CHKPRV		004146'	EXT	CLRAC0		001722'		CURUPT		000000	EXT
ATBPRV		002430'	EXT	CHKSGJ		000712'	EXT	CLRACH		001706'		DATCOM		000457'	EXT
ATBPVW		004227'	EXT	CKJPP2		005556'		CLRCM1		005140'	INT	DBRLP		004104'	
ATBRIB		004404'	EXT	CKJPPN		005547'		CLRCOM		005133'		DBRNXT		004124'	
ATBSIZ		004030'	EXT	CLCALC		002240'		CLRDD1		000662'		DBYT		000002	SIN
ATBSTS		005203'	EXT	CLCMXA		002244'		CLRDDB		000661'	INT	DCL		000007	SIN
ATBUMC		004004'	EXT	CLCUSD		002267'		CLRENT		005130'		DCLI		000023	SIN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 90-2
FILUUO.MAC	19-SEP-89 19:52		SYMBOL TABLE

DCTBSZ		000003	SPD	DLTNAM		004365'	EXT	DSKUGF		000155'		FNBDRB		001156'	EXT
DDBCOR		000672'	EXT	DLTTRC		004243'	EXT	DSLSTR		005415'		FNBEXT		004137'	EXT
DDBLEN		000010'	EXT	DMOVPG		000037	SIN	DSO		000022	SIN	FNBLNK		001170'	EXT
DDI	777777	777777	SIN	DMT		000014	SIN	DSPSIZ		000037	SPD	FNBNAM		004332'	EXT
DDINT		000001	SIN	DOU		000010	SIN	DUFD		000024	SIN	FNBNX		004423'	EXT
DDO	777777	777776	SIN	DRBALC		004660'	EXT	DVDSK		200000	SIN	FNBRIB		004424'	EXT
DDXZ		000000	SIN	DRBCNT		005223'	EXT	DVMAP		000026	SIN	FNBUPD		002650'	EXT
DECENT		000004	SPD	DRBFNB		001160'	EXT	DVSIZ		000003	SIN	FNCAPP		002616'	EXT
DECIN		000704'	EXT	DRBLNK		003235'	EXT	DVSMAP		000034	SIN	FNCCAT		003010'	EXT
DECLUK		000001	SPD	DRBLOG		001530'	EXT	DZAP		000012	SIN	FNCCNM		006215'	EXT
DECSTP		000005	SPD	DRBMXA		004671'	EXT	ECOD		005513'		FNCCPR		004145'	EXT
DECUP2		000003	SPD	DRBNAM		004141'	EXT	ECOD0		005474'		FNCCRE		003752'	EXT
DECUPD		000002	SPD	DRBNX		003630'	EXT	ECOD1		005475'		FNCDEL		003717'	EXT
DELGRP		002773'		DRBRIB		004572'	EXT	ECOD10		005504'		FNCEXC		002103'	EXT
DEN		000016	SIN	DRBUN1		004621'	EXT	ECOD11		005505'		FNCLOK		002076'	EXT
DEV1UN		005672'	EXT	DRBUNM		004613'	EXT	ECOD12		005506'		FNCRED		002113'	EXT
DEVATB		006233'	EXT	DRL		000006	SIN	ECOD13		005507'		FNCSUP		002322'	EXT
DEVDBL		004125'	EXT	DRMCNT		003624'	EXT	ECOD14		005510'		FNCTRN		002773'	EXT
DEVDRB		005230'	EXT	DRN		000020	SIN	ECOD15		005511'		FNCUPD		002622'	EXT
DEVELB		000000	EXT	DRPLOG		001527'	EXT	ECOD16		005512'		FNDDRB		004570'	EXT
DEVEXT		000016	SIN	DRPMXC		005224'	EXT	ECOD2		005476'		FNDNGT		002122'	
DEVFIL		000015	SIN	DRPNX		003627'	EXT	ECOD3		005477'		FNDROK		002111'	
DEVFLO		003275'	EXT	DRYCNT		000244'	EXT	ECOD4		005500'		FNDST1		005707'	
DEVIAD		000007	SIN	DRYPRV		004212'	EXT	ECOD5		005501'		FNDSTR		005704'	
DEVIOS		000002	SIN	DSEK		000025	SIN	ECOD6		005502'		FNFERR		000000	SIN
DEVLG		005613'	EXT	DSI		000021	SIN	ECOD7		005503'		FNPNX		004422'	EXT
DEVLOG		000005	SIN	DSIM		000032	SIN	ENTER1		005152'		FNYUFP		004361'	EXT
DEVMOD		000004	SIN	DSKCHK		005622'		ENTER2		005155'		FOUND		002074'	
DEVNAM		000000	SIN	DSKCHR		005601'	INT	ENTRB		020000	SIN	FOUND1		002132'	
DEVPOS		002006'	EXT	DSKCL1		000244'		EPT		000000	EXT	FOUND2		002140'	
DEVPPN		000017	SIN	DSKCL2		000235'		ERNSET		003517'		FOUND3		002156'	
DEVRB1		000000	EXT	DSKCL3		000226'		ERRLKM		005160'		FOUND4		002160'	
DEVRET		000342'	EXT	DSKCL4		000222'		ERRNET		005162'		FOUND5		002165'	
DEVRIB		003576'	EXT	DSKCL5		000254'		ETSLUP		005464'		FOUND8		002175'	
DEVSER		000003	SIN	DSKCL6		000250'		ETSSTR		005453'		FPCSET		000231'	EXT
DEYSTC		005210'	EXT	DSKCL7		000262'		ETSTAB		005466'	EXT	FREACC		001042'	
DEYTCT		000000	EXT	DSKCLN		006121'	EXT	ETSUNI		005470'	EXT	FREATB		006232'	EXT
DFCRE		000030	SIN	DSKCLR		000212'	INT	EXTUUO		200000	SIN	FUNM		003442'	
DFDEL		000027	SIN	DSKCM1		000720'		F		000004	INT	FUNM1		003462'	
DFEXC		000031	SIN	DSKCM2		000730'		FALHOL		003401'	EXT	FUTAB		004473'	
DFFIF		000035	SIN	DSKCOM		000704'	INT	FALPHP		003402'	EXT	FUUEND		006250'	INT
DFTRN		000036	SIN	DSKCTB		000207'		FBIT		002340'	EXT	FUULIT		006033'	INT
DFVLR		000033	SIN	DSKDDB		003254'	EXT	FBMERR		000003	SIN	GERIFS		005477'	SPD
DGF		000015	SIN	DSKDSP		000005'	INT	FBOOTB		006250'	EXT	GERILL		005506'	SPD
DGTRD		000013	SIN	DSKFND		005645'		FILLIC		004757'	INT	GERPPN		005502'	SPD
DHNG		000005	SIN	DSKINC		000750'		FILUUO		000000'	ENT	GET4WD		000642'	EXT
DIE		006235'	EXT	DSKKJB		000756'	INT	FINNXB		000542'		GETB		000010	SIN
DIN		000011	SIN	DSKKLP		000760'		FINSUP		000530'		GETBSA		005751'	
DINI		000004	SIN	DSKLGO		000174'		FINUS0		000554'		GETCBR		005516'	EXT
DIRBLK		004347'	EXT	DSKREL		001776'		FNBALT		004252'	EXT	GETER1		000000	EXT
DIRSRC		004351'	EXT	DSKRES		000000	SIN	FNBAPD		003033'	EXT	GETEXT		003112'	
DLK		000017	SIN	DSKUG1		000170'		FNBATB		001405'	EXT	GETGMT		002736'	EXT
DLTALL		001433'	EXT	DSKUG2		000172'		FNBDBL		004113'	EXT	GETLI1		005074'	INT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 90-3
FILUUO.MAC	19-SEP-89 19:52		SYMBOL TABLE

GETLIC		005070'	INT	JBTUN1		003203'	EXT	LOGCHK		005702'		P1		000014	INT
GETNAM		003106'		JBTUNM		003202'	EXT	LOGTST		001527'		P2		000015	INT
GETPPN		003116'		JBTWCT		000000	EXT	LOKLL5		003252'		P3		000016	INT
GETUPG		002341'	EXT	JBYIRD		000752'	EXT	LOKLUD		003242'		P4		000017	INT
GETWDS		000000	EXT	JBYRCT		000750'	EXT	LOKPPB		005450'	EXT	PCBCLR		000235'	EXT
GIV4WD		000675'	EXT	JBYWCT		000740'	EXT	LOKUNM		000324'	EXT	PCDTIM		004251'	EXT
GIVCB1		000270'	EXT	JBYWPT		004702'	EXT	LOOKB		040000	SIN	PDNMUP		000227'	EXT
GIVCBR		005532'	EXT	JFYSEC		002742'	EXT	LP2BAT		006246'	EXT	PE.NER		000000	EXT
GIVPAG		000000	EXT	JNA		040000	SIN	LP2HOM		006245'	EXT	PERSET	047000	777706	
GIVWDS		000000	EXT	JOB		005612'	EXT	LPNBAT		000000	EXT	PG		000003	INT
GOBSTR		005331'	INT	JOBN		000707'	EXT	LPNHOM		000000	EXT	PIDACC		003065'	EXT
GTCGSZ		003520'	EXT	JOBST0		005352'		LPPN		000000	SPD	PJOBN		006160'	EXT
GUFBT		005727'	EXT	JOBST1		005357'		LUDER0		003467'		PJRST	324740	000000	
HIGHJB		005561'	EXT	JOBST2		005362'		LUDER1		003474'		PJSP	265000	000000	
ICLOSB		002000	SIN	JOBST8		005363'		LUDER2		003500'		PJUMPE	322000	000000	
ILFERR		005474'	SPD	JOBSTR		005346'	INT	LUDERR		003463'		PPNERR		005502'	SPD
ILLERR		005506'	SPD	KFCRE		000035'	EXT	LUDHSH		001567	SPD	PPNUS1		003135'	
ILNMER		005110'		KFDEL		000034'	EXT	LUKER1		005112'		PPNUS2		003143'	
INBLT		000004'	EXT	KFEXC		000036'	EXT	LUPUNI		005767'		PPNUS3		003145'	
INDPPN		000000	EXT	KFFIFP		000042'	EXT	M		000013	INT	PPNUS4		003153'	
INLMES		000735'	EXT	KFTRN		000043'	EXT	MAPB		000004	SIN	PPNUS5		003163'	
INPB		010000	SIN	KMAPP		000033'	EXT	MAPID		000035	SPD	PPNUS6		003172'	
INSNAM		004374'	EXT	KMOVPG		000044'	EXT	MAPRDU		000346'	EXT	PPNUSR		003132'	INT
INSUN2		006025'		KONLTM		005544'	EXT	MAPRLS		000000	EXT	PRIVJ		005575'	
INVDDB		003036'	EXT	KSMAPP		000041'	EXT	MAPWLN		002346'	EXT	PRTERR		000002	SIN
IO		000020	SIN	KSNOCH		003526'	EXT	MAPWTL		000000	EXT	PRTT3		006207'	EXT
IOBDRB		000000	EXT	KVLRIB		000040'	EXT	MAPXCH		000000	EXT	PRTWDR		000750'	INT
IODEND		020000	SIN	LHUN		000004	SPD	MATLEN	777777	777756	SPD	PRTWDW		000744'	INT
IODTER		100000	SIN	LICFMK		000017	SIN	MAXLIC		005015'	INT	PTNPNO		000000	EXT
IOEND		000040	SIN	LICHR		000040	SIN	METSLN		005463'	EXT	PTRCHG		000000	EXT
IOSERR		003040'	EXT	LICJAL		001000	SIN	MFDPPN		003060'	EXT	PTROU2		000000	EXT
IOSRBE		003661'	EXT	LICMSK		005034'	INT	MSKUNI		005755'		PTROUT		001233'	EXT
IOSRIB		004276'	EXT	LICRFL		000010	SIN	MXACL1		002264'		PTSPNO		000000	EXT
IOSUPR		003531'	EXT	LICRMT		002000	SIN	MXACL2		002263'		PVEXOG		004000	SIN
ISUERR		000005	SIN	LICRPJ		000004	SIN	MXECOD		000016	SPD	PWAIT1		000000	EXT
J		000002	INT	LICRPS		000017	SIN	N		003506'		PX.MEM		000004	SPD
JALARG		004721'		LICSAM		005053'	INT	NAMSTR		000677'	INT	PXCT	256000	000000	
JBRIRD		000754'	EXT	LICSPG		005010'		NBOOTP		000000	EXT	QUEPCB		002021'	EXT
JBTABT		005531'	EXT	LICSPJ		005002'		NCSERR		005511'	SIN	RADX10		000755'	EXT
JBTAUN		004677'	EXT	LICSPY		200000	SIN	NETERR		000016	SIN	RBDLTA		000000	EXT
JBTDLK		003513'	EXT	LICSTR		004000	SIN	NLKPPB		005451'	EXT	RBINDX		000000	EXT
JBTERN		003522'	EXT	LICSYS		040000	SIN	NODIE		006116'	EXT	RBMASK		000000	EXT
JBTLIC		005576'	EXT	LICUNU		000020	SIN	NONUA		004722'		RBREAL		000343'	EXT
JBTNAM		000000	EXT	LICWFL		000002	SIN	NOOUT2		001300'		RBYPN1		000000	EXT
JBTNM1		003211'	EXT	LICWPJ		000001	SIN	NORED		002107'	EXT	RBYUN1		000000	EXT
JBTNM2		003212'	EXT	LICWPS		000021	SIN	NOWRT		002626'	EXT	RECLSD		003550'	
JBTPPN		006161'	EXT	LKCLNA		000003	SPD	NPVERR		005504'	SPD	RELLOK		006221'	EXT
JBTPRV		002121'	EXT	LKDATB		001515'	EXT	NRMERR		000014	SIN	RELRIB		005143'	EXT
JBTRCT		000356'	EXT	LKER1		005143'		OCLOSB		001000	SIN	RENAM		003526'	
JBTSER		003524'	EXT	LKMERR		000022	SIN	ONCTIM		000674'	EXT	RENAM0		003571'	
JBTSIN		000354'	EXT	LKSET		003510'		OUTBLT		000003'	EXT	RENAM1		003574'	
JBTSLK		003515'	EXT	LLINK		000002	SPD	OUTPB		004000	SIN	RENAM2		003605'	
JBTSTS		005563'	EXT	LOCK		005516'		P		000001	INT	RENAM3		003667'	
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 90-4
FILUUO.MAC	19-SEP-89 19:52		SYMBOL TABLE

RENAM4		003716'		RIBFUT		000000	EXT	S$ENTR	777777	777775	SIN	STRERZ		005163'	
RENAM6		004144'		RIBLCW		000000	EXT	S$EVEN		000006	SIN	STRFNC		005401'	
RENAM7		004001'		RIBLST		000000	EXT	S$HALT	777777	777777	SIN	STRFNN		000012	SPD
RENAM8		004152'		RIBMTA		000000	EXT	S$INFO		000005	SIN	STRHSH		000000	EXT
RENAM9		004235'		RIBMXA		000000	EXT	S$NAME		000000'	SPD	STRLEN		005304'	EXT
RENCLR		005215'		RIBNAM		000000	EXT	S$NONA		000000	SIN	STRNAM		005732'	EXT
RENDCR		004364'		RIBPFS		000000	EXT	S$PATC		000007	SIN	STRNXT		005667'	EXT
RENDEA		004255'		RIBPID		000000	EXT	S$TEMP	000010	000000	SPD	STROVR		000000	EXT
RENECM		004317'		RIBPJ1		000000	EXT	S$XCT	777777	777776	SIN	STRSID		005745'	EXT
RENER0		005117'		RIBPJ2		000000	EXT	SAVE4		005371'	EXT	STRTAL		005730'	EXT
RENER7		005200'		RIBPJC		000000	EXT	SAVLIC		002550'		STRUNI		005661'	EXT
RENER9		005172'		RIBPOS		000000	EXT	SAVT		000045'	INT	STRUUO		005371'	INT
RENFL1		004376'		RIBPPN		000000	EXT	SETACH		001663'	INT	SWPCL1		000101'	
RENFL2		004400'		RIBPVW		000000	EXT	SETALT		001764'	INT	SWPCLN		000077'	INT
RENM2A		003632'		RIBQTF		000000	EXT	SETAPN		003031'		SWPENT		000130'	
RENM2B		003631'		RIBQTO		000000	EXT	SETDD1		000641'		SWPLK1		000144'	
RENM2C		003655'		RIBRDL		002163'	EXT	SETDD2		000654'		SWPLK2		000142'	
RENM2D		003660'		RIBRIB		000000	EXT	SETDD3		000644'		SWPLUK		000141'	
RENM4A		003722'		RIBSIZ		000000	EXT	SETDD4		000652'		SWPUP2		000152'	
RENM4B		003717'		RIBSLF		000000	EXT	SETDDB		000627'	INT	SWPUPD		000134'	
RENM8A		004163'		RIBSNM		000000	EXT	SETDDO		000625'	INT	SYDCOM		005266'	EXT
RENM9A		004214'		RIBSTS		000000	EXT	SETEN1		002424'		SYDNM4		005277'	EXT
RENM9B		004215'		RIBSZS		000000	EXT	SETEN2		002432'		SYDST1		005273'	
RENM9C		004227'		RIBTRU		000000	EXT	SETEN3		002435'		SYDST2		005300'	
RENM9D		004250'		RIBUN1		000000	EXT	SETEN4		002463'		SYDST3		005303'	
RENMB		000040	SIN	RIBUNM		000000	EXT	SETEN5		002500'		SYDST4		005304'	
RENNMC		004326'		RIBUSD		000000	EXT	SETENA		002542'		SYDSTR		005267'	INT
RENNMR		004134'		RIBVER		000000	EXT	SETFIL		003122'		SYDUN1		005256'	
RENNXR		004131'		RIBWTL		004246'	EXT	SETN3A		002451'		SYDUN2		005254'	
RENR7A		004314'		RIBXT1		000000	EXT	SETN5A		002477'		SYDUN3		005247'	
RENRCM		005202'		RIBXT2		000000	EXT	SETPID		000601'	INT	SYDUN4		005260'	
RENRIB		004254'		RIPBDA		000000	EXT	SETPIO		000620'		SYDUNI		005243'	INT
RENRR0		005240'		RIPBDR		000000	EXT	SETVAL		004427'		SYSCOR		001172'	EXT
RENRR1		005234'		RIPBFS		000000	EXT	SETVL0		004450'		SYSDEV		000100	SIN
RENRR2		005214'		RIPDIR		004553'	EXT	SETVL1		004461'		SYSDRB		003452'	EXT
RENRR3		005201'		RIPHRE		000000	EXT	SETVTU		004467'		SYSPH2		005317'	
RENRR4		005212'		RIPHWE		000000	EXT	SIMENT		002301'	EXT	SYSPH3		005324'	
RENRR7		004315'		RIPLOG		002517'	EXT	SIMRLS		003656'	EXT	SYSPH4		005327'	
RENSTS		004274'		RIPNFS		000000	EXT	SLSTR0		005424'		SYSPHY		005315'	INT
RENZAP		004370'		RIPPID		000000	EXT	SLSTRR		005423'		SYSPPN		006174'	EXT
RESETB		000020	SIN	RIPSPP		004273'	EXT	SNFERR		005475'	SIN	SYSTU1		005313'	
RETARG		005472'		RIPUFE		000000	EXT	SRCFIL		003725'	EXT	SYSTUU		005307'	INT
RIBALC		000000	EXT	RMVATB		001441'	EXT	SRCNAM		003455'	EXT	SYSUNI		005766'	EXT
RIBALP		000000	EXT	RND		003335'		SRCSTR		005413'		T1		000006	INT
RIBALT		000000	EXT	RND1		003344'		SRPNDS		000222'	EXT	T2		000007	INT
RIBAUT		000000	EXT	RND2		003360'		SRUNI		005766'	INT	T3		000010	INT
RIBCOD		000000	EXT	RNM7A		004040'		SRUSR		003416'		T4		000011	INT
RIBDEV		000000	EXT	RNM7B		004051'		STNPRT		002434'	EXT	THSDAT		002664'	EXT
RIBDIR		004344'	EXT	RRSET		005533'		STOCBR		001213'		TIME		000000	EXT
RIBELB		000000	EXT	RRSETB		005546'	EXT	STOIOS		006055'	EXT	TPOPJ		005631'	EXT
RIBEST		000000	EXT	S		000000	INT	STRBTS		000000	EXT	TPOPJ1		000000	EXT
RIBEXT		000000	EXT	S$DEBU		000003	SIN	STRDDB		005660'	EXT	TRNERR		000006	SIN
RIBFT1		000000	EXT	S$DISK		000010	SIN	STRERR		005165'		TST1U0		005661'	
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89 PAGE 90-5
FILUUO.MAC	19-SEP-89 19:52		SYMBOL TABLE

TST1U2		005662'		ULOOK		002031'		UPTSAT		000000	EXT	WRTOK		002630'	
TST1U5		005672'		ULOOK2		002063'		UPTSPD		000000	EXT	WRTOK1		002643'	
TST1UN		005650'	INT	ULOOK3		002071'		USETI0		000026'	EXT	WRTOK2		002646'	
TSTDSK		000057'	INT	UMOVE	704000	000000		USETO0		000027'	EXT	X		003503'	
TSTRES		002012'		UMOVEM	705000	000000		USETST		000333'	EXT	XA		000002	SIN
TSTWRS		002637'	EXT	UNCERR		005507'	SPD	USIMUP		002556'		ZERDDB		002542'	EXT
TSTWRT		003671'	EXT	UNFERR		005512'	SPD	USRPP1		003202'		ZERO5		000000	SIN
TUTAB		002205'		UNICHR		005733'	EXT	USRPP2		003207'		ZZ	006353	516056	SPD
U		000005	INT	UNIDES		005704'	EXT	USRPP3		003211'		%%XCOD		000017	SPD
UCLSTR		005441'		UNIFEP		005751'	EXT	USRPP4		003216'		%%Z		000100	SPD
UENTR		002274'		UNIHID		005744'	EXT	USRPP5		003226'		%COW		003444'	EXT
UFDALP		000000	EXT	UNIKON		005543'	EXT	USRPP6		003235'		%COW.N		000371	SIN
UFDATB		001631'	INT	UNILOG		006030'	EXT	USRPPN		003177'	INT	%CTUPT		000000	EXT
UFDCDT		000000	EXT	UNIMS1		005760'		USRUS1		003404'	INT	%RB2.C		000000	EXT
UFDEOF		000546'		UNIMS2		005764'		USRUS2		003405'		%RIB		376000	SIN
UFDER1		001750'	INT	UNINAM		005774'	EXT	USRUSI		003362'		%RIB.C		002345'	EXT
UFDERR		000000	EXT	UNIPPU		005734'	EXT	UUNATT		000002	SIN	%UPT		000000	EXT
UFDEXT		000000	EXT	UNISTR		005713'	EXT	UUNEXT		000001	SIN	.CPDWD		003217'	EXT
UFDLCN		000507'		UNISYS		006001'	EXT	UUNNAM		000000	SIN	.ERFSA		000011	SIN
UFDLIC		000000	EXT	UNITAL		005731'	EXT	UUNPPN		000003	SIN	.ERILE		000003	SIN
UFDLLP		000401'		UNLFIL		006051'	EXT	UUOENT		040000	SIN	.ERILF		000000	SIN
UFDLNK		000000	EXT	UNPARG		004717'		UUOIRE		002000	SIN	.ERILL		000012	SIN
UFDMS0		000573'		UNYSIZ		005256'	EXT	UUOLUK		400000	SIN	.ERMCN		000007	SIN
UFDMSK		000565'		UNYSPU		005737'	EXT	UUOMLK		100000	SIN	.ERNCS		000015	SIN
UFDNAM		000000	EXT	UNYWPS		005736'	EXT	UUOMSK		777777	SPD	.ERNFS		000014	SIN
UFDNMK		000313'		UPDAT1		002571'		UUOREN		010000	SIN	.ERNPV		000010	SIN
UFDNSL		000370'		UPDATE		002567'		UUOSEK		000032'	EXT	.ERPPN		000006	SIN
UFDNXM		000320'		UPDEN2		003013'		UUOSIM		004000	SPD	.ERRSL		000017	SIN
UFDPRT		002433'	EXT	UPDEN3		002727'		UUOUFD		020000	SIN	.ERSNF		000001	SIN
UFDRIB		000000	EXT	UPDEN4		002735'		UUOXWR		002022'	INT	.ERSSA		000002	SIN
UFDRLK		000551'		UPDEN5		003024'		UUPPID		100000	SIN	.ERTME		000004	SIN
UFDSF0		000373'		UPDEND		003006'		UUPWDS		200000	SPD	.ERUNA		000005	SIN
UFDSFD		000375'		UPDER2		005124'		UUXALC		000011	SIN	.ERUNC		000013	SIN
UFDSIZ		000000	EXT	UPDER3		005126'		UUXENT		000040	SIN	.ERUNF		000016	SIN
UFDSLP		000363'		UPDERC		005122'		UUXEXT		000003	SIN	.FSDEF		000002	SIN
UFDSP1		000521'		UPDND3		003035'		UUXLCW		000014	SIN	.FSDSL		000001	SIN
UFDSPR		000524'		UPDND4		003025'		UUXMXA		000024	SIN	.FSLOK		000004	SIN
UFDUUO		000271'		UPDNU1		001760'		UUXNAM		000002	SIN	.FSRDF		000003	SIN
UFNBLK		000427'		UPDNUR		001757'		UUXNUM		000000	SIN	.FSREM		000005	SIN
UFNDAT		000473'		UPDTD2		002722'		UUXPPN		000001	SIN	.FSSRC		000000	SIN
UFNLIC		000434'		UPDTDN		002707'		UUXPRV		000004	SIN	
UFNNCV		000471'		UPDUF0		001726'		UUXSIZ		000005	SIN	
UFNSTS		000504'		UPDUF1		001751'		UUXSTS		000017	SIN	
UFPERR		000000	EXT	UPDUF2		001752'		UUXUSD		000025	SIN	
UFYCDT		000437'	EXT	UPDUFD		001727'		UUXVER		000006	SIN	
UFYCTM		001643'	EXT	UPNSDT		002736'		VREMOV	047000	777713		
UFYPRV		001633'	EXT	UPTJDA		000000	EXT	W		000012	INT	
UFYUF1		001647'	EXT	UPTPDL		000000	EXT	W2BLSH	777777	777771	SPD	
UFYUF2		001635'	EXT	UPTPID		000000	EXT	WAIT1		003527'	EXT	
UFYXCD		001641'	EXT	UPTPJC		000000	EXT	WATPCB		004323'	EXT	
UILNMD		005121'		UPTPOS		000000	EXT	WPJARG		004723'		
ULKDBL		005141'	EXT	UPTRB2		000000	EXT	

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

ADJMWS	   322%	   343	   350
AEFERR	  3496
ALCCHK	  2101	  2137#	  2953
ALIASD	   206	  4015	  4049	  4073#
ARGALC	  3309#	  3338
ARGALP	  3327#
ARGALT	  3333#
ARGAUT	  3322#	  3339
ARGDEV	  3314#
ARGELB	  3316#
ARGEST	  3308#	  3338
ARGEUN	  3317#
ARGFT1	  3311#	  3338
ARGFUT	  3307#	  3338
ARGLIC	  3312#	  3338
ARGLUP	  4092#	  4100
ARGMTA	  3313#	  3339
ARGMXA	  3320#	  3340	  3341
ARGPID	  3332#	  3338
ARGPJ0	  3329#	  3339	  3342
ARGPJ1	  3330#	  3339	  3342
ARGPJ2	  3331#	  3339	  3342
ARGPOS	  3310#	  3338
ARGPVS	  3179	  3180	  3334#	  3339	  3340
ARGQTF	  3318#	  3340	  3341
ARGQTO	  3319#	  3340	  3341
ARGSNM	  3328#
ARGSTS	  3179	  3180	  3315#	  3338
ARGTAB	  4096	  4103#	  4122
ARGTRU	  3325#	  3340	  3341
ARGUFD	  3326#	  3338
ARGUN1	  3324#	  3340	  3341
ARGUNM	  3323#	  3340	  3341
ARGUSD	  3321#	  3340	  3341
ARGVER	  3306#	  3338
ASSCON	   675
ASSPRG	   661	   675	  2391
ATBALP	    88%	   253	   892	  1074	  1105	  1303	  1346	  1756	  1838	  2762	  2770	  2807	  2808
ATBCNT	    88%	   264	  3524
ATBDOR	    89%	  1160	  2745	  2746	  2747	  2752	  2753	  2761	  2786	  2797	  2833	  2834	  2835	  2848
	  2874	  3015	  3071	  3072	  3571	  3572	  3583
ATBFNB	    88%	   237	   881	   957	   991	  1022	  1046	  1111	  1264	  1365	  1392	  1429	  1471	  2054
	  2191	  2664	  2802	  2821	  2822	  2831	  2838	  2849	  2878	  2961	  2991	  3016	  3026	  3058
	  3075	  3509	  3574
ATBLCW	    89%	   909	   920	   924	   940	  1094	  1102	  1112	  1135	  1348	  1371	  1373	  1413	  1953
	  2066	  2174	  2778	  2809	  2810	  2898	  2969	  2974	  3292	  3297	  3344	  3361	  3368
ATBLIC	    88%	  1299	  1343	  1860	  1988	  2068	  2776	  3472
ATBLNK	    89%	  1167	  2798	  2799	  2800	  2801	  2813	  2814	  2820	  2823	  2824	  2830
ATBMSC	    88%	   938	  1090	  1682	  1687	  1855	  1962	  2091	  2126	  2811	  2812	  2911	  2940
ATBMWC	    89%	  1148	  1226	  2056
ATBPID	    90%	  1351	  1865	  2171	  2899	  3294
ATBPRV	    89%	  1899
ATBPVW	    88%	  1108	  1680	  1691	  1919	  1951	  2088	  2124	  2909	  2916	  2918	  2942
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

ATBRIB	    89%	   873	  1042	  1169	  1214	  1309	  1325	  1366	  1393	  1474	  1843	  1941	  2022	  2628
	  3062
ATBSIZ	    88%	  1080	  1672	  1695	  1837	  1974	  2095	  2106	  2148	  2805	  2806
ATBSTS	    88%	   259	   276	   389	   859	   884	   945	   960	   998	  1035	  1049	  1055	  1068	  1086
	  1127	  1131	  1147	  1154	  1163	  1194	  1220	  1230	  1442	  1769	  1822	  1858	  1896	  1928
	  2030	  2041	  2053	  2630	  2645	  2657	  2663	  2678	  2700	  2707	  2920	  3003	  3065	  3103
	  3107	  3194	  3508	  3557
ATBUMC	    89%	  2783
ATMCNT	    91%	   265	   863	   948	   961	  1231	  2688	  3510
ATMCSC	    92%	  2777
ATMMWC	    92%	  1149	  1227	  2057
ATMUFP	    92%	  2065	  2777	  3352
ATMUFU	    92%	  3352	  3353
ATMUMC	    92%	   885	   961	  1050	  1231	  2782	  3510
ATPALC	    92%	   921	   925	  1100	  1113	  1134	  1370	  1412	  2065	  3359	  3362
ATPCNT	    91%	   883	   959	   997
ATPCRE	    91%	  1036	  1048	  1069	  1071	  1087	  1099	  1128	  1155	  1221	  1824	  1929	  3102	  3507
	  3510
ATPDEL	    91%	   864	   950	  1053	  1158	  1162	  1443	  2042	  2660	  2676	  2701
ATPDIR	    91%	   388	  1193	  1768	  1856	  2646	  2919	  3106	  3193
ATPDMP	    91%	   908	   926	  2896
ATPMXU	    91%	   961	  1142	  1228	  1231	  2048	  2052	  3510
ATPNDL	    91%	  1826	  2028	  2631
ATPPID	    92%	  1347	  2065	  2173	  2896	  3291	  3296	  3359	  3362
ATPREN	    92%	   265	   860	   946	  1155	  2706	  3002	  3064	  3510	  3556
ATPSUP	    92%	  1036	  1048	  1069	  1087	  1099	  1132	  1142	  1155	  1221	  1895	  3102	  3507	  3510
ATPUFE	    92%	  1097	  1098	  2972	  2973
ATPUPD	    91%	   258	   265	   275	   961	  1142	  1158	  1229	  2052	  2662	  2676	  3510
ATT1	   740%	   747
ATYADT	    94%	   923	   934	  1089	  1927	  2070
ATYBLK	    93%	  1763	  2190	  3162
ATYBSZ	    93%	   294	   424
ATYCDT	    93%	  1281	  1333	  2081	  2115
ATYCNT	    94%	  2781
ATYCSC	    93%	  1290	  1339	  1887	  2085	  2121
ATYCTD	    93%	  2939
ATYCTM	    93%	  1288	  1338	  2083	  2120
ATYPRV	    94%	  1273	  1329	  2927
ATYUF1	    94%	  1295	  1341
ATYUF2	    94%	  1277	  1331
ATYXCD	    93%	  1284	  1335	  1870	  1880	  1890	  1908	  1915	  1931	  2087	  2117	  2938
B2PLSH	  2473
B2WLSH	  2146	  2160	  2496
BADUFD	  1459#
BLKLNK	  2502	  2514#
CBUSER	    77%	  1502
CHGNAM	   829	   834#
CHGPPN	   820#
CHKAG1	  1997	  2005	  2203#	  2591
CHKAGX	  2208	  2225#
CHKARG	  1522	  1811	  2200#
CHKPP1	  2213	  2216#
CHKPP2	  2217	  2221#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

CHKPPN	  2210#	  2241
CHKPRV	    66%	  1651	  1656	  1664	  1827	  2031	  2034	  2155	  2169	  2639	  2727	  2756	  2889
CHKSGJ	   741%	   749
CKJPP2	  3952	  3958#
CKJPPN	  3729	  3814	  3951#
CLCALC	  1738	  1763#
CLCMXA	  1749	  1768#
CLCUSD	  1750	  1789#
CLFAL1	  3159#	  3170	  3171
CLFAL2	  3158	  3167#
CLFALC	  3130	  3156#
CLFLC1	  3360	  3364#
CLFLIC	  3133	  3344#
CLFMX1	  3255	  3269#
CLFMX2	  3256	  3272#
CLFMX3	  3257	  3263#
CLFMXA	  3141	  3255#
CLFNPS	  3180	  3187#
CLFPID	  3153	  3279#
CLFPIO	  3285	  3288	  3291#
CLFPIS	  3293#	  3298
CLFPIZ	  3280	  3296#
CLFQT1	  3195	  3215#
CLFQT2	  3200	  3202	  3212#
CLFQT3	  3210	  3216#
CLFQTF	  3139	  3193#
CLFSTS	  3136	  3179#
CLFUM1	  3219	  3223#
CLFUN1	  3145	  3226#
CLFUNM	  3144	  3219#
CLFUS1	  3233	  3241#	  3246
CLFUS2	  3234	  3248#
CLFUS3	  3235	  3244#
CLFUSD	  3142	  3233#
CLIBDR	   868	   892#	  2694
CLIDEL	   866#	   951
CLOCM1	  1222	  1230#
CLOCM2	  1238	  1241#
CLOCOM	  1165	  1176	  1181	  1190	  1195	  1204	  1207	  1211#
CLORS1	  1045#	  1079
CLORS2	  1052	  1057#
CLORS3	  1056	  1058#
CLORST	  1067	  1074#
CLOSCR	  1072	  1129	  1188#
CLOSE1	    56%	  2600	  3011
CLOSIN	   164	   845#	  1484	  2543	  2620
CLOSOU	   152	  1009#	  1485
CLOSRN	   863#	  2685	  3526
CLOSU1	  1154#	  1168
CLOSU2	  1159	  1167#
CLOSU3	  1161	  1183#
CLOSU4	  1169#	  1187
CLOUF1	  1199	  1203#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

CLOUPD	  1070	  1133	  1206#
CLRAC0	  1398	  1412#
CLRACH	   922	  1390#
CLRCM1	  3516#
CLRCOM	  3509#
CLRDD1	   694#	   700
CLRDDB	   182	   690#	  2544
CLRENT	  3506#	  3528	  3532
CLRNT1	  3508#
CLSACC	   913	   933	  3010	  3525
CLSDMP	   905
CLSIN	  2599
CLSIN2	   865	   900#
CLSIN3	   914	   930	   949	   955#	  2689
CLSIN4	   973	   980#
CLSIN5	   887	   962	   968	   985	   988#
CLSIN6	   964	   987#
CLSIN7	   907	   913#
CLSIN8	   912	   920#
CLSN2A	   937	   944#
CLSN2B	   927	   931#
CLSN3A	   886	   966#
CLSN3B	   972#	   976
CLSOU0	  1027	  1032#
CLSOU1	  1025	  1029#
CLSOU2	  1039	  1080#
CLSOU3	  1114	  1125#
CLSOUT	   900	  3525
CLSRST	  1032
CLSXIT	   903	   956	   995#
CLSXT1	   861	   947	   991#
CLSXT2	   989	   999#
CMBLNK	   120%	   369	   376	   984
CMPLOG	  4169	  4170#
CNVVPN	  2472	  2488	  2508	  2514	  2526
CODDSK	  3987#	  4003
CODKNC	  3991#	  4028
CODKON	  3992#	  4033
CODLUF	  3990#	  4020
CODPUN	  3993#	  4031
CODRIB	   109%	  1947
CODSFS	  3988#	  4082
CODSTR	  3989#	  4017
COMERA	   740%	   745	   751
CPOPJ	    49%	   214	   227	   803	  2142	  2263	  3279	  4002
CPOPJ1	    49%	   150	   203	   211	   335	   338	   351	   354	   645	   679	   728	   830	  1731	  2223
	  2231	  2269	  2279	  2286	  2297	  2316	  2330	  2336	  2346	  2365	  2622	  3470	  3614	  3615
	  3734	  3759	  3761	  3763	  3824	  3832	  3836	  3849	  3877	  3883	  3957	  3972	  4088	  4099
	  4101	  4157
CPOPJ2	    57%	  4162
CPRRED	  2472
CPUKS	  4120	  4121	  4124
CPUTYP	  4120	  4121	  4124
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

CPZZ	  4120#	  4120	  4121#	  4121	  4124#	  4124
CRBRWL	    72%	  1174
CREUFD	  1191	  1263#	  1448	  3000	  3056
CRLF	   740%	   764	   776
CURUPT	    58%
DATCOM	    61%	   521
DBRLP	  2852#	  2870
DBRNXT	  2854	  2868#
DBYT	   147#
DCL	   152#
DCLI	   164#
DCTBSZ	   329#	   337
DDBCOR	    85%	   667	   705
DDBLEN	    85%	   148	   672
DDI	   141#
DDINT	   146#
DDO	   140#
DDXZ	   145#
DECENT	   248#	  1977
DECIN	   740%	   743
DECLUK	   245#	  1210	  1728	  3562
DECSTP	   249#	   850	  1014	  1527	  1816	  2039	  2612	  2643	  2704
DECUP2	   247#	   995
DECUPD	   246#	  2186
DELGRP	  2103	  2154#
DEN	   159#
DEV1UN	  1833	  4063%	  4064
DEVATB	    84%	   234	   271	   292	   387	   423	   853	   988	   993	  1016	  1034	  1062	  1177	  1180
	  1240	  1364	  1425	  1470	  1648	  1820	  1839	  2020	  2603	  2625	  2741	  2742	  2758	  2836
	  2837	  2852	  2875	  3471	  3512	  3547	  3581
DEVDBL	    84%	  2850	  2855	  2856	  2858	  2869
DEVDRB	    84%	   854	  1017	  1251	  1649	  1821	  2021	  2637	  2708	  2737	  2743	  2744	  2759	  2866
	  3548	  3582
DEVELB	    84%
DEVEXT	  1269	  1529	  2014	  2266	  2398	  2721	  2843	  2863	  2882
DEVFIL	  1197	  1266	  1487	  1536	  1540	  1772	  1961	  2010	  2264	  2396	  2593	  2648	  2717	  2840
	  2861	  2862	  2880	  2924	  3019	  3198
DEVFLO	    85%	  2024	  2402
DEVIAD	  1660	  2027	  2038	  2204	  2227
DEVIOS	   583	   684	  1003	  1730	  1979	  2188	  2201	  2384	  2547
DEVLG	    70%	  4006
DEVLOG	   681	   682
DEVMOD	   228	   660	   676	   718	  2392	  3467	  4009	  4045
DEVNAM	   658	   678	  4011	  4048
DEVPOS	    85%	   297	  1488
DEVPPN	  1489	  1533	  1853	  1964	  1987	  2018	  2268	  2401	  2714	  2846	  2864	  2865	  2884	  2981
	  3365	  3475
DEVRB1	    85%	   683
DEVRET	    85%	   440
DEVRIB	    85%	  1172	  2023	  2629
DEVSER	   226	   673	   695	   703	   704
DEYSTC	    84%	   239	   241	   851	   996	  1015	  1212	  1528	  1729	  1817	  1978	  2040	  2187	  2613
	  2644	  2705	  3541	  3563
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

DEYTCT	    84%
DFCRE	   169#
DFDEL	   168#
DFEXC	   170#
DFFIF	   174#
DFTRN	   175#
DFVLR	   172#
DGF	   158#
DGTRD	   156#
DHNG	   150#
DIE	    16	    16%	    17	  1445	  1459	  1504	  2487	  3516
DIN	   154#
DINI	   149#
DIRBLK	    72%	  1433	  2994	  3031
DIRSRC	    69%	  1436	  2996	  3033
DLK	   160#
DLTALL	    68%	   869	  1040	  1178
DLTNAM	    68%	  2668	  3047
DLTTRC	    67%	  2162	  2955
DMOVPG	   176#
DMT	   157#
DOU	   153#
DRBALC	   102%	   254	   893	   894	   896	  1075	  1076	  1078	  1253	  1792	  1829	  2763	  2767	  2771
	  2772	  2774	  3209	  3238	  3251	  3258	  3264
DRBCNT	   102%	   260	   267	   999	  1058	  1233	  2060	  2651	  2709	  2788	  2793	  3004	  3066	  3514
	  3558	  3576
DRBFNB	   103%	   361	   371	   970	   971
DRBLNK	   102%	  2305	  2317	  2354	  2366	  2532
DRBLOG	   104%	   319	  1246
DRBMXA	   102%	  1256	  1780	  2768	  2769	  3208	  3239	  3240	  3259	  3275
DRBNAM	   102%	  2310	  2362	  2845	  2883
DRBNX	   103%	  1202	  2656
DRBRIB	   102%	  1200	  1777	  2654	  3201
DRBUN1	   102%	  2313	  2360	  3221	  3227
DRBUNM	   102%	  2312	  2359	  2539	  3220
DRL	   151#
DRMCNT	   104%	  2652
DRN	   161#
DRPLOG	   104%	   318	  1245
DRPMXC	   104%	   261	   268	  1000	  1059	  1234	  2061	  2710	  2789	  2794	  3005	  3067	  3515	  3559
	  3577
DRPNX	   104%	  1201	  2655
DRYCNT	   103%	   359
DRYPRV	   103%	  2929
DSEK	   166#
DSI	   162#
DSIM	   171#
DSKCHK	  4007	  4015#
DSKCHR	  3995#
DSKCL1	   359#	   380
DSKCL2	   326	   352#
DSKCL3	   327	   345#
DSKCL4	   328	   341#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

DSKCL5	   364	   368#
DSKCL6	   363#	   366	   373
DSKCL7	   362	   375#
DSKCLN	  1459%	  1459
DSKCLR	   321	   332#
DSKCM1	   744	   758#
DSKCM2	   753	   766#
DSKCOM	   739	   743#
DSKCTB	   326#	   329	   339
DSKDDB	    76%	   205	   224	   651	   657	   663	   671	   673	   682	   693	  2385
DSKDSP	    43	   143#
DSKFND	  4016	  4019	  4038#
DSKINC	   760	   782	   794#
DSKKJB	    43	   809#	   825
DSKKLP	   811#	   815
DSKLGO	   310#	   812	   816
DSKREL	   151	  1479#
DSKRES	    43	   803#
DSKUG1	   293	   301#	   304
DSKUG2	   296	   299	   303#
DSKUGF	   158	   290#
DSLSTR	  3793	  3813#
DSO	   163#
DSPSIZ	   145	   177#
DUFD	   165#
DVDSK	   229	   719	  3469	  4008	  4046
DVMAP	   167#
DVSIZ	   148#
DVSMAP	   173#
DZAP	   155#
ECOD	  3893	  3894	  3895	  3896	  3897	  3898	  3899	  3900	  3901	  3902	  3903	  3904	  3905	  3906
	  3907	  3908#
ECOD0	  3776	  3893#	  3908
ECOD1	  3774	  3894#
ECOD10	  3772	  3901#
ECOD11	  3902#
ECOD12	  3717	  3771	  3903#
ECOD13	  3780	  3904#
ECOD14	  3905#
ECOD15	  3778	  3906#
ECOD16	  3777	  3907#
ECOD2	  3895#
ECOD3	  3715	  3896#
ECOD4	  3897#
ECOD5	  3898#
ECOD6	  3716	  3773	  3899#
ECOD7	  3900#
ENTER1	  1828	  3528#
ENTER2	  1832	  1836	  1842	  3532#
ENTRB	   848	   879	   901	   955	  1009	  1063	  1215	  1518	  2595
EPT	    58%
ERNSET	  1807	  1996	  2575#	  2589
ERRLKM	  3536#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

ERRNET	  3539#
ETSLUP	  3871#	  3874
ETSSTR	  3800	  3861#
ETSTAB	    77%	  3873
ETSUNI	    77%	  3863	  3875
EXTUUO	    27#	    42	  1530	  1542	  1670	  1872	  1874	  1916	  1920	  1933	  2071	  2122	  2179	  2232
	  2245	  2250	  2255	  2618	  2901	  2944	  2949	  3489	  3493	  3542	  3544
F	   205	   224	   226	   227	   228	   234	   271	   292	   297	   385	   387	   423	   440	   583
	   656	   658	   660	   670	   672	   673	   676	   678	   681	   683	   684	   699	   703	   706
	   718	   845	   848	   853	   854	   879	   901	   929	   931	   955	   963	   988	   993	  1003
	  1004	  1009	  1016	  1017	  1033	  1034	  1037	  1038	  1062	  1063	  1066	  1088	  1172	  1177
	  1180	  1197	  1206	  1215	  1237	  1240	  1251	  1266	  1269	  1364	  1425	  1470	  1483	  1486
	  1487	  1488	  1489	  1518	  1529	  1533	  1536	  1540	  1648	  1649	  1654	  1660	  1661	  1730
	  1772	  1809	  1820	  1821	  1833	  1839	  1853	  1961	  1964	  1979	  1987	  1994	  2010	  2014
	  2018	  2020	  2021	  2023	  2024	  2027	  2038	  2188	  2201	  2204	  2216	  2227	  2264	  2266
	  2268	  2383	  2384	  2385	  2392	  2394	  2396	  2398	  2401	  2402	  2469	  2470	  2480	  2481
	  2492	  2493	  2542	  2546	  2547	  2556	  2593	  2595	  2596	  2603	  2623	  2624	  2625	  2629
	  2637	  2648	  2658	  2659	  2708	  2714	  2717	  2721	  2737	  2741	  2742	  2743	  2744	  2758
	  2759	  2836	  2837	  2840	  2843	  2846	  2861	  2864	  2875	  2880	  2882	  2884	  2924	  2981
	  3019	  3198	  3365	  3467	  3468	  3471	  3475	  3512	  3547	  3548	  3581	  3582	  3918	  3921
	  3923	  4009	  4011	  4012	  4045	  4048	  4064
FALHOL	  2466%	  2484
FALPHP	  2466%	  2485
FBIT	  1840%	  1840
FBMERR	  3503
FBOOTB	  4127%	  4127
FILLIC	  1989	  3366	  3373#
FILUUO	    16	    17#	    20
FINNXB	   553	   556	   577#
FINSUP	   485	   491	   499	   504	   536	   545	   567#
FINUS0	   467	   551	   590#
FNBALT	    96%	  1119	  1369	  1396	  1475	  2803	  2804	  2963
FNBAPD	    96%	  2192
FNBATB	    97%	   363	   967	  1153	  2813	  2823
FNBDBL	    97%	  2850	  2851	  2857	  2859
FNBDRB	    96%	   969
FNBEXT	    96%	  2842	  2881
FNBLNK	    96%	   970	   975	   980	   981
FNBNAM	    96%	  2839	  2879	  3017
FNBNX	    96%	  1218	  2674	  3061	  3078
FNBRIB	    96%	  1170	  1216	  1367	  1394	  1472	  2675	  3063	  3079
FNBUPD	    96%	  1152	  1223	  2055
FNCAPP	    99%	  2029
FNCCAT	   100%	  2168
FNCCNM	   100%	  2725
FNCCPR	   100%	  2888
FNCCRE	    99%	  1823	  2755
FNCDEL	   100%	  2638	  2726
FNCEXC	    99%	  1655
FNCLOK	    99%	  1650
FNCRED	    99%	  1653	  1663
FNCSUP	    99%	  1825
FNCTRN	   100%	  2154
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

FNCUPD	   100%	  2033
FNDDRB	    67%	  1198	  2649	  2925	  3199
FNDNGT	  1662	  1666	  1670#
FNDROK	  1658	  1661#
FNDST1	  4086#
FNDSTR	  4030	  4034	  4040	  4083#
FNFERR	  3486
FNPNX	    97%	  1217	  2673	  3060	  3077
FNYUFP	    97%	  1430	  2992	  3030	  3038	  3042
FOUND	  1648#
FOUND1	  1675	  1679#
FOUND2	  1671	  1687#
FOUND3	  1684	  1690	  1694	  1703#
FOUND4	  1700	  1707#
FOUND5	  1709	  1714#
FOUND8	  1704	  1711	  1724#
FPCSET	    72%	   348
FREACC	   879#	   898
FREATB	    66%	   255	   966	  1057	  3076	  3511	  3575
FUNM	  2500	  2522#
FUNM1	  2536	  2540#
FUTAB	  3117	  3127#
FUUEND	  4337#
FUULIT	  4195#
GERIFS	  3715#	  3733
GERILL	  3717#	  3727
GERPPN	  3716#	  3730
GET4WD	    58%	   668
GETB	  1654	  1661	  3468
GETBSA	  4120	  4125#
GETCBR	    66%	   313	   356	   852	   880	   911	   944	  1045	  1141	  1196	  1219	  1363	  1415	  1771
	  2008	  2304	  2353	  2530	  2627	  2672	  2682	  2780	  2923	  3059	  3196	  3506	  3523	  3573
	  3917
GETER1	    71%
GETEXT	  1868	  2012	  2250#	  2265	  2719	  2910	  2932
GETGMT	  1883%	  1883	  2114
GETLI1	  3471#
GETLIC	  3467#
GETNAM	  2009	  2245#	  2262	  2606	  2634	  2716
GETPPN	  2017	  2255#	  2267	  2713
GETUPG	  1841%	  1841
GETWDS	    49%
GINST	   393#	   393	   394	   394#	   395	   396#	   396	   397	   406#	   406	   407	   456#	   456	   457
	   487#	   487	   488	   529#	   529	   530	   544#	   544	   545	   550#	   550	   551	   569#	   569
	   570	   574#	   574	   575	  1679#	  1679	  1680	  1683#	  1683	  1684	  1688#	  1688	  1689	  1876#
	  1876	  1877	  1922#	  1922	  1923	  1935#	  1935	  1936	  1938#	  1938	  1939	  2092#	  2092	  2093
	  2113#	  2113	  2114	  2127#	  2127	  2128	  2138#	  2138	  2139	  2210#	  2210	  2211	  2237#	  2237
	  2238	  2238#	  2239	  2246#	  2246	  2247	  2251#	  2251	  2252	  2256#	  2256	  2257	  2375#	  2375
	  2376	  2538#	  2538	  2539	  2905#	  2905	  2906	  3490#	  3490	  3491	  3543#	  3543	  3544	  3545#
	  3545	  3546	  3760#	  3760	  3761	  3762#	  3762	  3763	  3828#	  3828	  3829	  3833#	  3833	  3834
GIV4WD	    58%	   708
GIVCB1	    68%	    70%	   358	   381
GIVCBR	    67%	   317	   320	   360	   866	   935	  1005	  1164	  1171	  1203	  1368	  1372	  1422	  1782
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	  1784	  2064	  2314	  2319	  2363	  2368	  2540	  2665	  2680	  2693	  2733	  2871	  2887	  2931	  3080
	  3205	  3212	  3497	  3518	  3554	  3580	  3918	  3929
GIVPAG	    73%
GIVWDS	    49%
GOBSTR	  3720	  3721#
GTCGSZ	   448	  2564%	  2566	  2576
GUFBT	    70%	  4103
HIGHJB	    56%	   810	  2280	  2291	  2331	  2341	  3961
ICLOSB	  2624
ILFERR	  3776#	  3788	  3790	  3794	  3795	  3796	  3797
ILLERR	  3771#	  3844
ILNMER	  1523	  1526	  1550	  1812	  1815	  1998	  2006	  2592	  3486#
INBLT	   129%	   141
INDPPN	    77%	  3393
INLMES	   741%	   758	   761	   766	   770
INPB	   929	   931	   963	  1088	  2542
INSNAM	    72%	  1189	  3054
INSUN2	  4185	  4188#
INVDDB	    66%	  1208	  1724	  2183	  2196
IO	  1173	  1248	  1431	  1703	  1707	  2430	  2993
IOBDRB	   383%
IODEND	   429	   582
IODTER	   433
IOEND	   429	   582
IOSERR	    50%	  2200
IOSRBE	    50%	  2430	  2684
IOSRIB	    50%	  1432	  1645	  2405	  2430	  2590	  2602	  2616	  2986
IOSUPR	    50%	  1490	  1517	  1805	  2587
ISUERR	  3494
J	   216	   232	   332	   445	   447	   450	   452	   626	   748	   750	   754	   772	   775	   781
	   783	   809	   811	   822	   826	   827	   828	   834	   837	   838	   904	  1480	  2303	  2352
	  2565	  2567	  2569	  2575	  2577	  2579	  3091	  3092	  3097	  3100	  3105	  3283	  3613	  3919
	  3920	  3921	  3922	  3927	  3928	  3932	  3939	  3940	  3956	  3959	  3963	  3964	  3966	  3969
	  3970	  3982	  3996	  3997	  4000	  4004	  4005	  4086	  4088	  4098	  4099
JALARG	  3098	  3340#
JBRIRD	   791%	   799
JBTABT	    57%	   447	   561	   587	   596	  3921	  3928
JBTAUN	    52%	   626	  1944	  2281	  2335	  3283
JBTDLK	    54%	  2567	  2568
JBTERN	    54%	  2577	  2578
JBTLIC	    54%	   216	   332	   822	   904	  1985	  2977	  3097	  3100	  3351	  3356	  3613	  3932	  3982
JBTNAM	  3231%
JBTNM1	   826	   837%	   837	  2294	  2342
JBTNM2	   827	   838%	   838	  2296	  2343
JBTPPN	    52%	   809	   813	   828	   834%	   834	  1852	  1986	  2212	  2292	  2345	  2980	  3364	  3474
	  3969	  3970
JBTPRV	    52%	  1669
JBTRCT	   451	   452	   740%	   772	   775	   781	   783
JBTSER	    52%	  2579	  2580
JBTSIN	   449	   450	   740%
JBTSLK	    54%	  2569	  2570
JBTSTS	    57%	  3963
JBTUN1	    52%	  2285	  2333
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

JBTUNM	    52%	  2283	  2332
JBTWCT	   740%	   772	   775	   781	   783
JBYIRD	   791%	   795	   797
JBYRCT	   740%	   768	   794
JBYWCT	   741%	   773
JBYWPT	    54%	   623	  3093	  3286
JFYSEC	    56%	   511	   524	  1885	  2118
JNA	  3964
JOB	    56%	  1480	  1501	  2302	  2303	  2315	  2320	  2351	  2352	  2364	  2369	  2389	  3473	  3920
	  3927	  4005
JOBN	   741%	   746
JOBST0	  3732	  3747#
JOBST1	  3750	  3754#
JOBST2	  3749	  3757#
JOBST8	  3752	  3758#
JOBSTR	    43	  3742#
KFCRE	    50%	   169
KFDEL	    50%	   168
KFEXC	    50%	   170
KFFIFP	    51%	   174
KFTRN	    51%	   175
KMAPP	    50%	   167
KMOVPG	    51%	   176
KONLTM	   122%	  3940
KSMAPP	    50%	   173
KSNOCH	   391	   391%	   847	  1012	  1520	  1803	  1992	  2584
KVLRIB	    51%	   172
LHUN	  2460#	  2498
LICFMK	  3420	  3439	  3459
LICHR	  3373	  3389	  3390	  3397	  3398	  3400	  3438
LICJAL	   820	   906	  3096	  3350	  3931
LICMSK	  3402	  3428#
LICRFL	  3383	  3384	  3389	  3397	  3480
LICRMT	  3373	  3387	  3388	  3389	  3395	  3396	  3397	  3400	  3437
LICRPJ	  3386	  3397	  3481
LICRPS	  3413	  3416	  3418	  3432	  3433	  3435	  3454	  3455	  3457
LICSAM	  3450#
LICSPG	  3391	  3394	  3400#
LICSPJ	  3378	  3393#
LICSPY	  3612
LICSTR	   215	  3931	  3981
LICSYS	  3612
LICUNU	  3441	  3461
LICWFL	   333	   334	   906	  2978	  3350	  3357	  3379	  3380	  3387	  3389	  3395	  3397	  3478
LICWPJ	   333	   334	  3099	  3358	  3382	  3395	  3397	  3479
LICWPS	  3408	  3409	  3412	  3428	  3429	  3431	  3450	  3451	  3453
LISTSN	     3	     6
LKCLNA	  3838#	  3843
LKDATB	    69%	   266	   987	  1232
LKER1	  1652	  3520#
LKMERR	  3536
LKSET	  1521	  2565#
LLINK	  2462#	  2503
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

LOCK	  3917#	  3998
LOGCHK	  4023	  4081#
LOGTST	   875	   897	  1044	  1213	  1245#	  3049	  3052
LOKLL5	  2377	  2383#
LOKLUD	  1539	  2215	  2373#
LOKPPB	    70%	  3847
LOKUNM	   383%	   421
LOOKB	   385	   845	  1063	  1206	  1237	  1809	  1994	  2469	  2480	  2492	  2542	  2623	  2658
LP2BAT	  4119%	  4119
LP2HOM	  4118%	  4118
LPNBAT	  4119%	  4119
LPNHOM	  4118%	  4118
LPPN	  2461#	  2501	  2524
LUDER0	  2404	  2545#
LUDER1	  2486	  2487	  2512	  2518	  2519	  2551#
LUDER2	  2388	  2556#
LUDERR	  2541#	  2554
LUDHSH	  2433	  2459#
LUKER1	  1519	  1806	  1995	  2588	  3489#
LUPUNI	  4153#	  4164
M	   301	   336	   392	   393	   394	   396	   405	   406	   419	   427	   439	   455	   456	   470
	   488	   544	   550	   569	   574	   578	   635	   644	   900	   905	   913	   933	  1032	  1524
	  1530	  1541	  1542	  1544	  1670	  1679	  1681	  1683	  1688	  1692	  1698	  1718	  1720	  1813
	  1857	  1863	  1871	  1872	  1873	  1874	  1901	  1916	  1920	  1922	  1933	  1935	  1938	  1957
	  1966	  1999	  2044	  2071	  2075	  2076	  2090	  2092	  2098	  2113	  2122	  2125	  2127	  2137
	  2138	  2157	  2158	  2161	  2179	  2182	  2195	  2205	  2206	  2209	  2210	  2221	  2222	  2232
	  2235	  2237	  2239	  2240	  2245	  2246	  2247	  2250	  2251	  2252	  2255	  2256	  2257	  2374
	  2378	  2399	  2524	  2533	  2535	  2537	  2538	  2541	  2548	  2557	  2598	  2599	  2601	  2605
	  2608	  2618	  2633	  2669	  2736	  2739	  2750	  2901	  2905	  2906	  2944	  2945	  2948	  2949
	  2987	  3010	  3013	  3048	  3051	  3113	  3116	  3122	  3156	  3165	  3190	  3252	  3266	  3276
	  3367	  3489	  3490	  3493	  3525	  3542	  3543	  3544	  3545	  3597	  3598	  3611	  3616	  3620
	  3621	  3722	  3731	  3742	  3748	  3758	  3760	  3762	  3786	  3787	  3791	  3818	  3825	  3828
	  3830	  3833	  3845	  3846	  3862	  3871	  3872	  3934	  3951	  3953	  3967
MAPB	   929	   931	   963	  1088
MAPID	  2465#	  2476
MAPRDU	    71%	   444
MAPRLS	    71%
MAPWLN	    68%	  1846
MAPWTL	    71%
MAPXCH	    71%
MATLEN	  4089	  4122#
MAXLIC	  3375	  3408#
METSLN	    77%	  3870
MFDPPN	    76%	   311	   821	  1534	  2219
MSKUNI	  4073	  4134#	  4178
MXACL1	  1770	  1785#
MXACL2	  1776	  1778	  1784#
MXECOD	  3676#	  3715	  3715#	  3716	  3716#	  3717	  3717#	  3771	  3772	  3773	  3774	  3776	  3777	  3777#
	  3778	  3780	  3891
N	  2415	  2417	  2437	  2438	  2441	  2442	  2561#
NAMSTR	   711	   718#
NBOOTP	  4127%	  4127
NCSERR	  3778#	  3779
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

NETERR	  3539
NLKPPB	    70%	  3848
NODIE	    16%	  1459
NONUA	  3108	  3341#
NOOUT2	  1024	  1030	  1066#
NORED	    53%	  1659	  2202
NOWRT	    53%	  2026	  2037	  2202
NPVERR	  3772#	  3826	  3933	  3984
NRMERR	  3533	  3593
OCLOSB	  2596	  2624
ONCTIM	    58%	   707
OUTBLT	   129%	   140
OUTPB	  1088
P	    17	   146	   149	   155	   156	   157	   187	   188	   189	   190	   192	   193	   194	   195
	   196	   204	   206	   207	   209	   210	   217	   218	   230	   255	   266	   272	   290	   302
	   312	   313	   316	   344	   345	   346	   348	   349	   352	   353	   356	   365	   386	   390
	   391	   399	   402	   420	   421	   428	   431	   435	   436	   438	   444	   448	   468	   469
	   471	   472	   477	   478	   512	   519	   520	   521	   526	   527	   528	   548	   549	   559
	   567	   568	   579	   584	   593	   594	   597	   603	   613	   633	   636	   651	   655	   659
	   668	   678	   709	   720	   743	   749	   752	   753	   754	   755	   758	   760	   761	   763
	   764	   766	   769	   770	   774	   782	   784	   814	   823	   824	   825	   828	   829	   835
	   839	   847	   849	   852	   862	   866	   867	   869	   875	   880	   882	   897	   910	   911
	   922	   935	   936	   943	   944	   958	   966	   987	   992	  1010	  1011	  1012	  1013	  1023
	  1028	  1029	  1040	  1044	  1045	  1047	  1057	  1125	  1130	  1136	  1141	  1164	  1171	  1174
	  1175	  1178	  1183	  1185	  1186	  1189	  1191	  1192	  1196	  1198	  1203	  1208	  1213	  1219
	  1232	  1239	  1241	  1247	  1249	  1263	  1265	  1312	  1313	  1314	  1349	  1353	  1363	  1376
	  1378	  1379	  1380	  1381	  1382	  1383	  1390	  1391	  1395	  1403	  1414	  1422	  1423	  1424
	  1426	  1428	  1433	  1434	  1436	  1445	  1448	  1449	  1450	  1451	  1452	  1453	  1455	  1456
	  1457	  1459	  1460	  1468	  1469	  1476	  1479	  1481	  1484	  1485	  1496	  1497	  1499	  1500
	  1504	  1516	  1520	  1521	  1522	  1525	  1539	  1643	  1651	  1656	  1664	  1710	  1724	  1725
	  1726	  1727	  1738	  1749	  1750	  1766	  1771	  1775	  1784	  1787	  1793	  1803	  1804	  1807
	  1808	  1811	  1814	  1818	  1827	  1841	  1846	  1859	  1868	  1883	  1936	  1975	  1976	  1992
	  1993	  1996	  1997	  2005	  2007	  2008	  2009	  2012	  2017	  2031	  2034	  2046	  2050	  2064
	  2067	  2101	  2114	  2141	  2145	  2152	  2153	  2155	  2162	  2166	  2169	  2181	  2183	  2184
	  2185	  2193	  2196	  2209	  2215	  2222	  2234	  2239	  2248	  2253	  2258	  2262	  2265	  2267
	  2301	  2302	  2304	  2314	  2315	  2319	  2320	  2321	  2350	  2351	  2353	  2363	  2364	  2368
	  2369	  2370	  2373	  2374	  2376	  2378	  2379	  2380	  2383	  2387	  2393	  2403	  2406	  2413
	  2420	  2421	  2422	  2423	  2428	  2429	  2457	  2471	  2482	  2487	  2494	  2499	  2522	  2523
	  2525	  2530	  2534	  2535	  2537	  2540	  2543	  2544	  2545	  2546	  2548	  2551	  2552	  2553
	  2556	  2557	  2566	  2571	  2576	  2581	  2584	  2585	  2586	  2589	  2591	  2598	  2600	  2601
	  2606	  2614	  2617	  2619	  2627	  2634	  2639	  2641	  2649	  2665	  2666	  2668	  2670	  2672
	  2680	  2681	  2682	  2683	  2693	  2702	  2713	  2716	  2719	  2727	  2730	  2733	  2734	  2740
	  2748	  2754	  2756	  2760	  2775	  2780	  2860	  2867	  2871	  2885	  2887	  2889	  2891	  2910
	  2923	  2925	  2931	  2932	  2953	  2955	  2958	  2967	  2985	  2989	  2994	  2996	  3000	  3001
	  3008	  3009	  3025	  3027	  3028	  3031	  3033	  3037	  3039	  3040	  3041	  3043	  3046	  3047
	  3049	  3050	  3052	  3054	  3056	  3057	  3059	  3076	  3080	  3089	  3091	  3105	  3119	  3124
	  3130	  3133	  3136	  3139	  3141	  3142	  3144	  3145	  3153	  3166	  3185	  3191	  3196	  3197
	  3199	  3204	  3205	  3212	  3213	  3217	  3224	  3229	  3242	  3253	  3267	  3270	  3277	  3290
	  3295	  3345	  3366	  3369	  3370	  3374	  3375	  3376	  3402	  3404	  3422	  3442	  3462	  3477
	  3482	  3497	  3506	  3511	  3516	  3517	  3520	  3522	  3523	  3528	  3532	  3546	  3549	  3550
	  3551	  3554	  3570	  3573	  3575	  3580	  3584	  3587	  3588	  3592	  3605	  3632	  3685	  3702
	  3729	  3732	  3755	  3814	  3848	  3867	  3911	  3917	  3919	  3922	  3924	  3926	  3936	  3955
	  3962	  3965	  3971	  4004	  4006	  4015	  4021	  4047	  4049	  4050	  4052	  4062	  4065	  4073
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	  4077	  4078	  4086	  4103	  4120	  4128	  4135	  4142	  4165	  4170	  4178	  4192	  4193
P1	   395	   401	   404	   405	   439	   481	   543	   571	   601	   606	   609	   612	  1689	  1693
	  1699	  1714	  1715	  1716	  1717	  1718	  1719	  1721	  1875	  1917	  2073	  2089	  2093	  2099
	  2170	  2206	  2207	  2226	  2228	  2229	  2230	  2231	  2233	  2236	  2428	  2431	  2519	  2523
	  2553	  2903	  2947	  2951	  3088	  3109	  3110	  3111	  3112	  3113	  3117	  3118	  3121	  3123
	  3615	  3723	  3724	  3725	  3726	  3743	  3744	  3745	  3759	  3761	  3845	  3870	  3873	  3874
	  4091	  4092	  4097
P2	   234	   236	   237	   238	   253	   259	   264	   276	   363	   364	   387	   389	   393	   398
	   400	   403	   417	   454	   482	   552	   563	   575	   600	   602	   604	   612	   853	   855
	   859	   873	   881	   884	   892	   909	   920	   924	   938	   940	   945	   957	   960	   991
	   998	  1016	  1018	  1022	  1034	  1035	  1042	  1046	  1049	  1055	  1068	  1074	  1080	  1086
	  1090	  1094	  1102	  1105	  1108	  1111	  1112	  1127	  1131	  1135	  1147	  1148	  1169	  1180
	  1183	  1184	  1186	  1194	  1214	  1220	  1226	  1230	  1264	  1299	  1303	  1309	  1325	  1343
	  1346	  1348	  1351	  1376	  1377	  1379	  1392	  1393	  1413	  1429	  1442	  1469	  1470	  1471
	  1474	  1476	  1648	  1672	  1680	  1682	  1687	  1691	  1695	  1756	  1769	  1820	  1822	  1837
	  1838	  1843	  1855	  1858	  1860	  1865	  1896	  1899	  1919	  1928	  1941	  1951	  1953	  1962
	  1974	  1988	  2020	  2022	  2030	  2041	  2053	  2054	  2056	  2066	  2068	  2088	  2091	  2095
	  2106	  2124	  2126	  2148	  2171	  2174	  2191	  2603	  2604	  2625	  2628	  2630	  2645	  2657
	  2663	  2664	  2678	  2700	  2707	  2742	  2745	  2746	  2752	  2753	  2758	  2761	  2762	  2770
	  2776	  2778	  2783	  2786	  2797	  2798	  2801	  2805	  2807	  2809	  2811	  2818	  2822	  2830
	  2833	  2834	  2836	  2838	  2848	  2853	  2874	  2875	  2876	  2878	  2898	  2899	  2909	  2911
	  2916	  2918	  2920	  2940	  2942	  2961	  2969	  2974	  2991	  3003	  3015	  3026	  3058	  3062
	  3065	  3071	  3073	  3075	  3103	  3107	  3194	  3292	  3294	  3297	  3344	  3361	  3368	  3508
	  3509	  3524	  3547	  3557	  3571	  3572	  3574	  3581	  3583	  3751	  3756	  3757	  3758	  3846
	  4038	  4039	  4053	  4054	  4060	  4061	  4090	  4093	  4104	  4106	  4117
P3	   237	   361	   362	   363	   369	   370	   372	   373	   395	   401	   408	   469	   471	   484
	   487	   506	   507	   508	   511	   513	   532	   533	   548	   552	   562	   567	   592	   881
	   957	   967	   969	   972	   980	   983	   984	   991	  1022	  1046	  1152	  1153	  1170	  1216
	  1218	  1223	  1263	  1264	  1313	  1428	  1429	  1434	  1450	  1779	  1780	  1785	  1789	  1792
	  1871	  1873	  1876	  1882	  1892	  1918	  2664	  2674	  2675	  2804	  2813	  2831	  2838	  2839
	  2842	  2857	  2859	  2878	  2879	  2881	  2905	  2906	  2907	  2908	  2917	  2934	  2939	  2991
	  3026	  3058	  3061	  3063	  3075	  3078	  3079	  3203	  3208	  3209	  3214	  3215	  3219	  3220
	  3221	  3226	  3227	  3233	  3235	  3238	  3239	  3240	  3248	  3251	  3255	  3257	  3258	  3259
	  3264	  3272	  3275	  3279	  3509	  3574	  3808	  3809	  3816	  3817	  3824	  3831	  3832	  3834
	  3839	  3840	  3847	  4170	  4171	  4172	  4173	  4174	  4176	  4184	  4186	  4189	  4190	  4192
P4	   236	   254	   260	   267	   357	   358	   361	   371	   376	   377	   379	   380	   392	   398
	   400	   409	   468	   472	   486	   505	   507	   514	   515	   516	   517	   518	   532	   537
	   539	   541	   542	   549	   568	   854	   856	   893	   894	   896	   999	  1017	  1019	  1058
	  1075	  1076	  1078	  1233	  1246	  1423	  1425	  1452	  1457	  1649	  1821	  1829	  2021	  2060
	  2637	  2708	  2709	  2738	  2744	  2747	  2752	  2759	  2771	  2772	  2774	  2793	  2832	  2833
	  2835	  2837	  2845	  2866	  2876	  2883	  2928	  2930	  3004	  3066	  3074	  3514	  3548	  3558
	  3571	  3576	  3582	  3785	  3808	  3816	  3842
PCBCLR	    73%	   352
PCDTIM	   131%	  1115	  1397	  1402	  1473	  2962
PDNMUP	    62%	   345	   346
PE.NER	  2463%	  2466%	  2488
PG	   443	  1725	  1727	  1845
PIDACC	    53%	  2202	  2203	  2225
PJOBN	    49%	   231	   445	   560	   586	   595	  1668	  1851	  1943	  1984	  2211	  2390	  2565	  2575
	  2976	  3092	  3349
PPNERR	  3773#	  3815
PPNUS1	  2281#	  2287
PPNUS2	  2282	  2284	  2287#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

PPNUS3	  2292#	  2298
PPNUS4	  2293	  2295	  2298#
PPNUS5	  2310#	  2318
PPNUS6	  2306	  2311	  2317#
PPNUSR	   835	  2276#
PRIVJ	  3721	  3813	  3841	  3861	  3981#
PRTERR	  3500	  3521	  3529	  3555	  3589
PRTT3	  2487%	  2487
PRTWDR	    44	   793#
PRTWDW	    44	   763	   781#
PTNPNO	   112%
PTRCHG	    86%
PTROU2	    73%
PTROUT	    72%	  1023
PTSPNO	   112%
PVEXOG	  1667
PWAIT1	    58%
PX.MEM	   393	   394	   396	   406	   456	   487	   529	   544	   550	   569	   574	  1679	  1683	  1688
	  1876	  1922	  1935	  1938	  2092	  2113	  2127	  2138	  2210	  2237	  2238	  2246	  2251	  2256
	  2375	  2538	  2905	  3490	  3543	  3545	  3760	  3762	  3828	  3833
QUEPCB	    57%	  1503
RADX10	   740%	   769	   774	   800
RBDLTA	   114%
RBINDX	   114%
RBMASK	   109%
RBREAL	   125%	   441
RBYPN1	   112%
RBYUN1	   112%
RECLSD	  2597	  2602#
RELLOK	    67%	   559	   588	   594	   943	  1028	  1125	  1175	  1192	  1250	  1258	  1449	  1455	  1980
	  2184	  2406	  2617	  2985	  3001	  3028	  3057	  3587	  3592
RELRIB	   383%	   436	  1726	  3520
RENAM	   161	  2584#
RENAM0	  2619	  2623#
RENAM1	  2604	  2627#
RENAM2	  2637#
RENAM3	  2635	  2700#
RENAM4	  2718	  2725#
RENAM6	  2723	  2887#
RENAM7	  2751	  2780#
RENAM8	  2872	  2894#
RENAM9	  2907	  2914	  2949#
RENCLR	  3570#	  3590	  3594
RENDCR	  3014	  3024	  3046#
RENDEA	  2904	  2946	  2950	  2969#
RENECM	  3004#	  3081
RENER0	  2594	  3491	  3494#
RENER7	  2728	  3554#
RENER9	  2735	  3547#
RENFL1	  3044	  3056#
RENFL2	  3055	  3058#
RENM2A	  2647	  2658#
RENM2B	  2650	  2657#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

RENM2C	  2661	  2680#
RENM2D	  2679	  2683#
RENM4A	  2730#
RENM4B	  2715	  2726#
RENM8A	  2902	  2906#
RENM9A	  2926	  2931#
RENM9B	  2922	  2932#
RENM9C	  2936	  2942#
RENM9D	  2957	  2961#
RENMB	   879	   901	   955	  1063	  1215
RENNMC	  2988	  3013#
RENNMR	  2740	  2754	  2760	  2878#	  3550
RENNXR	  2874#	  3025	  3040	  3046	  3050	  3588
RENR7A	  2990	  3001#
RENRCM	  3552	  3556#	  3567	  3585
RENRIB	  2952	  2954	  2967#
RENRR0	  2766	  3592#
RENRR1	  2757	  3587#
RENRR2	  2749	  3569#
RENRR3	  2890	  3555#
RENRR4	  2892	  3566#
RENRR7	  2995	  3002#
RENSTS	  2979	  2984#
RENZAP	  3029	  3032	  3050#
RESETB	  1033	  1037	  1038	  1066	  1483	  1486
RETARG	  3688	  3706	  3708	  3882#
RIBALC	   108%	  1764	  1765	  3161
RIBALP	   112%	  1106	  1107
RIBALT	   110%	  1117	  1118	  2964
RIBAUT	   108%	  1751	  1945	  1946	  3143
RIBCOD	   109%	  1948
RIBDEV	   107%	  1743	  3135
RIBDIR	    71%	  1249	  1426	  2989	  3027
RIBELB	   107%	  1745
RIBEST	   106%	  1737	  3129	  3159	  3160
RIBEXT	   106%	   939	  1091	  1093	  2844	  2941
RIBFT1	   107%	  1740	  3132
RIBFUT	   106%	  1736	  3128
RIBLCW	   107%	   941	   942	  1103	  1104	  1741	  1954	  2178	  2975
RIBLST	   114%
RIBMTA	   107%	  1742	  3134
RIBMXA	   109%	  1257	  1786	  3244	  3245	  3261	  3265	  3269	  3274
RIBNAM	   106%	  1963	  2841
RIBPFS	   111%	  1970
RIBPID	   109%	  1761	  1867	  2172	  2900	  3293
RIBPJ1	   113%	  1759	  3151
RIBPJ2	   113%	  1760	  1864	  3152
RIBPJC	   113%	  1758	  1862	  3150
RIBPOS	   106%	  1739	  3131
RIBPPN	   106%	  1965	  2847
RIBPVW	   106%	  1109	  1110	  1952	  2943
RIBQTF	   107%	  1252	  1255	  1747	  1781	  1790	  3207	  3216	  3236	  3249	  3260	  3262	  3273
RIBQTO	   108%	  1748	  3140
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

RIBRDL	    66%	  1710
RIBRIB	   112%	  1026
RIBSIZ	   112%	  1083	  1084
RIBSLF	   109%	  1942
RIBSNM	   108%	  1757
RIBSTS	   107%	  1095	  1744	  1854	  1955	  1960	  2970	  2984	  3182	  3184	  3189
RIBSZS	   109%	  1950
RIBTRU	   108%	  1754	  3146
RIBUN1	   108%	  1753	  3222	  3228
RIBUNM	   108%	  1752	  3223
RIBUSD	   109%	  1254	  1791	  3241	  3250	  3263
RIBVER	   106%	  1735	  3127
RIBWTL	    66%	   867	   936	  1029	  2166	  2748	  2891	  2958
RIBXT1	   107%	  1746
RIBXT2	   108%	  1755	  3147
RIPBDA	   114%	  1096	  2971	  3187
RIPBDR	   112%	   114%	  1096	  2971
RIPBFS	   114%	  1096	  2971	  3187
RIPDIR	   111%	  1958	  1959	  3181	  3183
RIPHRE	   111%	  1096	  2971	  3187
RIPHWE	   111%	  1096	  2971	  3187
RIPLOG	   111%	  1956
RIPNFS	   111%
RIPPID	   111%
RIPSPP	   114%	  1850	  2982	  2983
RIPUFE	   111%
RMVATB	    70%	   365	  1185
RND	  2420	  2421	  2422	  2423	  2437#
RND1	  2444#	  2456
RND2	  2447	  2456#
RNM7A	  2814#	  2819
RNM7B	  2824#	  2829
RRSET	  3801	  3931#
RRSETB	    72%	  3942
S	   429	   433	   437	   582	   583	  1003	  1173	  1248	  1431	  1432	  1490	  1517	  1645	  1703
	  1707	  1730	  1805	  1906	  1979	  2188	  2200	  2201	  2384	  2405	  2430	  2547	  2587	  2590
	  2602	  2616	  2684	  2986	  2993	  4003	  4017	  4020	  4028	  4031	  4033	  4082	  4085
S$DEBU	  2487	  2488
S$DISK	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150	  1156	  1224	  1235	  1326
	  1445	  1446	  1504	  1505	  2058	  2062	  2490	  2510	  2516	  2528	  2711	  2731	  2790	  2795
	  2816	  2826	  2959	  3006	  3068	  3516	  3517	  3560	  3578	  4181
S$ENTR	    16	    22	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150
	  1156	  1224	  1235	  1326	  1446	  1460	  1505	  1507	  1510	  2058	  2062	  2488	  2490	  2510
	  2516	  2528	  2711	  2731	  2790	  2795	  2816	  2826	  2959	  2998	  3006	  3035	  3068	  3517
	  3560	  3578	  4027	  4181
S$EVEN	  1445	  1459	  1504	  2487	  3516
S$HALT	    16	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150	  1156
	  1224	  1235	  1326	  1445	  1459	  1504	  1507	  1510	  2058	  2062	  2487	  2490	  2510	  2516
	  2528	  2711	  2731	  2790	  2795	  2816	  2826	  2959	  2998	  3006	  3035	  3068	  3516	  3560
	  3578	  4027	  4181
S$INFO	  1445	  1459	  1460	  1504	  2487	  3516
S$NAME	    20#	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150	  1156
	  1224	  1235	  1326	  2058	  2062	  2490	  2510	  2516	  2528	  2711	  2731	  2790	  2795	  2816
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	  2826	  2959	  3006	  3068	  3560	  3578	  4027	  4181
S$NONA	    19	    22	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150
	  1156	  1224	  1235	  1326	  1446	  1460	  1505	  1508	  1511	  2058	  2062	  2488	  2490	  2510
	  2516	  2528	  2711	  2731	  2790	  2795	  2816	  2826	  2959	  2999	  3006	  3036	  3068	  3517
	  3560	  3578	  4027	  4181
S$PATC	  1445	  1459	  1504	  2487	  3516
S$TEMP	    16#	    16	   153#	   153	   154#	   154	   249#	   249	   262#	   262	   269#	   269	   697#	   697
	   857#	   857	   977#	   977	  1001#	  1001	  1020#	  1020	  1060#	  1060	  1150#	  1150	  1156#	  1156
	  1224#	  1224	  1235#	  1235	  1326#	  1326	  1445#	  1445	  1459#	  1459	  1504#	  1504	  1507#	  1507
	  1510#	  1510	  2058#	  2058	  2062#	  2062	  2487#	  2487	  2490#	  2490	  2510#	  2510	  2516#	  2516
	  2528#	  2528	  2711#	  2711	  2731#	  2731	  2790#	  2790	  2795#	  2795	  2816#	  2816	  2826#	  2826
	  2959#	  2959	  2998#	  2998	  3006#	  3006	  3035#	  3035	  3068#	  3068	  3516#	  3516	  3560#	  3560
	  3578#	  3578	  4027#	  4027	  4181#	  4181
S$XCT	    22	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150	  1156
	  1224	  1235	  1326	  1446	  1460	  1505	  1507	  1508	  1510	  1511	  2058	  2062	  2488	  2490
	  2510	  2516	  2528	  2711	  2731	  2790	  2795	  2816	  2826	  2959	  2998	  2999	  3006	  3035
	  3036	  3068	  3517	  3560	  3578	  4027	  4181
SAVE4	    58%	   225	  3784
SAVLIC	  1859	  1984#	  2067	  2775
SAVT	   186	   187#	   204	   655
SETACH	  1363#	  2666
SETALT	  1468#
SETAPN	  2190#
SETDD1	   662	   667#
SETDD2	   664	   681#
SETDD3	   652	   670#
SETDD4	   678#	   685
SETDDB	   182	   655#	  2387
SETDDO	   650	   651#
SETEN1	  1879	  1881	  1895#
SETEN2	  1897	  1901#
SETEN3	  1900	  1904#
SETEN4	  1921	  1926#
SETEN5	  1941#
SETENA	  1967	  1975#
SETFIL	  1525	  1814	  2262#	  2730
SETN3A	  1911	  1916#
SETN5A	  1934	  1938#
SETPID	   622#
SETPIO	   622	   625	   629	   631	   638#
SETVAL	  1936	  2181	  2967	  3088#
SETVL0	  3101	  3105#
SETVL1	  3114#	  3118	  3123
SETVTU	  3115	  3121#
SIMENT	  1808%	  1808
SIMRLS	   129%	   849	  1013	  1481	  2670	  2681
SLSTR0	  3825#
SLSTRR	  3809	  3824#
SNFERR	  3774#	  3775	  3829	  3835
SRCFIL	    66%	  1643	  1818	  2403	  2614	  2734
SRCNAM	    67%	   316	  1775	  2534
SRCSTR	  3792	  3808#
SRPNDS	   118%	   341
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

SRUNI	   210	  3867	  3936	  4021	  4152#
SRUSR	  2498#	  2507
STNPRT	    76%	  1903
STOCBR	  1003#	  1064	  1241
STOIOS	    58%	   430	   434	   846	  1491
STRBTS	   118%	   342
STRDDB	    78%	   342	   411	  1831	  1968	  1972	  2765	  3022	  3623	  3634	  4038	  4053
STRERR	  2615	  3487	  3495	  3498	  3522	  3537	  3542#	  3564
STRERZ	  1644	  1819	  3530	  3534	  3540#
STRFNC	  3791	  3792#	  3802
STRFNN	  3789	  3802#
STRHSH	   116%	   411	  1968	  1972	  3022
STRLEN	    78%	  3635
STRNAM	    78%	  3624	  3636	  4106
STRNXT	    78%	  3626	  3630	  4060
STROVR	    78%	  2765
STRSID	    78%	  4117
STRTAL	    78%	  1831	  4104
STRUNI	    78%	  4039	  4054
STRUUO	  3783	  3784#
SWPCL1	   226#	   233	   235	   244	   273
SWPCLN	   224#	   279
SWPENT	   248	   253#
SWPLK1	   256	   267#
SWPLK2	   265#	   277
SWPLUK	   245	   264#
SWPUP2	   247	   275#
SWPUPD	   246	   258#
SYDCOM	  3617	  3639%
SYDNM4	    58%	  3608	  3628
SYDST1	  3624#	  3631
SYDST2	  3625	  3630#
SYDST3	  3622	  3634#
SYDST4	  3627	  3635#
SYDSTR	  3620#
SYDUN1	  3600	  3609#
SYDUN2	  3602	  3607#
SYDUN3	  3601#	  3604
SYDUN4	  3611#	  3637
SYDUNI	  3597#
SYSCOR	    77%	   368	   370	   375	   377	   982	   983
SYSDEV	  2216
SYSDRB	    76%	   314	   357	   378	  1773	  2305	  2354	  2531	  2532
SYSPH2	  3698#	  3701
SYSPH3	  3699	  3704#
SYSPH4	  3696	  3707#
SYSPHY	  3695#
SYSPPN	    76%	   310	  2220	  2276%	  2276	  2329%	  2329	  2400	  3954
SYSTU1	  3683	  3687#
SYSTUU	  3683#
SYSUNI	    77%	  3599	  3695	  4152
T1	   148	   203	   208	   228	   229	   231	   232	   239	   242	   253	   254	   258	   259	   260
	   261	   264	   265	   267	   268	   275	   276	   291	   294	   295	   300	   301	   303	   310
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	   311	   318	   319	   332	   333	   334	   336	   337	   339	   341	   342	   345	   347	   359	   360
	   368	   369	   371	   372	   375	   376	   378	   379	   388	   389	   406	   409	   410	   412
	   413	   417	   418	   419	   424	   425	   426	   427	   440	   441	   449	   450	   459	   460
	   475	   477	   478	   480	   481	   482	   492	   493	   494	   495	   496	   500	   501	   513
	   523	   525	   529	   538	   539	   540	   541	   552	   553	   554	   555	   560	   561	   563
	   564	   565	   572	   574	   575	   576	   577	   578	   586	   587	   590	   593	   595	   596
	   597	   607	   608	   609	   610	   611	   622	   627	   630	   632	   634	   635	   638	   639
	   643	   644	   658	   659	   660	   661	   670	   671	   672	   675	   676	   681	   682	   683
	   693	   694	   695	   696	   699	   705	   718	   719	   727	   768	   773	   794	   797	   798
	   799	   809	   813	   821	   824	   834	   850	   851	   859	   860	   863	   864	   883	   884
	   885	   892	   893	   895	   896	   904	   906	   908	   909	   920	   921	   924	   925	   926
	   959	   960	   961	   967	   968	   980	   981	   994	   995	   996	   997	   998	   999	  1000
	  1014	  1015	  1048	  1049	  1050	  1053	  1055	  1068	  1069	  1071	  1074	  1075	  1077	  1078
	  1080	  1081	  1082	  1083	  1084	  1085	  1089	  1090	  1092	  1093	  1094	  1097	  1098	  1100
	  1102	  1103	  1104	  1105	  1106	  1107	  1108	  1109	  1110	  1112	  1113	  1131	  1132	  1154
	  1155	  1158	  1162	  1163	  1169	  1170	  1172	  1193	  1194	  1197	  1201	  1202	  1210	  1211
	  1212	  1214	  1216	  1217	  1218	  1220	  1221	  1228	  1229	  1230	  1231	  1233	  1234	  1251
	  1253	  1256	  1266	  1267	  1268	  1269	  1271	  1272	  1281	  1282	  1283	  1284	  1286	  1287
	  1288	  1289	  1291	  1293	  1294	  1295	  1297	  1298	  1299	  1301	  1302	  1303	  1304	  1305
	  1307	  1308	  1309	  1310	  1311	  1328	  1329	  1330	  1331	  1332	  1333	  1334	  1335	  1336
	  1337	  1338	  1340	  1341	  1342	  1343	  1345	  1346	  1347	  1348	  1350	  1351	  1366	  1367
	  1370	  1371	  1373	  1393	  1394	  1396	  1397	  1400	  1402	  1412	  1413	  1430	  1434	  1442
	  1443	  1468	  1471	  1472	  1475	  1500	  1501	  1502	  1503	  1527	  1528	  1529	  1531	  1533
	  1534	  1536	  1537	  1540	  1541	  1544	  1545	  1650	  1653	  1655	  1659	  1660	  1663	  1667
	  1669	  1672	  1673	  1674	  1676	  1677	  1678	  1679	  1680	  1681	  1682	  1683	  1687	  1688
	  1691	  1692	  1695	  1696	  1697	  1698	  1720	  1728	  1729	  1735	  1736	  1737	  1739	  1740
	  1741	  1742	  1743	  1744	  1745	  1746	  1747	  1748	  1751	  1752	  1753	  1754	  1755	  1756
	  1757	  1758	  1759	  1760	  1761	  1763	  1764	  1765	  1768	  1769	  1772	  1780	  1781	  1786
	  1790	  1791	  1792	  1816	  1817	  1823	  1825	  1833	  1835	  1840	  1844	  1848	  1849	  1850
	  1854	  1856	  1858	  1860	  1862	  1864	  1869	  1870	  1880	  1881	  1885	  1886	  1893	  1907
	  1909	  1910	  1912	  1913	  1914	  1915	  1949	  1950	  1961	  1963	  1964	  1965	  1968	  1970
	  1971	  1972	  1973	  1974	  1977	  1978	  1988	  2010	  2013	  2015	  2018	  2022	  2023	  2026
	  2027	  2029	  2033	  2037	  2038	  2039	  2040	  2065	  2066	  2068	  2069	  2070	  2075	  2078
	  2081	  2082	  2083	  2084	  2085	  2088	  2090	  2091	  2092	  2095	  2096	  2097	  2098	  2106
	  2107	  2108	  2109	  2110	  2112	  2113	  2118	  2119	  2120	  2124	  2125	  2126	  2127	  2154
	  2158	  2159	  2168	  2173	  2174	  2178	  2186	  2187	  2190	  2192	  2210	  2211	  2212	  2214
	  2219	  2220	  2221	  2225	  2227	  2235	  2236	  2238	  2246	  2247	  2251	  2252	  2256	  2257
	  2263	  2264	  2266	  2268	  2276	  2281	  2292	  2310	  2329	  2331	  2332	  2333	  2335	  2337
	  2341	  2342	  2343	  2345	  2347	  2354	  2359	  2360	  2362	  2366	  2367	  2373	  2375	  2386
	  2389	  2390	  2391	  2392	  2400	  2401	  2407	  2408	  2409	  2410	  2411	  2412	  2414	  2415
	  2416	  2417	  2424	  2425	  2427	  2432	  2433	  2437	  2439	  2440	  2441	  2444	  2445	  2449
	  2450	  2453	  2454	  2455	  2472	  2477	  2482	  2488	  2489	  2494	  2495	  2496	  2497	  2498
	  2501	  2503	  2506	  2507	  2508	  2509	  2514	  2515	  2524	  2526	  2527	  2533	  2552	  2569
	  2570	  2579	  2580	  2607	  2612	  2613	  2628	  2629	  2630	  2631	  2635	  2638	  2643	  2644
	  2645	  2646	  2648	  2651	  2652	  2655	  2656	  2657	  2660	  2662	  2663	  2673	  2674	  2676
	  2678	  2688	  2704	  2705	  2706	  2707	  2714	  2717	  2720	  2722	  2725	  2726	  2737	  2738
	  2741	  2743	  2745	  2746	  2747	  2755	  2761	  2763	  2767	  2768	  2769	  2770	  2771	  2773
	  2774	  2776	  2777	  2778	  2781	  2784	  2787	  2792	  2793	  2794	  2798	  2800	  2802	  2803
	  2804	  2805	  2806	  2807	  2808	  2809	  2810	  2811	  2812	  2813	  2814	  2820	  2821	  2822
	  2823	  2824	  2830	  2839	  2840	  2841	  2842	  2843	  2844	  2845	  2846	  2847	  2850	  2856
	  2860	  2861	  2862	  2864	  2865	  2868	  2879	  2880	  2881	  2882	  2883	  2884	  2888	  2896
	  2898	  2912	  2913	  2919	  2920	  2924	  2927	  2929	  2933	  2937	  2938	  2940	  2941	  2942
	  2943	  2945	  2948	  2961	  2963	  2969	  2972	  2973	  2974	  2975	  2976	  2977	  2978	  2980
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	  2981	  2992	  3002	  3003	  3004	  3005	  3015	  3016	  3017	  3018	  3021	  3023	  3030	  3038	  3039
	  3060	  3061	  3062	  3063	  3066	  3067	  3070	  3071	  3072	  3073	  3074	  3077	  3078	  3116
	  3122	  3127	  3128	  3129	  3131	  3132	  3134	  3135	  3140	  3143	  3146	  3147	  3150	  3151
	  3152	  3159	  3160	  3161	  3163	  3164	  3165	  3167	  3168	  3170	  3183	  3184	  3187	  3189
	  3190	  3197	  3198	  3204	  3206	  3213	  3216	  3220	  3223	  3227	  3228	  3234	  3237	  3241
	  3244	  3245	  3249	  3250	  3251	  3252	  3256	  3262	  3263	  3264	  3265	  3266	  3269	  3273
	  3274	  3275	  3276	  3280	  3281	  3289	  3293	  3294	  3346	  3348	  3355	  3359	  3363	  3367
	  3368	  3379	  3382	  3383	  3386	  3388	  3390	  3396	  3398	  3401	  3403	  3467	  3469	  3471
	  3472	  3478	  3479	  3480	  3481	  3486	  3494	  3496	  3500	  3503	  3507	  3508	  3510	  3514
	  3515	  3521	  3524	  3529	  3533	  3536	  3539	  3543	  3545	  3549	  3551	  3555	  3566	  3569
	  3570	  3576	  3577	  3584	  3589	  3593	  3598	  3600	  3601	  3609	  3621	  3622	  3624	  3635
	  3683	  3684	  3686	  3687	  3696	  3698	  3704	  3707	  3722	  3723	  3742	  3743	  3748	  3749
	  3750	  3754	  3785	  3786	  3787	  3788	  3789	  3791	  3825	  3826	  3827	  3842	  3843	  3862
	  3872	  3873	  3882	  3893	  3894	  3895	  3896	  3897	  3898	  3899	  3900	  3901	  3902	  3903
	  3904	  3905	  3906	  3907	  3908	  3910	  3931	  3932	  3934	  3951	  3952	  3953	  3954	  3958
	  3959	  3960	  3961	  3963	  3966	  3967	  3968	  3969	  3970	  3995	  4000	  4001	  4002	  4011
	  4018	  4045	  4046	  4048	  4051	  4055	  4056	  4076	  4081	  4083	  4084	  4085	  4087	  4089
	  4096	  4100	  4134	  4156	  4161	  4171	  4175	  4176	  4177	  4190	  4191
T2	   189	   193	   240	   241	   292	   293	   297	   298	   300	   314	   317	   319	   411	   412
	   413	   423	   446	   447	   453	   457	   459	   462	   463	   466	   467	   475	   480	   484
	   492	   500	   512	   523	   524	   525	   528	   543	   546	   547	   573	   604	   605	   608
	   623	   624	   626	   627	   628	   667	   694	   695	   704	   706	   746	   748	   750	   752
	   795	   798	   810	   811	   812	   813	   815	   820	   822	   836	   837	   938	   939	   940
	   941	   942	   945	   946	   948	   950	   969	   970	   971	   972	   974	   975	   976	   982
	   984	  1035	  1036	  1058	  1059	  1091	  1092	  1095	  1096	  1115	  1117	  1118	  1119	  1127
	  1128	  1134	  1135	  1142	  1147	  1148	  1149	  1153	  1154	  1160	  1163	  1167	  1168	  1184
	  1188	  1200	  1202	  1226	  1227	  1245	  1246	  1252	  1253	  1254	  1255	  1256	  1257	  1267
	  1268	  1270	  1272	  1282	  1283	  1300	  1302	  1306	  1308	  1310	  1311	  1332	  1339	  1342
	  1345	  1364	  1365	  1366	  1371	  1373	  1377	  1473	  1475	  1668	  1669	  1773	  1777	  1779
	  1822	  1824	  1826	  1843	  1844	  1851	  1852	  1853	  1876	  1877	  1878	  1882	  1884	  1887
	  1888	  1889	  1890	  1891	  1892	  1893	  1904	  1905	  1906	  1907	  1913	  1918	  1919	  1928
	  1929	  1931	  1932	  1941	  1942	  1962	  1969	  1970	  1985	  2014	  2015	  2028	  2030	  2048
	  2052	  2053	  2060	  2061	  2076	  2077	  2086	  2087	  2115	  2116	  2117	  2121	  2138	  2142
	  2144	  2146	  2151	  2157	  2160	  2191	  2192	  2202	  2203	  2204	  2277	  2283	  2284	  2294
	  2295	  2312	  2328	  2332	  2342	  2359	  2375	  2379	  2395	  2396	  2397	  2398	  2426	  2427
	  2429	  2438	  2442	  2446	  2471	  2473	  2474	  2498	  2499	  2501	  2503	  2504	  2505	  2506
	  2518	  2520	  2522	  2531	  2535	  2539	  2651	  2654	  2656	  2709	  2710	  2721	  2722	  2762
	  2763	  2765	  2767	  2768	  2769	  2782	  2783	  2786	  2788	  2799	  2801	  2814	  2815	  2818
	  2824	  2825	  2828	  2852	  2853	  2855	  2856	  2857	  2858	  2863	  2908	  2909	  2914	  2921
	  2928	  2930	  2962	  2963	  2964	  2970	  2971	  2982	  2983	  2984	  3019	  3020	  3021	  3022
	  3023	  3024	  3037	  3041	  3042	  3043	  3053	  3064	  3065	  3093	  3094	  3096	  3097	  3099
	  3100	  3102	  3103	  3106	  3107	  3156	  3157	  3162	  3163	  3164	  3167	  3169	  3181	  3182
	  3193	  3194	  3201	  3203	  3206	  3207	  3208	  3209	  3236	  3237	  3238	  3239	  3240	  3258
	  3259	  3260	  3261	  3281	  3283	  3284	  3286	  3287	  3291	  3292	  3296	  3297	  3344	  3347
	  3352	  3353	  3354	  3356	  3357	  3358	  3373	  3380	  3384	  3387	  3389	  3395	  3397	  3400
	  3401	  3403	  3408	  3409	  3412	  3413	  3416	  3418	  3419	  3421	  3428	  3429	  3431	  3432
	  3433	  3435	  3436	  3437	  3438	  3439	  3440	  3441	  3450	  3451	  3453	  3454	  3455	  3457
	  3458	  3459	  3460	  3461	  3473	  3474	  3475	  3476	  3490	  3492	  3540	  3541	  3556	  3557
	  3558	  3559	  3562	  3563	  3610	  3611	  3612	  3613	  3636	  3866	  3935	  4008	  4009	  4024
	  4025	  4075	  4095	  4098	  4104	  4105	  4106	  4107	  4108	  4109	  4110	  4111	  4112	  4113
	  4114	  4115	  4116	  4117	  4118	  4119	  4126	  4127	  4134	  4137	  4141	  4154	  4155	  4159
	  4160	  4179	  4180	  4183	  4187	  4188	  4189
T3	   188	   194	   213	   214	   215	   216	   315	   455	   457	   488	   489	   497	   502	   509
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	   514	   519	   527	   534	   656	   657	   663	   703	   704	   836	   838	   970	   974	   981	  1086
	  1087	  1099	  1111	  1119	  1273	  1275	  1276	  1277	  1279	  1280	  1290	  1291	  1365	  1367
	  1369	  1392	  1394	  1396	  1472	  1474	  1774	  1839	  1884	  1888	  1895	  1896	  1898	  1899
	  1902	  1903	  1905	  1908	  1909	  1943	  1944	  1946	  1947	  1948	  1986	  1987	  2041	  2042
	  2054	  2055	  2056	  2057	  2137	  2139	  2143	  2148	  2149	  2150	  2151	  2211	  2212	  2278
	  2280	  2281	  2283	  2285	  2287	  2291	  2292	  2294	  2296	  2298	  2305	  2310	  2312	  2313
	  2317	  2318	  2329	  2333	  2343	  2360	  2413	  2414	  2416	  2418	  2444	  2446	  2447	  2448
	  2452	  2475	  2476	  2477	  2483	  2484	  2485	  2532	  2538	  2539	  2700	  2701	  2787	  2788
	  2789	  2848	  2849	  2850	  2851	  2852	  2855	  2858	  2859	  2862	  2863	  2865	  2866	  2867
	  2868	  2869	  2870	  2911	  2912	  2915	  2916	  2917	  2918	  3350	  3351	  3354	  3355	  3361
	  3362	  3363	  3364	  3365	  3374	  3376	  3377	  3393	  3408	  3410	  3411	  3413	  3414	  3415
	  3417	  3418	  3419	  3420	  3421	  3428	  3430	  3432	  3434	  3436	  3440	  3450	  3452	  3454
	  3456	  3458	  3460	  3981	  3982	  3995	  3996	  4029	  4032	  4074	  4075	  4076	  4136	  4137
	  4139	  4140	  4141	  4153	  4155	  4156	  4158	  4160	  4161	  4188
T4	   187	   190	   195	   225	   456	   460	   470	   471	   485	   487	   491	   496	   499	   501
	   504	   520	   526	   529	   533	   536	   542	   545	   571	   572	   923	   928	   932	   934
	  1265	  1270	  1271	  1274	  1275	  1278	  1279	  1285	  1286	  1292	  1293	  1296	  1297	  1300
	  1301	  1306	  1307	  1312	  1380	  1382	  1424	  1451	  1456	  1922	  1923	  1924	  1925	  1926
	  1927	  1930	  1932	  1935	  1938	  1951	  1952	  1953	  1954	  1955	  1956	  1958	  1959	  1960
	  1984	  1985	  1986	  2443	  2456	  2797	  2799	  2800	  2802	  2806	  2808	  2810	  2812	  2820
	  2821	  2828	  2831	  2832	  2834	  2835	  3090	  3095	  3098	  3104	  3108	  3114	  3115	  3179
	  3345	  3349	  3351	  3356	  3364	  3369	  3409	  3410	  3411	  3412	  3414	  3415	  3416	  3417
	  3429	  3430	  3431	  3433	  3434	  3435	  3451	  3452	  3455	  3456	  3721	  3784	  3813	  3841
	  3861	  3924	  3983	  3998
THSDAT	    56%	   928	   932	  1085	  1910	  1912	  1925	  1926	  2069
TIME	    56%
TPOPJ	    49%	   669	  1477	  1512	  2549	  2558	  4010	  4022
TPOPJ1	    49%
TRNERR	  3566	  3569
TST1U0	  4054#	  4061
TST1U2	  4055#	  4059
TST1U5	  4057	  4064#
TST1UN	  4045#
TSTDSK	   182	   203#
TSTRES	   862	  1011	  1496#	  1516	  1804	  1993	  2586
TSTWRS	    69%	  2046
TSTWRT	    69%	  1390	  2050	  2641	  2702
TUTAB	  1719	  1735#	  3121
U	   213	  3599	  3601	  3603	  3604	  3607	  3608	  3610	  3623	  3624	  3626	  3627	  3630	  3631
	  3634	  3636	  3695	  3698	  3700	  3701	  3705	  3706	  3707	  3875	  3939	  4039	  4054	  4055
	  4056	  4058	  4059	  4064	  4081	  4083	  4090	  4105	  4107	  4108	  4112	  4114	  4115	  4116
	  4125	  4152	  4153	  4158	  4163	  4164	  4191
UCLSTR	  3799	  3840#
UENTR	   159	  1803#
UFDALP	   124%	   492	  1306	  1308	  1345
UFDATB	  1325#
UFDCDT	   124%	  1282	  1283	  1332
UFDEOF	   562	   582#
UFDER1	  1445#	  2998	  3035
UFDERR	   124%
UFDEXT	   124%	   459	   480	  1270	  1272
UFDLCN	   476	   479	   483	   546#
UFDLIC	   124%	   500	  1300	  1302	  1342
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

UFDLLP	   475#	   547
UFDLNK	   126%	   554	   590
UFDMS0	   608#	   611
UFDMSK	   399	   402	   600#
UFDNAM	   124%	   457	   475	   484	   572	  1267	  1268
UFDNMK	   397	   403#
UFDNSL	   458	   462#
UFDNXM	   408	   414	   417#	   565	   598
UFDPRT	    76%	  1902
UFDRIB	   124%	  1310	  1311
UFDRLK	   446	   464	   473	   570	   580	   586#
UFDSF0	   461	   466#
UFDSFD	   454	   468#
UFDSIZ	   125%	   453	   462	   466	   546
UFDSLP	   457#	   463
UFDSP1	   559#	   591	   592
UFDSPR	   442	   562#
UFDUUO	   165	   385#
UFNBLK	   490	   497#
UFNDAT	   503	   530	   534#
UFNLIC	   498	   502#
UFNNCV	   510	   532#
UFNSTS	   535	   543#
UFPERR	   124%
UFYCDT	   126%	   505
UFYCTM	   125%	   508	  1292	  1294	  1336
UFYPRV	   125%	   537	  1274	  1276	  1328
UFYUF1	   125%	   540	  1296	  1298	  1340
UFYUF2	   125%	   538	  1278	  1280	  1330
UFYXCD	   125%	   506	  1285	  1287	  1334
UILNMD	  2011	  2016	  2019	  3496#
ULKDBL	    69%	   272	   882	   958	   992	  1047	  1239	  3517
ULKSTR	  3798	  3839#
ULOOK	   160	  1516#
ULOOK2	  1532	  1535	  1538	  1542#
ULOOK3	  1543	  1546	  1643#
UNCERR	  3780#	  3864	  3941
UNFERR	  3777#	  3868	  3937	  3938
UNICHR	    80%	  4107
UNIDES	    80%	  4083
UNIFEP	    81%	  4112	  4125%	  4125
UNIHID	    81%	  4116
UNIKON	    80%	  3939
UNILOG	    80%	  4056	  4081	  4114	  4153	  4191
UNIMS1	  4137#	  4140
UNIMS2	  4138	  4141#
UNINAM	    80%	  3601	  3610	  3698	  3707	  4055	  4115	  4158
UNIPPU	    81%	  4108
UNISTR	    81%	   213	  4058	  4090
UNISYS	    80%	  3603	  3607	  3700	  3705	  4163
UNITAL	    80%	  1835	  4105
UNLFIL	   383%	   428	   435	  2525	  2551
UNPARG	  3090	  3338#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

UNYSIZ	    82%	  3609
UNYSPU	    82%	  4111
UNYWPS	    82%	  4110
UPDAT1	  2000	  2007#
UPDATE	  1810	  2005#
UPDEN2	  2164	  2171#
UPDEN3	  2072	  2106#
UPDEN4	  2111	  2113#
UPDEN5	  2184#
UPDEND	  2100	  2102	  2128	  2156	  2166#
UPDER2	  2032	  2632	  2640	  3500#
UPDER3	  2043	  2047	  2051	  2642	  2653	  2703	  3503#
UPDERC	  3497#	  3501	  3504
UPDND3	  2163	  2167	  2195#
UPDND4	  2185#	  2197
UPDNU1	  1435	  1456#
UPDNUR	  1427	  1455#
UPDTD2	  2094	  2099#
UPDTDN	  2088#	  2123
UPDUF0	   910	  1378	  1414	  1422#
UPDUF1	  1437	  1448#
UPDUF2	  1444	  1449#
UPDUFD	  1130	  1423#
UPNSDT	  2074	  2080	  2114#
UPTJDA	    56%	  1004	  2393	  2394	  2470	  2481	  2493	  2545	  2659
UPTPDL	    61%	   355
UPTPID	    55%	   632	   634	   638	  3289
UPTPJC	    54%	  1862
UPTPOS	   130%
UPTRB2	    57%	  1506
UPTRIB	    57%	  1505
UPTSAT	    57%	  1509
UPTSPD	    55%	   630	   643
USETI0	    68%	   129%	   162
USETO0	    68%	   129%	   163
USETST	   383%	   431
USIMUP	   171	  1992#
USRPP1	  2332#	  2337
USRPP2	  2334	  2337#
USRPP3	  2342#	  2347
USRPP4	  2344	  2347#
USRPP5	  2359#	  2367
USRPP6	  2355	  2361	  2366#
USRPPN	  2328#	  2376
USRUS1	  2487#
USRUS2	  2479	  2488#
USRUSI	  2435	  2469#	  2520
UUNATT	  1681	  1871	  2125	  2906	  2945
UUNEXT	  1683	  1938	  2127	  2251	  3543
UUNNAM	  2246
UUNPPN	  1679	  2113	  2210	  2221	  2240	  2256
UUOENT	    29#	    42	  1813	  2161	  2182	  2195	  2736	  2987
UUOIRE	    33#	    42	  2608
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

UUOLUK	    26#	    42	  1524	  2399	  2605
UUOMLK	    28#	    42
UUOMSK	    35#	  2205	  2618
UUOREN	    31#	    42	  2633	  2739	  2750	  3013	  3048	  3051
UUOSEK	    73%	   166
UUOSIM	    32#	  1999	  2044
UUOUFD	    30#	    42	  1857	  1863	  1901	  1957	  1966
UUOXWR	  1504#	  1507	  1510
UUPPID	    40#	    45	  2226
UUPWDS	    38#	  2139	  2143	  2159	  3157
UUXALC	  2099	  2138	  2157	  2951	  3165
UUXENT	  2229	  2230
UUXEXT	  1688	  1922	  1935	  2076	  2092	  2252	  3545
UUXLCW	  3367
UUXMXA	  3266	  3276
UUXNAM	  1541	  2247
UUXNUM	  2137	  2158	  3156
UUXPPN	  2240	  2257
UUXPRV	  1689	  1692	  1873	  1875	  1917	  2073	  2075	  2089	  2090	  2903	  2905	  2947	  2948
UUXSIZ	  1693	  1698	  1699	  2093	  2098
UUXSTS	  3190
UUXUSD	  3252
UUXVER	  1714	  1717	  1719	  3088	  3109	  3112	  3117	  3121
W	  1004	  2393	  2394	  2470	  2475	  2481	  2493	  2545	  2659	  3882	  3910	  4087
W2BLSH	  1674	  2112	  3168
WAIT1	    56%	   290	  1479	  2007	  2585
WATPCB	    49%	  1136	  1242	  1381	  3009
WPJARG	  3104	  3342#
WRTARG	  3095	  3339#
WRTOK	  2036	  2039#
WRTOK1	  2045	  2050#
WRTOK2	  2049	  2053#
X	  2408	  2410	  2412	  2424	  2425	  2426	  2439	  2444	  2446	  2449	  2451	  2453	  2454	  2455
	  2560#
ZERDDB	    66%	  1975
ZERO5	  3792	  3793	  3794	  3795	  3796	  3797	  3798	  3799	  3800
ZZ	   393#	   393	   394#	   394	   396#	   396	   406#	   406	   456#	   456	   487#	   487	   529#	   529
	   544#	   544	   550#	   550	   569#	   569	   574#	   574	  1679#	  1679	  1683#	  1683	  1688#	  1688
	  1876#	  1876	  1922#	  1922	  1935#	  1935	  1938#	  1938	  2092#	  2092	  2113#	  2113	  2127#	  2127
	  2138#	  2138	  2210#	  2210	  2237#	  2237	  2238#	  2238	  2246#	  2246	  2251#	  2251	  2256#	  2256
	  2375#	  2375	  2538#	  2538	  2905#	  2905	  3490#	  3490	  3543#	  3543	  3545#	  3545	  3760#	  3760
	  3762#	  3762	  3828#	  3828	  3833#	  3833
ZZ1	   393#	   393	   394#	   394	   396#	   396	   406#	   406	   456#	   456	   487#	   487	   529#	   529
	   544#	   544	   550#	   550	   569#	   569	   574#	   574	  1679#	  1679	  1683#	  1683	  1688#	  1688
	  1876#	  1876	  1922#	  1922	  1935#	  1935	  1938#	  1938	  2092#	  2092	  2113#	  2113	  2127#	  2127
	  2138#	  2138	  2210#	  2210	  2237#	  2237	  2238#	  2238	  2246#	  2246	  2251#	  2251	  2256#	  2256
	  2375#	  2375	  2538#	  2538	  2905#	  2905	  3490#	  3490	  3543#	  3543	  3545#	  3545	  3760#	  3760
	  3762#	  3762	  3828#	  3828	  3833#	  3833
%%XCOD	  3890#	  3893	  3894	  3894#	  3895	  3895#	  3896	  3896#	  3897	  3897#	  3898	  3898#	  3899	  3899#
	  3900	  3900#	  3901	  3901#	  3902	  3902#	  3903	  3903#	  3904	  3904#	  3905	  3905#	  3906	  3906#
	  3907	  3907#	  3908	  3908#
%%Z	  3302#	  3306	  3306#	  3307	  3307#	  3308	  3308#	  3309	  3309#	  3310	  3310#	  3311	  3311#	  3312
	  3312#	  3313	  3313#	  3314	  3314#	  3315	  3315#	  3316	  3316#	  3317	  3317#	  3318	  3318#	  3319
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Symbol cross reference

	  3319#	  3320	  3320#	  3321	  3321#	  3322	  3322#	  3323	  3323#	  3324	  3324#	  3325	  3325#	  3326	  3326#
	  3327	  3327#	  3328	  3328#	  3329	  3329#	  3330	  3330#	  3331	  3331#	  3332	  3332#	  3333	  3333#
	  3334	  3334#
%COW	    60	    60%	  2498	  2501	  2503	  2524
%COW.N	    59#	    60	  2472	  2488	  2508	  2514	  2526
%CTUPT	    68%	  1708
%RB2.C	    71%
%RIB	   457	   459	   475	   480	   484	   492	   500	   554	   572	   590	   939	   941	   942	  1026
	  1083	  1084	  1091	  1093	  1095	  1103	  1104	  1106	  1107	  1109	  1110	  1117	  1118	  1252
	  1254	  1255	  1257	  1267	  1268	  1270	  1272	  1282	  1283	  1300	  1302	  1306	  1308	  1310
	  1311	  1332	  1342	  1345	  1735	  1736	  1737	  1739	  1740	  1741	  1742	  1743	  1744	  1745
	  1746	  1747	  1748	  1751	  1752	  1753	  1754	  1755	  1757	  1758	  1759	  1760	  1761	  1764
	  1765	  1781	  1786	  1790	  1791	  1847	  1848	  1849	  1854	  1862	  1864	  1867	  1942	  1945
	  1946	  1948	  1950	  1952	  1954	  1955	  1960	  1963	  1965	  1970	  2172	  2178	  2841	  2844
	  2847	  2900	  2941	  2943	  2964	  2970	  2975	  2984	  3127	  3128	  3129	  3131	  3132	  3134
	  3135	  3140	  3143	  3146	  3147	  3150	  3151	  3152	  3159	  3160	  3161	  3182	  3184	  3189
	  3207	  3216	  3222	  3223	  3228	  3236	  3241	  3244	  3245	  3249	  3250	  3260	  3261	  3262
	  3263	  3265	  3269	  3273	  3274	  3293
%RIB.C	    68%	   443	  1708	  1845
%UPT	    60	    60%	   355	   630	   632	   634	   638	   643	  1004	  1505	  1506	  1509	  1862	  2393
	  2394	  2470	  2481	  2493	  2545	  2659	  3289
.CPDWD	  2300%	  2300	  2349%	  2349
.ERFSA	  3662#
.ERILE	  3656#	  3715
.ERILF	  3653#	  3776
.ERILL	  3663#	  3717	  3771
.ERMCN	  3660#
.ERNCS	  3666#	  3778
.ERNFS	  3665#
.ERNPV	  3661#	  3772
.ERPPN	  3659#	  3716	  3773
.ERRSL	  3668#
.ERSNF	  3654#	  3774
.ERSSA	  3655#
.ERTME	  3657#
.ERUNA	  3658#
.ERUNC	  3664#	  3780
.ERUNF	  3667#	  3777
.FSDEF	  3646#
.FSDSL	  3645#
.FSLOK	  3648#
.FSRDF	  3647#
.FSREM	  3649#
.FSSRC	  3644#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 09:32  6-NOV-89
FILUUO.MAC	19-SEP-89 19:52		Macro/Opdef cross reference

CHANIO	  2477
ERCODE	  3672#	  3715	  3716	  3717	  3771	  3772	  3773	  3774	  3776	  3777	  3778	  3780
EXT	    60
IFCPU	  4120	  4124
IFNCPU	  4121
NOCHAR	   391	   847	  1012	  1520	  1803	  1992	  2584
PERSET	  2489
PJRST	   320	   430	   434	   588	   708	   728	   776	   800	   816	   846	   886	   887	  1005	  1064
	  1242	  1250	  1258	  1368	  1372	  1415	  1491	  1731	  1782	  1989	  2549	  2558	  2620	  2622
	  2685	  3011	  3518	  3526	  3844	  3849	  3929
PJSP	  1434
PJUMPE	  3847
PRINTF	    10#	   331	   717	  1830	  2218	  2764	  4037
PXCT	   393	   394	   396	   406	   456	   487	   529	   544	   550	   569	   574	  1679	  1683	  1688
	  1876	  1922	  1935	  1938	  2092	  2113	  2127	  2138	  2210	  2237	  2238	  2246	  2251	  2256
	  2375	  2538	  2905	  3490	  3543	  3545	  3760	  3762	  3828	  3833
PXGEN	   393	   394	   396	   406	   456	   487	   529	   544	   550	   569	   574	  1679	  1683	  1688
	  1876	  1922	  1935	  1938	  2092	  2113	  2127	  2138	  2210	  2237	  2238	  2246	  2251	  2256
	  2375	  2538	  2905	  3490	  3543	  3545	  3760	  3762	  3828	  3833
STOPCD	    15	   153	   154	   249	   262	   269	   697	   857	   977	  1001	  1020	  1060	  1150	  1156
	  1224	  1235	  1326	  1445	  1458	  1504	  1507	  1510	  2058	  2062	  2487	  2490	  2510	  2516
	  2528	  2711	  2731	  2790	  2795	  2816	  2826	  2959	  2998	  3006	  3035	  3068	  3516	  3560
	  3578	  4026	  4181
TXXGEN	  3174#	  3179
UMOVE	   347	   392	   455	   470	   488	  1544	  2075	  2076	  2137	  2157	  2158	  2206	  2247	  2252
	  2257	  2414	  2416	  2906	  3116	  3156	  3598	  3621	  3748	  3787	  3825	  3845	  3846	  3862
	  3872	  3934	  3951	  3953	  3967	  4001
UMOVEM	   301	   496	   501	   533	   542	   578	   635	   644	  1541	  1681	  1692	  1698	  1720	  1918
	  2090	  2098	  2125	  2221	  2945	  2948	  3122	  3165	  3190	  3252	  3266	  3276	  3367	  3611
	  3758	  3882	  3910	  4087	  4098
VREMOV	  2509	  2515	  2527
XA	  3300#	  3306	  3307	  3308	  3309	  3310	  3311	  3312	  3313	  3314	  3315	  3316	  3317	  3318
	  3319	  3320	  3321	  3322	  3323	  3324	  3325	  3326	  3327	  3328	  3329	  3330	  3331	  3332
	  3333	  3334
XCOD	  3888#	  3893	  3894	  3895	  3896	  3897	  3898	  3899	  3900	  3901	  3902	  3903	  3904	  3905
	  3906	  3907
XCTBU	   393	   394	   396	   406	   456	   487	   529	   544	   550	   569	   574	  1683	  1688	  1922
	  1935	  1938	  2092	  2113	  2127	  2210	  2237	  2375	  2538	  3543	  3545	  3760	  3762	  3828
	  3833
XCTFU	  1876	  2138	  2238	  2246	  2251	  2256	  2905	  3490
XCTTU	  1679
XP	  3644	  3645	  3646	  3647	  3648	  3649	  3653	  3654	  3655	  3656	  3657	  3658	  3659	  3660
	  3661	  3662	  3663	  3664	  3665	  3666	  3667	  3668
$END	  4195  s {