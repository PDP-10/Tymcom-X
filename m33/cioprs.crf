BSUBTTLDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1
S.MAC	 6-JUL-89 16:37		S.MAC - with system parameter file for P035/E, March 1989

BC				SUBTTL	S.MAC - with system parameter file for P035/E, March 1989
BC
BIF2IFNDEFLISTSNTAPEC				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
BC				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
BC
BIF2IFNDEFLISTSNC					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
B.CREFC					.CREF
BTAPEC									TAPE>>
BTITLEC				TITLE CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.
BC
BSTOPCDC					STOPCD(,ENTRY,CIOPR)^
BIFNDEFS$ENTRS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$ENTRS$TEMPIFIDNIFES$ENTRS$HALTIFGS$ENTRIFES$ENTRS$ENTRIF2IFNDEFDIEEXTERNDIENODIELALLENTRYCIOPRC					ENTRY	CIOPR		;For library searches
BCIOPRPUSHJPDIEC	000000'	260040	000000*	CIOPR::PUSHJ	P,DIE		;**** Default stopcode for "CIOPR" ****
BSIXBITC	000001'	435157	606200		SIXBIT	/CIOPR/  	;Title of module
BS$NONAC	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "CIOPR+nnn(nnnnnn)"
BCIOPRS$NAMEC			000000'	S$NAME==CIOPR			;For STOPCDs with no arguments
BSALLC					SALL>
BIFES$ENTRS$XCTIFES$ENTRS$NONAC				^
BLALLC					lall
BC
BC				;(who is JMS? Joseph M Smith did not work for TYMSHARE in 1980)
BC				; **jms4480** KMC SUPPORT FOR NODLOD.SAI ADDED 4-4-1980 /JMS
BC				; **gl 7180** PROTECTIVE CODE FOR UNEXPECTED INTERRUPTS
BC				; **lb 7780** SET/CLEAR MANUAL DOWN FLAG WHEN LOADING DRS
BC
BEXTERNCPOPJCPOPJ1C				EXTERNAL CPOPJ,CPOPJ1
BC
BC				;Enter here from UUOCON
BC
BCI.OPRUMOVET1WC	000003'	704312	000000	CI.OPR::UMOVE	T1,(W)		;FUNCTION,,ADR OF ARG BLOCK
BHLRZT2T1C	000004'	554340	000006		HLRZ	T2,T1		;T2:=FUNCTION CODE
BCAILET2DLFTLC	000005'	303340	000005		CAILE	T2,DLFTL-1	;IN RANGE?
BJRSTSETOT1C					 JRST	[SETO T1,
BJRSTDLEEC	000006'	254000	000447'			 JRST DLEE]
BXCTDLFTT2C	000007'	256007	000067'		XCT	DLFT(T2)	;YES, PERFORM FUNCTION.
BAOSAPC	000010'	354001	000000		 AOSA (P)		;SUCCESS
BDLEEUMOVEMT1WC	000011'	705312	000000	DLEE:	  UMOVEM T1,(W)		;ERROR CODE FOR USER.
BPOPJPC	000012'	263040	000000		POPJ P,
BC
BC
BIFCPUC				IFCPU (KS)^
BCPZZC			000000	CPZZ==0
BIRPC				IRP 
BC
BIFECPUTYPCPUKSCPZZC			000001	IFE CPUTYP-CPUKS,<CPZZ==1>
BC
BC
BC				;END IRP
BREPEATCPZZC				REPEAT CPZZ^,<	;ENDS ON LAST PAGE.
BC									; Default definition to JFCL
BDEFINEKMCMDNC					DEFINE KMCMDN,<JFCL 0>
BDEFINEKMCMUPC					DEFINE KMCMUP,<JFCL 0>
BC
BIFKMCREPEATDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC				IFKMC^REPEAT 1,^<					; If this is for a KMC system
BIFDEFKMCVECC				  IFDEF KMCVEC,<			;   and the KMC is defined
BC					DEFINE KMCMDN,<PUSHJ P,KMCSMN##>
BC					DEFINE KMCMUP,<PUSHJ P,KMCCMN##>>>
BC
BC				;DR11C hardware parameters.
BC
BDEFINEIOREGC				DEFINE IOREG(REGISTERNAME,OFFSET,BITNAMES,MSB),<
BC				 BIT==100000
BC				IFNB <MSB>,<BIT==MSB>
BC				DR'REGISTERNAME==OFFSET
BC				IRP BITNAMES,<REGISTERNAME'BITNAMES==BIT
BC				              BIT==BIT/2>
BC				>
BC
BIOREGC				IOREG(CSR,0,<RB,,,,,,,,RA,IEA,IEB,,,,1,0>)^
BBITC			100000	 BIT==100000
BIFNBC				IFNB <>,<BIT==>
BDRCSRC			000000	DRCSR==0
BIRPC				IRP 
BBITCSRRBC			100000	CSRRB==BIT
BBITBITC			040000	              BIT==BIT/2
BC
BBITCSRC			040000	CSR==BIT
BBITBITC			020000	              BIT==BIT/2
BC
BBITCSRC			020000	CSR==BIT
BBITBITC			010000	              BIT==BIT/2
BC
BBITCSRC			010000	CSR==BIT
BBITBITC			004000	              BIT==BIT/2
BC
BBITCSRC			004000	CSR==BIT
BBITBITC			002000	              BIT==BIT/2
BC
BBITCSRC			002000	CSR==BIT
BBITBITC			001000	              BIT==BIT/2
BC
BBITCSRC			001000	CSR==BIT
BBITBITC			000400	              BIT==BIT/2
BC
BBITCSRC			000400	CSR==BIT
BBITBITC			000200	              BIT==BIT/2
BC
BBITCSRRAC			000200	CSRRA==BIT
BBITBITC			000100	              BIT==BIT/2
BC
BBITCSRIEAC			000100	CSRIEA==BIT
BBITBITC			000040	              BIT==BIT/2
BC
BBITCSRIEBC			000040	CSRIEB==BIT
BBITBITC			000020	              BIT==BIT/2
BC
BBITCSRDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1-2
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC			000020	CSR==BIT
BBITBITC			000010	              BIT==BIT/2
BC
BBITCSRC			000010	CSR==BIT
BBITBITC			000004	              BIT==BIT/2
BC
BBITCSRC			000004	CSR==BIT
BBITBITC			000002	              BIT==BIT/2
BC
BBITCSR1C			000002	CSR1==BIT
BBITBITC			000001	              BIT==BIT/2
BC
BBITCSR0C			000001	CSR0==BIT
BBITBITC			000000	              BIT==BIT/2
BC
BC
BC				^
BCSR0DRFNC			000001	 DRFN==CSR0   ;Data ready for node (set by KS10 after loading OB).
BODOFSC			000001	 ODOFS==1	;High vector = dispatch when node's read OB.
BCSR1KRFMDC			000002	 KRFMD==CSR1  ;KS10 ready for more data (set by KS10 after reading IB).
BIROFSC			000000	 IROFS==0	;Low vector = dispatch when node's written IB.
BIOREGC				IOREG(OB,2)^
BBITC			100000	 BIT==100000
BIFNBC				IFNB <>,<BIT==>
BDROBC			000002	DROB==2
BIRPC				IRP 
BC
BC				^
BIOREGC				IOREG(IB,4)^
BBITC			100000	 BIT==100000
BIFNBC				IFNB <>,<BIT==>
BDRIBC			000004	DRIB==4
BIRPC				IRP 
BC
BC				^
BC
BC				;Macro to make a DR11c known to the system.
BC				;Since the concatenation operator can't be used outside of
BC				; macro definitions, we have to use the SETxxx macros.
BC
BDEFINESETBASC				DEFINE SETBASEADDRESS(N,ADDRESS),<DR'N'BA==ADDRESS>
BC
BDEFINESETVECC				DEFINE SETVECTORADDRESS(N,ADDRESS),<DR'N'VL==ADDRESS>
BC
BDEFINEDR11CC				DEFINE DR11C(BASEADDRESS,VECTORBASE),<
BC				SETBASEADR(\NUMDR,BASEADDRESS)
BC				SETVECTORADDRESS(\NUMDR,VECTORADDRESS)
BC				IF1,<BLOCK 8>
BC				IF2,<DRINTH(\NUMDR)>
BC				NUMDR==NUMDR+1
BC				>
BC
BNUMDRC			000000	NUMDR==0
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1-3
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC
BC				;macro to protect against & count unexpected dr interrupts. /GL 7-1-80
BC				;  and to move a JSR DX#INT into EPT+base+vec.
BDEFINEDRXJSRC				DEFINE DRXJSR(N,UBA,VEC),<
BC					JRST	DY'N'CNT+1
BC				DX'N'INT: EXP 0
BC					AOS DX'N'CNT
BC					JEN @DX'N'INT
BC				DX'N'CNT: EXP 0
BC				DY'N'INT: EXP 0
BC					AOS DY'N'CNT
BC					JEN @DY'N'INT
BC				DY'N'CNT: EXP 0
BC					MOVE	T2,EPT+100+UBA	;T2/ BASE VECTOR ADDRESS
BC					MOVE	T1,[JSR DX'N'INT]
BC					MOVEM	T1,VEC'/4(T2)
BC					HRRI	T1,DY'N'INT
BC					MOVEM	T1,VEC'/4+1(T2)
BC				>  ;End of DEFINE DRXJSR
BC
BC				;Insert definitions here.
BDR11CC				DR11C(767770,300/4)^
BSETBASNUMDRDR0BAC			767770	SETBASEADR(\NUMDR,767770)^DR0BA==767770^
BSETVECNUMDRDR0VLC			000060	SETVECTORADDRESS(\NUMDR,300/4)^DR0VL==300/4^
BIF1C				IF1,<BLOCK 8>
BIF2DRINTHNUMDRC				IF2,<DRINTH(\NUMDR)>^	;DR0 interrupt handler
BDR0IRFC	000013'	000000	000000	DR0IRF:0
BDR0IRC	000014'	000000	000000	DR0IR:0
BSETOMDR0IRFC	000015'	476000	000013'		SETOM DR0IRF
BJENDR0IRC	000016'	254520	000014'		JEN @DR0IR
BDR0ODFC	000017'	777777	777777	DR0ODF:-1
BDR0ODC	000020'	000000	000000	DR0OD:0
BSETOMDR0ODFC	000021'	476000	000017'		SETOM DR0ODF
BJENDR0ODC	000022'	254520	000020'		JEN @DR0OD
BC				^
BNUMDRNUMDRC			000001	NUMDR==NUMDR+1
BC				^
BDR11CC				DR11C(767760,310/4)^
BSETBASNUMDRDR1BAC			767760	SETBASEADR(\NUMDR,767760)^DR1BA==767760^
BSETVECNUMDRDR1VLC			000062	SETVECTORADDRESS(\NUMDR,310/4)^DR1VL==310/4^
BIF1C				IF1,<BLOCK 8>
BIF2DRINTHNUMDRC				IF2,<DRINTH(\NUMDR)>^	;DR1 interrupt handler
BDR1IRFC	000023'	000000	000000	DR1IRF:0
BDR1IRC	000024'	000000	000000	DR1IR:0
BSETOMDR1IRFC	000025'	476000	000023'		SETOM DR1IRF
BJENDR1IRC	000026'	254520	000024'		JEN @DR1IR
BDR1ODFC	000027'	777777	777777	DR1ODF:-1
BDR1ODC	000030'	000000	000000	DR1OD:0
BSETOMDR1ODFC	000031'	476000	000027'		SETOM DR1ODF
BJENDR1ODC	000032'	254520	000030'		JEN @DR1OD
BC				^
BNUMDRNUMDRC			000002	NUMDR==NUMDR+1
BC				^		; **jms4480**
BDR11CDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1-4
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC				DR11C(767750,320/4)^
BSETBASNUMDRDR2BAC			767750	SETBASEADR(\NUMDR,767750)^DR2BA==767750^
BSETVECNUMDRDR2VLC			000064	SETVECTORADDRESS(\NUMDR,320/4)^DR2VL==320/4^
BIF1C				IF1,<BLOCK 8>
BIF2DRINTHNUMDRC				IF2,<DRINTH(\NUMDR)>^	;DR2 interrupt handler
BDR2IRFC	000033'	000000	000000	DR2IRF:0
BDR2IRC	000034'	000000	000000	DR2IR:0
BSETOMDR2IRFC	000035'	476000	000033'		SETOM DR2IRF
BJENDR2IRC	000036'	254520	000034'		JEN @DR2IR
BDR2ODFC	000037'	777777	777777	DR2ODF:-1
BDR2ODC	000040'	000000	000000	DR2OD:0
BSETOMDR2ODFC	000041'	476000	000037'		SETOM DR2ODF
BJENDR2ODC	000042'	254520	000040'		JEN @DR2OD
BC				^
BNUMDRNUMDRC			000003	NUMDR==NUMDR+1
BC				^		; **jms4480**
BDR11CC				DR11C(767740,330/4)^
BSETBASNUMDRDR3BAC			767740	SETBASEADR(\NUMDR,767740)^DR3BA==767740^
BSETVECNUMDRDR3VLC			000066	SETVECTORADDRESS(\NUMDR,330/4)^DR3VL==330/4^
BIF1C				IF1,<BLOCK 8>
BIF2DRINTHNUMDRC				IF2,<DRINTH(\NUMDR)>^	;DR3 interrupt handler
BDR3IRFC	000043'	000000	000000	DR3IRF:0
BDR3IRC	000044'	000000	000000	DR3IR:0
BSETOMDR3IRFC	000045'	476000	000043'		SETOM DR3IRF
BJENDR3IRC	000046'	254520	000044'		JEN @DR3IR
BDR3ODFC	000047'	777777	777777	DR3ODF:-1
BDR3ODC	000050'	000000	000000	DR3OD:0
BSETOMDR3ODFC	000051'	476000	000047'		SETOM DR3ODF
BJENDR3ODC	000052'	254520	000050'		JEN @DR3OD
BC				^
BNUMDRNUMDRC			000004	NUMDR==NUMDR+1
BC				^		; **jms4480**
BC
BDEFINEDRINTHC				DEFINE DRINTH(N),<	;DR'N interrupt handler
BC				DR'N'IRF:0
BC				DR'N'IR:0
BC					SETOM DR'N'IRF
BC					JEN @DR'N'IR
BC				DR'N'ODF:-1
BC				DR'N'OD:0
BC					SETOM DR'N'ODF
BC					JEN @DR'N'OD
BC				>;DEFINE DRINTH
BC
BDRIVTBC	000053'			DRIVTB:			;Interrupt vector table
BDEFINEDRVECLC				DEFINE DRVECL(N) <
BC					DR'N'VL
BC				>
BC
BIF1C				IF1,<BLOCK NUMDR>
BIF2C				IF2,<
BZZC			000000	ZZ==0
BREPEATNUMDRC				REPEAT NUMDR,<
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1-5
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC					DRVECL(\ZZ)
BC				ZZ==ZZ+1
BC				>>
BC
BDRVECLZZC					DRVECL(\ZZ)^
BDR0VLC	000053'	000000	000060		DR0VL
BC				^
BZZZZC			000001	ZZ==ZZ+1
BC
BC
BDRVECLZZC					DRVECL(\ZZ)^
BDR1VLC	000054'	000000	000062		DR1VL
BC				^
BZZZZC			000002	ZZ==ZZ+1
BC
BC
BDRVECLZZC					DRVECL(\ZZ)^
BDR2VLC	000055'	000000	000064		DR2VL
BC				^
BZZZZC			000003	ZZ==ZZ+1
BC
BC
BDRVECLZZC					DRVECL(\ZZ)^
BDR3VLC	000056'	000000	000066		DR3VL
BC				^
BZZZZC			000004	ZZ==ZZ+1
BC
BC
BDRFLTBC	000057'			DRFLTB:			;Flag address table
BDEFINEDRFLAGC				DEFINE DRFLAG(N) <
BC					DR'N'IRF,,DR'N'ODF
BC				>
BIF1C				IF1,<BLOCK NUMDR>
BIF2C				IF2,<
BZZC			000000	ZZ==0
BREPEATNUMDRC				REPEAT NUMDR,<
BC					DRFLAG(\ZZ)
BC				ZZ==ZZ+1
BC				>>
BC
BDRFLAGZZC					DRFLAG(\ZZ)^
BDR0IRFDR0ODFC	000057'	000013'	000017'		DR0IRF,,DR0ODF
BC				^
BZZZZC			000001	ZZ==ZZ+1
BC
BC
BDRFLAGZZC					DRFLAG(\ZZ)^
BDR1IRFDR1ODFC	000060'	000023'	000027'		DR1IRF,,DR1ODF
BC				^
BZZZZC			000002	ZZ==ZZ+1
BC
BC
BDRFLAGZZC					DRFLAG(\ZZ)^
BDR2IRFDR2ODFDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 1-6
CIOPR.MAC	17-SEP-87 16:44		S.MAC - with system parameter file for P035/E, March 1989

BC	000061'	000033'	000037'		DR2IRF,,DR2ODF
BC				^
BZZZZC			000003	ZZ==ZZ+1
BC
BC
BDRFLAGZZC					DRFLAG(\ZZ)^
BDR3IRFDR3ODFC	000062'	000043'	000047'		DR3IRF,,DR3ODF
BC				^
BZZZZC			000004	ZZ==ZZ+1
BC
BC
BDRBATBC	000063'			DRBATB:			;Base address table
BDEFINEDRBADRC				DEFINE DRBADR(N) <
BC					3,,DR'N'BA
BC				>
BIF1C				IF1,<BLOCK NUMDR>
BIF2C				IF2,<
BZZC			000000	ZZ==0
BREPEATNUMDRC				REPEAT NUMDR,<
BC					DRBADR(\ZZ)
BC				ZZ==ZZ+1
BC				>>
BC
BDRBADRZZC					DRBADR(\ZZ)^
BDR0BAC	000063'	000003	767770		3,,DR0BA
BC				^
BZZZZC			000001	ZZ==ZZ+1
BC
BC
BDRBADRZZC					DRBADR(\ZZ)^
BDR1BAC	000064'	000003	767760		3,,DR1BA
BC				^
BZZZZC			000002	ZZ==ZZ+1
BC
BC
BDRBADRZZC					DRBADR(\ZZ)^
BDR2BAC	000065'	000003	767750		3,,DR2BA
BC				^
BZZZZC			000003	ZZ==ZZ+1
BC
BC
BDRBADRZZC					DRBADR(\ZZ)^
BDR3BAC	000066'	000003	767740		3,,DR3BA
BC				^
BZZZZC			000004	ZZ==ZZ+1
BC
BSUBTTLDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC				SUBTTL	Dispatch for KS version of CIOPR
BC
BC				;FUNCTION HANDLERS ARE PASSED ADR OF ARG BLOCK IN T1.RH.
BC				;SINGLE RETURN IF FUNCTION EXECUTED NORMALLY.
BC				;ON ERROR, SKIP RETURN WITH ERROR CODE IN T1.
BDLFTPUSHJPDLSCIC	000067'	260040	000100'	DLFT:	PUSHJ	P,DLSCI		;0 SELECT COMMUNICATIONS INTERFACE.
BPUSHJPDLSEDRC	000070'	260040	000264'		PUSHJ	P,DLSEDR	;1 PREPARE DR11C FOR DATA.
BPUSHJPDLWDRC	000071'	260040	000231'		PUSHJ	P,DLWDR		;2 WRITE WORD TO DR11C.
BPUSHJPDLRDRC	000072'	260040	000246'		PUSHJ	P,DLRDR		;3 READ WORD FROM DR11C.
BPUSHJPDLDDRC	000073'	260040	000312'		PUSHJ	P,DLDDR		;4 RELEASE DR11C TO KMC & NEXILIS NODE.
BPUSHJPDLKMCDC	000074'	260040	000075'		PUSHJ	P,DLKMCD	;5 GIVES ERROR RETURN IF KMCDO IS 0
BDLFTDLFTLC			000006	DLFTL==.-DLFT
BC
BC				;DLKMCD (FUNCTION 5) - TEST IF KMC IS SELECTED
BC
BDLKMCDSKIPNKMCDOKMCDOC	000075'	336000	000000*	DLKMCD:	SKIPN	KMCDO##		;(5) CHECK IF KMCDO IS SET
BAOSPC	000076'	350001	000000		  AOS	(P)
BPOPJPC	000077'	263040	000000		POPJ	P,
BC
BC				;DLSCI (FUNCTION 0) - SELECT COMMUNICATIONS INTERFACE.
BC				; ARG 0: INTERFACE TYPE: 0=CTYSIM, 1=DZKON, 2=TYMBASE NODE, 3=DR11C
BC				; **jms4480** THIS FUNCTION DOES NOT ALLOW  FOR MULTIPLE
BC				; **jms4480** DR'S (ALSO DR0 MUST BE USED). TO USE MORE THAN
BC				; **jms4480** 1 DR, THE KMC IS REQUIRED IN WHICH CASE THE (KMC)
BC				; **jms4480** INTERFACE SHOULD BE CLEARED FROM USER LEVEL.
BC
BDLSCIPUSHJPDLREIC	000100'	260040	000111'	DLSCI:	PUSHJ	P,DLREI		;REMOVE EXISTING INTERFACES.
BUHRRZC					UHRRZ	T2,(T1)		;GET INTERFACE TYPE.
BXCTBUSALLC				XCTBU	<HRRZ T2,(T1)		>^SALL
BPXCTPX.MEMHRRZT2T1GINSTPXGENZZIRPCZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNZZ1IFIDNIFNZZ1STOPIIFEZZ1IRPIFEZZIFEZZIFEZZIFEZZPURGEZZ1PXGENZZIRPCZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNIFIDNIFNZZ1IFEZZ1ZZZZZZZZZZ1IFIDNZZ1IFIDNIFNZZ1STOPIIFEZZ1IRPIFEZZIFEZZIFEZZPURGEZZ1GINSTC	000101'	256200	000451'
BPURGEGINSTCAILET2C	000102'	303340	000003		CAILE	T2,3
BJRSTDLE0C	000103'	254000	000351'		 JRST	DLE0		;ILLEGAL INTERFACE TYPE.
BJRSTT2C	000104'	254027	000105'		JRST	@.+1(T2)
BDLICTYC	000105'	000000	000215'		DLICTY		;0 CTY
BDLIDZC	000106'	000000	000223'		DLIDZ		;1 DZ
BDLINNC	000107'	000000	000230'		DLINN		;2 KMC
BDLIDRC	000110'	000000	000210'		DLIDR		;3 DR
BC				;*;	DLREI
BC
BC				;DLREI.  REMOVE LINKS BETWEEN DZKON, CTYSIM AND SYSTEM.
BDLREISKIPECTYDOCTYDOC	000111'	332000	000000*	DLREI:	SKIPE	CTYDO##
BJFCLC	000112'	255000	000000		 JFCL	;**D*	 PUSHJ P,DLRCTY
BSKIPEDZDODZDOC	000113'	332000	000000*		SKIPE	DZDO##
BPUSHJPDLRDZC	000114'	260040	000154'		 PUSHJ	P,DLRDZ
BSKIPEDRDODRDOC	000115'	332000	000000*		SKIPE	DRDO##
BPUSHJPDLRDRIC	000116'	260040	000122'		 PUSHJ	P,DLRDRI
BSKIPEKMCDOKMCDOC	000117'	332000	000075*		SKIPE	KMCDO##
BJFCLC	000120'	255000	000000		 JFCL			;KMC IS NEVER REMOVED
BPOPJPC	000121'	263040	000000		POPJ	P,
BC
BEXTERNEPTCPOPJ1C				EXTERNAL EPT,CPOPJ1
BC
BC				;Remove DR interface
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-2
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC
BDLRDRIMOVEIT2C	000122'	201340	000000	DLRDRI:	MOVEI	T2,0		;Clear DR0's CSR
BMOVET3DRBATBC	000123'	200400	000063'		MOVE	T3,DRBATB	; **jms4480** ONLY UPPORTED
BC								; **jms4480** AT THIS LEVEL.
BWRIOT2DRCSRT3C	000124'	713350	000000		WRIO	T2,DRCSR(T3)
BMOVEIT3CH7CH7C	000125'	201400	000000*		MOVEI	T3,CH7##
BMOVEIT2CLKDRCLKDRC	000126'	201340	000000*		MOVEI	T2,CLKDR##
BWRPILI.PIFC	000127'	700600	000400		WRPI	LI.PIF
BPUSHJPDLUIRC	000130'	260040	000175'		PUSHJ	P,DLUIR		;Unlink CLKDR from CH7
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000131'	256000	000000'		  STOPCD
BWRPILI.PINC	000132'	700600	000200		WRPI	LI.PIN
BPOPJPC	000133'	263040	000000		POPJ	P,
BC
BC				;Remove CTY interface
BC
BDLRCTYMOVEIT3CH7CH7C	000134'	201400	000125*	DLRCTY:	MOVEI	T3,CH7##
BMOVEIT2CH7LKCH7LKC	000135'	201340	000000*		MOVEI	T2,CH7LK##
BWRPILI.PIFC	000136'	700600	000400		WRPI	LI.PIF
BPUSHJPDLUIRC	000137'	260040	000175'		PUSHJ	P,DLUIR		;Unlink CH7LK from CH7
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000140'	256000	000000'		  STOPCD
BMOVEIT3CH6CH6C	000141'	201400	000000*		MOVEI	T3,CH6##
BMOVEIT2CH6LKCH6LKC	000142'	201340	000000*		MOVEI	T2,CH6LK##
BPUSHJPDLUIRC	000143'	260040	000175'		PUSHJ	P,DLUIR		;Unlink CH6LK from CH6
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000144'	256000	000000'		  STOPCD
BMOVEIT3CH6CH6C	000145'	201400	000141*		MOVEI	T3,CH6##
BMOVEIT2CH6KSTCH6KSTC	000146'	201340	000000*		MOVEI	T2,CH6KST##
BPUSHJPDLUIRC	000147'	260040	000175'		PUSHJ	P,DLUIR		;Unlink CH6KST from CH6
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000150'	256000	000000'		  STOPCD
BSETZMCTYDOCTYDOC	000151'	402000	000111*		SETZM	CTYDO##
BWRPILI.PINC	000152'	700600	000200		WRPI	LI.PIN
BPOPJPC	000153'	263040	000000		POPJ	P,
BC
BC				;Remove DZ interface
BC
BDLRDZWRPILI.PIFC	000154'	700600	000400	DLRDZ:	WRPI	LI.PIF
BPUSHJPDZREMDZREMC	000155'	260040	000000*		PUSHJ	P,DZREM##	;TURN OFF DZ11S.
BMOVEIT3CH7CH7C	000156'	201400	000134*		MOVEI	T3,CH7##
BMOVEIT2DZPINTDZPINTC	000157'	201340	000000*		MOVEI	T2,DZPINT##
BPUSHJPDLUIRC	000160'	260040	000175'		PUSHJ	P,DLUIR		;Unlink DZPINT from CH7
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000161'	256000	000000'		  STOPCD
BMOVEIT3CH6CH6C	000162'	201400	000145*		MOVEI	T3,CH6##
BMOVEIT2PERINTPERINTC	000163'	201340	000000*		MOVEI	T2,PERINT##
BPUSHJPDLUIRC	000164'	260040	000175'		PUSHJ	P,DLUIR		;Unlink PERINT from CH6
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000165'	256000	000000'		  STOPCD
BMOVEIT3CH6CH6C	000166'	201400	000162*		MOVEI	T3,CH6##
BMOVEIT2CONINTCONINTC	000167'	201340	000000*		MOVEI	T2,CONINT##
BPUSHJPDLUIRC	000170'	260040	000175'		PUSHJ	P,DLUIR		;Unlink CONINT from CH6
BSTOPCDIFNDEFS$NONAS$TEMPIFIDNIFIDNIFIDNIFIDNIFLS$TEMPS$TEMPIFNBS$TEMPS$NONAS$TEMPIFIDNIFES$NONAS$HALTIFGS$NONAIFES$NONAS$ENTRIFES$NONAS$XCTIFES$NONAS$NONAXCTS$NAMEC	000171'	256000	000000'		  STOPCD
BSETZMDZDODZDOC	000172'	402000	000113*		SETZM	DZDO##
BWRPILI.PINC	000173'	700600	000200		WRPI	LI.PIN
BPOPJPC	000174'	263040	000000		POPJ	P,
BC
BC				;DLUIR.  UNLINK INTERRUPT ROUTINE WHOSE ADDRESS IS IN
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-3
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC				; T2 FROM CHAIN ON CHANNEL IN T3.
BC				;SINGLE RETURN IF COULDN'T FIND THE ROUTINE.  OTHERWISE
BC				; SKIP AFTER UNLINKING IT.
BDLUIRSKIPAP2T3C	000175'	334640	000010	DLUIR:	SKIPA	P2,T3		;Unlink Interrupt Routine
BDLUIR0SKIPAT3T4C	000176'	334400	000011	DLUIR0:	 SKIPA	T3,T4		;PREVIOUS:=CURRENT
BHRRZIT4T3C	000177'	551450	000000		  HRRZI	T4,(T3)		;T3:=PREVIOUS
BHRRZT4T4C	000200'	550451	000001		HRRZ	T4,1(T4)	;T4:=CURRENT
BCAINT4P2C	000201'	306455	000000		CAIN	T4,(P2)		;LOOPED AROUND?
BPOPJPC	000202'	263040	000000		 POPJ	P,		;YEP, DIDN'T FIND IT.
BCAIET4T2C	000203'	302447	000000		CAIE	T4,(T2)
BJRSTDLUIR0C	000204'	254000	000176'		 JRST	DLUIR0
BDLUIR1MOVET4T4C	000205'	200451	000001	DLUIR1:	MOVE	T4,1(T4)	;PREVIOUS.NEXT:=CURRENT.NEXT.
BMOVEMT4T3C	000206'	202450	000001		MOVEM	T4,1(T3)
BJRSTCPOPJ1C	000207'	254000	000000*		JRST	CPOPJ1
BC
BC				;Install DR11C interface to NEXILIS node
BC
BDLIDRWRPILI.PIFC	000210'	700600	000400	DLIDR:	WRPI	LI.PIF
BSETOMDRDODRDOC	000211'	476000	000115*		SETOM	DRDO##
BPUSHJPDRINIDRINIC	000212'	260040	000000*		PUSHJ	P,DRINI##
BWRPILI.PINC	000213'	700600	000200		WRPI	LI.PIN
BPOPJPC	000214'	263040	000000		POPJ	P,
BC
BC				;Install CTY interface
BC
BDLICTYWRPILI.PIFC	000215'	700600	000400	DLICTY:	WRPI	LI.PIF
BSETOMCTYDOCTYDOC	000216'	476000	000151*		SETOM	CTYDO##
BSETOMNOWINNOWINC	000217'	476000	000000*		SETOM	NOWIN##		;SAY PORT LOGGED IN.
BPUSHJPCTYSETCTYSETC	000220'	260040	000000*		PUSHJ	P,CTYSET##
BWRPILI.PINC	000221'	700600	000200		WRPI	LI.PIN
BPOPJPC	000222'	263040	000000		POPJ	P,
BC
BC				;Install DZ-11 driver interface
BC
BDLIDZWRPILI.PIFC	000223'	700600	000400	DLIDZ:	WRPI	LI.PIF
BSETOMDZDODZDOC	000224'	476000	000172*		SETOM	DZDO##
BPUSHJPDZINIDZINIC	000225'	260040	000000*		PUSHJ	P,DZINI##
BWRPILI.PINC	000226'	700600	000200		WRPI	LI.PIN
BPOPJPC	000227'	263040	000000		POPJ	P,
BC
BC				;Install KMC to NEXILIS node interface
BC
BDLINNC	000230'			DLINN:
BC				;*;	SETOM	KMCDO##		;ASSUME KMCDO IS ALREADY SET
BPOPJPC	000230'	263040	000000		POPJ	P,
BC
BC				;DLWDR (FUNCTION 2) - WRITE WORD TO SELECTED DR11C.
BC				; ARG 0: DR11C#,,16 BIT WORD TO SEND
BDLWDRPUSHJPDLSDRC	000231'	260040	000335'	DLWDR:	PUSHJ	P,DLSDR		;GET DR11C BASE ADDRESS.
BJRSTCPOPJ1C	000232'	254000	000207*		  JRST	CPOPJ1		;ERROR.
BHRRZT4DRFLTBT2C	000233'	550447	000057'		HRRZ	T4,DRFLTB(T2)	;SEE IF PREVIOUS OUTPUT TAKEN.
BSKIPNT4C	000234'	336011	000000		SKIPN	(T4)
BJSPT1DLWAITC	000235'	265300	000343'		 JSP	T1,DLWAIT
BWRPILI.PIFDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-4
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC	000236'	700600	000400		WRPI	LI.PIF
BSETZMT4C	000237'	402011	000000		SETZM	(T4)		;CLEAR TAKEN FLAG.
BWRIOT3DROBP1C	000240'	713414	000002		WRIO	T3,DROB(P1)	;SEND WORD
BMOVEIT3DRFNC	000241'	201400	000001		MOVEI	T3,DRFN
BBCIOT3DRCSRP1C	000242'	715414	000000		BCIO	T3,DRCSR(P1)
BBSIOT3DRCSRP1C	000243'	714414	000000		BSIO	T3,DRCSR(P1)	;TELL DR NEW DATA IS READY
BWRPILI.PINC	000244'	700600	000200		WRPI	LI.PIN
BPOPJPC	000245'	263040	000000		POPJ	P,
BC
BC				;DLRDR (FUNCTION 3) - READ WORD FROM SELECTED DR11C.
BC				; ARG 0: DR11C #,,ADR TO RECEIVE WORD READ.
BDLRDRPUSHJPDLSDRC	000246'	260040	000335'	DLRDR:	PUSHJ	P,DLSDR		;GET DR11C BASE ADDRESS.
BJRSTCPOPJ1C	000247'	254000	000232*		  JRST	CPOPJ1		;ERROR.
BHLRZT4DRFLTBT2C	000250'	554447	000057'		HLRZ	T4,DRFLTB(T2)	;CHECK IF PREVIOUS INPUT RECEIVED.
BSKIPNT4C	000251'	336011	000000		SKIPN	(T4)
BJSPT1DLWAITC	000252'	265300	000343'		 JSP	T1,DLWAIT
BWRPILI.PIFC	000253'	700600	000400		WRPI	LI.PIF
BSETZMT4C	000254'	402011	000000		SETZM	(T4)		;CLEAR FLAG.
BRDIOT4DRIBP1C	000255'	712454	000004		RDIO	T4,DRIB(P1)	;GET WORD
BUMOVEMT4T3C	000256'	705450	000000		UMOVEM	T4,(T3)		;GIVE IT TO USER
BMOVEIT4KRFMDC	000257'	201440	000002		MOVEI	T4,KRFMD
BBCIOT4DRCSRP1C	000260'	715454	000000		BCIO	T4,DRCSR(P1)
BBSIOT4DRCSRP1C	000261'	714454	000000		BSIO	T4,DRCSR(P1)	;TELL DR INPUT HAS BEEN READ
BWRPILI.PINC	000262'	700600	000200		WRPI	LI.PIN
BPOPJPC	000263'	263040	000000		POPJ	P,
BC
BC				;DLSEDR (FUNCTION 1) - SELECT DR11C FOR USE BY THE 2020.
BC				; ARG 0: DR11C #,,0
BDLSEDRPUSHJPDLSDRC	000264'	260040	000335'	DLSEDR:	PUSHJ	P,DLSDR		;GET HANDLES ON DR11C
BJRSTCPOPJ1C	000265'	254000	000247*		 JRST	CPOPJ1		;ERROR.
BMOVET1T2C	000266'	200300	000007		MOVE	T1,T2		;SET UP T1 FOR SETTING MANUAL DOWN FLAG
BSKIPEKMCDOKMCDOC	000267'	332000	000117*		SKIPE	KMCDO##		;DONT SET IF NO KMC
BKMCMDNJFCLC	000270'	255000	000000		  KMCMDN		;SET DR MANUALLY DOWN
BHRRZT4EPTC	000271'	550440	000103*		HRRZ	T4,EPT+103	;SETUP INTERRUPT VECTORS.
BADDT4DRIVTBT2C	000272'	270447	000053'		ADD	T4,DRIVTB(T2)
BHLRZT1DRFLTBT2C	000273'	554307	000057'		HLRZ	T1,DRFLTB(T2)
BADDT1JSRC	000274'	270300	000452'		ADD	T1,[JSR 1]
BMOVEMT1IROFST4C	000275'	202311	000000		MOVEM	T1,IROFS(T4)
BHRRZT1DRFLTBT2C	000276'	550307	000057'		HRRZ	T1,DRFLTB(T2)
BADDT1JSRC	000277'	270300	000452'		ADD	T1,[JSR 1]
BMOVEMT1ODOFST4C	000300'	202311	000001		MOVEM	T1,ODOFS(T4)
BMOVEIT1CSRIEACSRIEBC	000301'	201300	000140		MOVEI	T1,CSRIEA+CSRIEB ;ENABLE BOTH INTERRUPTS
BWRIOT1DRCSRP1C	000302'	713314	000000		WRIO	T1,DRCSR(P1)
BMOVEIT1C	000303'	201300	001750		MOVEI	T1,^D1000	;GIVE IT A CHANCE TO INTERRUPT
BSOJGT1C	000304'	367300	000304'		SOJG	T1,.		;ASSUME NO INT PENDING AFTER THIS.
BHLRZT4DRFLTBT2C	000305'	554447	000057'		HLRZ	T4,DRFLTB(T2)	;CLEAR INPUT READY FLAG
BSETZMT4C	000306'	402011	000000		SETZM	(T4)
BHRRZT4DRFLTBT2C	000307'	550447	000057'		HRRZ	T4,DRFLTB(T2)	;SET DR11C READY FOR OUR OUTPUT FLAG
BSETOMT4C	000310'	476011	000000		SETOM	(T4)
BPOPJPC	000311'	263040	000000		POPJ	P,
BC
BC				;DLDDR (FUNCTION 4) - DESELECT DR11C.
BC				; ARG 0: DR11C #,,0
BDLDDRPUSHJPDLSDRDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-5
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC	000312'	260040	000335'	DLDDR:	PUSHJ P,DLSDR		;GET HANDLES ON DR11C
BJRSTCPOPJ1C	000313'	254000	000265*		 JRST CPOPJ1		;ERROR.
BHRRZT4DRFLTBT2C	000314'	550447	000057'		HRRZ T4,DRFLTB(T2)	;MAKE SURE LAST OUTPUT TAKEN.
BMOVEIP2C	000315'	201640	777777		MOVEI P2,-1		;SET COUNT OF 777777
BDLDDR1SKIPNT4C	000316'	336011	000000	DLDDR1:	SKIPN (T4)		;CHECK FOR DATA ACCEPTED
BSOJGP2DLDDR1C	000317'	367640	000316'		 SOJG P2,DLDDR1		;KEEP TRYING
BMOVEIT1C	000320'	201300	000000		MOVEI T1,0		;DISABLE INTERRUPTS
BWRIOT1DRCSRP1C	000321'	713314	000000		WRIO T1,DRCSR(P1)
BSKIPNT4C	000322'	336011	000000		SKIPN (T4)
BJSPT1DLWAITC	000323'	265300	000343'		 JSP T1,DLWAIT
BMOVET1T2C	000324'	200300	000007		MOVE T1,T2		
BSKIPECTYDOCTYDOC	000325'	332000	000216*		SKIPE	CTYDO##
BPOPJPC	000326'	263040	000000		  POPJ	P,		;IF RUNNING FORM CONSOLE QUIT NOW.
BSKIPNKMCDOKMCDOC	000327'	336000	000267*		SKIPN KMCDO##		;DONT REINSTALL DR DRIVER IF KMC ACTIVE
BPUSHJPDLIDRC	000330'	260040	000210'		 PUSHJ P,DLIDR		;REINSTALL DR11C DRIVER
BSKIPEKMCDOKMCDOC	000331'	332000	000327*		SKIPE KMCDO##		;DO CLEAR MANUAL DOWN FLAG IF KMC ACTIVE
BKMCMUPJFCLC	000332'	255000	000000		 KMCMUP			;"MANUALLY UP"
BPOPJPC	000333'	263040	000000		POPJ P,			;WITH OR WITHOUT KMC
BPOPJPC	000334'	263040	000000		POPJ P,
BC
BC				;DLSDR.  LOAD P1 WITH BASE ADDRESS OF DR11C SPECIFIED BY USER.
BC				; IN ARG 0.  SKIP IF LEGAL DR11C, SINGLE RETURN OTHERWISE.
BC				; T3.RH HAS ARG0.RH.  T2 HAS DR11C NUMBER.
BDLSDRUMOVET3T1C	000335'	704406	000000	DLSDR:	UMOVE T3,(T1)
BHLRZT2T3C	000336'	554340	000010		HLRZ T2,T3		;DR11C NUMBER
BCAILET2NUMDRC	000337'	303340	000003		CAILE T2,NUMDR-1
BJRSTDLE0C	000340'	254000	000351'		 JRST DLE0		;ILLEGAL DR11C NUMBER.
BMOVEP1DRBATBT2C	000341'	200607	000063'		MOVE P1,DRBATB(T2)	;T2:=DR11C BASE ADDRESS.
BJRSTCPOPJ1C	000342'	254000	000313*		JRST CPOPJ1
BC
BC				;DLWAIT.  WAIT UNTIL PREDICATE TRUE (SKIPS).  PUT PREDICATE
BC				; BEFORE JSP T1,DLWAIT.  IF PREDICATE FAILS, SLEEPS FOR
BC				; A WHILE, THEN TRIES AGAIN.  UP TO 100 TRIES ARE ALLOWED.
BDLWAITMOVEIP2C	000343'	201640	777777	DLWAIT:	MOVEI P2,-1
BDLWT1MOVEIP3C	000344'	201700	000002	DLWT1:	MOVEI P3,2		;RESCHEDULE
BC				;	SLEEP P3,	;**D* REMOVED ??
BXCTT1C	000345'	256006	777776		XCT -2(T1)		;EXECUTE TEST INSTRUCTION
BSOJGP2DLWT1C	000346'	367640	000344'		 SOJG P2,DLWT1		;RE EXECUTE LOOP IF TEST FAILED
BJUMPEP2DLE1C	000347'	322640	000352'		JUMPE P2,DLE1		;GO HANDLE ERROR IF P2 WENT TO ZERO
BJRSTT1C	000350'	254006	000000		JRST (T1)		;TEST SUCCEEDED-  RETURN TO CALLER
BC
BC				;ROUTINES FOR RETURNING ERROR CODES.
BDLE0JSPT1DLERRC	000351'	265300	000354'	DLE0:	JSP T1,DLERR
BDLE1JSPT1DLERRC	000352'	265300	000354'	DLE1:	JSP T1,DLERR
BDLE2JSPT1DLERRC	000353'	265300	000354'	DLE2:	JSP T1,DLERR
BDLERRHRRZIT1DLE0T1C	000354'	551306	000000*	DLERR:	HRRZI T1,-DLE0+1(T1)
BJRSTCPOPJ1C	000355'	254000	000342*		JRST CPOPJ1
BC
BC				;ROUTINE TO SETUP EPT FOR DR INTERRUPT PROTECTION. /GL 7-1-80
BDRPROTC	000356'			DRPROT::		;DESTROYS T1
BDRXJSRJRSTDY1CNTC	000356'	254000	000367'		DRXJSR(1,3,300)
BDX1INTEXPC	000357'	000000	000000
BAOSDX1CNTC	000360'	350000	000362'
BJENDX1INTDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-6
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC	000361'	254520	000357'
BDX1CNTEXPC	000362'	000000	000000
BDY1INTEXPC	000363'	000000	000000
BAOSDY1CNTC	000364'	350000	000366'
BJENDY1INTC	000365'	254520	000363'
BDY1CNTEXPC	000366'	000000	000000
BMOVET2EPTC	000367'	200340	000103*
BMOVET1JSRDX1INTC	000370'	200300	000453'
BMOVEMT1T2C	000371'	202307	000060
BHRRIT1DY1INTC	000372'	541300	000363'
BMOVEMT1T2C	000373'	202307	000061
BC						;DR#,UBA#,11VECTOR
BDRXJSRJRSTDY2CNTC	000374'	254000	000405'		DRXJSR(2,3,310)
BDX2INTEXPC	000375'	000000	000000
BAOSDX2CNTC	000376'	350000	000400'
BJENDX2INTC	000377'	254520	000375'
BDX2CNTEXPC	000400'	000000	000000
BDY2INTEXPC	000401'	000000	000000
BAOSDY2CNTC	000402'	350000	000404'
BJENDY2INTC	000403'	254520	000401'
BDY2CNTEXPC	000404'	000000	000000
BMOVET2EPTC	000405'	200340	000103*
BMOVET1JSRDX2INTC	000406'	200300	000454'
BMOVEMT1T2C	000407'	202307	000062
BHRRIT1DY2INTC	000410'	541300	000401'
BMOVEMT1T2C	000411'	202307	000063
BDRXJSRJRSTDY3CNTC	000412'	254000	000423'		DRXJSR(3,3,320)
BDX3INTEXPC	000413'	000000	000000
BAOSDX3CNTC	000414'	350000	000416'
BJENDX3INTC	000415'	254520	000413'
BDX3CNTEXPC	000416'	000000	000000
BDY3INTEXPC	000417'	000000	000000
BAOSDY3CNTC	000420'	350000	000422'
BJENDY3INTC	000421'	254520	000417'
BDY3CNTEXPC	000422'	000000	000000
BMOVET2EPTC	000423'	200340	000103*
BMOVET1JSRDX3INTC	000424'	200300	000455'
BMOVEMT1T2C	000425'	202307	000064
BHRRIT1DY3INTC	000426'	541300	000417'
BMOVEMT1T2C	000427'	202307	000065
BDRXJSRJRSTDY4CNTC	000430'	254000	000441'		DRXJSR(4,3,330)
BDX4INTEXPC	000431'	000000	000000
BAOSDX4CNTC	000432'	350000	000434'
BJENDX4INTC	000433'	254520	000431'
BDX4CNTEXPC	000434'	000000	000000
BDY4INTEXPC	000435'	000000	000000
BAOSDY4CNTC	000436'	350000	000440'
BJENDY4INTC	000437'	254520	000435'
BDY4CNTEXPC	000440'	000000	000000
BMOVET2EPTC	000441'	200340	000103*
BMOVET1JSRDX4INTC	000442'	200300	000456'
BMOVEMT1T2C	000443'	202307	000066
BHRRIT1DY4INTC	000444'	541300	000435'
BMOVEMT1T2DCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 2-7
CIOPR.MAC	17-SEP-87 16:44		Dispatch for KS version of CIOPR

BC	000445'	202307	000067
BPOPJPC	000446'	263040	000000		POPJ	P,
BC
BCQ				> ;END IFCPU (KS) STARTING PAGE 1.
BSUBTTLDCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 3
CIOPR.MAC	17-SEP-87 16:44		Dispatch for F3 version of CIOPR

BC				SUBTTL	Dispatch for F3 version of CIOPR
BC
BIFCPUCPZZIRPIFECPUTYPCPUF3REPEATCPZZC				IFCPU (F3),<
BC				;FUNCTION HANDLERS ARE PASSED ADR OF ARG BLOCK IN T1.RH.
BC				;SINGLE RETURN IF FUNCTION EXECUTED NORMALLY.
BC				;ON ERROR, SKIP RETURN WITH ERROR CODE IN T1.
BC				DLFT:	PUSHJ	P,DLSCI		;0 SELECT COMMUNICATIONS INTERFACE.
BC					PUSHJ	P,DLSEDR	;1 PREPARE DR11C FOR DATA.
BC					PUSHJ	P,DLWDR		;2 WRITE WORD TO DR11C.
BC					PUSHJ	P,DLRDR		;3 READ WORD FROM DR11C.
BC					PUSHJ	P,DLDDR		;4 RELEASE DR11C TO KMC & NEXILIS NODE.
BC					PUSHJ	P,DLKMCD	;5 GIVES ERROR RETURN IF KMCDO IS 0
BC				DLFTL==.-DLFT
BC				
BC				;ERROR CODE RETURNS
BC				ERRET0:	JSP T1,ERRETN	;ERROR RETURN WITH T1/ ERROR CODE
BC				ERRET1:	JSP T1,ERRETN
BC				ERRET2:	JSP T1,ERRETN
BC				ERRETN:	HRRZI T1,-ERRET0+1(T1)
BC					JRST CPOPJ1
BC				
BC				
BC				
BC				DLSCI:	UHRRZ	T2,(T1)		;(0) GET INTERFACE TYPE
BC					SETZM	T1
BC					CAIE	T2,2		;ONLY TYMBASE IS LEGAL
BC					 JRST	ERRET0		;ERROR RETURN 0
BC					POPJ	P,		;NON-ERROR RETURN
BC				repeat 10,<jfcl>
BC				
BC				DLSEDR:	UMOVE	T3,(T1)	        ;(1) SELECT DR
BC					SETZM	T1
BC					HLRZ	T2,T3		;/T2 INTERFACE NUMBER
BC					CAIE	T2,0		;ONLY ALLOWED TO SELECT DR 0
BC					 JRST ERRET0
BC					POPJ P,
BC				repeat 10,<jfcl>
BC				
BC				DLWDR:	UMOVE	T3,(T1)		;(2) WRITE TO DR
BC					SETZM	T1
BC					HLRZ	T2,T3		;/T2 INTERFACE NUMBER
BC					CAIE	T2,0
BC					 JRST	ERRET0
BC				PRINTF	(<[No code to let F3 load its own base]>)
BC					POPJ	P,		;NOOP
BC				repeat 10,<jfcl>
BC				
BC				DLRDR:	UMOVE	T3,(T1)		;(3) READ FROM DR
BC					SETZM	T1
BC					HLRZ	T2,T3		;/T2 INTERFACE NUMBER
BC					CAIE	T2,0
BC					 JRST	ERRET0
BC					POPJ	P,		;NOOP
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 3-2
CIOPR.MAC	17-SEP-87 16:44		Dispatch for F3 version of CIOPR

BC				repeat 10,<jfcl>
BC				
BC				DLDDR:	UMOVE	T3,(T1)		;(4) DONE WITH DR
BC					SETZM	T1
BC					HLRZ	T2,T3		;/T2 INTERFACE NUMBER
BC					CAIE	T2,0
BC					 JRST	ERRET0
BC					POPJ	P,		;NOOP
BC				repeat 10,<jfcl>
BC				
BC				DLKMCD:	SETOM	T1		;(5) CHECK IF KMCDO IS SET
BC					JRST	CPOPJ1		;SKIP RETURN FOR ERROR (NO KMC ON F3s)
BC				repeat 10,<jfcl>
BC				
BC				>  ;End IFCPU(F3)
BC
B$ENDCIOLITLITC	000447'	474300	000000		$END	(CIO)

BC	000450'	254000	000011'

BC	000451'	550346	000000

BC	000452'	264000	000001

BC	000453'	264000	000357'

BC	000454'	264000	000375'

BC	000455'	264000	000413'

BC	000456'	264000	000431'

BCIOENDENDC						;End of CIOSER (CIOLIT: CIOEND:)
BCIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89
CIOPR.MAC	17-SEP-87 16:44		C
?1 ERROR DETECTED
PROGRAM BREAK IS 000457
7K CORE USED
CIOPR UUO TO FIDDLE WITH COMMUNICATIONS INTERFACE.	MACRO 12.5-46.0 17:23  6-JUL-89 PAGE 4
CIOPR.MAC	17-SEP-87 16:44		SYMBOL TABLE

BCIO	715000	000000		DLUIR0		000176'		DY4CNT		000440'		
BIT		100000	SPD	DLUIR1		000205'		DY4INT		000435'		
BSIO	714000	000000		DLWAIT		000343'		DZDO		000224'	EXT	
CH6		000166'	EXT	DLWDR		000231'		DZINI		000225'	EXT	
CH6KST		000146'	EXT	DLWT1		000344'		DZPINT		000157'	EXT	
CH6LK		000142'	EXT	DR0BA		767770	SPD	DZREM		000155'	EXT	
CH7		000156'	EXT	DR0IR		000014'		EPT		000000	EXT	
CH7LK		000135'	EXT	DR0IRF		000013'		IROFS		000000	SPD	
CI.OPR		000003'	INT	DR0OD		000020'		KMCDO		000331'	EXT	
CIOEND		000456'	INT	DR0ODF		000017'		KRFMD		000002	SPD	
CIOLIT		000447'	INT	DR0VL		000060	SPD	LI.PIF		000400	SPD	
CIOPR		000000'	ENT	DR1BA		767760	SPD	LI.PIN		000200	SPD	
CLKDR		000126'	EXT	DR1IR		000024'		NODIE		000000	EXT	
CONINT		000167'	EXT	DR1IRF		000023'		NOWIN		000217'	EXT	
CPOPJ		000000	EXT	DR1OD		000030'		NUMDR		000004	SPD	
CPOPJ1		000355'	EXT	DR1ODF		000027'		ODOFS		000001	SPD	
CPUF3		000004	SPD	DR1VL		000062	SPD	P		000001	INT	
CPUKS		000003	SPD	DR2BA		767750	SPD	P1		000014	INT	
CPUTYP		000003	SPD	DR2IR		000034'		P2		000015	INT	
CPZZ		000000	SPD	DR2IRF		000033'		P3		000016	INT	
CSR		000004	SPD	DR2OD		000040'		PERINT		000163'	EXT	
CSR0		000001	SPD	DR2ODF		000037'		PX.MEM		000004	SPD	
CSR1		000002	SPD	DR2VL		000064	SPD	PXCT	256000	000000		
CSRIEA		000100	SPD	DR3BA		767740	SPD	RDIO	712000	000000		
CSRIEB		000040	SPD	DR3IR		000044'		S$ENTR	777777	777775	SIN	
CSRRA		000200	SPD	DR3IRF		000043'		S$HALT	777777	777777	SIN	
CSRRB		100000	SPD	DR3OD		000050'		S$NAME		000000'	SPD	
CTYDO		000325'	EXT	DR3ODF		000047'		S$NONA		000000	SIN	
CTYSET		000220'	EXT	DR3VL		000066	SPD	S$TEMP		000000	SPD	
DIE		000000'	EXT	DRBATB		000063'		S$XCT	777777	777776	SIN	
DLDDR		000312'		DRCSR		000000	SPD	T1		000006	INT	
DLDDR1		000316'		DRDO		000211'	EXT	T2		000007	INT	
DLE0		000351'		DRFLTB		000057'		T3		000010	INT	
DLE1		000352'		DRFN		000001	SPD	T4		000011	INT	
DLE2		000353'		DRIB		000004	SPD	UMOVE	704000	000000		
DLEE		000011'		DRINI		000212'	EXT	UMOVEM	705000	000000		
DLERR		000354'		DRIVTB		000053'		W		000012	INT	
DLFT		000067'		DROB		000002	SPD	WRIO	713000	000000		
DLFTL		000006	SPD	DRPROT		000356'	INT	WRPI	700600	000000		
DLICTY		000215'		DX1CNT		000362'		ZZ	000050	626272	SPD	
DLIDR		000210'		DX1INT		000357'		
DLIDZ		000223'		DX2CNT		000400'		
DLINN		000230'		DX2INT		000375'		
DLKMCD		000075'		DX3CNT		000416'		
DLRCTY		000134'		DX3INT		000413'		
DLRDR		000246'		DX4CNT		000434'		
DLRDRI		000122'		DX4INT		000431'		
DLRDZ		000154'		DY1CNT		000366'		
DLREI		000111'		DY1INT		000363'		
DLSCI		000100'		DY2CNT		000404'		
DLSDR		000335'		DY2INT		000401'		
DLSEDR		000264'		DY3CNT		000422'		
DLUIR		000175'		DY3INT		000417'		
  |K{ˆ