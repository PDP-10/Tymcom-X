
/GA



/F01
----

SCNSER
1) CHANGES TO PREPARE FOR TTY PASSING: ALL INTERRUPT ASSIGNMENTS
   STORED IN DDB, NONE IN LDB, TABS-AS-BREAKS AND NO HT/VT/FF ECHO
   BITS, AND IMAGE BREAK CHARACTER STORED IN DDB AND COPIED TO
   LDB ON ATTACH
2) POSSIBLE PERFORMANCE IMPROVEMENT (WE'LL SEE): TTY OUTPUT
   HIGH AND LOW-WATER MARKS ARE NOW CHANGABLE AT RUN TIME, AND
   THERE ARE DIFFERENT VALUES FOR SLOW (<1200) AND FAST (>1200)
   LINES. CELLS ARE
	OMX30	LIKE OLD TOCMAX -- # UNOUTPUT CHARACTERS PERMITTED
		BEFORE MONITOR PUTS YOU TO SLEEP
	OMX120	SAME BUT FOR FAST LINES
	OWK30	# UNOUTPUT CHARACTERS AT WHICH MONITOR WAKES YOU
		UP AGAIN (WAS THE CONSTANT 0)
	OWK120	SAME BUT FOR FAST LINES
	TOEMAX	LIKE OLD TOEMAX BUT A CELL NOT A CONSTANT
   THIS WAS ALL DONE BECAUSE OF THE OBSERVATION THAT ON 33 BLOCK
   OUTPUT SEEMED TO BE RIDICULOUSLY FASTER THAN ORDINARY OUTPUT
   AND THE HYPOTHESIS THAT THIS WAS DUE TO INADEQUATE BUFFERING.
   (ONE WOULD THINK TYMNET'S BUFFERING WOULD BE ENOUGH, AND THAT
   IS INDEED THE CASE IN EXPERIMENTS ON 37, SO MAYBE THE PROBLEM'S
   ELSEWHERE).
3) TTY RXE AND TTY NO RXE SET AND CLEAR THE REVERSE X-ENABLE
   PARAMETER
MCB 1/25/79

SCNSER
BUG FIX TO CHARACTERS-LOST CODE (FOUND BY EVS, FIXED BY MCB 1/25/79)

PICON
Fixed bug in code to check for AC stack about to overflow in
STKAC (KL). Ernie found this when looking at an unrelated crash.
/WRS 1-26-79

/F02
----

SCNSER BUGFIX AT SCNOUT TO TAKE INTO ACCOUNT THE FACT THAT
SNDBIO CAN SKIP-RETURN. /MCB 1-26-79

/f03
----

scnser bugfix at tinas1 to make HIBERs work better. /MCB

/F04
----

SCNSER
TTY DEF COMMAND (AND AUXCAL FUNCTION '63) KEEP PORT IN DEFERRED
ECHO FOREVER, THUS MAKING TYPEAHEAD WORK FOR THOSE WHO CARE.
/MCB 1-29-79

COMCON
Fixed bug where "E" and "VERSION" commands don't wait for IO
to complete.  This involved setting NOTIC in the flaggs for
these commands.  /WRS 1-29-79

UUOCON

UUOCON$: added the SETALP uuo, and a call for the RUNALP uuo.
	Changed SETJAL to do KJP for JL'd processes.  /WRS 2-24-79

CLOCK1$: changed KSTOP to clear JBTSTS[kjp] and also made things
	a little neeter.  /WRS 2-24-79














/03
---

CLOCK1$: ignore tru limit exceeded if KJP set in JBTSTS /WRS 2-26-79

SEGCON$: changed RUNALP uuo to be LOGOFF uuo.  If not called by
	logout program (indicated by JBTSTS[kjp]=0), then it
	will run the real logout program.  Otherwise, same funct
	as before.  /WRS 2-26-79

COMMON$: CLOCK1$: SEGCON$: UUOCON$: removed UPSALP bit from UPTSTS
	in lieu of it being implied by UPTALN neq 0.  /WRS 2-26-79














/04
---

SCNSER$: changed code in GETLCH so it will return bit 100000
	(GTLECS) eat command synch - when a command is available
	for rescan.  /WRS 2-28-79

Added new FRMSER module - will contain code that handles frame trees,
creating and destroying frames, etc. /EVS 3-9-79

SCNSER
New AUXCAL function, .AXSFS, function '64, like function '32, it
sets the port's file status bits from the (immediate) argument.
It then sets/clears the port's image state according to the data
mode set (previously, this didn't occur until the next i/o
operation). /MB 3-12-79














/05
---

Created new symbol HPGONC in ONCE, which is the symbol
used when moving the ONCE code and data to the highest
possible place away from the rest of the monitor.
Formerly, it was the magic number 337, but now the monitor won't
fit below 340000 if loaded with EDDT and symbols - the dynamically
allocated free core overwrites the physical pages that ONCE lives in.
More has to be done to remedy this situation.
/EVS 3-15-79

Changed ONCE code not to reference the ONCE PCBs by physical
location. This is necessary so that the ONCE PCBs can live
at addresses over 337777. In the future, must map the ONCE only
DDB (DDSTAR has the address of this) so that it too can be over
337777. /EVS 3-15-79

Installed new monitor user mode simulator in module DEBUG.
Documentation of some sort will be provided at a later date.
To use, get monitor file, say MONDEB$G, then 2 control b (as usual
for debugging) and 140$g.
Currently, you must be the only user running the simulator
who is GFDed to the directory you are GFDed to. This will
be fixed in the future. /EVS 3-18-79

Put missing CLRPTA into OPCBST. ONCE code was setting up
PGY tables in exec page map, then using them without making
sure the mapping took effect. /EVS 3-19-79

Re-arranged OPCBST/OPCBCL code to clear out stuff before invalidating
the page map pointers needed instead of after. Worked in present
system since the CLRPTA installed in this code (see above)
wasn't there, so mappings were still in effect, but simulator
dies right away. /EVS 3-21-79

Fixed bug in MPSUPS originally found by Lee - test on loop
is backwards, resulting in page table not getting cleared.
/EVS 3-21-79

Fixed bug in MAPUPS, test on loop is backwards, just like MPSUPS.
/EVS 3-21-79

Preserve location 66 in ONCE init code to keep out of simulators
way until a new uuo is written to replace location 66
(illegal instruction is stored there). /EVS 3-22-79

CLOCK1 STTIOD AND SETIOD NOW CHECK THAT TARGET JOB IS NOT
	IN SW STATE; IF SO,CRASH. THIS MAY HELP TO TRACK THE
	CAUSE OF CRASHES SEEN WHERE JOB WAKES UP BEFORE I/O
	COMPLETES (OR EVEN STARTS) ON PCB PAGE. ON H31 THIS
	HAPPENED DURING MAP OF A UFD PAGE SEARCHING DURING ENTER. /AA
	/AA 3-28-79

Got rid of HPGONC. ONCE code and ONCE PCBs, PGY tables, and DDB are
now physically relocated to just below the first hole in memory.
(Virtual addresses remain the same). See the new comment in the ONCE
module for a description of where everthing lives. /EVS 4-2-79

Monitor now will use the exec virtual address space (400-???)
to access free core, pgy tables, etc. See comment in ONCE.
New macros and symbols in S.MAC determine where the start
of exec address space is for this purpose and where the
ONCE code lives in virtual address space. This was done
to allow larger configurations to be generated without
running into the 340000 limit. /EVS 4-2-79

Bug in error messages for KL version of the monitor at
PTSML - would never print out the message. Fixed the bug.
/EVS 4-2-79

Took the exec mode simulator out of DEBUG module, created new
module SIMKL. This way, can use the simulator to debug other
exec mode programs. /EVS 4-2-79














/06
---

SCNSER
Block i/o fix. (SCNSER smerged to agree with P033/G02). /MCB 4-3-79

CORE1
MWS fixes and parameter tweaks. (CORE1 smerged to agree with
P033/G02). /MCB 4-3-79














/07
---

SCNSER smerged to agree with P033/G03. /MCB 4-6-79

Installed frame descriptor code into all VUUOs that take
"other frame bit" argument. Changed SETOTF to take a frame
descriptor rather than a job number. /EVS 4-6-79

Changed CREFRM UUO to return a 2 word universal frame descriptor in
AC and AC+1. /EVS 4-5-79

Put access rights and frame handle tables into the context pages.
Put frame descriptor, frame handle, and access rights code
definitions into S.MAC. /EVS 4-5-79

Changed SETLIC uuo so it will only write a stream accounting record
in the event that the job half of JBTLIC is affected.  /WRS 4-9-79

Changed STOLM?, SETLM? routines to clear page table after page
map slot is stored, rather than before to guard against
hardware dragging old slot contents back into paging memory
before new slot contents are stored. /EVS 4-13-79

Reference bit trapping is implemented. /EVS 4-13-79

Two new page fault information UUOs - PGRSTS, and PGISTS.
These UUOs return up to two words, like PGFSTS and PERSTS do,
first a user word then an exec word. In PGRSTS, the
left half contains 1b0 if the data is valid, and the right
half contains the address of the fault location which had
the reference bit off. If the monitor turns a ref bit on
or the user program can't take the trap, the exec word
is set. In PGISTS, the right half contains the software page
fail bits (SPFW.?) and the left half contains the address
of the ILL MEM REF, write violation or address break.
SPFW.U is always set, and reading the words with PGISTS always
sets them to zero, so check for existence is SPFW.U.
/EVS 4-13-79

UUO SPECIFIES ILLEGAL ADDRESS message has been changed to
ILL MEM REF IN UUO FOR LOCATION xxxxxx (PAGE xxxxxx on KI)
ILL MEM REF message now prints location instead of page on
KL processors. ADDRESS CHECK for DEVICE xxx changed to
print failing location. /EVS 4-13-79

PICON$: fixed the WAKE uuo to not write anywhere in exec space.
/wrs 4-18-79

UUOCON$: changed SETE password /wrs 4-19-79

Fixed CTYTYO in SCNSER to do filler characters, and to not
loop forever if the -11 is down. /EVS 4-20-79

New FRMOP functions to start and stop frames. /EVS 4-20-79

Replaced CLRPTA with CLRPTO %UPS in ONCE at PGSLP+??. /EVS 4-20-79

Changed message for per job exec address space address breaks
not to try to type error message out. Now sets UTRP and
UPSABK so that the correct message comes out at USRXIT.
/EVS 4-20-79

Implemented new set address break uuo. Format is same as KL
DATAO APR format. Zero argument means clear.
Can only set to exec address space if
process has WC license. /EVS 4-20-79

Exec address space per job address breaks now save all the ACs
in global table ABKACS. CAUTION: Do not set exec address space
breaks at interrupt level routines or in the context switching
code. The STKAC and KTRRET routines will not operate
correctly in this case. /EVS 4-20-79
/09
---

SCNSER smerged to agree with P033/J04. /MCB 5-16-79
(This included the following change. /EVS)
SCNSER:
Fixed code at BIOZAP (zap of circuit in block mode) to NOT
force the job out of BF wait, since this confuses the extra-
buffer allocator. This bug may have caused some crashes on 29.
/MCB 5-15-79

ACTSER: Fixed bug where AC owner had pending software interrupt
(JBTAWQ sign bit on) and exited GETABS routine thru ABTUUO,
but didn't give back AC. Fix is just to call RELACB. /EVS
5-18-79.

ERRCON$: updated to reflect P033/J12 changes regarding error in
detached jobs putting OPR: in monitor mode.  /WRS 31-May-79
(This included the following change. /EVS)
ERRCON$: Fixed problem causing a message from an error on a detached
job to force OPR: into monitor mode.  U was getting setup to OPR: by
TTYERP and was left that way when HOLD was called.  New JHOLD and JHOLD0
which setup U before calling HOLD and HOLD0 respectively. /WRS 31-May-79

ERRCON$: Cosmetic changes to output from ERRCON. /WRS 5-31-79


SEGCON: updated to reflect P033/J11 changes in MAPHS
to close security gap with GETSEG of SWR file. /aa 1-Jun-79














/10
---

SMERGE bring P034 completely in line with changes made
from monitors P033/HA to P033/K03 that hadn't been edited into
P034. The following changes were SMERGEd in: (/EVS)
SCNSER:
Added code to do upper to lower case conversion on output at
user's option.  Involved adding a new output mode (3) to the
character table, another flag to LDBDCX (LXLLCO), code to
perform conversion if LXLLCO set, new AUXCAL (65) and TTY
command option (UCO) to set/clear LXLLCO.  This [hack] is
needed by APL 2741s which don't like upper case. /TLC 5-18-79

S CLOCK1 SCHED1 SCNSER
Rewrote block i/o buffer-reservation and base-port allocation logic.
There is now one queue, BPQ, for waiting for a base port, and one
queue, BBQ, for waiting for a monitor block i/o buffer. A base port
is what the TYPNEG message negotiates for: it is a slot in the base
which holds a port number, an input buffer address, and an output
buffer address. Whenever a port goes from doing neither block
input or output to doing one or both, it gets a base port. There
can be more PDP10 ports doing block i/o than there are base slots;
in such cases, the BPQ gets used to multiplex the base slots among
the jobs. BIOCNT.rh is the number of PDP10 ports, BIOPRT the
number of base ports. BIOBUF is the number of monitor buffers,
which is determined by the routine BLKADJ, which now makes
BIOBUF = BIOPRT+2 if it can (this lets 2 people do full-duplex
block i/o with no contention for monitor buffers).
/MCB 5-21-79

SCNSER
No longer sends a bell at RECHT1 if port is in image state,
per request from TYMNET.
/MCB 5-21-79

S CLOCK1 SCHED1 SCNSER
No more BBQ and no more BLKADJ. Buffers are allocated on demand
(with the jobs possibly going into FC wait). When released, they
go into a block buffer pool if noone's in FC wait; otherwise, they
get returned to freecore. SCNSEC will move a buffer from the
block pool to freecore if it finds FCREQ >= 0 (and, of course,
if there is a free buffer). BIOBUF is the number of block buffers
and BBFREE the number of free buffers in the block i/o pool.
.AXEBM never fail-returns due to a lack of freecore.
/MCB 5-23-79

SCNSER
Removed crash-causing BLKICK at BLKIHR (it's ok to get an
input-terminated-by-host-request when there're no block
buffers). Also made BLKIO (.AXEBM) error-return if the base
gave us zero block ports.
/MCB 5-24-79

SCNSER:
SCNSER, COMCON:  Modified TALK command so that lower case is not
upshifted.  COMTYI made to inhibit upshifting when TRNCOM is
not equal to zero. /TLC 5-30-79

COMCON$: Added APL and TERMIN commands which run program of same name
on SYS:   /WRS 1-Jun-79

SCHED1:  IMPLEMENTED "OUTJOB" AND "BIGFIT" IN SWAPPER. ELIMINATED
SIPQTA LIMITATION ON JOBS ENTERING SWAPPER.  OUTJOB IS THE JOB
WHICH SWOSCN EATS AWAY AT FROM CYCLE TO CYCLE.  BIGFIT IS THE
JOB WITH SEVERAL PAGES NEEDING TO COME IN WHICH THE SWAPPER IS
CURRENTLY TRYING TO GET IN.  ONE BIGFIT JOB AND ANY NUMBER OF
OTHER MRQ'D JOBS WITH FEWER PAGES NEEDED CAN GET SWAPPER
SERVICE ANY CYCLE. /AA 6-1-79

FIXED MODS TO /J13 - BIGFIT MODIFICATION. /EVS 6-1-79

TVEDIT command runs RPG - for future.  /WRS 2-Jun-79

Changed SETICP to be set with MRQ as soon as OUTJOB is set.
No more page quota for OUTJOB which delays setting SETICP for now.
/EVS 6-5-79

Put special TRACE macro into SCHED1, puts information into trace buffer.
Feature enabled by defining SCDTRC symbol. /EVS 6-5-79

Added another TRACE macro. /EVS 6-5-79
SCNSER,COMCON: CHANGED IMPLEMENTATION OF TRANSPARENT TALK.
NOW DOES NOT USE FLAG, INSTEAD COMTYI GIVEN TWO ENTRY POINTS:
COMTYI WHICH UPSHIFTS INPUT; COMTYT WHICH DOES NOT.  ALSO
LEADING BLANK DELETION (ETC) WAS REMOVED FROM TALK. /TLC 6-8-79

Changed TRACE macros to have a type number instead of storing
the traced instruction in the ring. Changed the macros always
to store 2 data items in the buffer so the records are always
fixed length. Took out TRACE macros that traced FIT getting
set up. These changes were made for the new TRACES program
that reads the buffer and prints a diagram representing
the state of the scheduler and swapper. /EVS 6-8-79

SCHED1:  Added counters SSTC0 thru SSTC9 which can be hooked up
to any code of interest by patching running monitor.  Also modified
ICP to look at these and print them out as SSTCn  xx counts/second
if they are found changing.  /aa 6-8-79













/11
---

SMERGE fixes to TALK command in from P033, and POSAVL fix
into scheduler. Also, new counters into scheduler.
Following are the changes from P033.MEM. /EVS 6-12-79

SCHED1:  Added counters BIGCNT,OUTCNT,EATCNT.  These count
jobs chosen for BIGFIT, chosen as OUTJOB and totally eaten in
SWOCTX,respectively.  /AA 6-8-79

SCHED1:  Fixed SWOSCN logic re POSAVL.  Code will now
compute POSAVL the first time it is forced to do a scan.
(This may not happen for many ticks if OUTJOB lasts). /AA 6-8-79
---------(end of text from P033.MEM)

Fix simulator bug that caused JEN and JRSTF not to restore
first part done in PC. /EVS 6-12-79














/12
---

SEGCON:  Fixed bug in save code and readls which would compute
length of saved area to be <0 if JOBFF>400000+JOBSV-1
(ie, greater than 400076).  Problem lay with several HLRE instrs
which are now HLRO instrs so that -length is always
<0 even if bit 18 of -length is 0 (which happens whenever
length=(jobff)-1-jobsv-1>400000. /AA 6-13-79

SCNSER: fixed comment at HNGELS about last job on quque for
spare ldb having 0 lh in ttytab.  He has -1 in lh. code was right.
Fixed TTYATT to return F/0 if no tty ddb found (happens if target
job is on spare ldb queue).
COMCON:  ATT2A types "CANT ATT TO JOB" if ttyatt returns f/0
instead of using garbage in F /AA 6-13-79

Changed macros to define access rights bit tables and
access rights definitions ".AR???" in preparation
for translation from monitor to user access right bit map
functions. /EVS 6-13-79

COMMOD: Added LKBSIZ to LEVEL-D disk parameter table so user can
gettab the length of the longest meaningful lookup block...
GETTAB [20,,16].  /WRS 14-JUN-79

COMMOD: Fixed some problems where someone added two number 14 entries
in the LEVELD gettab table.  I changed all the comments and made a note
to change the documentation to reflect the way anyone who's using it
thinks it really is.  /WRS 15-JUN-79

COMCON: added TE to run RPG for TECO so TE still works in spite of
TERMIN command (especially for Mike Rude).  /WRS 21-Jun-79


MAPIO:  fixed VFSTAT uuo kernel KFILCK to call RELSAT if
GETSAT fail-returns;  old code assumed that no SAT mapped if
fail-return, but can have sat mapped if had to read it in
and SATCHK found it bad.  Call RELSAT unconditionally if
GETSAT fails; RELSAT does nothing if no sat there. /AA 6-22-79

Changed NUMCHN to 48. /EVS 6-27-79












/13
----

Simio: Fixed bug which left microcycle clock on if doing
dump output. Now clock off during execution of dump
input or output. /AA 7-9-79

COMMON:  Revised method by which MINCOR = amount of freecore
is calculated.  A bug existed which I discovered in process
of trying to increase P90's freecore alloc by about 1K.
MINCOR and MINCLN are eliminated.  New calculation produces a
symbol FCWDS which includes a factor to account for
SPT usage.  Symbol SHRFPG can be defined in CONFIG as number
of expected shared file pages. New symbol FRECOR contains
value FCWDS uy once-time code to allocate freecore.  This
can be patched directly to increase the amount. /AA 7-9-79

CONFIG:  brought from OSCURRENT config changes for
C38 and P90.  38 gets 2 dsk controllers. P90 more jobs, etc. /AA 7-9-79

FRMSER,SEGCON,UUOCON,COMCON,COMMON:
Put new FRMOP function .FOSVA in - start a frame at one of its
start vector addresses. E points to -ve job data area offset
or +ve target process specified start vector address.












/14
---

SCNSER: Fixed bug in CTYCHR that didn't do the waiting count
correctly. /EVS 7-11-79












/15
----

SCNSER: FIXED HORRIBLE BUG WHICH WAS INTRODUCED WHEN FREECORE
VIRTUAL ADDRESSES BECAME DIFFERENT THAN PHYSICAL ADDRESSES.
MUST NOW DO MAP INSTRUCTIONS AT GOBIO2. /EVS 7-11-79












/16
----
UUOCON: ACTSER:  IMPLEMENT TRU COMPONENT CHECKPOINT RECORD
[TYPE 21 LENGTH 41] XC req'd Generated by [new] XCHARG fn 6 /AA 7-12-79

ADDED CAPABILITY TO ACTSER TO WRITE LOGIN RECORDS FOR FRAME CREATION
FRMOP. CHANGED .FOCFM TO WRITE THE LOGIN RECORD. /EVS 7-13-79

Fixed TTYNFR to set TTYATC (so code for forced commands won't think
it's an aux port) and PJOBN (for neatness) and clear rh(DDBLDB)
(superstition). /MB 7-16-79












/17
---

ACTSER: fixed bug in frame create FRMOP - routine in ACTSER was
using wrong size for login record. /EVS 7-16-79

UUOCON: removed requirement for JL from CONT uuo.  Can only protect
user so much from himself.  /WRS 7-16-79

ACTSER: Fixed confustion about symbol ACUTAB in WRTACR. /EVS 7-17-79

UUOCON: Added SETE password with all licenses for self. /TLC 7-18-79

S: Changed IO, MB, and WS state codes from SJ to DJ.
This fixes a bug - a job in IO wait could control C out,
and do a COMCON command that started a monitor job if JBTIOA
was zero - which zapped the state code. Meanwhile, there is still
a DDB with IOW set on it, which will cause SETIOD to get called
when the interrupt for the device comes in, or the device
becomes hung. Changed WS from SJ to DJ because there still might
be some code that calls WSYNC that assumes that either the
code will be continued or DHNG will be called. Since we have
changed IO and MB to DJ and RN is DJ, this is no great loss.
Put comment in S just before QUEUES and CODES macro definitions
to explain the rules for selecting SJ/DJ for a new or existing state
code. /EVS 7-19-79

ERRCON: Clear IOW in the DDB as well as IOACT so SETIOD won't
wake the job up in case we get an interrupt from the hung device
some time after hung code is called. Some drivers clear IOW themselves
and call SETIOD, and some don't, so this code is for safety.
/EVS 7-19-79

CONF90:  Increased P90's ports to ^D127 (avoiding 128 out of
 fear that a bug may exist at this boundary.) /AA 7-19-79

UUOCON:  replace mask 777700 with extern name JBRIRD
 from COMMOD in TRU calc in case byteptr ever changes. /AA 7-19-79












/B

/A01
---

SCNSER: Added capability to selectively place backspace in either
the BREAK or BREAK2 set. Default is BREAK (the reverse of tab).
New AUXCAL mode 66 selects break set: param LSB 1 gives BREAK2,
0 BREAK. Backspace break state is recorded in L2LBBP in LDB
and DCLBBP in DDB. L2LNXO moved to LDRNXO to make room for
L2LBBP. BS assigned SPAI code 17 and SPAR code 6. changes
made to input, echo, rubout, and output routines to recognize
new property of bs. Of special note: deleted bs with L2LBSP set
echos as SP; without L2LBSP set, echos nothing. SETTBK,
TTYRES (RESET UUO), and ATTLDB modified to accept new BS.
Minor bugs/typos detected and corrected in related
parts of SCNSER: previously no entry for BS in remote echo
code; wrong reg and flag tested in ATTLDB in instruction in code
to restore TABS-AS-BREAK condition. /TLC 7-20-79

/A02
---

UUOCON: Fixed VREPLC bug involving pickup of UPTOFD
"other frame" descriptor.  This bug was causing REMAP
to fail for MAGNUM people first day 034 was up on C33.
Actually, any remap would fail. /AA

SEGCON,SIMIO,SCHED1,S,UUOCON,CLOCK1,ONCE,COMMON,PICON,COMCON,ERRCON
NEW MODULE: ERRMSG.MAC

ALSO EFFECTED (DEVICE DEPENDENT BITS MOVED TO MAKE ROOM FOR NEW
DEVICE INDEPENDENT BIT IOHNG) PTPSER,FTASER,CDRSER,
ACTSER,LPTSER

Rewrote ERRCON to allow a parent frame to HIBER or interrupt
on child halting. Implemented new FRMOP which reads a halt
status block for a frame which contains halt class and type,
halt count, PC, last UUO PC, and halt type dependent data.
New module ERRMSG contains a macro definition which
should define all system error messages, except those
that come from commands. .FOHLT and .FOCLR will also
generate unique halt class-type numbers.
/EVS 8-1-79

ERRCON,SEGCON:
Changed some error messages - instead of JOB SETUP and JOB SAVED,
SEGCON now calls ERRCON which will print <filename> SETUP and
<filename> SAVED.
Instead of BETTER SPECIFY A CORE ARGUMENT it now prints
CORE ARGUMENT MUST BE SPECIFIED. Instead of REMAP UUO FAILURE
VM SPACE MANGLED it now prints REMAP UUO FAILURE DURING RUN OR
GET - the user can draw his own conclusions about what the address
space is worth after this error.

COMMON: Extensive cosmetic edit removing misleading and obsolete
comments, regrouping definitions, etc.  Introduced symbol
OPNFPF (Open Files Per Frame) INFDEF'd to 4, used to calculate
freecore requirements.  Fixed JSR LODBTS stuff in crash code.
COMMOD:  Introduced OPNFPF and new filser freecore requirement
calculations.  Deleted FIL4WD and SYS4WD calcs and replaced
with new symbol FFCBLK (Filser Free Core Blocks) which is
set to JOBN*<2+<2*OPNFPF>>; this allows average of 2 DRB's
(one each for logged-in and gfd'd ufd) and an ATB and FNB pair
for each of the OPNFPF files expected, per job.  /AA 8-1-79

UUOCON:
NEW HIBER enable bit for child frame exits enabled - bit 9.
/EVS 8-1-79


/A03
----

ERRMSG: Made a mistake and left TTY finishing routine arg blank
in the macros defining SETUP and SAVED exits - they were clearing
type ahead and they are not supposed to. /EVS 8-2-79

SCNSER/UUOCON: .STTLK SETUUO function ('10) to talk kludgily to
other people's terminals; RETACH UUO (calli -'135) to move
terminals around (generalized ATTACH). /MCB 8-2-79

Temporarily stopped HALT command from trying to
store into UPX even though its not always there.
Need to replace cal to STOP1 with call to something
that interrupts parent if he's enabled. /EVS 8-2-79

/A04
----

HALT FRMOPs and HALT commands no longer store termination status
in UPT, but do cause an interrupt in parent or traphandler.
When parent gets an interrupt and wants to see if frame has stopped,
it should keep track of whether it was running or not in its per-frame
database, and compare that against JBTSTS. /EVS 8-2-79

/A05
----


SCNSER: RETACH BUGFIXES /MCB 8-3-79

FIXED TRHALT NOT TO SKIP. /EVS 8-3-79

Put a primitive EBOX and MBOX simulation into SIMKL to chase
down a bug in WATCH statistics and microcycles.
Every time meter for a UPT is read, 20000 EBOX cycles
are simulated and 10000 MBOX cycles. /EVS 8-3-79

UUOCON: new sete password for me. /AA 8-3-79

UUOCON: Fixed bug in CLKTRU which incorrectly masked the
number of disk reads and writes obtained from JBTRCT and
JBTWCT. /EVS 8-3-79

/A06
----

SCNSER: Block i/o formerly kept every buffer it got from freecore
in a pool of its own unless it saw people in FC wait. Since some
people freak when there's no freecore instead of going into FC
wait, this might have been bad. Now, when a port stops being a
block port (BIODEC), it releases any block buffers in excess
of 2 * #block ports to freecore. The SCNSEC code to check FCREQ
and free a buffer has been removed. /MB 8-6-79


FRMSER: Fixed bug that left newly created frame in NU state,
which made subsequent start operations fail, since state code was
NU so SETRUN didn't cause frame to go into run queue. /EVS 8-6-79

SCNSER: CTYCHR routine - changed SPCTRY timeout from 40000
to 100000 - when cache was on, took more than 40000 counts for
KLDCP to finish with the character. /EVS 8-6-79

/A07
----

Fixed bug uncovered by fixing NU queue bug - was doing XORM assuming
JERR was off, but for previously used job slots, it was on, so XORM
was turning it off, allowing FRMOP that starts frame to call SETRUN
which started up job with no pc or exec acs. /EVS 8-6-79

/A08
----

Fixed sign error in BIODEC buffer-freeing code. /MB 8-7-79

ERRMSG:
Corrected erroneous error message REMAP UUO FAILURE DURING RUN OR GET
to be FATAL REMAP UUO FAILURE. /EVS 8-7-79

Changed HALT error message in SIMKL to be the authentic KLDCP
message. /EVS 8-7-79

FRMSER: SY license now allows some access through absolute
frame descriptors. /EVS 8-7-79

S: Unscrambled user access right numbers - they were scrabled for
test purposes. /EVS 8-7-79

Fixed bug in MAP instruction simulation in SIMKL.
Allowed simulated user IOT bit to allow simulated user to
execute simulated I/O instructions. /EVS 8-7-79

UUOCON: Added virtual PEEK, POKE, BITPOK capability to routines
of same name. Created new CALLI -125, NPEEK, which is now the heart
of PEEK that nonskip returns for error and skip returns if no error.
Sign bit of address to read or write if set indicates address is
virtural; if clear, physical. /TLC 8-8-79

MAPIO: Fixed bug in VFSTAT UUO - was returning VM page does not exist
because W was not setup to new call to REDLMA. /EVS 8-8-79

UUOCON: Chaged KERUUO to assume 1b0 is set already in T1 according
to caller's PC rather than setting it up. Changed VFSTAT to always
set 1b0 in T1 (would have crashed if it was clear). Changed
VCLEAR and VREMOV to get caller's PC from proper place
(PDNMUP(P)) and set or clear 1B0 in T1 accordingly before falling
into KERUUO. /EVS 8-9-79

UUOCON: Took extraneous MOVE T2,JOB out of GETTAB code - was left
over from HISEG days. /EVS 8-9-79

/A09
----

UUOCON: Fixed CONT uuo to error return if detached job.  /WRS 8-14-79

COMCON: Fixed ADRBRK command not to crash monitor when type
ADRBRK xxxxxx MONITOR <anything else> - call to CKSLC was returning
to main code after going thru COMERR, TTCMCA was zeroed,
and next call to COMERR looped. /EVS 8-14-79

SCNSER: Fixed code at TYICC to check for attachedness after job
continues from a ^C. /MCB 8-14-79

SCNSER: Added new flag, 1B14, to HANG UUO to facilitate elimination
of phantom circuits. When 1B14 is set and the specified port
has LDBLOG of zero, that port is hung; if LDBLOG <>0, error
return. /TLC 8-14-79

/A10
----

UUOCON$: SETE "broken" so will work over aux circuits.
	SETLIC "broken" so it will work over aux circuits provided
that the calling process has a MAXLIC with LICWCR.  /WRS 8-15-79

SCNSER: Fixed block i/o bug introduced in /A06 -- BIODEC thought
BIOCNT was really a count, and forgot that its left half could
contain a -1 flag. /MCB 8-16-79

SCNSER: New spare LDB code. Uses lh(TTYTAB) differently (see
comment at page 3 of HANG UUO) so it can remember for jobs on the
spare LDB waiting list whether the HANG that put them there
was forcing KJOB (bit 16) or not -- formerly it always assumed
it was. New code for circuit zap -- it is now guaranteed that
after returning from RCVZAP, the LDB is really detached.
/MCB 8-23-79

/A11
----

SCNSER: Fixes to new spare LDB code. /MCB 8-27-79

/A12
----

SCNSER: FIXES O NEW SPARE LDB CODE. /MCB 8-29-79

/A13
----

Backed up version of SCNSER to SCNSER.A95 (A09.5) which has
block I/O bug fixed but has old spare LDB code. /EVS 8-31-79

UUOCON: Split UUOCON into two modules, UUOCON and IOCSS.
UUOCON contains for the most part general UUO stuff,
and IOCSS has the I/O channel stuff. (IOCSS stands for IO common
subroutine service). /evs 8-31-79

Redefined frame descriptors. For new definitions, see FRMOP.DOC
in (MONDOC). Important change - GETTAB for job things will
return the values that SY license was required for if the caller
process has RC or WC. Non-job data still requires SY explicitly.
/EVS 8-31-79

Fixed horrendous bug that was causing two part instructions
(such as ILDB, IDPB, DMOVE, DMOVEM) not to execute first part
in software interrupt routines - monitor failed to clear
first part done (PC.FPD) in new PC if it was on in old PC.
PC.FPD will remain on until the first two part instruction is encountered.
Hardware PI system correctly preserves all flags except for turning
PC.FPD off, so CLKTRP now does just that. Also clear PC.ADR while
we were at it so that interrupt routine will not miss address break
if it gets one at the first instruction of the interrupt routine. /EVS 8-31-79

Change TIMINT in SIMKL to 70 octal so that simulator works better on
2020s. /EVS 8-31-79

/A14
----

SCNSER: Fixed misunderstandings at TTYKIL -- basically, when TTYKIL
is called from COMCON with F/ 0 and U/ "spare" LDB, it must NOT
call NXTFRC because there is no appropriate TTYTAB entry. The old
code "solved" this by not clearing lh(U) before comparing U with
LINTBE, which just happened to make it think it wasn't the spare
LDB after all in all the right cases. When I made the code clear
lh(U) in /A12, this broke down. Now things are a bit clearer.
/MCB 9-1-79

/A15
----

SIMKL: If SETABK fails (it will on KI) no longer a fatal error, just
informative message is printed out. /EVS 9-4-79

UUOCON: Fixed DONUMT to return address of NUMTAB if user asks for it.
/EVS 9-4-79

/A16
----

UUOCON: GETTAB CHANGE INCLUDED REMOVING TABLE 1
, BUT CHKPNT COUNTS ON GETTING A ZERO FOR ALL VALID JOB NUMBERS.
PUT TABLE 1 BACK IN. /EVS 9-4-79

/A17
----

PICON: WAKE and EVICT now take frame descriptors instead of job
numbers. /EVS 9-5-79

New CALLI - SETSTV (CALLI -137), takes count,,addr of start vector table
and stores into UPT, returns old setting in AC.
Start vector setting is cleared out after core image is setup, at same
time license is set. /EVS 9-5-79

/A18
----

Fix bug in create frame FRMOP error return, decremented pushdown
pointer one too many times. /EVS 9-6-79

/A19
----

S,FRMSER: Rewrote ABSACC and changed ARMAC arguments so that
each license can have its own table of access bits that it gives
the user of an absolute frame descriptor with that license.
The old scheme involved a ring of protection (WC,RC,SY,TP).
This change makes GETTAB work like it used to, i.e. RC and WC
no longer give SY kinds of access to frames. In fact, WC no longer
gives the ability to read another frame's ACs - they can only be written
unless the caller has RC as well. /EVS 9-10-79

/A20
----

SCNSER: Repair to code which processes HANGs on jobs already on
the spare LDB queue -- it formerly ORd the job # into the TTYTAB
entry. /MCB 9-21-79

SCNSER: RETACH recoded to check access rights, to have different
error codes, and to take more argument bits -- see the page before
the RETACH:: label for documentation. /MCB 9-21-79

SCNSER: New routine COMATT to perform certain functions common to
all attaching operations. Probably more such routines forthcoming.
/MCB 9-21-79

/A21

CONFIG: give V25 16 drives instead of 8 as per V. Hunter request.
	/AA 9-27-79

CONFIG: give C26,C29,C36 ^D30 SAT PCB's as per results of testing
	C36 and finding that overlaying out of COEES' 1ESORD.OVL
	was needing more SAT's than standard 15. This change was
	patched on C36, found good, and requested for 26,29.
	CONFIG for all systems changed to have parameters
	SPCBN ; number of SAT pcb's
	RPCBN ; number of RIB pcb's
	defined.  /AA 9-27-79 and 9-28-79

SCNSER: New TTY DDB bit, DCLCOM, reflects the setting of
LDLCOM at the time of the last detach. It is set to command
mode (1) by HANGs and command-port circuit zaps if the
job is not continue-on-disconnect, and by the detach
function of the ATTACH UUO. It is set to the current
LDLCOM setting by HANGs and zaps of continue-on-disconnect-job
command ports, and by RETACH. RETACH has a mode where it
will restore the state appropriately. RETACH has also been
changed to return the port number at the source end of the
TTY being moved. (In keeping with the future, it gets this
from rh(DEVNAM) rather than returning the actual host
port number).
/MCB 9-28-79

/A22

SCNSER: bugfix at NAMSCN. 200000 <= nam <= 270000 should be
200000 <= nam <= 272727. (PATCHED IN /A21-1)
/MCB 10-1-79

CONF90:  for SLIGOS, set BPAUN=^D16 (up from 14) and SHRFPG=1000
	(up from 500 as per Bernard). /AA 10-3-79

SCHED1: Changed
		CKJB0:	SKIPN	TIMEF
			JRST	...
			PUSHJ	p, ...
	to
		CKJB0:	PUSHJ	P, ...
so rescheduling always happend when the current job is unrunnable,
not just at clock ticks. This increases scheduler overhead slightly,
but reduces unnecessary null time.
/MCB 10-3-79


KS10 support added. New modules RMXKON (KS style disk driver),
DZKON (support for DZ11 driver, used when no network is connected
to the 20), DR11C (network base ring simulator), CIOPR
(communications interface handling module).
/ELB (/EVS) 10-3-79

Fixed bug in CMPLOG routine in FILUUO that caused unit within
structure name to get set to DKKB? instead of DSKB? when adding
a pack to an unrefreshed structure. /EVS/ELB 10-3-79

Fixed bug in VREPLC FRMOP that did not allow monitor to replicate
pages into per process area because PDNMUP(P) should have been
PDNMUP-1(P), so was checking user bit in wrong stack word. /EVS
/ELB 10-3-79

Fixed bug in examine/deposit into frame FRMOP (.FORVA and .FOWVA)
which did not handle negative args correctly - address is in right half
and left half is now ignored. /EVS 10-3-79

Added .FOGFT FRMOP, graft frames. See (MONDOC:37)FRMOP.DOC for
grafting description. /EVS 10-3-79

Fixed bug where read frame virtual address would fail on a page
with MAX WRITE off because monitor always tried to replicate the page
writably. /EVS 10-3-79.

SEGCON: Fixed bug so that MFR is not set up to all rights in the case
where HF is present on file, or file has a PID, since that would allow
anyone who ran a program with HF or PID in an inferior frame to
completely take advantage of the capability. /EVS 10-3-79

UUOCON: NEW SETE PASSWORD FOR /AAA 10-5-79

/A23
----

Added .FOCON FRMOP, continue a frame.
More efficient than reading PC and starting frame up with .FOSAA.
/EVS 10-8-79

S, KISYM, KLSYM: Fixed headers and deleted trailing RCREFs so that
now these modules will cref when compiled with COMMON. /TLC 10-8-79

/A24
----

.FOCON not sufficient for restarting frames - if halt a frame,
do an $X (deposits, starts), want to be able to restart the frame,
and continue will not work properly. Solution: change .FORPC
(read PC) to return c(UPTPDL)-1 if UPTPC is an exec mode PC.
So if frame is in the middle of a UUO when it was stopped,
PC will point to UUO and get PC and restart will work properly,
since if frame was stopped, code was arranged to UUO could be
restarted. /EVS 10-8-79

/A25
----

CONF35.MAC: NUMPRT==0  number of remote ports
MON35.CMD:  RMTSER/NOLOAD as per K. Carta; C35 no longer
has a remote base. /AA 10-9-79

CONF26
CONF29
CONF36	Withdrew the increase to 30 SAT pcb's until pcb lock
code can be fixed to allow more than 15. /aa 10-9-79

PICON: SNOOP code fixed at SNNMI stopping snoop interrupts.
This change is designed to eliminate the crash on timer overflow
which was crashing P90 when they used it.  Now we stop SNOOPI
by setting a flag which causes SNOOPI to restart regular
interval-timer interrupts at the end of the current "tick".
In SNNMI we just sleep for a second to let this happen. /aa 10-9-79

/A26
----

CORE1: Fixed bug that happened when frame went into CW. When it came out,
it put frame #,,frame# into UPTLKJ which screwed things up.
/EVS 10-10-79

PICON:	Fixed bug in EVICT uuo to prevent T1 from getting clobbered.
/WRS 10-11-79


ERRCON: If detached frame has a parent, no message is printed out
for monitor error messages. It is assumed that the parent will
print out the message. Messages will still be printed out for detached
orphan frames. Original intent of this is in case system jobs like
PJ and CHKPNT bomb out. /EVS 10-12-79

CORE1: Fixed bug where context page lock was given to two frames - the
code that woke up the next waiter left UPTLKJ zero, so if after waking
up the next frame to get the lock the frame tried to get the lock,
it got it because UPTLKJ was zero, and the waiting frame assumed
that it had the lock because it was awakened. Fix is to set UPTLKJ
at the time of assigning the interlock to the next waiter, and increment
UPTLKC. /EVS 10-12-79

/A27
----

COMCON, FRMSER: Fixed bug that caused frame tree to get screwed up.
When frame was killed, it orphaned all its children, but did not
take the killed frame away from its parent. /EVS 10-12-79

ERRCON: Fixed mis-SMERGE which had IFCPU(KI) instead of IFNCPU(KI)
around code at ERRSCP, causing KL and KS monitors not to print out
"FOR LOCATION ??". /EVS 10-12-79

FRMSER: Previous fix for .FORPC which decremented PC on stack was
not correct - if a job has a PC in the monitor and its state code
is not TI or SL, any attempt to start it will first run through
the rest of the monitor code it was in, and then USRXIT will
start the program at the new PC, which should be the location after
the UUO. If in TI or SL, however, the proper place to restart would
be at the UUO itself. Therefore, .FORPC has been changed to
return the actual PC on UPTPDL if not in TI or SL, and c(UPTPDL)-1
if is TI or SL. /EVS 10-12-79

/A28
----

FRMSER: Changed some erroneous comments in CREFRM, PSHARG. No source
code changed. /EVS 10-17-79

COMMOD: Fixed bad UNYOS and UNYRCO byte pointers - used UNS???
to address unit data block locations instead of UNI???. /EVS 10-17-79

COMMOD, FILIO, BPXKON, RMXKON: Took device dependent code that was checking
at runtime for TYPRM in FILIO away.
To add insult to injury, this code was also under IFCPU(KS) conditional,
when actually it is possible that in the future KS will have different
disks other than RM03 disks. Added new device dependent routines
called thru KONSFT and KONHRD, which calls the device service routine
on soft and hard errors respectively. For BP units, just a noop, but
for RM units, copies the RH11 registers into the proper unit data block
locations. /EVS 10-17-79

DR11C:  Fixed bug which caused block mode output header message to be dropped
when block mode output requests were adjacent and interrupt activity was high.
Also added comments to most of the code. JRG/18-oct-79

SCNSER: Removed STOPCD in NXTFRC when it finds a job on the spare
LDB queue which has no TTYTAB entry -- it is indeed possible for
the job to have killed itself while on the spare list. The new code
just goes on to the next job, if any.
/MCB 10-22-79


PCBIO: INSTALL PPCBWC AND SPCBWC PRIM AND SEC PCB WAIT COUNTERS
 FOR ICP TO WATCH. /AA 10-19-79

/A29
----

CLOCK1:  install OLDJOB cell gets set just after MOVTST to
 job we last ran, in hopes that crash analysis can sometimes be
simplified. /AA 10-23-79

SCNSER: Changed F to T2 in NXTFRC "fix" -- DDB addresses are not
job numbers (see, if the monitor were written in PASCAL...).
/MCB 10-26-79

CORE1: Fixed bug that crashed system when tried to add
super mapped page into working set. /EVS 10-31-79

/A30

SCNSER: NXTFRC made to save/restore J in case this is the cause of
the mangled-J crashes.
/MCB 11-2-79

MON26.CMD: Make C26 a KL processor, was a KI. /AA

/A31
----

Fixed bug in UUOCON - If got address check in IOWD list, MAPLSE
which decrements DIO counts would call ADRCLS, but JBTABT was stil
setup, so it did UMOVE F,F which got contents of user F, used it as
DDB address, crashed. Fix is to SETZM JBTABT(J) in ADRCLS.
/EVS 11-9-79

/A32
----

MON37.KI,MON37.KL
CONF37.KI,CONF37.KL
Make command files for 37 to be a KI.  Both are available;
MON37.CMD and CONF37.MAC are whatever was most recently copied
from the KI or KL file. /AA









/C

/B01
----

COMCON - Changed the REASSIGN calli to perform a deassign if the
destination job number = 0.  This is for CHKPNT.  /WRS 15-NOV-79

PICON, FILIO, KLSYM, IOCSS:
FIXED CACHE BUG THAT INVOLVED KL10 CACHE VALIDATES.
BUG WAS THAT A CACHE SWEEP COULD BE LEFT RUNNING AFTER DISMISSING
BACK TO USER - INTERRUPT COULD COME IN FOR CACHE SWEEP DONE RIGHT AFTER
CACHE VALIDATE CODE PICKED UP SERIAL NUMBER AND BEFORE VALIDATE
WAS STARTED, CODE WOULD BELIEVE THE VALIDATE WAS COMPLETE, BUT
THE VALIDATE WAS STILL RUNNING. IF THE VALIDATE THAT CAUSED THE
INTERRUPT WAS RUNNING DURING USER MODE EXECUTION, THE CODE THAT DID
THE SECOND VALIDATE COULD START I/O BEFORE MEMORY WAS COMPLETELY
UPDATED. FIXED BUG BY DOING FOR VALIDATE WHAT WAS ALREADY DONE FOR
UNLOAD -TURN OFF PI SYSTEM, START THE VALIDATE, AND CLEAR CACHE
SWEEP DONE, AND RETURN SWEEP SERIAL NUMBER IN T1. THUS, CAN NEVER
LEAVE CACHE SWEEP RUNNING WHEN USER IS. /EVS 11-19-79

DDT: EXEC DDT NOW HAS ^Y COMMAND FILES. FIRST
VERSION OF FRMDDT IN THIS SOURCE. /EVS 11-19-79

/B02
---

COMMON: fixed erroneous comment about SHRFPG symbol and moved
some text which had gotten orphaned on page 2 back to page 3 where
it belongs. (Probably a SMERGE effect). /AA

COMMON: Inserted new channel routine macro UNASS on p. 53. Macro
is called to generate code for unassigned channels that turns off
the channel and logs the occurence of the faulty interrupt by
setting a bit in the flag word BADINT in crash code.  New symbols
UNASS'CH are initially set to 1 and cleared to 0 by macros MULASG,
ASGSAV, and ASGINT as particular channels are assigned.  UNASS'CH are
then used to help determine which channel macros to invoke.
CTYSIM: MOVE T1,CH6+1 changed to MOVE T1,[JEN @CH6] on p. 9 to
support above. /TLC 11-28-79

Changed erroneous comment in FRMSER about not being able to halt
a frame, read PC, and start it at the PC in order to continue it.
Actually, if the frame was in IO wait in an INIT UUO, it is
not restartable. Therefore, OPEN should be used instead.
(This is because PC points to data in the INIT. Could be fixed by
adjusting the PC inside INIT) /EVS 11-28-79

SCNSER: Fixed XOFF bug introduced by tabs break code. L2LNXO moved
to LDRNXO but GOXOFF: MOVSI LDRNXO instead of MOVEI LDRNXO and
BYTPD pointed to left instead of right of LDBDCH. /TLC 11-28-79.

CLUBS: fixed bad code in KCBKER which called GETLMA then
sosge uptldc before existence check. Now call REDLMA and
no SOSGE.  P3/P4 carry slot info around in CLUBS; but as far
as I can see its only use is to test LMPMXW in order
to set first-class membership properly. /AA 11-28-79

SCNSER: GOBPF+5 MOVSI to MOVEI (more of 11/28 fix). /TLC 11-29-79

SIMKL: Made simulator work on a KI by adding code to simulate
the DADD instruction. Took out message SETABK UUO FAILED.
/EVS 11-29-79

SCNSER: GOSBL made to not send bell if either (1) port is in
image state or (2) host-no-xon is set for it.
TTYKIL made to re-route the spare-LDB queue around the job
being TTYKILled if the job is detached -- this should
solve the recent crashes -- and to STOPCD if the job is
attached and on the spare queue. The STOPCDs at HNGWT2 and NXTFRC
which had been patched out have been put back in (since
null DDBs should no longer be found in the queue, since
TTYKDB should have taken them out). TTYNFR made to error-return
if the "new" frame already has a command port DDB (this is what
TTYATI, COMCON's analogue to TTYNFR, already does).
Per AAA, AUXSTA states given names, and state tables commented.
Also, CREAUX error-code names changed to agree with those in
the YAMM.
/MCB 11-30-79

/B03
----

LPTSER: Reassigned LPT??? LH(S) bits again. All other modules
had their bits moved to make room for device independent bit
IOHNG, but somehow change never made it to LPTSER. This caused
hung device problem whenever LPT tried to run. /EVS 12-6-79

PICON,COMMON,DR11C,DZKON,CTYSIM: KS change. Now a second "SH"
command at the 2020 console will act the same way a deposit in 30 acts
on the KL/KI's and will crash the system./ELB 12-6-79

/B04
----

SCNSER aux circuit timeout back to 150 sec (incorrect edit in /B02
made it 15 sec).
/MCB 12-7-79

SCNSER AUXCAL fn '67, .AXOPC, output pointer with count. Like
.AXOPT but (1) stops at specified count INSTEAD OF when a null
is reached, and (2) always updates the count and pointer,
not just when it can't complete the output. The count is in
the rh of the word at the effective address; the byte pointer
is at the effective address+1.
/MCB 12-7-79



/B05
-----

SCHED1	MAKE OLDJOB CELL REALLY WORK RIGHT. CODE MOVED HERE FROM
	CLOCK1. /AA 12-10-79

CONF90 increase SHRFPG to 1300., define OPNFPF to 10.
	/AA 12-12-79

/B06
----

SCNSER Fixed misassembling masks. /MCB 12-13-79

/B07
----

SCNSER Typos in spare LDB cleanup code. /MCB 12-14-79

/B08
----

Changed SAA and SVA to be fast rights in preparation for gate jumping
code. /EVS 12-14-79

COMMON: CRSCNT MOVED TO END OF CNFTBL. IFCPU(KS)< MAKE FORM-
SIZE AND LINES PER PAGE INTO PARAMETERS TAKEN FROM CONF##.MAC
/ELB 12-14-79

FRMSER: New FRMOPs .FOCAR,.FOCER,.FOVCH,.FOJMP, which are
read child to parent rights, read child to parent effective rights,
validate child's handle, and gate jump. /EVS 12-14-79.

/B09
----

COMMON:
CORE1:
ONCE:
MAPIO:
PCBIO: CHANGE DATA STRUCTURE ACCESSED THRU %CTSTS,%CTADR SO
THAT FIELDS ARE 6 BITS WIDE; NEW JBTPCB REPLACES JBPADR &
JBPSTS.  FOR ANY GIVEN JOB, JBTPCB(J) HOLDS ALL STATUS & ADR
BYTES FOR THE JOB.  HEAVY PCBIO EDIT, MINOR MODS TO OTHER
MODULES LISTED.  ALSO CHANGED PAGIN/PAGOUT/PAGIMD TO
STORE REAL PCB ADDR IN PGYLMA, AND FINPCB TO PICK IT UP FROM
THERE. PGYLOG FIELD NOW NOT USED. /AA 12-18-79

/B10
----

UUOCON:
SETE##: NEW MODULE SETE## CONTAINS SETE PASSWORD AND
LICENSE TABLES ONLY. FOR TYMSHARE HOSTS, SETETY.MAC IS
STANDARD. FOR TYMCARE, SETETC.MAC; TRW: SETETW.MAC;
OTHERS WILL BE ADDED AS NEEDED.

MON##.CMD MODIFIED TO LOAD NEW MODULE FOLLOWING COMMOD.
GUY BLOOD'S SETE PASSWORD ASSIGNED 0 LICENSE. /AA 12-18-79

/B11
----

SCNSER: Fixed CREAUX to use 0 as the "originating" port
when the command port of the job building the circuit is
in fact the spare LDB (the spare LDB has an unacceptable
port number).
/MCB 12-19-79

/B12
----

SCNSER: DDBLDB(U) => DDBLDB(F) /MCB 12-19-79


/B13
----

SETETY: NEW PASSWORD FOR ME /AAA 12-28-79

COMMON: FIX TAKDWN JSR LODBTS BUG INTRUDUCED LONG AGO BY ME
	/AAA 12-28-79
/B14
----

COMMON: PUT IN IFNDEF'S FOR LPTLPP AND LPTFS FOR THE KS LINE PRINTER VFU
	DEFINTION./ELB 12-31-79

COMCON: FIX BAD COMMENT FOR JOBKL /AA 1/2/80
	FIX NEWTER: "PORT CAPACITY EXCEEDED" MSG TO CHECK F/0
	AND STOPCD IF F/NON-ZERO (MEANS TTYTAB(J) HAS A DDB BUT
	JBTSTS(J) HAS JNA OFF--SOMETHING SCREWED UP). /AA 1-3-80

SCNSER:	ADD COMMENTS TO ROUTINE TTYATI /AA 1-3-80








/D

/C01
----

PCBIO: FIX TYPO IN MAPXCH..LEFT IN @-BITS IN INSTRUCTIONS
REFERENCING %CTADR,%CTSTS. /AAA 1-7-80

UUOCON: FIX NAMES OF CALLI'S (UNUSED 1ST ARGUMENT TO
'X' MACRO, PAGE 7) TO STANDARD NAMES RECOGNIZED BY MACRO.
FROM NOW ON, THIS LIST OF NAMES WILL BE THE FINAL AUTHORITY
ON UUO NAMES.  WHEN YOU INVENT A NEW UUO, THE FIRST ARG
TO "X" SHOULD BE THE AUTHORIZED PUBLIC NAME OF THE UUO;
THE SECOND ARG CAN BE ANY CONVENIENT LABEL WHERE THE UUO CODE
BEGINS; THIS INTERNAL MONITOR SYMBOL MAY OR MAY NOT
BE THE SAME AS THE EXTERNAL PUBLIC NAME. /AA 1-8-80

LPTSER: (IN THE KS10 SECTION) FIXED THE OFFLINE-ONLINE & POWERDOWN-UP
PROBLEMS.  STILL MAY LOSE A COUPLE LINES OF DATA IN THE OFFLINE-ONLINE
CASE BUT NOW IT WON'T HANG THINGS UP FOREVER. /GL 1-11-80

COMCON: FIX JOBKL TO SET UP F (VIA A CALL ON TTYFND) WHEN IT
DOESN'T CALL JOB1. THIS MAKES TTYKIL WORK. /MB 1-18-80

SEGCON: Changed error in comments for LOGOFF uuo.  /WRS 1-18-80

/C02
----

COMCON: RESCINDED NEWTER CHECK ON F=0; F<>0 HAPPENS WHEN
LOGIN CMD IS PROCESSED 2ND TIME. /AA 1-22-80

CONF25: DEFINE 2ND STRING DISK BPB WITH 8 DRIVES /AAA 1-24-80

/C03
----

COMMON: Fixed MXPROT which had been inserted in the middle of GETTAB
table 15 (GTODP).  Also various cosmetic changes to same page.

FRMSER: Fixed typo in comment -- said error codes were returned
in T3 when they are returned in P3. /MB 1-29-80

SCNSER: Fixed off-by-one error in symbol MAXTMC. Also made SCNSER
accept TMC subcodes up to TMCSLP greater than MAXTMC so that
TYMNET can get ahead of us (this "solves" some crashes).
/MB 1-30-80

/C04
----

SCNSER: Fixed typo in CREAUX timeout, 15 sec should have been
150 sec. Also made KSs use port 1 instead of port 0 for CREAUXes
from detached jobs, and merged in Lee's change to let KS's
use any host #.
/MB 1-31-80

/C05
----

SCNSER: Fixed SETTBK typo (actually, rewrote the whole thing so's
it can be read.
/MB 2-7-80

SCNSER: Made ACTMC (which sets terminal characteristics) fake the
effect of the node's reflecting the terminal type. This is, of
course, temporary. /MB 2-8-80

/C06
----

FRMSER: changed read halt status block operation to only require
.ARRUN access rights.  /WRS 2-11-80

S: changed the access right .ARDET to X rather than W access required
to allow EXEC to simulate TTY trees until they are here.  /WRS 2-11-80

SCNSER: Changed HNGUUO to take a frame descriptor rather than just
a job number. If bit 15 (hang system) or bit 17 (hang port) is
set, it requires WC license like before; otherwise, the rh of
the argument is taken to be a frame descriptor and it requires
hang-frame access to the specified frame. /MCB 2-12-80

FRMSER,SEGCON: Added the following FRMOPs:
  fn 32 .FOGET setup frame core image from file
  fn 33 .FORUN setup and start frame from file
  fn 34 .FOSAV save frame core image on file
  fn 35 .FOSSA sharably save frame core image on file
These features are required for the EXEC.  /WRS 2-12-80
[these featues don't seem to work in C06]

/C07
----

SCNSER: .ARHNG is a slow access right! changed FARCHK call to
FDRUPX. /MB 2-13-80

SCNSER: Made aux circuit timeout values (AUXTMR, AUXTMP)
variables so they can be patched in cases of slow TYMNETs.
/MB 2-13-80

SCNSER: Added two counts: NRPCNT is the number of times
CREAUX has given the "supervisor didn't supply a port"
error-return, ZRPCNT is the number of times the received port
was zapped. Thus, the difference between the two counts is
the number of times the supervisor REALLY failed to supply
a port. /MB 2-13-80

SEGCON: Fixed some typeo's in FRMOPs added to C06.  /WRS 2-13-80

/C08
----

SCNSER: New TINASS causes, .IAYEL (9.: yellow ball received),
and .IAGOB (10.: character gobbler received). Enabling .IAYEL
prevents the monitor from reflecting the yellow ball. If such
an unreflected yellow ball has been received, the user may (should)
use the new .AXSOB (70: send orange ball) AUXCAL function to
reflect it (.AXSOB does a LEVDEF so the ball will be sent
immediately). There are two new POLPRT bits,
LXRYBS (1B7: yellow ball seen) and LXRCGS (1B8: character gobbler seen)
to go with the new interrupts.
/MB 2-14-80

/C09
----

SCNSER: Fixed bug in HNGUUO -- wrong sense for "job, not port" bit.
/MB 2-14-80

/C10
----

FRMSER: Save name of new process in JBTNAM on GET/RUN FRMOP's.
/WRS 2-24-80

SCNSER: New bit, LNLZIN in LDBLIN (the safest word in the LDB), set
when a real zapper is received from TYMNET, cleared when that
zapper is responded-to. Three counters added: NZAPIN, the number of
zappers received, NZAPN2, the number received on a port which
had already received one but not yet echoed one back, and
NZAPOT, the number echoed.
/MCB 2-27-80

/C11
----

SCNSER: More zapper-anomaly stuff. New counter, NZAPLG, # times
we've gotten a login on a port with an unechoed zapper. Also,
for it and the other detected anomaly, NZAPN2 (see above), it
now calls ZAPBUG, which stores a bunch of data about the LDB into
locations starting at ZBGBUG (which will contain the address of
the counter, either NZAPLG or NZAPN2 currently).
/MCB 3-3-80

/C12
----

SCNSER: Fixed above stuff related to calling ZAPBUG.  /WRS 3/3/80

/C13
----

UUOCON: Changed JOBLIC routine to allow job license to be increased
only if the current process has WC license.  The restriction about
aux-circuits has been removed.  /WRS 3/5/80
*****								   *****
*    Note: if this monitor is released before 4/1/80, it should be     *
*    patched so that the test for WC license in JOBLIC always skips.   *
*****								   *****

SCNSER: Fixed a bug where zappers directed at detached aux
circuits don't get echoed -- this caused us to lose a zapper
whenever a zapper arrived after a type 7 but before the job
could wake up, get a DDB, and attach it to the aux port.
/MCB 3-6-80

MAGSER: Fixed bug in 2020 tape service which caused hung tape
units never to give back control, since HASCTL was turned off
in S but never stored back in DEVIOS at TMXHNG. /EVS 3-10-80

MAGSER: Fixed bug in SGTDEV (gets tape control) which never gave
the skip (unit unavailable) return, therefore never getting
the DEVICE MTA? OPERATOR ACTION REQESTED message. Instead,
it was incrementing location on stack above return address,
having God knows what effect. /EVS 3-10-80 (These bugs
found and fixed at TRW)

PICON: made APRFAT global for FILDDT's sake.

FILIO: Fixed cache bug which reared its ugly head whenever SWPSTR
tried to include a disk transfer when the disk address was contiguous
with the last address but core was not contiguous, forcing a new
section of channel command list to be written. bug was just failure
to notice in this condition if the sweep number of the request
was greater than greatest seen so far, which caused sweep
not to happen in this case. bug didn't manifest on busy or partly
busy system because if another job runs it tends to flush out
the cache. This is definitely the cache bug found in Paris - the
tests they had to reproduce the failure on a stand alone system
now succeed. /EVS 3-19-80.

SCNSER: Removed POPJ P, P1 at start of ZAPDFR, since ZAPDFR
now PJRSTs to SIMRZP instead of redispatching.
/MCB 3-21-80.

SETETY: Put myself in the SETE table at position 3. /GL 3-25-80

COMMON: Changed the initialization of the LP20 buffer space.  The
changes are all within an IFCPU(KS).  I'm using more space.  If it
now takes more than one page LPTSER probably won't work on the 2020.
See comments near LPVLPT:.  /GL 3-25-80
Corrected a typo from 3-25-80.  /GL 3-26-80

FRMSER: Bug fixes to .FOGET,RUN,SAV,SSA.  /WRS 3-27-80
SEGCON: Optomized SG3.  Changed how .FOGET,RUN,SAV call things.
/WRS 3-27-80

C13
---

COMMON: added some new entries to GETTAB tables for CRSHID's sake:
	NSW(40) = SYSUID; last allocated universal frame id number
	NSW(41) = THSTIM; UPTIME when SCNSER last ran
	NSW(42) = MXTIM; all time max of (THSTIM-UPTIME)
	CNF(36) = XWD SAV30,NUMTAB; addresses for CRSHID
SCNSER: removed definitions of THSTIM,MXTIM as per above
/WRS 3-27-80

FRMSER: "patched" FRMOP dispatch table for .FOGET,RUN,SAV,SSA to
	CPOPJ so as not to provide a potentially buggy service in
	version D.  /WRS 3-27-80


CONF26:
CONF29:
CONF36: XP SPCBN,^D30 in all 3, so we won't need to patch this
in any more on these systems.  Backup CONF##s not made. /AAA 3-27-80

CONF33: MON33.CMD make 33 a KI again
CONF39: MON39.CMD make 39 a KL again /AAA 3-27-80


P034/E
------

/D01
----

CON23.MAC changed JOBN to ^D80, PORTN to ^D96 as per
	Saltyron and Spinale /AA 4/8/80

COMMON UUOCON SCNSER Initial PTY implementation. New CALLI,
CREPTY (-141) returns a pair of PTY port #s in the left and
right halves of the ac. The idea is that you set image mode and
turn off echo on the one (data mode 24 or 214) and keep it
for yourself, then attach the other one to the job you're
controlling. They work more or less like aux circuits: to
get rid of one you (either end) zap it. Two new symbols,
RPORTN (# of real ports) and PPORTN (# of PTYs). They add
up to PORTN. COMMON sets PPORTN to 4 if it is undefined,
and this is subtracted from PORTN to get RPORTN, so if a
system's configuration file is unchanged it will wind up
with 4 fewer real ports than it used to have (and 4 more
PTYs). /MCB 4-9-80

/D02
----

SCNSER Dynamic quota-setting for PTYs, dependent on TIHLTN and
LDBTIC/ECC at the other end. Also, PGSBL code, though now
(paradoxically) it should never get executed.
/MCB 4-11-80

CONF37 64 real ports, 64 pseudo ports for system 37. /MCB 4-11-80

SCNSER Fixed yellow and orange ball PTY dispatch routines
to manage timeout bits and wait for input wait (!),
respectively. /MCB 4-14-80

/D03
----

SCNSER Fix at FRCCGB to load F (!). /MCB 4-15-80

SCNSER New AUXCAL function '71, .AXSOX to set/clear/read the
suppress-output-translation bit for the OTHER SIDE of a PTY.
Also, fixed LDPDEM to point to the new position of the bit
(which moved from LDLDEM to LDRDEM). /MCB 4-15-80

/D04
----

It is now possible to delete files with RIB errors normally.
The sequence is: LOOKUP (gives error 6), then just rename to 0
as in normal deletes. Most programs will not be able to delete
the RIB error files because they don't continue past the lookup error.
/EVS 4-17-80

Fixed race condition in file deletion code that could potentially
cause a file that is superceding an existing file to get deleted
instead of the existing file in the case where someone is
deleting the existing file. Also, this bug could cause in very rare
conditions multiple UFD entries. (No interlock was gotten while
deleting UFD name out of directory, and it looked by name, not by
retrieval pointer. Fix was to set ATPUPD as an interlock). /EVS
4-17-80

Fixed bug in CLOSE code that would die if doing CLOSE reset
on a channel open for update and the file had a RIB error.
/EVS 4-17-80

Performance improvement: In prior monitors, CLOSE output always
made the RIB and UFD page dirty by filling in the stuff from
the ATB (and FNB). Save IO sometimes by doing compare before stuffing
the data to see if its actually changing. Probably will save
writing out the RIB again on CLOSE for update mode where nothing
about the file has changed.
/EVS 4-17-80

Installed mechanism to cause a new bit in RIBLIC and the corresponding
field in the UFD, ATPALC in ATBLCW, UFPALC in UFYUF2, RIPALC in RIBLCW,
to get set before any allocation change is about to occur and to
get cleared on close input under the proper circumstances. New RIB
location used called RIBALT which is used to determine when
a file's RIBs, SATs, and UFDs have all been written out to the disk.
This bit is looked at by DSKCLN in "fast" mode in the UFD. In "fast"
mode, only those files with RIPALC are looked at, and the resulting
pages are cross checked for multiple use and ORed into the SATs.
Lost pages can easily result, but the theory is that the file
structure will still be intact. The operator can override the
monitor's decision as to which mode to run DSKCLN in in case there
is some file system corruption that results in a "fast" STOPCD
which doesn't fix the damage. /EVS 4-17-80

An attempt was made to abolish UPTREL. It would be nice if
a program could mess with .JBREL and cause the CORE UUO
to do allocations past a holey part of the address space
that was brought into being by doing MAPs or VCREATes or something.
But LOADER sets JOBREL to what it thinks it should be after
one of its CORE UUOs, resulting in a mess, so I had to take
the part that looks at .JBREL out in the CORE UUO and make it
look at UPTREL again. However, allocation of buffers looks
at .JBREL, and so does REMAP, so beware of dumb programs that
set .JBREL by themselves to something. /EVS 4-17-80.

Part of the "fast" DSKCLN change - STOPCD now has an argument.
SLO means that the crashing monitor will attempt to tell the
newly reloaded monitor that slow DSKCLN must run. A blank
argument means the new monitor will run "fast" DSKCLN.
An argument of NO means things are so bad that a warning message
should be printed out and auto reload defeated. This is intended
to get the operators to make maintainence fix the hardware.
The criterion for setting a SLO as opposed to fast DSKCLN is
as follows: STOPCDs that are intended to check non-file system
related interfaces should all be normal ("fast"). STOPCDs
that indicate trouble with the file system data base (ATBs, FNBs, STTs,
etc.) should be slow, since they don't happen that often and
they indicate possible trouble with the data base on disk.
STOPCDs that imply that the IO or PCB data bases are bad can be
fast, since chances are that the disk is still OK. (This may prove
to be wrong by experience, in which case we will change the STOPCD
to SLO.) STOPCDs that deal with SAT counts, bits not being on in the
SAT when they should and vice versa, should be SLO, since it is very
likely that there are multiply used pages hanging around somewhere.
When writing a new STOPCD, bear in mind that the availability
increase we hope for is based on running "fast" DSKCLN in most
cases, so be thoughtful before deciding that SLO is the proper
STOPCD. Also remember the effect that the system comes down in
fast DSKCLN, and crashes again with a SLO DSKCLN - if it is likely
that this will happen for a certain STOPCD, then the first one is ok
to be fast, since chances are a slow STOPCD will result if the
first decision was wrong.

RIB errors with no IO error on the transfer no longer crash the system
immediately. This is because the system can crash in the middle of
a RENAME, and ATPALC isn't set on the old UFD entry for efficiency
sake. Instead, we will expect to see a RIB error when the system
comes up again, and the file can be deleted using the new RIB error
deletion feature. However, if ^D60 rib errors with no IO error
are seen for two or more RIBs, the system will go down and run
slow DSKCLN. This number can be changed as we have experience
with it, and it might be possible to also introduce more than
one memory cell to remember RIB error retrieval pointers so
that we can crash after seeing X different errors on Y different
RIBs. This eventual crash is designed to protect the system
against flakey disk hardware. /EVS 4-17-80

COMMON,COMMOD,FILUUO,UUOCON,ONCE,ONCDSK: Installed Restart mechanism
to allow flexible system bring up.  Currently three Restart types
exist:
	Type	Mnemonic	Meaning
	ONCE	ON		manual ONCE
	BOOTS	BT		manual BOOTS
	DSKCLN	DC		DSKCLN type: 0=None, 1=Fast, 7=Full

ONCE and BOOTS state can be selected by three entities: user via .REST
SETUUO, oper with SS4, monitor.  The effective state is determined by:
  user if defined else SS4 if set else monitor.
DSKCLN type can be specified by oper in ONCDSK, user prog with .REST,
monitor in crash code, HOM blocks, default (type Full), in that
order of priority.

COMMON: CRASH code: Replaced old SAX BOOTS readin code with a
generalized primitive driver; entry points: SAXRED, SAXWRI.  Added
routines to setup for (PMDRD, PMDWT) and dispatch to (PMDDSP)
primitive drivers.  Changed dispatch addr to BOOTS to always be
startadr+5: new BOOTS entry point that accepts a command string
addr passed in reg 1.  Added new routine ISBOOT to verify that
BOOTS has indeed been loaded; BTPREP to do SAX area save and find
highest possible BOOTS starting addr.  Save SAX area at bootsend+100
even for systems without SAXs because BOOTS requires this to preserve
SAX area in crash dumps.
        Inserted Restart code: Macro RESYM to generate Restart
symbols, byte pointers, RESTRT validator, user Restart save word.
Determination of monitor Restart conditions based upon take-down
type, hardware status, and file system integrity.  Transfer of
user hang or crash Restart bits to RESTRT word.  Validation of
RESTRT.  Transfer of pack ID from STR DDB to REPSID.  Writing of
DSKCLN type to HOM blocks if required, desired.  Prepartion of
BOOTS command string, BTSTR.  Routine RECOMP to compute Restart
condition based upon user, monitor Restart and SS4 setting.
Location TDERR to be JSRed to if Restart error occurs (e.g.
inconsistent HOM blocks).  Inserted inter-monitor block to facilitate
communication between two consecutive monitors:  REPSID=26: pack
set identifier used to insure that otherwise valid RESTRT will
be ignored if new STR is mounted between monitor incarnations;
RESTRT=27: lh/ validator, rh/ user, monitor Restart state.
New GTODP GETTAB table item 5 (.ODDCT) holds DCN which contains
DSKCLN type desired for DSKCLN after sys initialized.  During ONCE
DCN is used to store DSKCLN types supplied by various sources.

Changes in other modules to support Restart:

COMMOD: Added HOMDCT (=30), HOMDCV--HOM block DSKCLN type and
validator; STRPID, STR pack set id in lh of STRBTS; UNYSCN, byte
pointer to UDB chan #.

FILUUO: Changed DSKCLR UUO.  Accepts 3 modes specified by ac field
value: DC.CLR (=0), clear in-core disk info; DC.FPC (=1), set
STTFPC for all SATs on all units and clear SRPNDS; DC.NDS (=2),
clear SRPNDS only. DC.NDS is needed to support DSKCLN mode 0 (None)
since it is DSKCLN that decides it does not have to analyze a
particular STR.

UUOCON: New SETUUO function 12 (.REST) to read/write crash/hang
Restart bits and designate whether Restart is to be written to
disk.  New SETUUO function 11 (.BTSTR) to read/write BOOTS command
string and ascertain max string length.

ONCE: Copy Restart from RESTRT to DCN, clear RESTRT--done to insure
that RESTRT is only good for the life of one crash/hang.  Check
RESTRT validity, compute once action and act accordingly.

ONCDSK: Macro DCNDEF to define ONCE Restart symbols and pointers
and select DSKCLN type priorities.  Setting DCN to highest priority
DSKCLN type to allow GETTABing by DSKCLN.  Oper prompt for DSKCLN
type if not defined in core or disk and SRPNDS set.  Last two items
accomplished with SPCDKN.  Routine SPCDKP used to compute highest
priority DSKCLN type.  Parsing done with SCAN macro.  New command,
DSKCLN, to allow oper query and selection of DSKCLN type.
					/TLC 4-29-80
/D05
----

SCNSER Fix at FRCCGB to load J (!). /MCB 4-17-80

SCNSER Make PTY send-bell code simulate a black ball to either
end instead of sending a bell. It shouldn't happen anyway. The
count TTYLOS is still the # of TYMNET black balls; there is a
new count, PTYLOS, for the simulated ones (# balls/2).
/MCB 4-17-80

UUOCON:  corrected name of Calli -136 VPEEK (was NPEEK)
/AAA 4-17-80

PICON: changed EVICT uuo to require job to be running
/WRS 4-17-80

/D06
----

LPTSER: Added form size control for the LP20 using the MTAPE UUO
to pass a list of commands to change the DAVFU buffer and reload
reload the LP20s vertical format unit.  All changes are within
the IFCPU(KS) section. /GL 4-23-80

File system bug in the new truncate CHANIO. DLTTR0 call to FLUSHA
assumed that callers were RENAME or ENTER and that DDB pointers
were already dumped out if they were changed. This is not true
of the truncate CHANIO, so for safety sake put in call to PTROUT
at DLTTR0. Symptom of this was file with RIB errors, since after
truncation the deallocted pointers still left in DDB would be written
back to RIB at CLOSE time, thus generating free pages and making
RIBALP and RIBSIZ wrong. If RIB validate CHANIO was performed
before truncate, nothing went wrong because pointers were dumped out
then. /EVS 4-24-80

SEGCON: skip over UXCTBU doesn't work, caused SAVE not to save
enough (supposed to use JOBREL if JOBDDT setup.). /EVS 4-24-80

PICON: fixed EVICT uuo fix.  /WRS 4-25-80

SCNSER: Fixed CREAUX code that decides whether to use the
command port's port# or port 0 to deal correctly with PTYs
(i.e., to use port 0). /MCB 4-28-80

COMMON: A crash during DSKCLN (i.e. when SRPNDS=1) will now cause
monitor DSKCLN type to be set to FULL. /TLC 4-29-80

COMMON: Changed the initialization of the LP20 buffer space again.
The changes are all within an IFCPU(KS).  /GL 4-30-80

COMMON: Fixed bug causing CRASH once command to hang in crash code.
/TLC 5-2-80

/D07
----

COMMON SCNSER: Block i/o for PTYs. (COMMON has new block i/o buffer
size). /MCB 4-30-80

SCNSER: New AUXCAL function, .AXFRS (function 72), Force Rescan String:
	MOVE	ac, [port,,.AXFRS]
	AUXCAL	ac, [
		count
		ildb pointer
	]
	  error return	;for the normal AUXCAL reasons
	normal return	;ac/ return code
where <return code> is one of
	0  .FROK   no error
	1  .FRAUX  can't do it on an aux circuit
	2  .FRBIG  string too long (must be < TIHLTN)
It clears the input buffer, forces the string in, adjusts the LDB
so the string won't be echoed, and sets the rescan bit.
/MCB 5-2-80

/D08
----

SCNSER:  PTY block output fix /MCB 5-5-80

/D09
----

SCNSER: PTY block input fix /MCB 5-5-80

ONCDSK:  SWPDEF ROUTINE NOW ASSIGNS DEFAULT SWAP SPACE
 OF 1 PAGE PER UNIT RATHER THAN ^D700 FOR 3330-TYPE PACKS.
/AAA 5-5-80

COMMOD: FIX LIMP4S TO EQUAL UNSP4S.  BOTH WERE INDEPENDENTLY
 SET = ^D13.  LIMP4S IS USED BY ONCDSK TO LIMIT SIZE OF
 OPERATOR ENTRY WHICH IS STUFFED INTO FIELD UNYP4S WHOSE
 WIDTH IS UNSP4S. /AA 5-5-80

SCNSER: Block input-message-handler fixes at FREBUF and BLKIHR.
/MCB 5-7-80

SEGCON: MAGTAPE GET/RUN FIXES; ELIMINATE REQUIREMENT
 THAT OPERATOR SPECIFY CORE ARG TO THE GET/RUN.  USE
 JOBHCR (VESTIGIAL JOBCOR) IF HE GIVES NO CORE ARG. /AA 5-9-80

/D10
----

SCNSER: .AXFRS now causes the i/o-would-block interrupt
rather than blocking, if the interrupt is enabled and there
is no bufferlet space for the string. An output-space-available
interrupt will be signalled at the next second there is ANY
bufferlet space. /MCB 5-9-80

SCNSER: New POLPRT bit, LXRIOS ('400), set when an output-
space-available interrupt has been signalled for the port.
/MCB 5-9-80

/D11
----
SEGCON: FIX SAVJOB TO INITIALIZE VESTIGIAL JOBDAT EVEN
IN THOSE CASES WHERE PG 400 CANNOT BE MADE
RDW. TRY TO MAKE IT COW (.SHR AND .HGH CASE) AND DO
THE INIT'ZN. /AA 5-12-80

/D12
----

FRMSER: turned on FRMGET FRMRUN FRMSAV FRMSSA, but only for doing them
to another frame...until I get time to fix the rest of the code, user
will get "frame already running" error if does them on himself.
/WRS 5-13-80

/D13
----

SCNSER: Another attempt at a working .AXFRS. New error codes
(see SCNSER at FRSRSC:). /MCB 5-14-80

/D14
----

SCNSER: Made .AXFRS nonskip-return on errors. You can tell its
error-returns from the AUXCAL dispatch's because .AXFRS has no
error code 72 (and presumably never will).
/MCB 5-14-80

/D15
----

SCNSER: Experimental fix to backpressure code. Message types
TRO CGB BIN TRI and BPN can now be sent even if the port is
being backpressured (the point was to allow BPN to be sent;
the rest were promoted because their ordering seemed possibly
significant). New pseudo-message type BOP (block output in progress)
for PTYs. /MCB 5-16-80

/D16
----

SCNSER: bugfix at PGBOP. /MCB 6-16-80

/D17
----

MAPIO, FILRIB: KFTRN was comparing new file size with current
to see if new size was still within last page without the atomic
file lock, and then getting the lock if same and storing ATBSIZ,
but this left window where file size could change while waiting
for the lock, and ATBSIZ could wind up wrong. Fix: create new
entry point in DLTTRC for truncate for the case where the
file lock has already been obtained and call there with the lock.
/EVS 5-20-80

COMCON: Fixed DETACH <device> command to print all of its
error messages instead of just some and to print a prompt
when it succeeds (U was getting clobbered). /MCB 5-21-80

SCNSER: Made CHKROM check JBTAWQ and go to ABTUUO if an interrupt
is pending, when it's thinking about going into output wait. This
appears to solve APL's problem of CLRBFOs being less effective
on AUXCAL characters than on TTCALL characters. /MCB 5-21-80



P034/F
------

/E01
----

SCNSER: Fix terminate-block-output call to cancel a pending block
output request to TYMNET (otherwise it gets sent anyway, AFTER
the terminate request is sent). /MCB 5-21-80

SCNSER: Small fix in RETACH (remember to call SETLMD when attaching
in user mode). /MCB 5-21-80

UUOCON: Change .BTSTR, .RESTRT to require WC instead of OP
for changes. /TLC 5-21-80

CONF90.MAC:  as per B. Mathieu request, reduced freecore
 alloc's to allow them to load monitor in 1500K or less:
 OPNFPF xp ^D9  (was 10)  causes one less DDB (32 wds) per
 frame, or more than 4 pages less freecore (FCWDS)
 M.SBSZ xp 1000 (was 4000) saves 3 pages SNOOP buffer
 (if they need to use it, just reduces resolution) /AA 6/2/80

SCNSER: New AUXCAL function '73, .AXTCN, read/set Terminal
Characteristics by Number. Call is:
	MOVE	ac, [port#,,.AXTCN]
	MOVE	arg, [tc#,,new value (-1 to just read)]
	AUXCAL	ac, arg
	  error return	;normal reasons, or tc# or new value bad
	normal return	;rh(arg) := old tc value
The terminal characteristics are defined on page 2 of SCNSER.
Note that they do NOT contain program-related characteristics
(such as tabs-as-breaks), only real terminal characteristics.
/MCB 6-2-80

SCNSER: New AUXCAL function '74, .AXTCP, read changed Terminal
Characteristics from (the other side of) a PTY. The call is
	MOVE	ac, [your side's port#,,.AXTCP]
	AUXCAL	ac, arg
	  error return	;normal reasons, or not a PTY
	normal return	;arc := tc#,,new value or -1 if
			;nothing has changed since the last call
New TINASS cause, .IATCC (^D10), and matching POLPRT bit,
LXRTCC ('200): the event happens whenever the other side of
the PTY sets its terminal characteristics.
/MCB 6-2-80

SCNSER: New AUXCAL function '75, .AXNZP, read/set No-ZaP bit,
useful if you change your mind about an aux circuit, and useful
for slaved command ports, where there is no parameter to control
the setting of the bit.
/MCB 6-2-80

SCNSER: Fast block i/o for PTYs: if PGBOT finds the other end
in block input wait with its block input buffer empty and
its request size the same as the output block's size, it
will (almost) simply swap the two block buffers.
/MCB 6-2-80

/E02
----

SCNSER: Bugfix at ACPTPC (failed to note that TYMTC1 skips).
/MCB 6-3-80

NOTE!!! Setting the backspace-for-delete bit (via .AXBS) is
now equivalent to the TTY BACKSPACE command: it clears the
erase-for-delete bit. Clearing the backspace(erase)-for-delete
bit is now equivalent to the TTY NO BACKSPACE(ERASE) command:
it clears both backspace and erase. If your INIT file
formerly set first the erase then the backspace bit
(in order to get the TTY ERASE effect), it will now give
you the effect of TTY BACKSPACE instead.
/MCB 6-3-80

/E03
----

SCNSER: Bugfix: LDPTBK ("trap breaks") is now LDPTLN ("trap line").
LDPTBK is now a byte pointer to the tabs-as-breaks bit.
Also a bugfix in ACERAC.
/MCB 6-4-80

/E04
----

SCNSER: GETLCH, per request from JP, now returns the backpressure
bit (as bit 0 -- it is one of the LDBDCH bits that's returned
in its "correct" position).
/MCB 6-11-80


/E05
----

CONF38:
CONF39:  increase JOBN to ^D80, up from 60 as per SRA request.
	increase PORTN to ^D96, up from 64, in keeping with
	similar values for C36,C29.
	/AA 6-12-80.

RMXKON:	Changed the JRST CPOPJ1 at RMXRCL+4 to POPJ P,0 to fix a bug
that EVS found today. /GL 6-12-80

COMMON: Changed RM/RP code to read BOOTS into a general purpose
primitive driver. Interfaced driver to soft crashing mechanism.
Added code to read KS BOOTS via prim. driver.  Made minor changes
to SAX prim. driver and BOOTS load caller to save a little space.
/TLC 6-13-80

/E06
----

SCNSER: Made incoming aux circuits (terminal id code = 0) always
apply backpressure, rather than only in image mode. This helps
programs that are talking to aux circuits, but may hurt
"transparent" programs like AUXIO, since, once backpressured,
you can't ^C a program that you've discovered is not
listening to you.
/MCB 6-16-80

/E07
----

(KS2020): P034/E07 Represents no changes to source in (m33).  I'm making
this note as a record of the initial test monitor for 37 of the KMC
source.  The source of the merged modules (~P034/e03) is in (ks2020).
/GL 6-16-80

/E08
----

SCNSER: SMERGEd KS version (/E) with non-KS version (/E06).
/MCB 6-16-80

COMMON: FIXED SOME KS RM/RP PRIMITIVE DRIVER BUGS. MOVED CODE TO
DEFAULT TO READ/WRITE ONE PAGE OUT OF SAX DRIVER SO IT COULD BE
SHARED BY RM/RP DRIVER. /TLC 6-17-80

KSSYM:,KISYM:,KLSYM: Added definitions for IFKMC & IFNKMC. KI & KL are
			defined to have no KMC.  KS is defined with KMC.
NOKMC:,KMCDDT:,KMCSER: New modules for KMC support.  NOKMC is used to
			build a KS monitor with out a KMC.
CIOPR:,DR11C:,DZKON:,KSIORG:,MAGSER: These are KS specific modules which
have been changed to support the KMC.
DDT:	DDT has a new command to look at KMC style 8 bit bytes.  It is
like the normal display byte command except you type $88o instead of
$8o.  The 88 is interpreted to mean KMC style bytes.
These changes should have no effect on KI or KL monitors except forcing
a recompile because of the new dates on KISYM & KLSYM.  /GL 6-17-80

COMCON:	Merged in KMC support.
CTYSIM:	Merged in KMC support.
ONCE:	Merged in KMC support.
PICON:	Merged in KMC support.
COMMON:	Merged in KMC support.
SCNSER:	Merged in KMC support.
	See KMC.DOC for details of KMC "support". /GL 6-17-80

/E09
----

Changed USETST+20 STOPCD to STOPCD SLO so DSKCLN can fixup the
probable cause: RIBSIZ too big.  /WRS 6-18-80

Added debuging aid (temporary) to REQUE in CLOCK1: job table JBTWRS
which contains the 6 most recent job state codes (right to left).
This should be instructive when looking at JBTPGO(j)=j crashes.
Also to SCHED1 and COMMON.
/WRS 6-20-80

/E10
----

Made improvements and fixes to above mentioned debugging aid.  New
table (temporary) MAPQUE (really should be MAPSTS) is used as
follows:  MAPQUE[i*20+j] = <number of times state changed from i
to j>.  If this value is found negative, such a state transition
will SYSCRS.  R(WRS)MAPQUE to get a picture of this array.
/WRS 6-23-80

/E11
----

Changed all STOPCDs in FILRIB to SLO that weren't already.
/EVS 6-23-80

SIMIO:
	fix INBLT bug which appears when error on superio read
	is followed by a super write..page still mapped RDO.
	Solution is to remove the page after any super
	read error.  /AA 6-25-80
SIMIO:
COMMON:
	Eliminate UPTPCN array (SIMIO debugging aid..
	has never turned up any bugs. /AA 6-25-80

FILUUO: Fixed bug that let close code be executed for a file
already closed when file that was marked for deletion was deleted
and then closed.
	Changed RENAME to turn off file dumped bit when user does
not pass .RBLIC and have WF or JL. (Discovered that some of ATMUFP
may behave strangely--get cleared if user's arg block has .RBLIC
entry and user does not have WF or JL but be preserved if block
does not contain .RBLIC.)  /TLC 6-25-80

/E12
----

CLOCK1: minor insignifigant change to fix MAPQUE statistics at REQUE.
/WRS 6-25-80

MAPIO: Fixed bug in KFTRN that allowed caller to set RIBSIZ past
the HPW.  Changed DLTTCI error code to FALRBE (was FALPHP)
when caller is KFTRN. /TLC 6-27-80


CLUBS:  Rearranged CMC database to make a CMC 4 words
 long instead of 5...saves freecore on any system which
 uses lots of clubs.  Two bytes were substituted for
 two halfwords, and the CID became a 27-bit byte instead
 of a whole word.  Only 1 of the bytes is accessed inside
 any loop.  It is doubtful that the club ID ever gets
 up to 2^27-1, much less 2^35-1, so this limitation is
 probably never going to be of consequence. /AA 6-29-80

/E13
-----

MAPIO: Forgot to take out two instructions in DELXCH that make
it ignore bounds checking for file size if called by KFTRN.
Did it now. /TLC 7-1-80

SCNSER: PTY block-output fix (ILDB => UUILDB at PGBOP1:) for KS with
KMC. /GL 7-1-80

CIOPR: Added DRPROT:: to be called from KMCSER to protect us from
unexpected DR interrupts (flakey hwd). /GL 7-1-80
KMCSER: Added call to DRPROT. /GL 7-1-80

MAPIO: Moved around code in KFTRN to make it a little more efficient.
Didn't cost any space. /TLC 7-1-80

COMMON, ERRCON: changed around some crash related things in order to
provide hooks for CRSHID.  New global locations useful for looking at
crashes:
    STOPPC/ the real PC of the *first* STOPCD we hit
	- this differes from SYSCRS in four ways: 1) if we crash twice,
	STOPPC is the address of the first one, SYSCRS is that of last.
	2) if we hit a STOPCD (SLO) or JSR SLOCRS, STOPPC has the adr
	of the STOPCD while SYSCRS has SLOCRS+n.  3) SYSCRS has the
	would be return address, while STOPPC is the actual STOPCD adr.
	4) if there is a 147 restart, STOPPC/ 147.
    STOPCN/ the number of times we tried to crash (if this is non-zero,
	the crash code HALTs)
Fixed a bug where on nested crashes, AC17 gets trashed.
/WRS 7-1-80

SCNSER: Added code in CREAUX to try building circuits to the next DR
when we get a 'host not available' message on multi DR KS Systems.
/GL 7-1-80

/E14
-----

SEGCON: Attempted to fix GET for a file over 1/2 adr space big.  I found
many problems, but apearently not all.  Still doesn't work for real big
ones, but some work that didn't before.  At READLS and RDLSUU.
/WRS 7-2-80

CONF38: Define OPNFPF to ^D12, system running out of freecore
 alot, this will allocate more for DDBs. /AA 7-3-80

LPTSER: Changed the LP20 character translation to a simpler scheme, and
changed a STOPCD for the "impossible" condition of seeing the done bit
along with error bits, to a JRST LPTERR since this condition does happen
and is recoverable.
/GL 7-4-80

CIOPR: Added code to set the node manually down when preparing the DR
to down line loaded and to clear the manual down flag when the node
has been successfullly loaded
/ELB 7-7-80

/E15
----
CLUBS: Changed state that jobs get put into from RNQ to ISQ when they get a club
inerlock after having waited. Really, ISQ is just defined as TSQ inside
SCHED1, but didn't want to see TSQ appear in CLUBS. Orignially
this was supposed to go into source for P90 so job with inerlock
wasn't so low a priority as to keep other jobs from running
and slow response up for many subsystem users, but didn't get
into the sources. Could possibly allow two or more jobs which
fight for the interlock to take over the system. /EVS 7-9-80

SCHED1: Put ILWQ into ISCAN and OSCAN. Note that there are many
potential interlocks involved among all jobs in IL wait, but
I have done the standard QBAK1 and QFOR1 anyway. This is under the
assumption that although the scheduler doesn't scan the club data base
to decide who the next owner of the interlock will be, the first
one on the IL queue is probably the first one for one of the interlocks.
Perhaps we should arrange not to give the interlock to someone who
is swapped out - but this might infringe on fairness. This change
made after seeing a problem on Tymcare 2020 system with a bunch
of MAGNUM jobs locked in core in IL state and two other jobs
fighting for memory while running. /EVS 7-9-80

CIOPR: Defined calls to KMCSMN & KMCCMN as macros defined outside
the IFCPU (KS) and defined as JFCLs when IFNKMC.  IFKMC & IFNKMC
seem to confuse MACRO when used inside an IFCPU(KS).  All this
was nessisary because KMCSMN & KMCCMN don't exist in NON-KMC systems
like TRW. /GL 7-10-80

/E16
----

PICON:  IFCPU(KS) SNOOP CODE WAS WRONG. FIXED SNSTI AND SNOOPI
	 TO SPLICE SNOOPI CODE INTO APRINT ROUTINE PROPERLY
	USING JRST;  NO JSR'S. /AA 7-11-80

SCNSER: Added code to CREAUX to call WRTACR to write a CREAUX
stream record.  Normally this is only done when CREAUX succeeds;
however, if AXELOG is JFCLed, a record will be written for non-local
CREAUX errors.

UUOCON: Added code to LOGINN to call WRTACR to write a LOGINN
stream record.  WRTACR is called only if user supplies proj. code
(in arg block words 5-7) else LOGINN works as it did before.

ACTSER: Added routine W22ACR to write CREAUX stream record.
Contents: standard header plus word containing in left half error
code with bit 0 set if monitor supplied error and in right half
aux port number.  Inserted appropriate table entries for TATTLE
and CREAUX records.
						/TLC 7-15-80
/E17
----

PICON: Fixed APRPR1 to jump back to APRP1R after counting a soft error
on KS.  /GL 7-15-80

/E18
----

ACTSER: Write standard header for CREAUX record. /TLC 7-16-80

/E19
----

SETETY: Added sete password #2 for Sherman Gavette.  /WRS 7-17-80

/E20
----

SCNSER: Added BBPAGE table to reflect operationns to UBA page table.
/GL 7-21-80

/E21
----

SCNSER: Added "IFKMC" code to CREAUX to look at the high 3 bits passed
in the AC to determine to which node (TYMBASE) to build the circuit.
If the node is not up at the time the UUO is processed a new CREAUX
Error code will be returned (^D8 in the left half of the error word).
This replaces the 'cycle thru the nodes' code of E13.
/GL 7-22-80

/E22
----

Removed AAA sete password.  /WRS 7-24-80

SCNSER: Doubled the number of unread input characters allowed before
throwing chars away for KS with KMC (this is for TYMCARE).
TIHLTN is still ^D500 without KMC but contains ^D1000 for KMC systems.
/GL 7-24-80

SEGCON: Save code fixed to break IOWD in half before doing OUTPUT uuo
if necessary, should fix saving huge files.
/WRS 7-24-80

/E23
----

COMMON: made SAV30 global again.  /WRS 7-29-80

COMMON: added 5th line for INITIA (good to keep a spare)  /WRS 7-30-80

SEGCON: fixed get run save uuo's to not fetch username from AC0,1 if
ppn field is zero.  /WRS 7-30-80

CLOCK1: at STOP1 added call to TYCIOS to clear IO status for ALL ports
belonging to job.  This should fix the problem of people being
woken out of some state (ie SW) and put in TS after being halted
and restarted.  /WRS 7-30-80

SCHED1: added cell MAPQSW which may be patched to
  POPJ P,	to turn off MAPQUE stuff
  JFCL		to turn on MAPQUE stuff
/WRS 7-30-80

/E24
----

CORE1 - changed number of ticks running between page aging calls
from 10 to 120 due to excessive overhead in AGEPAG. /EVS 8-3-80

CLOCK1: SCNSER: changed STOP1 fix to go at MSTART and MXSTRT.  This
seems to be a much better approach since the UUO doesn't really get
restarted on a continue, rather it is continued!  /WRS 8-4-80

/E25
----

ACTSER: Fixed CREAUX stream record writer to correctly indicate
port number. /TLC 8-4-80

/E26
----

SCNSER, ACTSER: More of 8-4-80. /TLC 8-6-80

/E27
----

SCNSER: fixed .AXSYB, .AXSOB, .AXHNG auxcal's to not skip as they are
documented (and have always been).  /WRS 8-8-80

Added CNFN22, CONF22, MON22 for C22, a system which looks like C36.
	/TLC 8-15-80

CONF23: Changed JOBN to 108 and PORTN to 127. /TLC 8-15-80




P034/G
------

/F01
----

SCNSER: Fixed KS Block I/O bug.  Added some BIO debug code to make it
easier to see what's going on during BIO or after a crash. /GL 8-20-80

/F02
----

CORE1: Added call to PAGWAK in BLTULP to wake jobs waiting for
DIO on a pg to go to zero. /TLC 8-21-80

/F03
----

FILRIB: Inserted call to RELRIB before doing SETACH in DLTTCI
routine to insure that RIB is released. /TLC 8-21-80

/F04
----

CLRPT instructions on 2020 are very slow, because they sweep
the whole cache. To minimize the number of these done, if a frame's
own context pages appear in %UPX, they are always write enabled,
rather than switching between write enable and write protect.
If another frame's context pages appear in %UPX, they are handled
as they were previous to this change, i.e. when not in use for writing,
they are write protected. /EVS 8-26-80

/F05
----

SCNSER: Added test in GOZAP to STOPCD if port being zapped is > RPORTN.
/GL 9-4-80

/F06
----

Conditioned out code for MAPSTS.  /WRS 9-5-80

/F07
----

Increased value of OPNFPF for C22 to 10 files per frame.
Increase value of SHRFPG to ^D1300, taken from P90's value.
/EVS 9-15-80

Increased default value of OPNFPF (open files per frame) to ^D10.
Increased OPNFPF for C38 to ^D16.
/WRS 9-16-80

/F08
----

Fixed crash code in COMMON to write down more accurate STOPPC
information.  /WRS 9-19-80

SCHED1: Fixed possible problem with wait states getting overwritten
at SWOSJ0 - if interrupt changed JBTSTS, MOVEM T1,JBTSTS(J) would
write old value back, causing various problems possibly having
symptoms like the JBTPGO loops. /EVS 9-22-80

CORE1: Add log(base 2) freecore request failure table plus
GETLNK("NOCORE") GETTAB to get at it. /Darren 22-SEP-80

UUOCON: new UUO RLSLDB - release spare LDB, to be used by LOGOUT
to release the SLDB so that alt log progs don't tie things up and
to speed killing jobs in general.	/WRS 9-25-80

ACTSER: FILUUO: UUOCON: changed places who got date and time together
to do check for midnight to avoid off by 24 hour errors.  Anyone who
wants date AND time should PUSHJ P,GETGMT to avoid more problems.
/WRS 9-25-80

UUOCON: new DAYTIM uuo returns secs past 1/1/64 - good for computing
elapsed time, etc.  Also added 1 word format to the DATUUO uuo.
/WRS 9-25-80

/F09
----

UUOCON: fixed DAYTIM uuo - wasn't accounting for DATCOM skip return.
/WRS 9-25-80

SCNSER: Fixed CREAUX to always use 1 for it's dummy port number in
KMC monitors.  Using the CMD PORT number as it sometimes did caused
the wrong 11BASE to get the AUX request sometimes. /GL 9-26-80

FILIO: Add routine to type "Unit XXXX Hung" to operator whenever
a hung disk condition is detected. /Darren 26-SEP-80

SCNSER: Fixed SNDBIO to send BLKNEG to first "UP" DR in a KMC MONITOR
instead of the first node (up or not).  Won't affect KI or KL.
/GL 9-26-80

/F10
----

SCNSER: New .AXOSF (Output String to Fit) to output a string and
non-skip return with updated arguments when no more characters
fit.  Skip returns if string all output.   /WRS 9-26-80

/F11
----

UUOCON: minor change of strategy in DAYTIM, etc.  /WRS 9-26-80

FILFND: MAPIO: folded in Ernie's CB free core interlock problem
patch.  /WRS 9-29-80

/F12
----

MAPIO: (nothing is ever right the first time) fixed my misteak in above
fix for free core interlock problem.   /WRS 9-29-80

/F13
----

FILIO: Be picky - set alarm & pretty up hung msg - Darren 9/30/80



P034/H
------

/G01
----
Smerged F3 stuff into /G monitor. New modules APXKON, F3TSER.
/EVS 11-11-80

/G02
----
UUOCON: added U.FIXR and U.FLTR to simulate FIXR and FLTR instructions
on the F3 until the microcode is fixed.  /WRS 11-13-80

/G03
----
UUOCON: Make U.FIXR work for negative numbers in the same wrong way
the hardware does.
SCNSER: Make HANG UUO check against RPORTN rather than PORTN to
prevent zappers being sent for PTYs. /Darren 13-Nov-80

/G04
----
COMMON: Allow CONFIG to define RPORTN and PPORTN and have PORTN
computed. /WRS 11-25-80

/G05
----

Fix comment at head of SETALP UUO to reflect reality. /TLC 12-2-80

Added Darren SETE password #4.
Removed Lee Blton's SETE password #4.
/WRS 12/03/80

/G06
----

CTYSIM: Fix ^ZL loginn sequence to accept lower case L.  Pull CTYDO out
and declare it external.
ONCE:	Add CONSOLE command to those accessible when sense switch 4 is
set.  It sets CTYDO etc. to come up manually in CTYSIM standalone mode.
COMMON:	Added NXTLPT:: EXP LPRUN for LPTSER to test to find out how many
LP20s the monitor was configured for.  0==> non-existant device.
LPTSER:	Fixed bug by adding PXCT 4,[] arround HLRZ T3,(M) in VFU code.
ONCDSK:	Took out the RMA# IS OFF-LINE/NO RESPONSE messages IFKMC<>.
CIOPR:	Fix for NODLOD. Don't set DRDO just because KMCDO was off when
deselecting a DR.  This causes crashes when running from the CONSOLE.
/GL 12-6-80


/G07
----
Fixed bug which had symptom of causing crashes at MAPF34+4, USEOUT+3.
RIBs would get areas where there were 0 pointers when there should
have been a real pointers. Problem was that code changed DEVRIB
prior to reading in prime rib for file, and DDB pointers were
still valid and from the spare rib. If another job was sharing file
and went looking thru DDBs for pointers, it would find these pointers
and copy them, DEVFLO, and DEVRIB from the DDB which was in process
of reading in the prime rib. Therefore, the copied pointers were
from another rib other than the DEVRIB one. If these poiners were
written back out, prime rib could get smashed with pointers
that didn't belong there. This bug could also cause GIVPGK crashes,
since it could cause same pointer to appear in two places in the file.
Fix is to invalidate DDB pointers before changing DEVRIB. In NXTPT0
this meant just turning on sign bit, since need the value of DEVFLO
throughout the routine.
Rib validate CHANIO, USETST, NXTPT0 changed to fix this condition.
/EVS 12-8-80

Changed ENTER and RENAME so that it requires WA to set or clear
ATPPID and ATPALC. Previously to this any program could clear
either of those bits, and JL and WF programs could set them. /EVS
12-8-80

Fixed bug where 1)Lookup file 2) Do some input on it so ATB stays
around after close 3) Do truncating RENAME 4)Lookup file sometime
later while FNB still around 5) Close file caused
crash due to FNBALT being set to -1. This was because truncating
RENAME code didn't set FNBALT and RIBALT after finishing
the allocation change. (Slight oversight in doing fast DSKCLN
file system change.) /EVS 12-8-80

Fixed potential bug where doing CLBMEM UUO could screw up
by not giving all club members if job doing CLBMEM UUO
got rescheduled in middle of returning club IDs (could happen
if page fault for user's page) and someone left the club.
Was not likely to happen, but it could if the club membership
card got reused before CLBMEM job started up again.
Fix is to check to see if any jobs on system have left a club
and start UUO over if they have. /EVS 12-8-80

Attempted to solve IL club interlock problem for general case:
Don't give club interlock to job with MRQ set unless RNDBIT
is set in the system uptime (RNDBIT is an attempt to be fair
every once in a while on a "random" basis) unless that job is
the only one who needs the interlock.
/EVS 12-8-80

SCNSER: Fixed cache bug in block output that was discovered
by inspection (cache bug was suspected, but turned out to be
some other problem). BIOCSH set too early, before copying
data from user space to the block I/O buffer. Move this
to after data is BLTed to the block I/O buffer. /EVS 12-9-80

/G08
----

S: Added macro MAPONC to define symbols for once module sizes;
ONSZCK to check if enough pages have been allocated to a particular
once module and print an error message if not.  Changed once module
page allocations to 3 for REFSTR, 6 for ONCDSK, and 3 for ONCE (the
minimum sizes). Commented out the RES page allocation.  It is not
yet clear if this is valid.
REFSTR,ONCDSK,ONCE: Call ONCSZCK to check if module is larger than
number of pages allocated to it.  /TLC 12-11-80

FILUUO: put in Ernie's patch to fix GIVPGK crashes (WRTOK2+n)
/WRS 12-20-80

/G09
----

CORE1: Introduced new routine REPOK to check to see if a page selected
by the uws or mws alg is bumpable (i.e. doesn't have DIO up or isn't
locked).  Call REPOK from uws and mws code when a page is selected
to be replaced.  Previously these checks were only done in the mws
alg so it was possible, for example, for the destination of a BLTPAG
to be the page selected for replacement if uws full and a fault occured
on the source page.  /TLC 12-29-80

/G10
----

COMMON: new gettab stuff for sake of patching,
CONFIG+37/ -len,,patch		; this is for static patch area
CONFIG+40/ -len,,ttyini		; this is for dynamic patch area
and a few for the sake of CRSHID, and real users,
CONFIG+41/ cputype index...of (KI,KL,KS,F3)

/G11
----

CLUBS: Fixed random function in RELINL to work correctly - must
use mask to test bits, not just test bit. /EVS 1-5-80

FILUUO: In CLRACH, turn off ATPALC if FNBALT is greater than
PCDTIM, since in this case RIBALT must have been from a previous
incarnation of the monitor. Installed this so that merely
looking up a file and closing it will clear ATPALC if it got turned
on in a previous monitor most of the time. This is so the program
CLRALT will still be able to clear ATPALC after an all files restore,
in which all ATPALC bits are on, even if the system crashes.
/EVS 1-5-80

SCNSER: Fixed GOTBUF routine to not mangle PDL in the case where
there is contention for block I/O input buffers. /Darren 08-Jan-81

CLUBS: FIXED BUG IN CLBINI UUO THAT CAUSED IT TO RETURN THE ID
OF THE CURRENT JOB RATHER THAN THAT OF THE JOB HOLDING THE
LOCK.  /TODD 1-13-81


/G12
----

S: CHANGED PAGE ALLOCATION FOR ONCE FROM 3 TO 4 FOR KS. /GL 1-14-81


/G13
----

COMMON:	Put back two lines lost in the F3 smerge that point to the
2020s tape DDBs. /GL 1-19-81

/G14
----

LPTSER:	UUO to reload LP20 VFU now error returns if LP is off-line.
/GL 1-21-81

/G15
----
COMMON, UUOCON, FRMSER: Add FRMOP to read & write frame attributes;
Add UPTLOG (copy of LDBLOG) to UPT & make it frame attribute # 1.
/Darren 22-Jan-81

/G16
----

SCHED1: Moved TI queue higher in swap out priority, just below
SL. Reason for this is alleged problem reported in Paris
concerning ML waiters getting swapped out when TI jobs were still
hanging around in core, causing PCB resource turnaround to go
way down. Observed this on C29 (Coees). Moved TI to be swapped out
before any sharable resource wait, since sharable resource
waits should normally not be long. This may not be exactly right
because of other low priority reasons for going into ML wait
(Aux circuit wait, block I/O stuff, etc). /EVS 1-22-81

SETETY:	Moved Todd to 4 and Darren to 6.  Added Macros and PRINTX to
allow definition of industry SETEs in CONF##.MAC (2020s only).
/GL 1-23-81

SETETY:	Added Carl at 7.  /CARL 1-23-81

CONF37: CONF54: CONF56: increased ports to 127, bpa to 16, fta to 4,
except 56 which ports still at 60 due to wierd base.  Note some of these
things were already as specified.  Per request from Tom Marconi.
/WRS 1-29-81

F3TSER: Fixed bug that caused random location to get clobbered
in MAGINI (GETST smashes T2, but MAGINI uses T2 as AOBJN pointer.)
/EVS 1-28-81

F3TSER: Added support to make IBM mode (zero byte adjust only)
work. /EVS 1-28-81

/G17
----

SCNSER:	Added IRPMSG to hold 1st word of input message currently being
processed.
COMMON:	Corrected address of KMC control register 0 to 760540 from
760541 in the crash code to reset the KMC's RUN bit. /GL 1-30-81

/G18
----

ONCDSK: Added R,RE,REF,REFR,REFRE commands to say type REFRESH.
Changed ARE YOU SURE to Say that it deletes all files to do a refresh
and if they really wanted to do it. /CAB 2-2-81

COMFAK: Fixed defaulting of PORTN,RPORTN,PPORTN so it says what it has
and doesn't bother with the rest.  /WRS 2-2-1981 AD

FRMSER: Re-do read/write frame attribute FRMOPS to match spec.
	FRMOPs to read, write or write/read (exch) frame
	attributes.  Format of call is:
		MOVE	AC,[FN,,FD]
		FRMOP	AC,ADDR
		  <ERROR>
		<SUCCESS>
	<ADDR>:	Attribute #,,<Argument address>
			OR
	<ADDR>:	     0,,<Argument block address>
		-COUNT,,<Attribute list address>
	-----------------------------------------
	On error return, FRMOP error is in AC right, positive
	index into argument/attribute table is in AC left.
	-----------------------------------------
	FRMOP function codes are:
		36 - Read frame attribute
		37 - Write frame attribute
		40 - Exchange (read, then write) frame attr.
/Darren 02-Feb-81

/G19
----

SEGCON: fixed LOGOFF uuo to not allow starting LOGOUT at ***ANY***
address.  /WRS 03-Feb-81

COMMON: fixed SBDIAG instructions (@ERASTS) to select controller
#4 (DMA20), and perhaps retrieve useful information. /Darren 06-Feb-81

SCNSER: Added ^H==RUBOUT Feature. AUXCAL '77, TTY BSD "BackSpaceDelete".
Also saving start of last 3 IRING messages in IRPMSG, IRPMS2, and
IRPMS3 to catch KMC bug.  Also to blink 2020 state light. /GL 07-Feb-81

SEGCON: added "<" and ">" in addition to "(" and ")" in usernames so
more software will work.  /Carl 07-Feb-81 THIS HAS BEEN BACKED OUT!

/G20
----
PICON: (KL only) Do SBDIAG and RDERA on every APR interrupt.
	***NOTE*** This information is stored in PICON:SAVERA and
	PICON:SAVSB0+1. Disable Sbus errors when disabling MemBusParity
	errors. Type out APR status, ERA, and SBUS function 0 on
	every parity error before sweeping core. /Darren 10-Feb-81

COMMON: Put JBTWRS (job state trace) table back in.
CLOCK1: Restore calls to WRSMAP routine.
SCHED1: Restore WRSMAP routine and calls to it, minus 2K MAPQUE
	table; check in PAGWAK for job going into SS from state
	other than SW. /Darren 10-Feb-81

/G21
----

ACTSER, UUOCON, SCNSER: Added more general support for variable length
accounting records.  Creaux record changed to be old creaux record with
login string appended.  /TODD 2-11-81


/G22
----

FRMSER: Fixed confusion in FRJSLO (gate jumps) about what was in P4 -
SLIGOS was getting "bad frame number" error returns because
frame handle address was in P4 instead of frame handle index number.
Cure is to refetch index out of user AC. /EVS 2-13-81

ACTSER: Zero bit 35 in last word of login string.  Read from beginning,
not end, of login string.  /TODD 2-17-81

/G23
----


ACTSER, UUOCON: ACT UGETF now sets sign bit if record is variable length.
New symbol VARMIN is minimum legal length of var len stream records.
	/TODD 2-18-81

/G24
----

SCNSER:	Added TTY RBS command so we can turn "remote backspace echo" on
(and off!). Also added somemore KMC debug code.  /GLYONS 2-19-81

/G25
----

ACTSER: Added missing entry for CHKPNT uptime rec to SPCACT table.
/TODD 2-24-81

/G26
----

SEGCON: "<>" hack backed up to previous source file without.  /CARL 2-26-81

/G27
----


ACTSER, UUOCON:  Added minimum legal lenth field to info maintained for
stream accounting records.  This field is zero if record is fixed length.
	  /TODD 2-26-81

/G28
----

SCNSER:	Doubled high character limit for 2020s form ^D1000 to ^D2000 tcompliment the KMC bug fix.  /GLYONS 2-27-81

LPTSER: Changed title of KS version so that KS and KI,KL versions can be on
the same master cref.  /TODD 3-17-81

CLOCK1: Put code to ignore ucycles for Foos in IFCPU conditional.
Also put F3 Printx msg in IF2 cond to avoid having it appear in .LST
before module title which screws up FSHSPL.  /TODD 3-17-81

P034/J
------

/H01
----

FILUUO: changed code in close (CLSN2B) to not force access date
to be updated when ATPALC is being cleared unless the file was
actually accessed (ie. INPB or MAPB are on).  Note: ATPALC will
still not get cleared if CLSACC is set in the close (inhibit
access date).
/WRS 3-17-81

CLOCK1: Put setz t1, to zero microcycles for F3 in IFCPU(<F3>).  /Todd 3-17-81

SWAMP: Call SLOCLE when the first bad sat is discovered so that a slow
DSKCLN is rquested by monitor.  /Todd 3-17-81

Changed Configuration files for various systems to reflect the following:
System V70 is the new name for the old V25
D37 has 128 ports 110 frames 16 bpa 4 fta on a KL processor
D54 has  79 ports 100 frames 16 bpa 4 fta on a KL processor
D56 has 100 ports  80 frames 16 bpa 4 fta on a KI processor
D65 has 100 ports  80 frames 16 bpa 4 fta on a KI processor
D25 has 100 ports  80 frames 16 bpa 4 fta on a KI processor
Changed MONxx.CMD, CNFNxx.MAC and CONFxx.mac  and added sysdat of 17-Mar-81
for the new systems.  /CARL 3-17-81

FRMSER - Page 21, Fixed comment "MOVE ac,[fd,,fn]" to "MOVE ac,[fn,,fd]"
as per documentation in the YAMM and the code reflects.  Typeo!  /CARL 3-17-81

/H02
----

FILUUO: New entry point SLOCLE can be called to force full DSKCLN.  Same
as SLOCLN except is called with a pushj and returns to next instruction.
FILIO: Changed SLOCLN call to SLOCLE.
SWAMP: Added code to cause a full DSKCLN if an output error on a SAT
is detected.  /Todd 3-19-81

/H03
----

FRMSER: FRMOP function to read effective rights always returned zero
for created process handles. This is because check for PNO of created
process handle was made against JBTSPN instead of JBTPNO. Fixed this.
(Found by SLIGOS).
/SOCCI 3-20-81

/H04
----

F3TSER: Fixed bug in error detection code at end of reads ad OD.RF.
Added new error bit TIMOUT that Poole told me about.
/SOCCI 3-20-81

/H05
----

UUOCON: fixed bug in DATUUO for converting from 1 word format.
/WRS 3-20-81

/H06
----

UUOCON: fixed the rest of the DATUUO bug.   /WRS 3-20-81

UUOCON: made SIMINS flag a suppressed symbol.  /WRS 3-20-81

P034/K
------

/J01
----

F3TSER: ADDED IN CODE TO DO READ INTERRUPT TYPE TAPE TRANSFERS.
ALSO ADDED READ AND WRITE ERROR RECOVERY CODE, SINCE NEW MICROCODE
DOESN'T DO WRITE ERROR RECOVERY ANY MORE. THIS VERSION OF F3TSER MUST
RUN WITH THE NEW TAPE MICROCODE - WILL NOT RUN WITH OLD TAPEMICROCODE.
NEW TAPE MICROCODE WILL SUPPORT EITHER OLD OR NEW VERSION OF F3TSER.
/EVS 4-21-81

/J02
----

FILUUO: Dskclr mode 0 now sets Adjmws to -1.  /Todd 5-1-81

F3TSER: Discovered that new OVRRUN bit (overrun of tape channel)
comes up when reading record longer than channel word count.
Changed OD.WF status checking code to allow this to happen.
(not good that can't detect combination overrun and length error).
/EVS 5-1-81

/J03
----

COMCON: Added UNDEL command to call the file undeleter program. /Todd 5-5-81


/J04
----
F3TSER: Discovered that EOF bit is really EOT indicator on writes.
Indicates reading a file mark on reads. The real EOT bit in tape status
only says tape is at exactly EOT. Changed forward and back record,
write gap and write tape mark, read and write interrupt routines to
reflect this. Now, IOTEND will only come on on writes, IODEND will
only come on on reads. Program is responsible for detecting two EOF marks
as logical EOT on reads. I don't know if this is compatible with our other
tape services. /EVS 5-8-81.

/J05
----
F3TSER: Make OD.SKR and OD.BSR always clear IOLEND and IOTEND after J04
change took that behavior away. Set TUBSB in tape UDB on hung
tape transfers. /EVS 5-8-81.

/J06
----

COMCON: Modify WSCTL CALLI to not change JBTSTS<JWSADJ> on read-type
functions.
/DARREN 5-13-81

SCNSER: Fix for the "Messy Screen" KS Block I/O bug. at GOBIO2+13,14,15.  /GLYONS 5-13-81

COMMON: Fix for the primitive RM/RP drivers to wait a few ms before
testing to see if write done so as not to saturate the unibus.
/Todd 5-14-81

APXKON,FILIO,COMMOD: New disk driver. Has hung disk code fixed,
multiple transfer capability (doesn't call FILINT for each page transferred
if a group of contiguous pages is started, instead calls when all pages
in group are finished). This saves some CPU time, and also
was done to attempt to be able to reduce the time between end of last page
transfer and beginning of next page in less than 60 microseconds.
However, disk I/O rate didn't speed up at all, indicating that must
start the next transfer in less than 60 microseconds. I timed PI cycles
at 42 us, and time it took from after PI cycle to time next transfer
was sucessfully started at 42us, for total of 84 us. /EVS 5-19-81

/J07
----

Removed Ginzburg's SETE password.  /WRS 5-21-81

APXKON:  Fixed bug in disk driver which forgot to turn off disk
conroller "idle" flag after a transfer - caused lost tape interrupts,
since tape would interrupt and disk control idle flag would still be
on.  (Foonly interrupts aren't like interrupts on the other machines,
where as long as the interrupt flag is on the interrupt will keep
coming in.  You only get one interrupt when the flag is set by the
microcode (microcode keeps a count for every channel of how many
flags were set for each channel)). /EVS 5-26-81

/J08
----

Added the XMAGNUM command to COMCON to run (SYS)XMAGNU.  /WRS 5-26-81

/J09
----

COMMON:	Slight change to KS primitive disk code that TODD fixed to handle
4 or more disk drives on the KS.  wouldn't complile because macro doesn't
like "100." as a notation for 100 decimal.  Changed 100. and 2000. to
^D100 and ^D2000 (near symbol RMP1:).  /GLYONS 6-8-81


/J10
----

SCNSER: Moved command request and forced command bits from the left
  half of LDBDDB to the left   half of TTYTAB.
- Remove the spare LDB and all of its associated merde.
- Overhaul the ZAP/HANG code to reflect the aforementioned.
- Remove TTYCOM, COMWCM, SETKIL, and TTFCOM.
- Modify LOGIN/TTYINI/INISET to assign frame number before forcing
  command.
- Don't allow aux circuits to log into a shut system.
COMCON: Moved forced command/command request bits into left half of
  TTYTAB.
- Overhaul command dispatcher, assuming job number is always assigned.
- Add the following routines:
  * CHKKIL - called at end of command dispatch to see if job needs
    to be killed (copied/modified from SCNSER:SETKIL).
  * COMKJB - kill a detached job/frame.
  * COMWCM - Set command request &/or forced command for a frame
    (copied/modified from SCNSER:COMWCM).
  * COMCMR - Command finish-up (copied/modified from SCNSER:TTYCMR)
  * TTFCOM table - copied from SCNSER.
  * FRMCOM - Find a frame with command pending (copied/modified
    from SCNSER:TTYCOM).
FRMSER: Extract FRMASN (Assign Frame Number) routine from CREFRM
  and make it callable from LOGIN in SCNSER.
UUOCON: Changed RLSLDB UUO to CPOPJ.
COMMON: Define COMFLG bit table in jobs rather than ports.
- Change LINNTB to BITNTB and redefine for general use.
- Remove now-extraneous PVZHNG byte pointer.
- Delete now-unused LINTBE definition.
CLOCK1: Move TIMSET and TIMRST argument words here from SCNSER and
  add CLKJOB byte pointer for writing job # into them.
PICON: Use CLKJOB instead of hard-coded byte pointer.

/DARREN 6-9-81

/J11
----

COMMON - Remove symbol SETWCH, no longer used.
CLOCK1 - Clear JBTWCH in CLRJBT, prevents job from getting previous job's
  WATCH setting.
/DARREN 6-10-81

/J12
----

PICON - Make APR console messages more precise and more verbose for maint.
  engineers who turn out to need almost as much hand-holding as operators.
/DARREN 6-10-81

/J13
----

ONCE:	Added a warning message when bringing up a 2020 manually to the
effect that "the KMC will not be loaded so the Host will NEVER synch. with
the Base".  Also made the CONSOLE command available to non 2020 monitors.
/GLYONS 6-19-81

/J14
----

UUOCON:	Define CIOPR for F3 as well as KS.
CIOPR:	A quick debug version for the F3.  Doesn't work yet but won't hurt
anything.    /GLYONS 6-20-81

/J15
----

COMCON - Fix problem where jobs would get hung with command pending
	because COMCNT was zero, caused by cases where job would exit
	from command dispatcher with different job number than that
	with which they entered (e.g., ATTACH).
/DARREN 6-22-81

/J16
----

SCNSER: Input and skip auxcals will no longer go into wait when there are
echo chars, but no input chars and no chars can be converted (because of
backpressure, etc.).  Also, if a job becomes detached after an inc and
skip auxcal has begun execution, the auxcal will error return.  /TODD 6-29-81

/J17
----

SCNSER: Execute echo logic even for a backpressured port.  Don't allow
output if it is attempted.  This allows echo characters to be converted
into input characters when a port is backpressured and echoing is turned
off (as for an aux circuit).  /TODD 7-7-81

/J18
----

SCNSER: Fix code to allow echo when backpressure on.  /TODD 7-7-81

/J19
----

SCNSER: Allow backpressure off to be output on a backpressured port.
Change definition of BPOKBN to fix off-by-one error.  /TODD 7-7-81

/J20
----

SCNSER: Clear SKPFLG befor ABTUUO is called in TWAITC.  /TODD 7-8-81

/J21
----

SCNSER: Process only data present in input ring at start of processing
before servicing the output ring.  This should solve the problem of character
lossage that results from reading too much data for one port before
backpressure can be applied.   /TODD 7-14-81

/J22
----

removed E.Socci SETE password
removed G.Lyons SETE password
changed W.Soley SETE password
/WRS 7-17-81

IOCSS - Add BFICLN fix which forces "previous context user" before trying to
clear user's input buffers, thus preventing STKAC crashes.
/DARREN 7-23-81

SCHED1 - Change AOS BADSS to STOPCD at PAGWK1+2 in yet another further
attempt to track down JBTPGO loop bug.
/DARREN 7-23-81

UUOCON - Always allow (SYS) programs to write to the CTY.
Logoff programs that SETNAM to EUTHAN (giggle).
/DARREN 7-24-81

FILRIB - Add hack at RIBEX2 to insure correct value for RIBSZS before trying
to expand RIB (to be removed when problem has been diagnosed more thoroughly).
Also count number of times each of the RIB expansion routines is called.
/DARREN 7-24-81

/J23
----


SCNSER: Added routine BPTEST to test to see whether few enough chars remain
to be read such that backpressure can be turned off on a port.  Call this
routine where necessary.  Previously backpressure was turned off too often
causing the number of unread input chars for a port to progressively increase
until chars were thrown away.  Changed TIHLTN to be max number of chars in
input ring for one port so that backpressure on has a chance to be put in the
output ring.  Fixed code at TTYSTR to consider both def and remote echo
break chars.  /Todd 7-24-81



/J24
----

SCNSER: FIXES TO ABOVE.   /TODD 7-24-81

/J25
----

RMXKON: inserted fix for RMX ECC bug that was patched on 654 and
seems to work.  Simply forces page transfer when doing retries
since block transfers seem to not work very well.
/WRS 7-27-81

SCNSER: Extended Trmtab to include entries for new terminal types supported
by Tymnet.  /TODD 7-28-81

COMMON - Redefine SCNN (# TTY DDBs) to JOBN+PORTN+1 from
MAX(JOBN,PORTN)+AXDDBS.  Incidentally, symbol AXDDBS is now
extraneous (i.e., never referenced anywhere).
/DARREN 7-29-81

/J26
----

Added 2 new entries to CONFIG table in COMMON:
    PATMAP= CONFIG+42/ bit n is on if patch n is installed
    MONID= CONFIG+43/ sixbit serial number of monitor in form M#####
	changed for every monitor to prevent confusion when config
	changes or such.
/WRS 8-13-81

/J27
----

RMXKON - Correct RMXADD to give error return only when actually attempting
to read past end of cylinder (previously gave error even when reading up to
the end).
/DARREN 8-14-81

RMXKON - Check for zero offset before backing up to previous block, thus
preventing exec page faults in ECC correction routine DATERR. (Ernie's fix)
/DARREN 8-16-81

COMCON: Remove check for non-zero job number upon return from command
dispatch, since we no longer depend on it for updating the tables.  This
fix will prevent further crashes at COMDIS+5. /Darren
/DARREN 8-17-81

IOCSS: Added Chanio function 46, .chnxt.  If Chan is -1 the number of
the next free chan is returned and the chanio skip-returns.  If Chan is
a legal chan #, the chanio skip-returns if the chan is not in use.
Otherwise, the chanio non-skip-returns.   /TODD 8-17-81

/J28
----

CIOPR: fixed bug which left interrupts enabled after a nodeload.
/ernstd   /TODD 8-24-81

/J29
----

IOCSS: Set the "previous context user" bit to user before doing a buffered
mode close and restore to previous previous context user when done.  This
is necessary so that the monitor can do a close on chan 0.  /TODD 8-24-81

/J30
----

COMCON - Put COMDIS+5 crash check back in - will fix individual commands
instead.  /DARREN 8-25-81

FILUUO - Fix DSKCOM command to always restore J before exit.
/DARREN 8-25-81

/J31
----

CORE1: fixed code in DOXCT routine which handles UXCT## macros to not
reference 1(P) so that interrupts might be less devestating.  /WRS 8-27-81

/J32
----

F3TSER: Changed OLDMOP to use exec virtual locations starting at %ONC instead
of page 500.  This is necessary because page 500 (and above) may be used for
other things in a big enough monitor.  Hopefully the use of %onc to %onc + ?
is not in conflict with anything else.  There is currently no good way to
know precisely which exec virtual pages are "claimed".   /TODD 8-31-81

/J33
----

F3TSER: Minor change to above F3TSER change.  /TODD 9-1-81

COMMON: FILUUO: changed crash code to pickup PCs from STOPCD(SLO) and
STOPCD(NO) in a more structured and accurate manner.  Also STOPPC will now
only get decremented when it contains a real PC so DEP in 30 will not
show up as STOPPC/-1 anymore.   /WRS 9-1-81

/J34
----

FILRIB: Remove RIBEX2 hack, add better checks in RIBCK1 for consistency
between RIBSZS and RIBSNM, and fix DLTSRB to adjust RIBSZS when RIBSNM has
been decremented to zero.
/DARREN 9-2-81

/J35
----

COMMON: Do a TNCONO for F3s when sys comes down to tell the node that
the sys is down.  This allows the node to resync with the host much faster
because the node waits ~1 min. after it first learns that the host is down
before resynching.  /TODD 9-2-81

Changed terminal characteristic fields for IR and OR (input baud rate and
output baud rate) to 4 bits from 3 bits to be compatable with Tymnets new
codes.  Change is actually per DWS.  /WRS 9-2-81

CORE1: Make sure VALID and REMOVE set up J before calling PAGWAT.  This
should prevent any more JBTPGO loops, but it's hard to say since the
problem couldn't be duplicated reliably.  /DARREN 9-9-81

/J36
----

COMCON: Fix TIME command to restore job # after an attempt to get time
on another job without appropriate lic.  Caused COMDIS+5 crash when TIM 0
tried.   /TODD 9-10-81

COMMON: Created the crash data block (CRSDB) where all important crash
data is storred in an orderly defined manner so programs like CRSHID can
get at them without symbols or other kludge.  /WRS 9-11-81

/J37
----

UUOCON: Set Jbtslc to Max Jbtslc and new process lic in Setlic.  This allows
process lic to be reduced and then restored when proc lic was increased
by a previous Setlic past Jbtslc.  This can occur if frame lic increased
by a sete or another frame.  Problem occurs when frame lic is reduced after
proc lic is increased.   /TODD 9-16-81

S.MAC: Added access right 32 for license passing.  /TODD 9-17-81

/J38
----


COMMON: Add new UPT location UPTMTM (micro-cycle timer) plus new interrupt
type (15) and byte pointer JBYMCY into trap word UPTTP1 (which is now full).

CLOCK1: Add routine CHKMTM to update micro-cycle timer (called from TIMADJ).

UUOCON: Add CALLI -144 SETMCY (Set Micro-cycle Timer).

PICON: Add routine SETMCY (called from UUOCON) to set micro-cycle timer.
/DARREN 9-21-81

/J39
----

ONCE: Changed the SCAN and SCNTB macros to allow for a more versatle
set of commands and options, and to ignore the UNI and STR fields needed
in the corresponding macros in ONCDSK.  Modified the CMDSCN routine from
the ONCDSK module to work with the new macros and made it local to ONCE.

ONCE: Added the FULL command for bringing up the monitor to run a FULL
      DSKCLN for this time only.  Nothing is written in the HOM pages.
/CARL 10-9-81

/J40
----

Scnser: Tihltn <- 2 * size input ring (in chars) + Tiwrnn.  This should
reduce character losage for bases that don't know when to quit sending
us characters on one port.   /TODD 10-13-81

Note: Lospdp does NOT necessarily mean that we're too slow in requesting
backpressure.  Consider:  host receives .ge. tiwrnn chars so requests
and sends bp on, next time thru i ring lopbpn gets set again because
# chars is .gt. tiwrnn and .lt. tihltn, enough chars are present in
ring so that further reading of chars causes tihltn to be exceeded.  This
may (should) be changed.   /TODD 10-13-81

/J41
----

ONCE: Again modified SCAN and SCNTB macros.  Moved CMDSCN routine back
      into ONCDSK.  Changed FULL command to be highest priority even to
      override DSKCLN xxxxxx set by FILES.

      Made FILES command harder to enter by asking for verification to
      enter the ONCDSK dialogue.

ONCDSK: Modified SCAN and SCNTB macros as per ONCE.  Added some better
      documentation in the HELP messages for the commands.  Added a bit
      to the SCNTB macros to require verifiation of individual commands.

      Removed earlier edit for REFRESH command and cleaned up some of
      the associated code.
/CARL 10-15-81

/J42
----

S:  Bumped counter OND in MAPONC macro from 6 to 7 because ONCDSK
    grew some.  /CARL 10-15-81

/J43
----

Scnser: Make Auxcal function 10 behave like Skpinc for command port.
Previously would assume chars were present if a command was waiting
to be rescaned.   /TODD 10-16-81

Scnser: Don't wake job if backpressured port that is not in input wait
attempts to echo a character.  /TODD 10-21-81

SCNSER: Added AUXCAL 100 (.AXTTP) to set sixbit terminal type.  Added
 corresponding 'TTY' command (TTY TYPE FOO).  /dws
/DWS 10-23-81

/J44
----

ONCE: Fix problem with SCNTB macro under IFKMC < ... > conditional.
It seems that IFKMC translates to "REPEAT 1," and an extra set of
angle brackets "REPEAT 1,<< ... >> causes MACRO-10 to break generating
correct code, but producing assembly error messages.  Changed SCNTB
macro to omit the duplicate "<>"'s allowing a clean assembly.
/CARL 10-28-81

UUOCON: Fix typo in setlic mod to update Jbtslc.   /TODD 10-28-81

/J45
----

Changed SETE password.  /WRS 10-29-81

/J46
----


Scnser: Fix an earlier fix.   /TODD 10-29-81

/J47
----

Scnser: Change parameter name for tty command to set terminal type to
"class" from "type" since type was already taken.   /TODD 10-29-81

/J48
----

Common: Fix bug that caused free core Aobjn pointer to have its length
set too large if the size of the free core bit table is greater than
^D144 words.   /TODD 11-3-81

/J49
----

ONCE: Removed "Entering ONCE ... type HELP for help..." message.

ONCDSK: SHORTened the verification message to ask "Are you SURE you
      want to do this? " instead of very long message.  /CARL 11-5-81

Core1:  Location Maxcor contains the beginning of free core relative
address of the highest free core block assigned.  Accessable via
Getlnk gettab.   /TODD 11-6-81

/J50
----

F3tser: Fixed Oldmop to work with odd %onc.   /TODD 11-6-81

/J51
----

ONCE: Accidentally deleted label HLPCMD: while shortening messages.
      Checked code & renamed label HLPCM1 and all references to HLPCMD.
      Verification still re-types the HELP text for the command which
      needs verification.  /CARL 11-6-81

COMMON: changed defaults for PPORTN to JOBN/2
/WRS 11-10-81

/J52
----


F3tser: Setup Oldmop buffer byte pointer correctly.  /TODD 11-12-81

/J53
----

F3tser, Magser: Fix buffered mode tape op to work when buffer empty.  Two
problems were present: (1) SRFX didn't return properly for empty buffer.
(2) MT resource was not released when buffer was empty.  /TODD 11-13-81

/J54
----

COMCON: Modified DAYTIM command code to display the time zone immediately
after the date and time display.  Currently "unknown" time zones have the
letter designation as copied from the YAMM.  For daylight-savings time,
the associated codes have a plus-sign "+" after the letter.

COMCON: Moved routine PRTIME out of the daytime command and made it
callable to return "hh:mm:ss" on the current output device.  Routine
PRTIM has been changed print 2 digits each for SS.HH although it may
leave out HH:MM:.... if both are zero.  Will also print 2 digits for
minutes.  (uses common code from PRTIME).

COMCON: Removed "TVEDIT" command from the list of RPG commands since
noone uses it (as per WRS).  Added "VUE" command in its place for that
time when VUE is added to RPG.  (Maybe soon?)

UUOCON: Made routine DSTCHK internal so that the daytime command can
check to see if the current time/date is between periods of daylight-
savings, as per the table in uuocon.  /CARL 11-18-81

/J55
----

COMCON: Changed WATCH-DAY routine to use PRTIME instead of PRTIM.  We
don't want to see hh:mm:ss.hh for time of day.  However, we are leaving
out the time zones from this command.  Also, fixed code which printed
out a clobberred register as the hundredths of seconds.  Now works ok.
/CARL 11-18-81

/J56
----

IOCSS: Get UPT and UPX locks in cannonical order (lowest frame number
first) in Vreplu to avoid deadlock.  /TODD 11-18-81

/J57
----

Frmser: Install Sligos fix to Chepar.  Previously right of parent
instead of child was being checked.  /TODD 11-20-81

/J58
----

Doubled SAT and RIB PCB allocation for 38 on a hunch.   /WRS 11-20-81

/J59
----

COMCON:  Changed time-zone table to reflect JST and JST+ for Tokyo (I),
         to print WET for GMT+daylight, EET for CET+daylight, EEDT for
         EET+daylight (Europe).  /CARL 11-24-81

ERRMSG, UUOCON: Define new error class 3 (ill inst trap) subtype 4 to
be called when an illegal CALL parameter is given.  Previously a
non-existent CALL would do a SEEK.  /TODD 11-30-81

/J60
----

FILIO: Turn on disk PI at end of UUOSK1.  On FOOs this caused sys to hang
after a SEEK because of a ucode bug: if PI n pending, but off and m pending
and on where m>n, m will not fire.  On other than FOOs ch7 (or something)
turns the disk PI back on. /TODD 12-1-81



CONF??, COMMON, CLOCK1: Delete extraneous conditional assembly switches from
CONF?? files and from monitor.  The following symbols are now useless:
	SYS40N, SYS50N - we no longer use DEC disk service
	DSKN - yes, we have disks on our systems
	LEVDN, LEVCN - refs to DEC level "C" and "D" disk service
	PDP10N, KT10AN - we have no PDP-6's
	DDTN - always included
	MOVIEN - we don't dump to line printers
	DISN, PENN, T340N, TVP10N, T30N, DTAN, DTCN, MTAN, MTBN, MTCN -
		- obsolete DEC peripheral devices
	TEMPN, TMPN, TMPLN - yes, we have TMPCOR
	LOKN, CMNN, RTTRPN - misc. obsolete DEC switches
/DARREN 12-2-81

/J61
----

COMMON,
S, PICON, CLOCK1, SCNSER, CLUBS, ERRCON ,SEGCON: Fix probs. with Hiber return
and interrupt on wake uuo and exit in child identified by Sligos.  A new
flag, EXCFLG, now exists.  It's function is analogous to WAKFLG.
JBYFEX, child frame exit channel number, has been replaced with JBYEXC.
Previously WAKFLG served both function and confusion resulted. For example,
Hiber on Wake would return on exit in child.  WAKFLG, EXCFLG are now
set only when TAKTRP isn't called.  This avoids getting two interrupts/
hiber returns for one cause.  For same reason JBYFEX, JBYWAK are cleared
in TTSCLR.  WAKFLG, EXCFLG are also cleared in SEGCON (so that a wake/exit
directed to previous process will not affect the new process) and at
logout.  Note that the behavior of wake and exit in child are now sufficiently
different from the past so that programs that were were written to cope
with the bugs may not now work.  In fact, some may sleep forever waiting
for a second interrupt which won't come.   /TODD 12-4-81


/J62
----

COMCON: Changed table entries for time zones to those agreed upon with
        international.  Zones 60,61 and 62 (european daylight times)
        have been renamed "WEST","CEST" and "EEST" for Western, Central
        and Eastern EUROPEAN SUMMER TIME.   /CARL 12-7-81

/J63
----

SCNSER: Clear LOPBOP (PTY block-output-in-progress) flag in BIOZAP, so that
receiving a zapper on a PTY port in block I/O mode won't crash at PGBOP+2
as it used to.  /DARREN 12-8-81

SCNSER: Fix TIHLTN value calculation.  /TODD 12-10-81

SCNSER: Fix bug that caused Inchwl to deadlock a job if job was backpressured
and less than Tiwkc chars were waiting to be read.  Now Inchwl will return
any time chars are waiting and port is backpressured.  /TODD 12-10-81

/J64
----

ONCE: Fix reference to HLP'CMD: to reset T1 and have all other
references jrst to HLPCM1 which assumes T1 is already setup.
(Fix to fix for missing label).
/CARL 12-21-81

/J65
----

P034/L
------

/K01
----

S: Changed the IFCPU and IFNCPU macros to "repeat cpzz" instead of
   "repeat cpzz," so that IFCPU(x),< ... >  would not generate two
   commas.  /CARL 12-28-81

PICON,ONCE: Fixed Typoe of "IFCPU (x),< mumble >,end ..." which should
   have been "IFCPU (x),< mumble > ; end ... "  (Yes, a comma and not
   a semicolon).  /CARL 12-28-81

UUOCON: Fix X macro used in WAYS macro.  Put a "," between the IFB,IFNB
   and the code to be generated.  Also, add missing ")" close-paren to
   the last item in the WAYS macro (fixed undefined symbol).
   /Carl 12-28-81

UUOCON: Removed SEXTERNAL symbol references SYDFTA and SYDMTX and made
   them conditional on non-zero definitions of the configuration symbols
   FTAUN (# of FTA's) and MAGUN (# of MTA's).

UUOCON: Magically transformed .ELINK into .LNKEND for the new MACRO,
   leaving .ELINK alone for the old MACRO %46.

CTYSIM,CIOPR,KMCSER,DR11C,DZKON,ONCE: Removed SEXTERNAL references to
   DZDO,DRDO,KMCDO,DZINI,DRINI,KMCINI,KMCSMN,KMCCMN and made them all
   conditional on IFKMC.  DZDO,DRDO and KMCDO are defined in CTYSIM as
   always.  /CARL 12-28-81

SIMKL,ONCE: Removed SEXTERNAL references to ONCGO,MONDEB,& PATSIZ and
   added the symbol KL$SIM in the simulator which is checked for non-zero
   by ONCE under an IFCPU (KL) conditional.  Code was added to the patch
   code in the simulator to set KL$SIM non-zero.  /CARL 12-29-81

DDT: Commented out the line "SEXTERN OVTAB." in DDT.  This symbol is not
   even referenced once in the source. (OR in *.mac in M33 or MPL) except
   for LOADER.MAC which is only generating a DUMMY location OVTAB. if it
   doesn't exist already (Special case!).  /CARL 12-29-81

Note:  The monitor now has NO S-EXTERNALS in it.  It will now load using
LINK-10.  With the exception of external POINTer references, the monitor
will also assemble under MACRO %53B.   /CARL 12-29-81

COMMON: (UUOCON,FRMSER,COMCON) Moved pointer UPYPSR from UUOCON into
   COMMON and added corresponding pointers USYPSR & UXYPSR for %UPS
   and %UPX.  All 3 are internal and referenced elsewhere at least once.
   /CARL 12-30-81

COMMON: (SCHED1,CORE1,UUOCON,COMCON,PICON,ONCE) Moved pointers from
   literals in many modules into COMMON where the symbols used are defined.
   New symbols are UPYPTx,UPYPXx,USYPTx,USYPXx,UXYPTx and EPYPSx where <x>
   is either "N" or "M" depending upon whether %xxx.N or %xxx.N-1 is used
   as argument to the macros.  /CARL 12-30-81

COMMON,CORE1: Moved macro definition UPTPTR from CORE1 into S so that it
   can be used where necessary.  Moved the only use of it into COMMON with
   the pointers UPYPTx as mentioned above.  Also: *** NOTE *** I changed
   the name of the macro (UPTPTR) to (UPYPTR) so as not to conflict with
   the UPT symbol UPTPTR.  /CARL 12-31-81

COMMOD,CORE1: Moved pointers from literals into COMMOD for their def's
   and created 2 more symbols RB1PNO and BA1NBB which are near to RBYPNO
   and BAYNBB in definition, but not quite!  /CARL 12-31-81

COMMON,MAPIO,CORE1: Defined some more bit masks in COMMON so that less
   polish is needed for adding bit definitions in other modules. New
   symbols: LMMMXW, LMMSUP, LMMRED, LMMRDW for LMAP bit configurations.
   /CARL 12-31-81

COMMOD,FILRIB: More about pointers: RBYUNA, RBYUNR and RBYUNV for getting
   the unit from ATBRIB(P2), DRBRIB(P1) and DEVRIB(F).  /CARL 12-31-81

FRMSER: Changed BYTE (18) arg,0  to XWD arg,0 inside JDSMAC macro to fix E
   errors in the new macro.  comment used to say something about a bug in
   the old MACRO, but it assembles ok with either version at present.  Also
   changed reference to literal to use UXYPSR in COMMON.  /CARL 12-31-81

FILUUO: Fixed [XWD BYTE (5)0 (3)CPRRED (10)1 (8)0 (10)%COW.N+CNVVPN] to
   simply [<CPRRED>B7+1B17+%COW.N+CNVVPN] to work with the new MACRO.
   Macro-46 simply allowed that construct. Amazing!  /CARL 12-31-81

COMMOD,FILFND: Defined SPTNMM to be SPTNME justified to SPNNFE so we don't
   have to play games with externals.  /CARL 12-31-81

ACTSER: Changed the ATB macro to use Xwd rather than BYTE and added
   a ",0" to the end of each line where a 4th argument was wanted.
   Put angle brackets "<>" around constants used in arithmetic with
   an external.  Fixed "Polish too complex" error.  /CARL 12-31-81


/K02
----

COMMON, CLOCK1, UUOCON: Removed job tables JBTRMT and JBTRMC (no longer used).
/DARREN 1-6-82


CONF??.mac, COMMON: The following symbols have been moved from CONF??.MAC to
COMMON or deleted entirely:  SYSDEV,SYSNAM,SYSDAT,RP10N,RA10N,C0FHN,C0DPN,
C0MDN,RD10N,NUMPRT,COREN,SEGNX,CR10N,CDPN,SPCINT,SPCDDB,SPCSAV.
/DARREN 1-10-82

/K03
----

COMCON: In JOBKL, delay call to TTYKIL until after returning from KILUPT.
This should prevent job from being rescheduled with TTYTAB(J)=0, which int
turn should prevent any more crashes at SCNSER:STTLK+6.
/DARREN 1-11-82

COMCON: Set Errflg in P3 instead of clearing J to indicate error at COR2+2.
Error happens when CORE command requires hiseg to be deleted.  Problem
was discovered by noticing that SYSTAT followed by CORE 5 (with SY lic)
crashes system.  /TODD 1-19-82

Errcon: Don't set up previous context F when Adrerr is called.  Fixes
bug that would either crash system or print a bogus device name in
address check error message.  Sys would crash if user ac 4 had a value
such that an exec mpe would occur.  /Todd  /TODD 2-1-82

/K04
----

COMMON - Add new job table JBTSCA which contains TRU scaling argument,
	plus byte pointers to the 4 9-bit fields.
CLOCK1 - Modify GTCGSZ (Get Charging Size) to use TRU scaling args if present.
UUOCON - Modify CLKTRU to do size-dependent and size-independent components
	seperately, scaling size-independent according to JBTSCA args.  Add
	XCHARG function 7 for TRU scaling.
/DARREN 2-9-82

/K05
----

COMMON: Allow FCWDS to be defined in Conf.  /TODD 2-10-82

/K06
----

PICON: Added Internal label PGFUIO just prior to PGFAIL with contents
       PC.UIO,,PGFAIL to be used by ONCE inside IFCPU(KI) conditional
       for getting there on page-fail conditions.  /CARL 2-18-82

ONCE:  Changed all occurrances of [EXTERNAL] and [POLISH] to non-literals
       so that MACRO 53B can be used for assembly.  /CARL 2-18-82

/K07
----

Comcon: change UNDEL command to UNDELETE.  /TODD 2-23-82

FILIO - Add counter OHTREP to count number of times INSOHT is called more
than once for the same disk page; also halfword table OHTCPN for Core Page
Number of disk page entered in OHTTAB.  /DARREN 2-23-82

ONCE:  Modified routines Evaset and Evaclr and added Evahi to allow
	dynamic data structure allocation to start at next pg after
	initial Syssiz.  Previously started at %Min (pg 400).  Evahi
	determines if virtual address has transitioned from below per-
	process area to within or above it.  If it has, it sets Evasiz
	to %Min.
COMMON, ONCE:  Call Evahi after Evasiz is modified.  Repeat allocation
	code for a particular data structure if it couldn't fit below pg
	340 and addr wasn't previoulsy above %Min.  /TODD 2-25-82

/K08
----

KSSYM,KSIORG: Updated XCREF/RCREF to .XCREF/.CREF so that either macro
    can assemble the sources for a KS processor. /Carl 2-Mar-82

KSSYM,ONCE: Moved WRHSB from ONCE to KSSYM where it belonged. /Carl 2-Mar-82

ONCE: Removed more literals so that ONCE would assemble for the KS.  The
    Old MACRO %46 would not fold literals on pass 2 tha same as pass 1,
    thus we got "P" errors during assembly.
      /CARL 3-2-82

/K09
----

ONCE: Text message at HLPCMD was re-inserted to catch illegal commands
      given to the ONCE> prompt.  Removed originally because it was too
      verbose.  Now skipped upon entry.  Message:
      ?Unrecognized command - Please type HELP for help.
        /CARL 3-3-82

IOCSS:	Push F at CLOSE3 and pop at UCLS3 so can tell if buffered io
was being done so can determine whether to restore previous pc.uio state.
Solves XBASIC Getseg error problem.  /TODD 3-3-82

COMMOD, CONF??.EXP - Move a few more symbols out of the config files -
  C1FHN, C1DPN, C1MDN (defined only on a few VF KI's and always to 0)
/DARREN 3-5-82

S,FILUUO - Add DMOVPG to disk DDB dispatch table.
APXKON - Ernie changes - ?
CORE1 - Add "validate even if private" flagg VL.VPP.
IOCSS - Add CHANIO function 47 - VMOVPG.
SWAMP - Make UPDAC0 an external entry point.
SIMIO - Don't undo 4 disk-block charge after SIMCRE, no longer accrued.
FILFND - (quote) "Add routine DECUNS to decrement ATBUMC & ATBMXW, and
  remove SPT entry for unshared DP so it can be moved to another file."
MAPIO - All the good stuff:
  Add VM kernel routine KMOVPG to "take a page which is currently mapped
    and not part of a file and cause it to be mappable from the specified
    position of a file open on the channel."
  Add routine LOKHPW, called (by KFCRE & KMOVPG) when holding only the
    atomic file lock and needing the write lock to manipulate a slot past
    highest page written (HPW).
  Add entry SWEPRH to SWEEP to sweep file with real holes despite TITO
   crock; modify SWEEP to use VMOVPG if sweeping 1 real page (SIMIO case).
/DARREN 3-9-82

/K10
----

IOCSS, CORE1:  Call Uniupt from Reprlu to release %upt lock if held
by current frame and not complain if not.  Delete Reprl1 code because
can always get upt lock (eventually).  /TODD 3-10-82

/K11
----

CONF??, COMMON: (KS only) Move definitions of LPTN, LPRUN, and LPRVEC
from CONF?? to COMMON, enclosed by IFCPU(KS), since they're the same on
all 2020's.  Remove VECMIN, VECMAX, VECNUM, TBISTR, and TBIEND as perhaps
the silliest consistency check ever devised.
COMMON, ONCE: Use size of TBISAV table to init loop counter in SETUBT.
/DARREN 3-13-82

COMMON - Remove two more job tables that appear to be unused - JBTCB2 and
  JBTIDN - apparently used by CLUBS at some point in history.  /DARREN 3-18-82

/K12
----

Scnser: Have Newjer zap tty after printing out error message.  Previously
job capacity exceeded would not kill port and this eventually would
cause a crash in addition to the nuisance of echoing user name and
leaving port in limbo.  /Todd  /TODD 4-8-82


S, FILUUO: Install new close flag, CLSDMP=200, to set file dumped bit.
This will allow TITO to set file dumped without doing a rename and
potentially changing some other rib data.  /TODD 4-13-82

/K13
----

UUOCON - Time to remove EUTHAN hack from SETNAM.
/DARREN 4-16-82

FILIO - One-line fix to INSOHT change.
/DARREN 4-19-82

COMCON: added POP command - special form of ATTACH to attach you to your
parent (if any) and log out current job.  /WRS 4-20-82

COMCON: updated several messages to talk about frames not jobs.  /WRS 4-20-82

COMCON: changed attach code to check for attached frame license greater than
source frame license.  /WRS 4-20-82

FILUUO: changed LICMSK to return the current license in the case where
the requested license is greater than the current (for example it used
to be that LICMSK(WA,WF)=0, rather now LICMSK(WA,WF)=WF)  /WRS 4-20-82

/K14
----

COMCON: fixed POP command to handle errors more gracefully  /WRS 4-20-82

/K15
----

COMCON: more fixes to ATTACH and POP license restrictions  /WRS 4-20-82

IOCSS - Fix function code check, broken when NXTCHN was added.
/DARREN 4-21-82

COMCON - Change INITIA command to .INITI for obscure and perverse
  reasons.  /DARREN 4-21-82

MAPIO - Fix KMOVPG for case where file page argument is -1 (insert after
  current EOF).  /DARREN 4-27-82

/K16
----

S: Change CLSDMP to be 100000 from 200 to avoid conflict with possible
DEC expansion.  /TODD 4-30-82

ONCDSK: Modified STSREF (REFRESH) to force a call to UPDHOM after the
        refresh is complete.

ONCDSK: Split GETRAN into SETRAN (start timer) and GETRAN (stop timer
        and read number into RANNO) and call both routines whenever
        CMDSCN is called by ONCE or ONCDSK so that the clock is always
        running while waiting for command input.  This solves the KS,
        KL problem doing a refresh and setting the pack-set id to 0.
          /CARL 5-5-82

/K17
----

ONCDSK: Removed erroneous calls to SETCHG which may have clobbered
        something since U was not guaranteed to be setup in /K16.
        Re-Inserted LSH to zap low order 12 bits in GETRAN since a
        KL always returns 0 [Inside IFCPU(KL)].
Note: REFSTR rewrites the HOM pages before it returns to ONCDSK, so
      no other forced rewrites are necessary in ONCE.
      /CARL 5-7-82

ONCDSK:  Fixed CMDSCN routine to skip return on "NO" answer to the
         "are you sure" question, so that it doesn't complain about
         commands which require verification as "unrecognized".
ONCDSK:  Added local symbol CMDMSG which if non-zero will only type
         the "Are you sure" question on verification rather than the
         verbose help text put in for operators to read.  Mainly for
         debugging use when jumping in and out of ONCE/ONCDSK.
/CARL 5-8-82

FRMSER - Add .FRMOP 41 (Stop Frame) - simulates ^C on a frame.  /DARREN 5-25-82

/K18
----

DDT: Changed code which checked for processor type to check FOONLY using

DDT: Changed F3 processor check from AOBJN test to PUSH test for KA/F3's.
     Ac/ 0,,-1  PUSH Ac,0  (1,,0 no carry; 2,,0 otherwise) TLZ Ac,1 to have
     all good DEC hardware return 0.  /CARL 5-29-82

/K19
----

COMCON: changed ATTCHK (check source / target frame license for attach) to
check frame license rather than process license (ooops).  /WRS 6-7-82

SCNSER: Only negotiate for BIO ports if on a Tymnet base.  I.e., if a
KI or KL.  /TODD 6-22-82

/K20
----

Mapio:  Return valid error code from sweep vmovpg failure.  Solves crashes
caused by copying a file into a full directory.  /TODD 7-13-82

/K21
----

FRMSER: Add new format .FOCFM call, allowing new JBTPPN = caller's
   AUN, PVYMSK bits in JBTPRV to be different, plus provision for
   running LOGINN in the child frame.
	NEWWAY:	MOVSI	ac,.FOCFM
		FRMOP	ac,BLOCK
		  error return
		normal return
	BLOCK:	flags,,count
		exp JBTPPN,JBTPRV,JBTAUN,JBTUNM,JBTUN1
	;FLAGS
	CF.OLD== 1B0			; this word is -cnt,,adr (old way)
	CF.LOG== 1B17			; run LOGINN in child
FRMSER: Add .FRMOP 42 - Force command on frame, this was the chosen
   generalization of "force INITIA command", plus new .FRMOP error
   code 37 (illegal command).
UUOCON, FRMSER: Move code for CHPRJ calli (change project code) from
   UUOCON to FRMSER and add a FRMOP entry point (.FRMOP 43).
COMCON: Add routine to return forced command index given SIXBIT string,
   called by .FRMOP 42.
 - Allow LOGINN to be run in a detached frame.
 - Have POP command run LOGOUT, remove CPOP routine.
 - Add PCOM & DCOM commands (both run PCOM) and PEAK command (runs PEAK).
 - Remove PCHECK command and code.
 - Add .USESTAT command to display incremental data.
SCNSER: In normal character mode, have ^T force .USESTAT command if
   LDBDCX<LXLRTC> is set.
 - Add "TTY [NO] RTCOMP" & AUXCAL 101 to set/clear LXLRTC.


/K22
----


/K24
----

/K24
----

Assigned JP.MAI (1b8) in priv word to indicate (new) mail waiting.  Added
SETMAI UUO (CALLI -145) using most of SETMAL as a subroutine.  Added code
in SCNSER to print "[Mail Waiting]" if JP.MAI set.  Note:  None of the
above invalidates any of the JP.MAL (old RPG mail) stuff.
/DWS 7-19-82

/K25
----

/K26
----

Common, Clock1, Uuocon:
   Add Inactivity Timeout feature.  New job table, JBTINA, keeps track
of user specified inactivity timeout (0 if off), time since job was
last active, and whether the inactivty limit was hit.  Once-a-minute code
in Clock1 increments inactivity counters.  If the time-limit is hit, the
process will be evicted if enabled for eviction otherwise it will be
hung (killed regardless of hang/zap action specified by user).  Changing
the timeout limit is accomplished with the SET AUTOLOGOUT n command,
SET NOAUTOLOGOUT command, SETPRV UUO with bit 2000 set as desired
(if old Jbtprv 2000 XOR new Jbtprv 2000 = 1 then limit is updated) to set/
clear a timeout of 15 min., and CALLI ac,-146 where ac is limit in min.
Gettab -55 has been added to read the Jbtina word.

Scnser:
   New hang flag, (1B13), causes job to be hard killed without detaching.
Needed so that Logout can print message when autologout occurs.

/TODD 7-21-82

SCNSER: Changed TRMBYP to a 5 bit field for network terminal ID code (TIC).
 Also extended the table TRMTAB to 32 entries, making up something reasonable
 for the as yet undefined codes.  /WRS 8-2-82

/K27
----

/K28
----

Commod, Oncdsk, Refstr, Swamp, Filuuo:  Remove all code pertaining to
the obsolete swapping area.  /TODD 8-10-82

/K29
----

COMMON, COMMOD - Move another whole bunch of symbols from the CONF?? files
into COMMON and COMMOD, mostly inside IFCPU/IFNCPU conditionals.
/DARREN 8-17-82

/K30
----

/K31
----

SCNSER - Comment out IFKMC conditional which ended up inside IFCPU(<KI,KL>)
conditional last time around, thus causing assembly error when building
monitor for KL system.  /DARREN 8-19-82

Frmser:  Add capability to pass lic. to new style Crefrm.  Setting flag
1b16 passes word after Logtab arg block ANDed with the parent's process
lic. to the child as its frmae lic.    /TODD 8-19-82

/K32
----

ONCDSK,REFSTR: Renamed RANNO in ONCDSK to RANHOM since all but one use
    was to hold the value of HOMRAN for packset-id checks.  Added RANNO
    as internal to REFSTR only for setting HOMRAN during the REFRESH
    command.  RANNO is set to a random # each time a command is entered
    to ONCE or ONCDSK.  /CARL 8-27-82

/K33
----


UUOCON, ERRCON, ERRMSG - Add frame stop and frame exit (equivalent
to EXIT and EXIT 1), CALLI -142 (frame error class 4, type 2) and
-147 (class 4, type 7).  Treats error code in AC as either octal (if
left half is zero) or SIXBIT (if not).  Also merged ERRMSG.MAC into
ERRCON.MAC.

/DARREN 8-28-82

/K34
----

COMMON - Replace EVAHI with EVMALC, which does ONCE-time core allocation
  across the pre-process area.  Adjust AC use in LINKDB to use proper
  AC's for EVMALC call.  Modify free-core allocation to allocate in
  ^D145 word blocks.  Use %ERR rather than %DDT in crash code when
  copying context pages.
S - eliminate exec virtual page for %DDT.
ONCE - Call EVASET to set up exec page map before setting up ONCE
  PCB's and calling FILMAN.  Modify OPCBST/OPCBCL to use existing
  map slots for ONCE PCB's rather than inventing them.  Modify
  routines which allocate EVM to call EVMALC.
ONCDSK, COMMOD - Call EVMALC to allocate STT storage, eliminate
  HICORE and CORGRB.

/DARREN 9-1-82


COMMOD, CONF?? - Move symbols FTA and FTATYP from CONF?? files into
  COMMOD, delete AXDDBS (no longer used), allow M.SBSZ (SNOOP
  histogram buffer size) to default to 0.

/DARREN 9-1-82

/K35
----

CORE1 - Add context page lock/unlock log in order to track down problem
of this monitor not working properly on KL processors.  /DARREN 9-21-82

/K36
----

FRMSER - Copy project code from parent to child in CREFRM.
/DARREN 9-22-82

SCNSER:  Added routine CHKYEL to TINASS UUO to check for condition prexisting
when interrupt is enabled to prevent yellow ball races.  /WRS 9-25-82

/K37
----

Frmser:  Change the exec XCT HRRM to an exec XCT MOVEM in FRMCFH
because HRRM doesn't work on KI's if the destination is to a register.
The register affected is in the kernel block not the user's.
/TODD 10-1-82

/K38
----



COMCON Modified the send routine in order to allow a user with either
op license or acct suprprv to talk with all persons in their gan. Two
additional registers were brought in to the SEND routine, and because
it was not known if they contained important information or not, their
contents were pushed on to the stack upon entry. This required modifying
all points at which the SEND routine exited in order that the stack was
the same upon exit.  /MATOKA 10-8-82

/K39
----

S.MAC: Change PVDINA to lh 400 from rh 2000.  Rh 2000 in priv. word
is used to indicate that a TRU budget is present.  This wasn't documented.
/TODD 12-1-82

COMCON - Give special prompt [!] if in PDP mode and any license set.
/DARREN 12-2-82

SETETY - Remove Sherman's SETE password.
/DARREN 12-7-82

ONCE,ONCDSK:  Modified the HELP texts and printed messages in the
        ONCE/FILES dialogues to remove the word "ONCDSK" from all
        places and to make the terminology clearer to operations.
        (This will now match the NEW documentation Rick Daniels is
        putting together for the /L operator mini-manuals.)
/CARL 12-8-82

/K40
----

COMMOD - Put back place-holders for obsolete entries that went away.
/DARREN 12-15-82

/K41
----

FRMSER: fixed problem causing assembler to generate bad code resulting
in .FOSVA not working.  Made JDSVTB table a fullword table rather than
halfword (making it 2 words longer).  Took out about a dozen instructions
to make up for it.  /WRS 1-14-83

UUOCON, ERRCON: changed name of fail exit, stop ...
    Fail Stop   is CALLI -147   is continuable   is HST 4,,7
    Fail Exit   is CALLI -142   is not continuable   is HST 4,,2
/WRS 1-15-83

/K42
----

FRMSER: Fixed misplaced flag in /K41 edit.  STARCL belongs on the
        CCL vector rather than the normal start vector for the
        .FOSVA frmop.   /CARL 2-4-83

/K43
----

ONCE - Split EVASET into two routines, so that high-seg page map set-up
and setting the lower boundary for EVM allocation can be done at different
points in ONCE.  The new routine EVMINI can be called more than once to
allow for the perversities of the FILES subsystem.  /DARREN 2-9-83

SEGCON, ERRCON - Fix old "TRANSMISSION ERROR" message to type out "I/O
error on file FILNAM.EXT".  /DARREN 2-9-83

CORE1 - Remove context page lock/unlock debug code, since problems seem
to be fixed.  /DARREN 2-9-83

/K44
----

SCNSER: added code to TATUUO (ATTACH UUO) and RETACH (UUO) to allow
user to specify forcing target frame to RUN state if not already so,
by calling SETRUN.  This may not make sense with certain other options
specified.  In particular, in RETACH, it will only work when the port
being moved is being attached as the command port.  The option is
selected as follows:
    bit 1B15 in the AC of an ATTACH UUO
    bit 1B4 in the bits field of a RETACH UUO argument block
/WRS 3-15-83

/K45
----

ONCDSK - When setting up for REFRESH, insure that RANHOM is non-zero before
  calling RWRHOM to re-write home pages, so that subsequent call to RDHOME
  will not generate the "MISSING OR INCONSISTENT PACK SET ID" message when
  using a virgin pack set.  /DARREN 3-18-83

/K46
----


REFSTR - Repair the home page retrieval pointer table which got broken
  back in K27/K28 - the table must match the home page exactly.
/DARREN 3-20-83

/K47
----

PICON:  Fixed typo from /K06 version - moving INTERN PGFUIO inside an
	IFNCPU(KI) conditional.
SIMKL:  Repeat 0'ed OUT the KL-simulator leaving the global symbol KL$SIM
	inside an IFCPU(KL) conditional.  If the KL-simulator is wanted,
	should be re-installed via a new config symbol, so that PARIS can
	continue to exclude it if desired.   /CARL  3-24-83

ONCE - Fix recently-introduced bug in PGY table allocation - CAVPGN is
  NOT the size of the PGY table if there are holes in core...
/DARREN 3-31-83

/K50
----
P034/M
------

/L01
----

ONCE, SCNSER - Inserted console messages that describe what is
	happening during RELOAD.  /SUTTOND 8-31-83

/L02
----

CORE1 - modified code @ REMOV5+5 to handle context pages for frames other
	than the current frame.  This should fix the REMCHR+4 and REMCHR+11
	crashes.  /SUTTOND 8-31-83

/L03
----

Added Dave Sutton to SETE tables.  /SUTTOND 9-19-83

/L04
----

IOCSS:	Inserted code in routine DEVPHY: to crash if the user requests
	device SYS and SYS cannot be found in the DDB chain.
	/SUTTOND 10-5-83

/L05
----

SCNSER: removed local variables THSTIM and MXTIM and made them external.
Code will now use the global THSTIM and MXTIM defined in COMMON and
appearing in NSWTAB+41 and NSWTAB+42 (gettabable) like it was supposed to.
/WRS 10-6-83

/L06
----

ONCDSK: Enclosed test for disk unit off-line inside IFCPU (F3)
	conditional @ KONTOK.  /SUTTOND 10-20-83

/L07
----

ONCDSK: Set EVASIZ to zero @ FILOPT+5 so that EVMINI will get
	called the 1st time EVMALC is called when allocating memory
	for UDB's.  /SUTTOND 10-28-83

/L08
----

COMCON: POP registers S and P1 off the stack in case of error in
	argument to TALK command in SEND: routine.  /SUTTOND 11-1-83

/L09
----

PICON:	Deleted command to clear Cache Sweep Done Flag in routines CSUNL
	and CSVAL.  Not necessary since monitor waits every time for
	cache-sweep-done interrupt.  /SUTTOND 11-2-83

/L10
----

COMCON: Added "Special Command Mode" to run RCM program in case
	PVSCMD is set and user types otherwise illegal command.
S.MAC:  added PVSCMD==200,,0
FRMSER: Child now inherits RCM program on a CREFRM

Note: RCM program now receives monitor parsed command name in sixbit
in user AC 1.  This prevents problem caused by multiple rescan's.
/WRS 11-3-83

/L11
----

Removed Darren Price from SETE tables.  /SUTTOND 11-7-83

/L12
----

FILFND: Prevented loop in DB linkages by inserting a conditional
	at SRCFINI+6.  /SUTTOND 11-16-83

/L13
----

Modified ONCE and COMMON so that FRECOR will default to the available
executive virtual memory below ONCE.  /SUTTOND 11-21-83

/L14
----

PICON:  Added code @ KEYSET+3 to crash if SCNINT is not called within
	2000 tics(17 secs).  /SUTTOND 12-13-83

/L15
----

ONCDSK: Amplified error messages in routine UNTDWN.  /SUTTOND 1-11-84

Added PVLOS - LogoutOnStop.  Added check at COMCON:STOP and CLOCK1:STOP1
to force LOGOUT if its set and job is being stopped.  Also check at command
dispatch time in COMCON and force RestrictedCommandMode if PVLOS is set.
Lastly, added code to FRMSER:PSHPRV and UUOCON:SETPRV to allow user to set,
but never clear PVLOS.  /WRS 1-20-84

/L16
----

Changed COMCON so panic logouts (like EXIT in a logged out job and
EXIT or STOP in a PV.LOS job) happen immediately rather than being
postponed until the next command input.  /WRS 1-27-84

/L17
----

Modified default open files/frame(OPNFPF) in COMMOD to be ^D10
so that there will be plenty of room for ATB's & FNB's in systems
with more than 1 Meg.  Specify smaller OPNFPF in the CONFnn file
for systems with less memory if necessary.    /SUTTOND 1-31-84


/L18
----

Deleted Adele Newmon from SETETY tables.  /SUTTOND 2-6-84

/L19
----

FILUUO: Modified SKIPGE to MOVE at CLRACH+6, eliminating slow
	crash since FNBALT(xx) is initialized to -1 for debug
	purposes.  /SUTTOND 2-23-84

/L20
----

COMMON: Inserted cache sweep in CRASHX routine so that memory in
	the crash file looks the same as it did to the CPU at the
	time of the crash.  /SUTTOND 2-29-84

/L21
----

SCNSER: Entered test for beyond last legal priority bit in LDBOUT(U)
	in routine SCOTTY at  GOLIN+2.  Don't do output on line if test
	fails.  /SUTTOND 3-2-84

/L22
----

CLOCK1: Modified inactivity timer code @INACT2+2 to use one less
        instruction, and eliminate use of T2.  Also changed comments
        for better understanding of the routine.  /CARL 4-20-84

/L23
----

ONCE:   Change CONSOLE command to set CTY flag, Added NETWORK command
        to clear CTY flag.  Use GO, FULL, MANUAL or READONLY to bring
        up the system.

CTYSIM: Allow lower-case on all commands, added ctrl-z ? to print a
        short help text of legal ones.  /CARL 4-23-84

/L24
----

PICON: changed EVICT UUO to set PV.LOS (logout on stop) so an evicted job
that gets sick and halts or doesn't know any better and exits will get
logged out.    /WRS 5-22-84

/L25
----

SCHED1: changed default setting for MAPQUE (JBTWRS) feature to off.
	/WRS 6-6-84

PICON:	Removed edit /L14, code at KEYSET+3 which caused a crash if
	routine SCNINT was not called within so many (2000) tics.
	We don't need to MAKE the system "crash" here!  /CARL 6-7-84

ONCDSK: Modified CMDSCN routine, near CMDSC5 to disregard verification
	if CMDMSG is non-zero, and added new bit for MKTBL macro AB.CVR
	to ignore verify bit (AB.VER) if CTYDO flag is set (for CONSOLE).

ONCE:	Defined AB.CVR for ONCE/ONCDSK command table bits, set the bit
	for MANUAL and READONLY.  Modified CONSOLE and NETWORK commands
	to give an acceptance response and a reminder to type one of the
	system startup commands: GO, FULL, MANUAL, READONLY.

	Modified SUTTOND's amplified INITIA message to only print when
	INITIA is really being forced, i.e. TLNN (STAUTO),STATES
	/CARL 6-7-84

	Fixed TYPO which broke abbreviation of CONSOLE command by
	mispelling NETWORK as <CONSOLE>.  Also changed code at CHGSYS
	to allow larger than 255 as host number on micro-node bases.
	KI/KL's still have 255 maximum.  /CARL 6-8-84

S.MAC:	Changed SIZONC from 4 to 5 in MAPONC call for KS.  /CARL 6-13-84

/L27
----

Removed Lois Lindley from Sete and added Osman Guven.  /OSMAN 6-20-84

/L30
----

ACTSER: Copy UPTLOG for new frame into supervisor info when writing the
	accounting record for .FOCFM (we are assuming that the LOGIN UUO
	handles this correctly elsewhere).  /OSMAN 7-6-84

/L31
----

F3TSER: Fixed radix in formula which calculates byte pointer into EPT page map
	to ^D18 and ^O1000 to avoid confusion.  The assembler defaults to ^D
	in the offset part of the pointer, so the calclation was always wrong.
        /CARL 7-8-84

P034/N
------

/M01
----

Mis-release by Dave Sutton caused confusion.  So, to avoid further
confusion as to which /M this is, it has been decided to skip the
release of P034/M altogether and proceed to the next release.

P034/P
------

/N01
----

COMMON, COMCON, CLOCK1 and UUOCON:  Renamed pointer JBYLIM for inactivity
	time-out to JBYINA so that JBYLIM could be used for TRU-limit
	interrupt pointer.  /CARL

COMMON: Added interrupt cause (16) and pointer JBYLIM for the interrupt
	channel.  Points to last 6 bits of UPTTP1.  TRU limit is stored
	in JBTLIM(J) as per "SET LIMIT" command, UUO not yet defined.
	/CARL 6-15-84

/N02
----

COMMON: Added new job table JBTINT to hold interrupt channel assignments
	which were previously in LH of JBTIOA and RH of JBTSLC.  Also
	moved new TRU interrupt from UPTTP1 here since it must be in main
	memory for clock level.  Above changes affect byte pointers in
	table INTBYP.  /CARL 6-22-84

PICON:  Removed unnecessary references to JBTIOA,JBTSLC and changed code
	at APRENB/APRDIS to clear JBTINT instead.  Same change done in
	INTADR code at INTAD1+5.  Also cleared %UPT+UPTTP1 here since it
	seemed like it "ought" to be done here as well.  /CARL 6-22-84

PICON:  Removed label INTAD3 by changing test condition and calling an
	existing routine instead of jrst'ing past code block.  /CARL 6-22-84

CLOCK1: Added code to fire the TRU interrupt if enabled when the user
	exceeds his limit instead of just falling through to ERRTLE.
	Added label CIP5B for call to ERRTLE just prior to CIP6.
	/CARL 6-22-84



/N03
----

COMCON:	Set maximum of ^D3435973 for SET LIMIT and complain if more is
	specified.  Changed SETLIM references to SETTRU.  Now sets both
	JBTLIM(J) and JBTSLM(J) to the current "maximum" limit.

COMMON:	Replaced table JBTTRU with JBTSLM to contain the maximum TRU
	limit for the frame.  JBTLIM is used for the current TRU limit
	from now on and is checked at clock level, reset from JBTSLM on
	RESET UUO (or frame reset) or SETLIM uuo with argument of 0.

UUOCON:	Added SETLIM (CALLI -150) functions to set/reset (.SLSET), extend
	(.SLEXT) and increment (.SLINC) the current TRU limit.  GETTAB
	table -56 (.GTSLM) returns the limit set by the console, and the
	old .GTLIM (GETTAB -30) returns the current limit as before.
        /CARL 7-21-84

/N04
----

CLOCK1:	Added JBTSLM to CLRJBT routine, fixed critical place test by
	loading XWD JACCT,KJP instead of JACCT+KJP in TRU check routine.
        /CARL 7-22-84

/N05
----

COMMOD: Added <> around XP definition of SPTNMM to circumvent what
	appears to be a MACRO bug.  SPTNMM is correctly defined as
	17 instead of 62.  Was only used once @CRESP1+5 in FILFND
	which should be patched to HRRI T3,17 in P034/N. /CARL 10-21-84

/N06
----

FILUUO: Fixed typo in definiton of ECOD'x where x is %%XCOD which
        was initialized to - instead of 0.  Apparently was bad since
        originally written in P030/D.  /CARL 10-22-84

SCNSER: Moved misplaced code (RTCONT) from RTATS+6 to after TATUUO at
        TATUU1+4.  Apparently calls to RTATS where source DDB neq DDB
        for the port # in F fell into RTCONT erroneously.
	/CARL 11-12-84

ONCDSK: Copied "DDT" and "BOOTS" commands from ONCE into FILES just
        to make it easier to get out of FILES in hairy situations.
        No more "reboot monitor" when stuck in FILES. /CARL 12-5-84

/N07
----

ACTSER: Changed WRTAC1+4 from JRST @SPCACT-40(T3) to XCT SPCACT-40(T3) to
        force execution of STOPCD instead of jrst SYSCRS.  /CARL 2-27-85


UUOCON: changed SETMAI calli to set mail waiting based on job number rather
than user name and changed PRVMSK to allow non-priv jobs to set/clear own
[mail waiting] bit.  (for TUMS)  /WRS 3-3-85


/N08
----

CLOCK1: Added check for UBR non zero before doing context switching
	wrubr, when switching jobs or setting up nuljob.  /CARL 3-29-85


ONCE:	Added UPTTB0 with BLT pointer for UPT trap vectors so we can copy
	UPT stuff into page 0 to aid in tracking UBR=0 bug.  /CARL 3-30-85

COMMON: Moved non-F3 IRING/ORING buffers and anything else not hard-coded
	for page-0 locations out of the way so page 0 was as free as was
	possible for tracking UBR=0 bug.  /CARL 3-30-85

/N09
----

S:	Commented out MAPONC(DUM,1) to see if we really need it!  It
	was put in originally because we thought something wanted an
	extra page, possibly fixed with /L31? F3TSER fix.  /CARL 4-10-85

/N10
----

UUOCON:	Changed code using register to copy EPYPSN [EPTPTR(%UPS.N)] then
	does a DPB PG,register to simply do DPB PG,EPYPSN to free an AC.
        /CARL 4-12-85

FRMSER:	Put in check for NULQ in FRMASN, since only jobs actually in the
	NULL queue should be re-assigned.    /CARL 4-12-85

COMMON:	Added symbol BADQUE which is incremented every time a frame is
	attempted assignment because JNA is clear, but the job is NOT
	in the NUL queue.  /CARL 4-12-85

SETETY: Sete password changed.  /WRS 5-21-85

KMCSER: Fixed code at SETRM1, changed AOS T2,PG3ADR to AOS PG3ADR which
	was only executed if the IRING was NOT in page 0.  /CARL 6-13-85


/N11
----

UUOCON: Changed GETTAB .GTSLF tables from XWD FOO+WAYFOO,TABLE(J) to
	XWD FOO+WAYFOO+J,TABLE to get around bug with polish fixups in
	the new MACRO %53A(1152).  /CARL 5-16-85

UUOCON: Add some new GETTAB table pointers to provide the proper tables
	for STOPCDs and compatibility with DECs TOPS-10 tables which
	only have dissimilar indicies.  /CARL
	Changed SETINA and SETPRV UUOs to use default inactivity value
	from NSWTBL.  Added SETUUO function to set it.  /CARL

COMMON:	Added FETTBL,FETMXL globals for the feature test tables, added
	CRSLEN,CSRMXL for addition to the GETTAB index table.  /CARL
	Added INADEF to NSWTBL (re-using obsolete offset word 7) for
	the default inactivity time limit.  /CARL

COMMOD:	Change EXTERNAL to ## and INTERNAL to ::.  /CARL

COMCON:	Interned WATTAB,COMTAB,SETBL and added WATMXL,COMMXL,SETMXL for
	the new GETTAB indicies in UUOCON, sixbit table of WATCH,MONITOR
	and SET commands.  (Added TTY and TERMINAL to SET table to jump
	into the TTY command).  /CARL
	Added SET DEFAULT INACTIVITY [N] command requires OP to set the
	system-wide inactivity logout time limit in minutes.  /CARL

SCNSER:	Added TTYTBL @ TTCWDT+1 (to skip 'NO') and TTYMXL for the new
	GETTAB indicies.  Sixbit table of TTY commands.  /CARL 6-18-85

S:	Changed STOPCD macro.  /JMS 6-19-85

ERRCON:	Put in a dummy DIE routine (which fakes a JSR SYSCRS).  /JMS 6-19-85

F3TSER:	Replace JSR SYSCRS with STOPCD, update all STOPCDs.  /JMS 6-19-85
MAGSER:	Replace JSR SYSCRS with STOPCD, update all STOPCDs.

LPTSER:	Update all STOPCDs to assemble with new macro.  /JMS 6-19-85

/N12
----

ERRCON:	Install DEC's DIE routine (from 7.03 sources) to process stopcodes.

COMMON:	Defined global variables - .CPxxx = CPU Data Block, .SYxxx = System
	wide error counts.  Included only the variables used by DIE routine.

COMCON:	Add PRTPPN and PRTDDB routines.  The latter outputs the DDB pointed
	to by F as DEVICE:FILE.EXT[P,PN].

PICON:	Minor mods to the order in which routines are called for fatal APR err.

SCNSER:	Added more routines to output data to the CTY.

/JMS 6-24-85

	The new stuff is between "Start of STOPCD data" (page 45) and
	"End of STOPCD data" (page 56), with additional information up to
	"End of SYSCRS/REBOOT" (page 59).

COMMON:	Add DEC's routines, RCDCSB records CPU status block, TYPSTB displays it.
	Redefine JOB=.CPJOB, add DVCSTS (under REPEAT 0) to do CONI on all.

S:	Defined DEBUGF flags, PIOFF and PION macros, XCT and CPU stop types.

F3TSER:	Slight reformatting of STOPCDs.
MAGSER:	Slight reformatting of STOPCDs.
LPTSER:	Slight reformatting of STOPCDs.

PICON:	Remove routine to output KL CPU status (replaced by RCDCSB and TYPSTB).
	Give names to STOPCDs at APRFAT and nonzero in 30.  Add FLTCHK routine.

ERRCON:	Change DIE routine to use the right global symbols.  Set up an
	emergency stack for EXEC PDL OV.

UUOCON:	Make GETTAB table 51 point to .SYSxx variables, table 52 to CRSHAC.

CLOCK1:	Add code to calculate the Universal Date/Time and store it in DATE.

SCNSER:	Add dummy routine to save protocol/disable keep-alive.

SIMIO:	Add routine at SIMIOS(FCR.E+3) to output T1 via STOPCD routines.

/JMS 6-29-85

COMCON:	The PRTDDB routine borrowed from COMCON.703 uses DEC's convention of
	<PUSHJ P,SAVE1>, had to change to <JSP T4,SAVE1>.  The routine PRPER can
	not be used to print a period (license prints "!").   /JMS 6-30-85

/N13
----

ALL:	Add the line S$NAME='module' at the beginning of each source file.
/JMS 7-1-85

COMCON,SCNSER:	Change name of routine to print a prompt to PRPRMT.  Add
	PRPER to output a period only.  /JMS 7-2-85

COMMON:	Change ">=" to ".GE." to balance angle brackets.  /JMS 7-2-85

COMFAK:	Combine COMFAK and COMTXT into COMTXT.MAC, change command files to
	assemble COMTXT without S+K?SYM.  /JMS 7-2-85

COMMOD:	Make FTULNH global again.  WARNING: COMMOD.N12 will not load on KI
	or KL because FTULNH is not declared as being INTERNAL.  /JMS 7-3-85

/N14
----

FILFND,CTYSIM,ONCE,DZKON,DR11C,KMCSER,COMCON,F3TSER,MAGSER,REFSTR:
	Remove all references to SYSCRS from these files.
/JMS 7-9-85

COMCON,COMMON: Added code at COMMAND+1 to count times COMCNT is wrong
	in CMNOTF (%SYCCO) and at COMCMR+6 to count total commands that
	are processed in COMTOT (%SYNCP).  /CARL 7-9-85


FILFND: Added the following stopcodes...
	FILDMO (DSKCLN) DRB Max count overflow
	FILDMU (DSKCLN) DRB Max count underflow
	FILANF (DSKCLN) ATB not found in list
	FILBNF (DSKCLN) DDB not found in FNB device block list
	FILATB (DSKCLN) Bad ATB pointer
	FILLAS (DSKCLN) LMAP slot active/super
	FILAMO (DSKCLN) ATB Max write count overflow
	FILSEO (DSKCLN) SPT free entry count overflow
	FILAUO (DSKCLN) ATB Unshared map count overflow
	FILAUU (DSKCLN) ATB Unshared map count underflow
	FILAUS (DSKCLN) ATB Unshared map count with valid SPT

FILIO:  Added the following stopcodes...
	PGENIO (STOP) Paging Error: No I/O in progress
	PGEZER (STOP) Paging Error: Page count is zero
	PGEOOR (STOP) Paging Error: Out of range
	PGENDP (STOP) Paging Error: Not a disk page
	OHTFUL (STOP) Output Hash Table Full - Too many DP errors
	OHTENF (STOP) Output error Hash Table - Entry not found

CORE1:  Added the following stopcodes...
	REMVPG (STOP) Remove virtual page - Error
	BACRFP (DSKCLN) SAT (M) Bit already clear - File Page
	BACRVP (DSKCLN) SAT (M) Bit already clear - Virtual Page
	ULKNME (STOP) Unlock UPx - Not mine error
	PFLNUL (STOP) Page fault from NULL JOB
	PFLPR0 (STOP) Page fault writing - Page protection 0
	LAFUPS (STOP) LMAP Activation Failure - %UPS preserved
	LAFPOR (STOP) LMAP Activation Failure - Page out of range
	LDFPOR (STOP) LMAP Deactivation Failure - Page out of range
	CHTFLS (STOP) CHT Failure - Search: RBMASK bits on
	CHTFNJ (STOP) CHT Failure - Remove: No job in use list
	CHTFIU (STOP) CHT Failure - Remove: In use/io in progress
	CHTFNF (STOP) CHT Failure - Remove: CP not found in CHT
	CHTFMU (STOP) CHT Failure - Remove: Multiply used PGYADR
	CHTFDP (STOP) CHT Failure - Insert: Duplicate page
	LRFPRx (STOP) LMAP Read Failure: Page out of range
	LSFUFx (STOP) LMAP Store Failure - LDC count underflow
	LSFPRx (STOP) LMAP Store Failure - Page out of range
	PGUSEO (STOP) Page Use Error: Count increment overflow
	PGUSEU (STOP) Page Use Error: Count decrement underflow
	PGUSEA (STOP) Page Use Error: Slot still active
	PGWNME (STOP) Page Wait queue error: Not me
/CARL 7-10-85

CORE1,DEBUG,FILRIB,FILUUO,FRMSER,MAPIO,SEGCON,SIMIO: move OPDEFs to S

S:	The OPDEFs moved into S are the following negative CALLIs:
	VDSKPT, PERSTS, VALPAG, PREREF, WSCTL, PERSET, PAGSTS, VPROT, VCREAT,
	VCLEAR, VREMOV, VREPL.  VPGSTS was changed in DDT, MAPIO, and SIMIO
	to conform with the YAMM, which says that CALLI -71 is PAGSTS.
/JMS 7-11-85

APXKON,F3TSER: Copy F3-OPDEFs into F3SYM.
SCNSER:	Move TYMNET opdef into F3SYM.
/JMS 7-11-85

KSSYM:	Changed OPDEF WRADB[JFCL] to DEFINE WRADB,<PRINTX KS does not have ADB>.
ERRCON,CLOCK1:	Put all references to WRADB inside IFNCPU(KS).
/JMS 7-12-85

ERRCO:	Add PUSHJ P,PRTDIR to output username of file in STOPCD processor.
COMCON:	Create PRTDIR, which outputs username in parenthesis.  Calls PPNUSR.
FILUUO:	Create PPNUSR and USRPPN - routines to translate PPN to USERNAME and
	USERNAME to PPN.  These two routines search only the in-core tables,
	and give a nonskip return if not found.  USRPPN is the first part of
	the LOKLUD routine (the second part reads LUD.SYS).
/JMS 7-15-85

Module Old name Times    New name  (note: DISK=STOPCD(.,DSKCLN,...)
====== ========  ==  ==============================================
CLOCK1 CIP7+3     1  STOP,PAGZER,<Pager - UPT is zero>
COMCON CKRCER+2   1              no STOPCD at this location
COMMOD SAXINT+5   1  INFO,SAXIN1,<Spurious SA-10 interrupt>
COMMON EPT+43     1              no STOPCD at this location
COMMON SYSINA+4   9  CPU ,CRS147,<147 restart>
CORE1  ACTLMS+4   1  STOP,LAFUPS,<LMAP Activation Failure - %UPS preserved>
CORE1  DECUS0+7   1  STOP,PGUSEA,<Page Use Error: Slot still active>
CORE1  PAGWAT+1   1  STOP,PGWNME,<Page Wait queue error: Not me>
CORE1  REMCHR+4   1  STOP,CHTFNJ,<CHT Failure - Remove: No job in use list>
CORE1  REMV16+7   1  STOP,REMVPG,<Remove virtual page - Error>
CORE1  REMV31+14  4  DISK,BACRFP,<SAT (M) Bit already clear - File Page>
CORE1  REMV41+3   1  DISK,BACRVP,<SAT (M) Bit already clear - Virtual Page>
CORE1  SRCCHT+1   1  STOP,CHTFLS,<CHT Failure - Search: RBMASK bits on>
CORE1  STOLMA+1  12  STOP,LSFUFA,<LMAP Store Failure - LDC Count underflow>
CORE1  USRFLT+3   4  STOP,PFLNUL,<Page fault with LDC in use>
ERRCON EXCMPE+3   1  STOP,S..IME,<Illegal Memory-reference from Exec>
ERRCON INSSIM+2   0  STOP,S..UIL,<Uuo at Interrupt Level>
ERRCON ILLINS+2  98 DEBUG,S..EUE,<Exec Uuo Error>
ERRCON UUOCTR     4  JOB ,UUOCTR,<UUO from Concealed mode, Trap>
ERRCON UUOSTR     0  CPU ,UUOSTR,<UUO from Supervisor mode, Trap>
FILFND CNVATP+1   1  DISK,FILATB,<Bad ATB pointer>
FILFND DECRMV+13  3  DISK,FILAMO,<ATB Max write count overflow>
FILFND DECUMC+4   2  DISK,FILAUU,<ATB Unshared map count underflow>
FILFND DECUMC+10 10  DISK,FILAUS,<ATB Unshared map count zero with SPT>
FILFND ULKDB0+4   3  DISK,FILBNF,<DDB Not found in FNB device block list>
FILFND USRUSI+22  1 DEBUG,USRUS1,<Unexpected CHANIO error in USETI>
FILIO  INSOH3+1   3  STOP,OHTFUL,<Output Hash Table Full - Too many DP errors>
FILRIB USEOUT+3  15  DISK,RIBBRP,<RIB error - Bad Retreival Pointer>
FILRIB RIBERR+6  14  DISK,RIBTME,<Too Many RIB errors - disk is unsafe>
FILUUO CLRACH+7   1              no STOPCD at this location
FILUUO CLRCOM+5   1  DISK,CLRCM1,<CLRCOM decremented DRBCNT too far>
FILUUO TSTRES+13  1  DISK,UUOXWR,<UUO eXit with Resources still owned>
FILUUO UPDUFD+16  2  DISK,UFDER1,<UFD error return from DIRSRC>
FILUUO USRUSI+22  1  DEBG,USRUS1,<Unexpected CHANIO error in USETI>
FTASER FXWN21+12  1              no STOPCD at this location
FTASER SCMBF1+3   2  JOB ,MTATMW,<Too many data words>
FTASER SGTDEV+14  1              no STOPCD at this location
MAPIO  MAPF34+4   7  JOB ,MPFBRP,<MAPF error - Bad Retreival Pointer>
PATCH            12              patches to the Monitor to get more information
PCBIO  GETTR1+2   1  STOP,GETTR3,<End of list detected at GETTR1+2>
PCBIO  GTDON4+4   1  JOB ,GTDON1,<PCB link zero at GTDONE+12 or GTDON4+4>
PCBIO  MAPALL+4   8  STOP,MAPAL1,<Bad Retreival Pointer detected at MAPALL+4>
PICON  APRFAT    26  CPU ,APRFAT,<Fatal APR error - hardware failure>
PICON  USEPER+3   2  STOP,NJBPER,<Parity error in Null Job>
PLTSER PLTBL+3    1              STOPPC=147 (PLTBL=144, see COMMON SYSINA+4)
PTPSER PTPBL+3    1              STOPPC=147 (PTPBL=144, see COMMON SYSINA+4)
SCHED1 PAGWK1+2   3  JOB ,PAGWK2,<Job not coming out of SW queue at PAGWK1+2>
SCNSER CNTPRT     1  INFO,TTYBMT,<Bad Message Type from Base>
SCNSER FRCIBF+1   1 DEBUG,TTYBNP,<Block mode IO not in progress>
SCNSER GETBBP+1   5  STOP,TTYNFB,<No Free Buffrers>
SCNSER PGBIN+6    1  JOB ,TTYNPB,<No PTY Buffer for block IO>
SCNSER PGTRI+7    2  XCT ,TTYNPB,<No PTY Buffer for block IO>
SEGCON MAPHSF     1  JOB ,MAPHSF,<Unexpected error from CHANIO VMAP>
SIMIO  FCR.E+4   23  JOB ,SIMIOX,<Unexpected error at SIMIOS>
SIMIO  SIMRM1+1   1  JOB ,SIMRMV,<Unexpected VREMOV error at SIMRM1+1>
SWAMP  GIVPGK+5   8  DISK,GIVPG1,<Error in GIVPGK - F bit is not on>
SWAMP  GTSA42+5   1  DISK,GTSA43,<Error at GTSA42 - STTPTR is zero>
SWAMP  SEAR15+1   1  DISK,SEAR14,<Error at SEAR15+1 - No bits free in SAT>
UUOCON USRXIT+3   3  JOB ,UUOXWL,<UUO eXit With Locks still active>
/JMS 7-17-85

COMMON:	Put DEC's definitions for the CONFIG table inside REPEAT 0,<>.
/JMS 7-18-85

S:	Added ND and NDL macros.  They define a value as being global if not
	already defined, and show the value defined in the listing.  All
	occurrances of IFNDEF FOO,<XP FOO,BAR> can be replaced with ND FOO,BAR.
/JMS 7-18-85

COMMOD:	Added XP SPCBN,30 and XP RPCBN,14 inside IFCPU(KL)
CONF##:	Removed XP SPCBN,30 and XP RPCBN,14 from all KL config files.
/JMS 7-18-85

MAPIO,SEGCON:	"STOPCD ] ;COMMENT" is OK, but MACRO generates bad code for
	"STOPCD ] ;COMMENT ;;ADD1PG+5".  Cure: Move "]" to seperate line.
/JMS 7-19-85

/N15
----

COMMON,UUOCON,FRMSER:	Add CARL's changes to enable job inactivity timer from
	LOGIN and CREFRM uuos.

ONCE:	Change the instruction that sets up the LUUO trap to
	IFCPU (KI),<MOVEM T1,EPT+41>
	IFNCPU(KI),<MOVEM T1,41>	;KL and KS use Exec virtual address 41.
/JMS 7-19-85

S	Change "1B<tab>" back to "1B0<tab>".  MACRO 47 was generating "good"
	code for this, MACRO 53 rightly reported an "N" error.
/JMS 7-23-85

/N16
----



ONCE:   Added 2 lines @ ONCGP1+lots to initialize the default inactivity
	timer INADEF to INADFL  /CARL 7-24-85

COMCON,ERRCON: Minor reformatting of STOPCD output.  /JMS 7-24-85

FILUUO: Fixed logic error in PPN=>USERNAME search.  Save JOB around
	code to grab CB resource to get GFD'd USERNAME.  /JMS 7-24-85

/N17
----

COMCON:	Fix PJOBX to output 'DET' for jobs that are detached.
FILUUO:	Clean up the stack before calling GIVCBR in USRPPN and PPNUSR routines.
ERRCON:	Add a new frame halt status code for jobs halted by a job STOPCODE.
	For halt class HC.SYS added HT.MED - Monitor Error Detected at user PC.
S:	Add PFALL macro.  Use "PFALL ADDR" instead of ";JRST ADDR".
/JMS 7-25-85

/N18
----

ONCE:	Moved setting of INADEF from (/N16 p.13) to p.33 just after the
	BLT that clears all of COMMON's low core (SYSBEG, etc).  /CARL 7-25-85

SCNSER: Changed TTYBMT and TTYBPN stopcodes from INFO to STOP, since we
	aren't really able to continue at this point.  BMT - unknown or
	bad message type, we could be anywhere inside a message, BPN -
	bad port #, we need to sift through (some messages are multi-word
	and we can't just go to SCNIN2).   Added TTYBZP INFO stopcd in
	the BADPRT code, for message types which should be 0 or are really
	ignored anyway, to print the info, then execute the code for the
	appropriate message as if no error occurred.  /CARL 7-25-85

SCNSER,ERRCON: Changed TTYBPN stopcd and added TTYBZP stopcd to use PRTP1U
	routine in ERRCON to print out P1 & U, as Message type and Port for
	bad message (or) port stopcds that eventually continue.  /CARL 7-25-85

ERRCON:	Fix the KI version of the routine to type out the instruction that
	caused an IME stopcode (Illegal memory-reference from Exec).

UUOCON:	Add comments describing which DEC CALLIs we are missing.  Match
	angle brackets.

/N19
----

DDT: Fixed 1^B,2^B,3^B buffers and munched FILDDT commands as well.
     /CARL 7-26-85

COMMON: Removed (POPJ) "No CRASH.EXE" message till later date.  Removed
	symbol SYSBG1, never referenced.  Moved NFCNT to %SYCCO until we
	get a chance to check where referenced.  /CARL 7-26-85

UUOCON: PRVMSK had PDVINA on the wrong side of the comma.  /CARL 7-26-85

/N20
----

ERRCON:	Call CONMES instead of CONMSG for JOB stopcodes, CONMSG hung the
	CPU.  /JMS 7-26-85

COMMON:	Move DSKDIE from COMMON to ERRCON and document it.  /JMS 7-26-85
	Deleted NFCNT (same as CMNOTF / %SYCCO) never referenced.
	/CARL 7-26-85


/N21
----

UUOCON:	Add dispatches for CALLI 67 and CALLI 70 uuos.  Each one currently
	points to a POPJ, but if the POPJ at CALI67 is changed to a JFCL,
	then CALLI 67 causes a JOB stopcode (S..JOB).  If the POPJ at CALI70
	is patched to a JFCL, then CALLI 70 causes a DEBUG stopcode (S..CI7).
/JMS 7-29-85

CLOCK1:	Add code to call routine in ERRCON to decrement the stopcodes-per-minute
	counter.  (TOPS-10 now uses 2-word CLOCK requests, TYMCOM-X only 1 word)
ERRCON:	Set up right data for the clock request.  Current limits are to stop
	if 2 stopcodes within 60 seconds, 4 stopcodes within an 8-minute period,
	and 8 stopcodes per hour.
/JMS 7-29-85

/N22
----

CTYSIM: Change POPJ's to JRST CTYOUT to force string output (fixes to
	CTY ^Z<xxx> messages), Change some JRST's to PJRSTs.  /CARL 7-29-85

/N23
----

ERRCON:	Add SKIPE S to not output job status twice during STOPCD.
SCNSER:	Clear byte count consistantly so that we don't put 34 characters into
	a 32 byte message.  WRS noticed that the two extra characters were
	getting thrown away because they were not accounted for.
/JMS 7-30-85

DDT:	Change the default $1M mask to 1000.  Now DDT will output "LABEL+offset"
	where offset can go up to 777.  Add OPDEF for VPEEK, POKE, and SETMOD
	so that it will assemble with MACRO 53.
/JMS 7-30-85

CLOCK1: In once-a-minute check for JBYINA against JBTINA(J), change the
	CAIL to a CAILE to only give the user 0-59 seconds rather than
	60-119 seconds extra slack time for autologout.  /CARL 7-31-85

/N24
----

FILIO:	Change STOPCD(,XCT,BADSAT) and give it a unique name.
	STOPCD(.+1,INFO,WRTSAT,WRTST1,<Disk output error writing SAT>)
	This STOPCD was hit on C57 and did not output enough info.  It now
	outputs the disk page number that got the error.  (Note: the stopcode
	BADSAT in SWAMP is when a SAT is read from the disk, and fails the
	consistancy check.  WRTSAT is when the SAT cannot be written.

SCNSER:	JFCL out the JSR SPCINI in SVPPC routine until we know it works.

ERRCON:	Comment out MOVE U,LINTAB(U) in DIETYO until the CTY gets an LDB.

COMMON:	Carl found a PUSHJ P,SAVE4 in the part of RCDSTB that reads the
	SBUS DIAGs.  It needed to be JSP T4,SAVE4 and was causing the KL to
	halt due to ILL MEM REF when the stopcode processor was saving the
	machine status.

HALT:	For your info:  There are only two occurrances of the HALT instruction
	in the Monitor.  The first is at DIE+1, DIEREH=Recursion in Error
	Handler.  This is if a 2nd stopcode occurs while processing a stopcode.
	The second HALT occurs if the Console PDP-11 is not running when a
	stopcode is detected.  This is because the CTY cannot be used to output
	information.  (If the PDP-11 is reloaded, and the KL continued, the
	stopcode will then be processed.)
/JMS 8-14-85

/N25
----

PICON:	Ignore nonzero in 30 if we are in the process of outputting a STOPCD.
ERRCON:	Re-enable channel 1 interrupts for JOB, DEBUG, and INFO stopcodes.
	This is so that the base will not get upset and crash the PDP-10 when
	the system is continued after one of the above stopcodes.
/JMS 8-19-85

/N26
----

ERRCON: Added PRTCRS routine to print out 30 and the Key in a useful
	manner.  /Carl
PICON:  Changed CRSHWD checking STOPCD to call PRTCRS.  /Carl
COMMON:	Reformatted crash code, commented out where it tells the base
	where to dump into PDP-10 memory. (Never again!)
	Added SYSBTS:: at 146 to JRST LODBTS so this may eventually
	work someday.  /CARL 8-20-85

/N27
----


SCNSER: Fixed problem with loop in input ring processing caused by bad
	JRST ZAPLOG's which should have been PUSHJ P,ZAPLOG's.  Reworked
	LOGIN & RCVAUX to use new-style ZAPLOG and return to SCNIN1.
	Put a DEBUG stopcode at ZAPLOG which is called in a few places.
	Added INFO stopcode TTYZNE to notify us if a zapper hasn't been
	reflected to the base and the base re-assigns the same port.
	Added state 7, .ASWTP to aux-circuit build tables which causes
	RCVSUR to check for errors and if none, reset the build process
	back to state 1, .ASRQ1 to re-try the circuit; SNDAUX will
	continue to decrement the response timeout unless a response is
	received.  Thus, if we get a bad type 7 message from the base,
	we will (a) No longer loop forever, (b) not confuse either the
	base or the user by a spurious zapper, (c) actually zap the aux
	port and re-request another circuit from the supervisor to keep
	everyone happy.  If we get a bad type 6 message from the base,
	we will (a) No longer loop forever, (b) recover gracefully and
	print a stopcode message on the CTY before continuing.  /CARL 8-30-85


/N28
----

PROBLEM: CRSHID gives up, says "the crash code was not executed".
DIAGNOSIS: In /N23 and /N27, 3 words of the crash data block are not set up.
CURE:  Set up STOPCN, PISTS, and APRSTS when a STOPCODE is hit.
Note: The LH of CONFIG-2 still points to the old crash data block.  GETTAB
  table 44 points to the new crash data block.  (GETTAB tables 55 and 56
  need to be defined to do this right.)

COMMON: Change 5 lines in the crash code to set up STOPCN, PISTS, and APRSTS.
UUOCON: Make table 44 point to .GTCRS for now.  /JMS 8-31-85

/N29
----
P034/Q
------

/P01
----

FILIO:	Change WRTSAT from INFO to a DSKCLN type STOPCD.
ERRCON:	Change HALT at DIEREH(DIE+1) to JSR CRS147
COMMON:	Change HALT at CRASHX+1 to JSR GOBOOT
CORE1:	Change [HALT] at INSTYP+5 to [STOPCD].    /JMS 9-26-85

PICON:	Check for page fault while in user mode when running the null job.
COMCON:	Change PJOBX to output "Frame" number.
/JMS 9-30-85

FILUUO:	Add routine CHGNAM.  It is called by CHGPPN to make sure that the GETTAB
	tables +31 and +32 match the GFD's PPN in GETTAB table +2.
UUOCON:	Call CHGNAM during LOGIN uuo.
FRMSER:	Call CHGNAM during CREFRM uuo.  Both LOGIN and CREFRM accept additional
	arguments.  The first 5 are still the same: PPN,PRV,AUN,UNM,UN1.
	The new optional arguments are: #6=LDBLOG, #7=PJC1, #8=PJC2, #9=PJC3.
	All three words of the project code must be specified if any are.
/JMS 9-30-85

/P02
----

FRMSER:	Fix bug in new code in FRMSER - AC W was getting clobbered.
FILUUO:	Change PPNUSR and USRPPN to not check the core blocks while translating
	PPN to username during a STOPCD.  The stopcode FILAUS has been known to
	Ill Mem Ref in this routine.    /JMS 10-8-85


/P03
----

ERRCON:	Add routine DSKCLN which will set the needs-full-DSKCLN flag and
	output message to the CTY, but will continue the system.
SIMIO:	Make SIMUUX stopcode call DSKCLN and output more data on which
	uuo failed.
FILIO:	Make WRTSAT stopcode call DSKCLN and output unit # and page #.
	Note: The routine CPLSAT in SWAMP is the one that outputs the
	message "? BAD SAT ON BPA5 ..." to both OPR and the CTY.
/JMS 10-9-85

CLOCK1:	Fix "(MAIL)TUMS.SAV not found" and "illegal name" from stale JBT entries
	Have CLRJBT clear JBTNM1 and JBTNM2 when it clears JBTPPN.
/JMS 10-13-85

COMMON,FILIO,FILUUO,SWAMP:	Change INFO/JOB stopcodes in these modules
	to use the DSKCLN subroutine where necessary.
/JMS 10-13-85

/P04
----

ERRCON:	Fix job stopcodes to not reload the system when a type-out routine
	was given.  This was happenning in SIMUUF.  Also made PCP global
	(to print PC) and modified RADX10 to output negative numbers.
SIMIO:	Changed many JSP T2,MAPERR to JRST MAPER1 and MOVEM T1,SIMIT1.
	This will preserve more information for FCR.E+4 stopcodes.
	Changed stopcode SIMUUF to output PC and number of free disk pages.
/JMS 10-23-85

FRMSER:	Changed TLO T3,ABSGAN at ABSAC0-1 to TRO since ABSGAN is in RH.
PICON:	Changed POPJ at EVICT+5 to JRST TPOPJ.  This bug caused 20 ILLINS
	crashes on D25, and occured when an account supervisor tried to
	kill another job in the same GAN, and the killer had no license.
/JMS 10-23-85

COMMON:	Add UVAR(UPTUUO) just before UPTPDL.
UUOCON:	Add MOVEM M,UPTUUO to store original user-mode MUUO in fixed location.
ERRCON:	Output UPTUUO during stopcode if the return address on the top of
	the stack does not match the PC in UPTMUP.  This condition will be
	true when a stopcode occurs while the monitor is doing an exec UUO
	during a user UUO (ie CHANIO MAPF on behalf of the OUTPUT UUO).
/JMS 10-23-85

F3SYM:	Added DEFINE PRINTF(TEXT),<IF2,<PRINTX TEXT>> to output reminders.
K?SYM:	Added DEFINE PRINTF(TEXT),<> to not output reminders on these systems.
COMMON,ERRCON,SIMIO,FRMSER,PICON,UUOCON,MAPIO,SCNSER: Changed IF2,<PRINTX TEXT>
	to PRINTF(TEXT) so that the people building monitors for transmittal
	won't see the messages stating that such-and-such needs more work.
/JMS 10-23-85

/P05
----

PICON:	At KEYSET+6, added SKIPN .CPCPC before WRPI REQCLK to avoid
	initiating a channel 7 interrupt cycle during STOPCD typeout.
/JMS 11-4-85

COMMOD,ONCDSK:	Update comments, change some INTERNAL to :: and EXTERNAL to ##.
/JMS 11-12-85

FILIO:	Remove LSH T1,9 and LSH T2,9 in front of both PUSHJ P,@KONADD(J).
APXKON,BPXKON,RMXKON:	Change xxXADD to use pages instead of words.
FHXKON,DPXKON:	Obsolete disk drivers renamed to (OSARC).
	This change documents an existing condition: All disk I/O is done
	a page at a time.  After /P05 is tested, then the definition of
	UNIBLK (current disk block address) may be changed.  /JMS 11-12-85

COMMON,ONCDSK:	The code in ONCDSK to calculate PROT and PROT0 (for in-core
	protect times) based on disk type produced garbage on F3 (as a result
	of dividing by zero).  PROT and PROT0 are now set in COMMON based on
	IFCPU(<KI,KL>).  The way that SCHED1 uses these numbers should be
	changed someday.  /JMS 11-13-85

/P06
----

COMMOD,ONCDSK,FILIO,APXKON,BPXKON,RMXKON: Rename UNIBLK to UNIPAG.
	All I/O is done in pages (except in low-level RMXKON and BPXKON).
	Comment out most references to UNYPPL (partial page transfers).
/JMS 11-14-85

/P07
----

COMMOD:	Change name of UNIBPT/UNYBPT to UNIRPT/UNYRPT since the device drivers
	are concerned with records per track, not blocks per track.
APXKON,BKXKON,RMXKON:	Change UNYBPT to UNYRPT.
FILIO:	Remove references to UNYPPL since all transfers are in pages.
	This appears to fix problem with MDDT not working in P06.  /JMS 11-19-85

/P08
----

COMMOD:	Change UNIRPT again.  Now the sign bit of UNICHR is set if the unit
	if formatted in pages.  UNYBPT points to blocks per track, UNYPPT
	to pages per track, UNYBPY points to blocks per cylinder, UNYPPY to
	pages per cylinder.  Bits 1-8 of UNICHR not used.
APXKON,BPXKON,RMXKON:	Use UNYBPT or UNYPPT as appropriate instead of UNYRPT.
/JMS 11-22-85

/P09
----

BPXKON:	Changed all occurrances of SUBI XX,200 to use 1000 if the disk is
	formatted in pages.  /JMS 11-27-85

ERRCON,CONF??:	Move hardware designation into LH of .CPLOG, use the RH for
	the PDP-10 base number.  /JMS 11-27-85

/P10
----

CONF24:	Define additional 16 units on BPB.  Total of 32 disks in 4 strings.
/JMS 12-4-85

COMMON,PICON:	Don't output long stopcode message from DEPOSIT-NONZERO-IN-30.
	Set the STOPPC to DM30.1 (since command is DM 30,1).  /JMS 12-4-85

BPXKON:	Determine type of disk by trying to SEEK to cylinder 600.  Determine
	format of disk by reading the COUNT field of record 1.  Set UNYUTP as:
	0: 3650 in blocks,   103875 pages total (used to be 3330-I in blocks)
	1: 3330-II in blocks, 68680 pages total (old standard)
	2: 3650 in pages,    116550 pages total (new)
	3: 3330-II in pages,  76760 pages total (new)
UNYTYP=0 defined for testing purposes only, no program should depend on it.
/JMS 12-12-85

/P11
----

S.MAC:	Change STOPCD definition.  Add "STOPCD(,ENTRY,COMCON)" at the
	beginning of COMCON to define the default block for stopcodes that
	have no names (they all do an XCT S$NAME where S$NAME=COMCON).
	This allows ERRCON to output the offset from the start of the module
	to the unnamed stopcode, and makes the literal pool smaller.

ALL:	Add "STOPCD(,ENTRY,XXX)" at the beginning of each source module.
/JMS 1-2-86

MON##.CMD	Added new module.  MONBTS has only one dummy entry point now,
	the portions of COMMON that reload BOOTS from the disk will be put
	in this module.  /JMS 1-2-86

SETETY:	Removed Ron Saltgaver's SETE password (SALTYRON).  /JMS 1-6-86

/P12
----

COMMOD:	Add ND DSKTYP,^D<3330> and define DSKTYP=^D<3650> in CONF24.MAC
BPXKON:	Put in kludge to set disk type to 3650 pages on system 24.
/JMS 1-7-86

FILUUO:	Translate [1,4]=(SYS) without scanning core blocks (for STOPCD output).
ERRCON:	Output more info on NONAME stopcodes.  /JMS 1-7-86

SCNSER,ONCE,COMMON,CTYSIM: Change name of SCNDDB to CTYDDB.
COMMON:	Store address of CTYLDB in LINTAB+0 so TTY0:=CTY:.
ERRCON:	Output to CTYLDB for EVENT and INFO stopcodes.  /JMS 1-7-86

FILIO:	Add STOPCD(.,STOP,PGEUOR,PRTPGU,<Paging error: Unit out of Range>)
	to get more info from C24.  /JMS 1-7-86

MON##.CMD:	Added .MAC to all lines so RPG won't try to compile xx.P11.

COMMON:	Don't put CTYLDB in LINTAB until further testing is done.  /JMS 1-9-86

/P13
----

SCNSER: Added space in the LDB to hold a copy of AUXSTR after a circuit
	has been built.  This will allow circuit tracking from the host
	on a port by port basis.  /CARL 1-10-86

/P14
----

COMCON:	Equate TERMIN command with TTY command, add SUBMIT to run SYS:SUBMIT,
	add WHERIS to run RPG (add WHE to still run SYSTAT for WHERE).
/JMS 1-20-86

COMMON:	Set DEBUGF on non-F3 to reload on JOB and DEBUG stopcodes.  This
	is temporary so that the crash can be saved.  Re-arrange code in
	preparation of moving LODBTS into MONBTS.MAC, make LODBTS understand
	3650 formatted in pages.  /JMS 1-24-86

COMCON:	Add .DSKCL and FINISH to forced command table, put table in alphabetical
	order.  ".DSKCL" runs DSKCLN not logged in as [2,5].  /JMS 1-27-86

/P15
----

FILUUO:	Removed kludge that said SYS:[proj,prog] = DSKB:[1,4]
	EXCEPT that SYS:[1,1] = DSKB:[1,1].  This was a hold-over from
	the level-C disk structure..  /JMS 1-31-86

PCBIO:	If all the disks are write-protected, the system dies with
	NONAME stopcode at CTLFN1+7.  Gave it the name of NOWRIT.  /JMS 1-31-86

ERRCON:	Change the format of output of NONAME stopcodes.  Output "?HALT"
	at the beginning of STOP stopcodes and put quotes aroung the
	stopcode name.  /JMS 1-31-86

/P16
----

COMMOD:	Add pointer to front-end file for KS to the home page.  /CARL 2-4-86

COMMON:	JRST BOTLOD in MONBTS to test new BOTLOD routine.  /JMS 2-6-86

FILIO:	Don't put pages in OHT if running READONLY, to try to get ASP working
	on the 3650 project.  /JMS 2-10-86

/P17
----

COMMON:	Add code to SVSETS to save locations 150-167 (base pointers) into
	BASAVE, and save locations 300-337 (SA-10 pointers) into SASAVE.
	/JMS 2-18-86

REFSTR: Standardized FBOOTB=3, NBOOTP=3, LPNSAT=10 on all processors.
	Put IFCPU(KS) conditionals around all FEFILE.SYS code and store
	length,,first for each unit that an FE area is created on in
	HOMFEP and UNIFEP.  Removed previous HOMFEF code, see HOMSPG.
	Put IFN FTSPAG conditionals around all new code for SPAGES.SYS
	to reserve cylinders 1 and 2 on all units.  Rib page address is
	stored in HOMSPG (old location of SWAP.SYS rib).  /CARL 2-21-86

COMMOD: Defined HOMFEP, UNIFEP, HOMSPS (system pack set), HOMSPG (spare).
	Defined STRSPS to contain the structure SYSTEM PACK-SET ID.  This
	will eventually be set by ONCDSK when the structure DDB is built
	for "each" structure.  /CARL 2-21-86

FILUUO: Modified the DSKCHR uuo to return STRSPS as word #17, the old
	first page for swapping on this unit word, and UNIFEP as word
	#12, the old pages for swap on this unit word.  /CARL 2-21-86

/P18
----

REFSTR: Added MOVE U,FSTUNI after the JUMN U,xxxxx loops prior to calls
	to RBNFI9 to make sure that the proper unit was setup for the
	rib.  /CARL 2-25-86

/P19
----

REFSTR: Fixed updating of RIBALP for SPAGES and FEFILE so that everything
	is in working order.  /CARL 2-28-86

/P20
----

FILUUO: Changed DSKCHR uuo to test for STRucture using presence of a DDB
	pointer rather than 0 sat pages on this unit.  /CARL 3-5-86

FILUUO: Modified all references to STRDDB+ to loop through all structures
	(new code commented out) or added PRINTFs describing what needs to
	be done in the future to STRDDB.  /CARL 3-5-86

CLOCK1: Modified references to STRDDB+ (see FILUUO above).  Put in code
	for once a minute check of pages available to check all structures
	(new code commented out).  /CARL 3-5-86

COMMON: Modified references to STRDDB+ (see FILUUO above).  /CARL 3-5-86

COMCON: Modified references to STRDDB+ (See FILUUO above).  Changed CORE
	command to look at all structures (new code commented)  /CARL 3-5-86

FILIO:  Modified references to STRDDB+ (See FILUUO above).  /CARL 3-5-86

CORE1:	Modified STRDDB references (See FILUUO above).  All referenes use
	STRDDB instead of DRBSTR for the proper AUN or file.  /CARL 3-6-86

MAPIO:	Modified STRDDB references (See FILUUO above).  /CARL 3-6-86

FRMSER:	Modified STRDDB references (See FILUUO above).  /CARL 3-6-86

SWAMP:	Modified STRDDB references (See FILUUO above).  Most were changed
	to MOVEI ac,STRDDB ... although a few were able to use the fact of
	an existing "intact" unit data block to obtain HRRZ ac,UNISTR(U)
	so as to make it as transparent as possible.  Many PRINTFs were put
	in to alert monitor developers to changes.  /CARL 3-6-86

/P21
----

COMMOD: Added the long awaited STRNXT field as the left half of STRP4C
	which is virtually unused.  Renamed STRSPS to STRSID which is
	STRucture Set ID.  STRHSH may have this same function but isn't
	very readable by humans at the moment.  /CARL 3-8-86

ONCDSK/REFSTR: Changed MOVE/MOVEM pairs which act on HOMP4C and STRP4C
	to HRRZ/HRRM pairs to only act on the right half.  /CARL 3-8-86

FILUUO: Uncommented the HLRZ ac,STRNXT loops of various UUOs.  Modified
	the SYSSTR UUO to really work in the case of more than a single
	structure.  Currently there is only 1 structure.  /CARL 3-8-86

FILIO:  Add more paranoia in checking for bad unit number.  Add routine
	PRTPGY which outputs core page number, unit number, disk page number.
ERRCON: Use right AC when printing PC of IME.  Output "HALT stopcode" instead
	of "STOP stopcode" (looks nicer to Operations).  /JMS 3-12-86

PICON:  Don't output full "CRASH" stopcode when the nonzero quantity deposited
	in 30 is 7 or less (because on F3 it's easiest to deposit 4 in 30).

MAPIO:  Don't make U nonzero at SPRBNS, it kept DSKCLN from working!
	/JMS 3-14-86

/P22
----

ERRCON:	Move PRTCRS to PICON (it outputs contents of SAV30 and KEY620).
PICON:	When nonzero is detected in 30, check if KEY620 is 0 or 633751506262.
	If neither, then STOPCD(.,STOP,BASE,PRTCRS,<BASE initiated crash>).
COMMON:	Make sure SAV30, BASAVE, and SASAVE are all updated together (they are
	the saved contents of 30, IRING/ORING pointers, and SA10 pointers).

TYPOUT.MEM - Update list of TTY output routines.  /JMS 3-24-86

SCNSER:	Put BIOZAP.PAT into the source.  Stopcode BIOZAD checks for port being
	zapped before starting block IO.  Add SUBTTLs for CONTEN.TEC /JMS 4-8-86

SCNSER:	New handling for message types 3 and 4 from the base.
	TYPCRS=3 used to mean that the base has crashed and we should too.
	TYPDIE=4 used to mean that the base wants us do crash.
	TYPRES=3 now means base has crashed, reloaded, and is telling us what
	version of code it is running.  We should marks all ports as being
	zapped, and return TYPRAK=4 to the base to acknowlege the reset.
	When the base gets message type 3, it returns message type 4 which also
	has the base version number.  The three formerly unused bytes of both
	messages now have the debug flag, the version number, and the release
	number of the code.  Note: The above description does not apply to the
	2020, since it uses message type 3 to determine how many DR11s are
	connected to the KMC.

COMMON:	Define location BASVER as NSWTBL+5.  It gets BYTE(8)DEBUG,VERSION,RELEAS
	Add routine CTYDEC to output decimal number on the CTY (for BIGBEN).

CLOCK1:	BIGBEN outputs free disk space on the CTY every 8 hours.  /JMS 4-8-86

/P23
----

COMMON,CLOCK1,ONCE:	Set GETTAB values so that local time can be used for
	timestamps on the CTY.  The value TIMZON in CONFxx is used for this.
	TIMZON=^D<-8> for Pacific Standard Time.  /JMS 4-11-86

UUOCON:	Start work on the DATUUO to return time in UDT format.  /JMS 4-11-86

ONCDSK:	Find the RIB to SAT.SYS by reading the HOM page, instead of using the
	"constant" LPNSAT.  This bug affected the 2020 since P20.  /JMS 4-11-86

/P24
----

S	Make INFO and EVENT stopcodes PUSHJ P,NODIE so that these types
	can be processed differently.
ERRCON:	For now, NODIE is 2 JFCL's in front of DIE.  /JMS 4-16-86

UUOCON:	Add another bit to the DATUUO for "halfword format", where LH has
	number of days since 1-Jan-1964 or since 18-Nov-1858 and RH has
	fraction of a day (increments every 0.3296 seconds).  Documented
	in (MONDOC)DATUUO.MEM.  /JMS 4-22-86

FILUUO:	PUSH/POP T4 around call to DATCOM in .CHUFD routine.
CLOCK1:	Change BIGBEN to every 4 hours, UDTFIX uses new DATCOM.
	Change name of GETUDT to GETULT since it gets user local time.
COMCON:	Change GETUDT to GETULT.  /JMS 4-22-86

COMMON:	Change location 146 to JRST BOTLOD and replace the HALT in COMMON
	(when it cannot load BOOTS from disk) to JRST BOTLOD.  /JMS 4-22-86

MONBTS:	Got the new BOTLOD code working on C24.  /JMS 4-22-86

SCNSER:	Define SCNVER=1, SCNREL=0 for message types 3 and 4 to the base.
	Change %CHRMX to ^D30 for more efficient use of the ORING and to match
	what the EBUS base uses.  Fix bug at MDRLUP which would hang the 2020
	when no DR's responded.  Output request for supervisor clock before
	the message with host and port numbers, so that it can be easily patched
	to output message type 3 instead.  /JMS 4-23-86

SCNSER:	Change name of terminal characteristic #15 to match TYMNET.  It is a
	4-bit field, was called "TYP", now is "PD" for "parameter D".
	Added name "KAT" for #16, which is a 1-bit field for Katakana mode.
	Added AUXCAL set parameter 102 to set KAT.  The following are defined
	in TYMNET and need to be added to SCNSER:
	  TOB = Terminate Output on Break (translate BREAK to char gobbler)
	  ESC = Echo ESCape at the TYMSAT end
	  QM  = Q-mode, where "}" and "~" echo at the TYMSAT (TTY NO ALTMODE)
	  SPA = Space Parity, where the TYMSAT ands off the 8th bit on output
/JMS 4-24-86

P034/Q
------

/P25
----

S:	Add LICQM=1B11 for license to manipulate the XEXEC queue.
/JMS 4-29-86

CLOCK1,COMMON: Use NULPDL## instead of [IOWD EPLLEN,UPT+UPTPDL].

SCNSER:	Define OPROUT as a coroutine to set COMTOA.  It is called with the
	number of LDBs to use in T1.  0 = go directly to the CTY using a wait
	loop, 1 = go to the CTY's LDB only, 2 = go to both CTYLDB and OPRLDB.
ERRCON:	Use OPROUT instead of DIETYO for outputing stopcode messages.
CLOCK1:	Change BIGBEN to use OPROUT and LOCTIM, print name of STR (DSKB).

COMCON:	Move PRTDEC (alias RADX10) here from ERRCON, make PRT2 global.
	Replace INLMES+":" with PRCOL, INLMES+"," with PRCOM, INLMES+" " with
	PRSPC.  Allow "!" in addition to ";" for comments at command level.
	Output reminder to set date and time every prompt until it is set.
/JMS 5-2-86

S,COMMOD: Move definition of SAX0,SAX1 device codes from S to the modules
	that need them.  The disk definitions in COMMON really need to go
	in COMMOD.  /JMS 5-2-86

COMMON:	Put IRING/ORING in page 2 on all processors.  This moves the null job
	UPT to page 3 on all processors.  Reserve 3 pages for UPT so that the
	currently running job's context pages can be BLT'ed to absolute pages
	3,4,5 when taking a dump.  Add IRINGX/ORINGX which get a snapshot of
	the rings when taking a dump.  The ring pointers (150-167 or 2000-2017)
	are saved in absolute locations 170-207.  Locations 173 and 177 are
	modified to point to IRINGX and ORINGX.  This makes it possible for
	a program such as CRSHID to look at the rings at the instant that
	the crash occurred.  /JMS 5-2-86

ERRCON,COMMON: If a slow stopcode (HALT,JOB,CPU,DEBUG,DISK) occurs in the
	middle of a fast stopcode (INFO,EVENT), don't die with recursion in
	the stopcode handler.  Instead, let the second stopcode go to
	completion, then abort the first one by reloading the system.
/JMS 5-2-86

CORE1:	Add STOPCD(.,STOP,PFLJB0,,<Page fault in the null job>) at USRFLT+1
	(PAGFLU+15), just before stopcode PFLLDC.  This is to detect errors
	in the pager (hardware problems).  /JMS 5-2-86

PICON:	When nonzero is detected in 30, check the key.  If KEY620=4 then
	STOPCD(.,STOP,BASE04,,<Base detected bad message from 10>), else
	STOPCD(.,INFO,BASE,,<Base crashed>).  In the latter case, set the
	flag BASDWN, continue the system, and attempt to resync with the
	base when it comes back.
SCNSER:	Add Carl's code to resync with the base at clock level when the
	flag BASDWN is nonzero.  /JMS 5-2-86

SCNSER:	Increase the number of characters allowed in the input buffer before
	waking the job from 72 to 132 (for LA36 terminals).  /JMS 5-2-86


UUOCON,SCNSER: Add to function .STTKL=10 of the SETUUO.  The first word now
	has an optional byte count in LH, job number in RH.  If the LH is
	zero, then the string is terminated by a null (ASCIZ), if nonzero,
	then it is the count of characters to output.  If the RH is zero,
	then output to the CTY.  /JMS 5-2-86

ERRCON,SCNSER: Do not enable channel 1 interrupts during a continuable
	stopcode.  Instead, CTYTYO updates the key after every character
	it sends to the CTY during stopcode output.  /JMS 5-2-86

SEGCON:	Do not mess with JOBSA when program is run at CCL entry.
/JMS 5-2-86

/P26
----

SETETY:	Changed SETE password.  /JMS 5-7-86

ONCE:	Fix BOOTS command to do a 146 restart and go to BOTLOD.  /JMS 5-12-86

ONCDSK:	Fix BOOTS command in FILES dialog to do a 146 restart.  Output the
	physical unit name and pack-id on all disks, 4 per line.
	Copy HOMFEP to UNIFEP.  The Front-End Pointer (FEP) is nonzero only
	on 2020 disks that have been refreshed by P034/P20 or later.
	If UNIFEP is zero on a KS disk, then the 8080 boot area is 64
	pages starting with page 8 (<100,,10> octal).  /JMS 5-13-86

FILUUO:	Fix DSKCHR uuo to return accurate data on the KS.  If UNIFEP is
	nonzero, then it points to the 8080 area and BOOTS is in pages
	3,4 & 5 like the KI, KL, F3.  A zero in UNIFEP implies that the 8080
	area is in the old postion, <100,,10>.  /JMS 5-13-86

FILUUO:	Change the DSKCHR uuo match routine from TOPS-10 philosophy to TYMCOM-X
	philosophy.  That is, physical and logical names are 5 characters long.
	(Such as DSKB1, DSKB17, BPA2, BPA12.)  Therefore, when looking for
	DSKB1, do not accept DSKB10 as a match.  /JMS 5-16-86

UUOCON:	Added more documentation at INSSIM describing what instructions need
	to be simulated on a KI and F3.  Replaced CAIN skip chain with a
	dispatch table.  Simulate ADJSP on the KI.  /JMS 5-16-86

PICON:	Moved routine to update the KEY into SCNSER, call via JSP T1,UPDKEY.
	When nonzero is detected in 30, JSP T1,CHKBAS in SCNSER to check if
	this is a base initiated crash.  Eliminated call to CH2RMT since
	we do not support RMTSER.  /JMS 5-16-86

COMMON:	Add global variables KEYTIM, IRPTIM, ORPTIM.  Removed CH2RMT.
	Documented and updated FETTBL - table of feature-test settings.
	/JMS 5-16-86

SCNSER:	Add timers KEYTIM, IRPTIM, ORPTIM.  They are all incremented every
	clock tick when SCNSER runs, and are reset when the key is updated,
	when a message is seen in the IRING, and when a message is put in
	the ORING, respectively.  If the neither the key nor the input ring
	has been updated in the last 3 minutes, output EVENT(NOBASE).  When
	the base comes back and sends us a type 3 or type 4 message, then
	output EVENT(BASEOK) and print the version number of the base code.

	Routine UPDKEY added to update the key and check its previous value.
	Routine CHKBAS added to check if the nonzero value in 30 matches
	the base's ring pointers.  If so, check the key and output either
	STOPCD (.,STOP,BASE04,PRTCRS,<Bad message type from host>) or
	STOPCD (.+1,INFO,BASE,PRTCRS,<BASE has crashed - bad KEY620>).

	Note that if the base tells us it is crashing, we will output an
	INFO stopcode on the CTY, detach all ports, and patiently wait for
	the base to be reloaded.  When it does, we output the EVENT stopcode
	BASEOK and continue operation.  /JMS 5-16-86

/P27
----

CTYSIM:	CONSOLE mode was broken.  Fix to not STOPCD when message type 3 or
	message type 4 is seen in the ORING.  /JMS 5-22-86

SCNSER:	Make sure the initial messages in the ORING are in KMC format on the
	2020.  Garbled message caused CTYSIM to die in CONSOLE mode.
/JMS 5-22-86

COMCON:	Don't die with UIL crash from "TALK JOB 0 THIS IS A TEST".
/JMS 5-30-86

SCNSER:	Change timeout for NOBASE message to 90 seconds of inactivity, do not
	timeout in CONSOLE mode.  Output BASEOK message on the F3 when resync
	is done.  In the SETUUO function to talk to a job, if job 0 is requested
	use subroutine OPROUT to go to both OPR and CTY.  (OPROUT will output a
	CRLF if the CTY is not already at the left margin.  /JMS 5-30-86

COMCON:	Add TYMVAL command to run (SYS)TYMVAL.  ("TYM" is still a valid
	abbreviation to go to TYMEX mode.)  Fix bug in TYMEX prompt introduced
	in P25.  Output prompt if ^T (USESTA) typed in command mode.
	Output bell in TALK message.  Modify VERSION command to use one of two
	formats depending on the contents of user location 137.  If bits 3-11
	are all zero, use TYMSHARE format of "LH.RH".  If bits 3-11 nonzero,
	output in DEC format.  /JMS 5-30-86

ONCE,COMMON,UUOCON,PICON,SCNSER: Purge all references to RMTSER.
/JMS 6-1-86

COMMON:	Add JBTFNT (frame interrupt assignments).  This table is set up like
	JBTINT and has JBYLCF (logout in child frame), JBYECF (exit in child
	frame), JBYSIP (software interrupt from parent), JBYSIC (s.i. from
	child), JBYSIS (s.i. from sibling), and JBYSIA (s.i. from any).
PICON,CLOCK1: Clear JBTFNT whenever JBTINT is cleared.
UUOCON: Add FINASS[CALLI -151] to set frame assignments in JBTFNT.
ERRCON:	Check JBYECF before checking JBYEXC when telling parent about exit
	in child frame.  JBYEXC is in the parent's table, and gives an
	interrupt on a single channel when any child exits.  JBYECF, on the
	other hand, is stored in the child's table.  This allows the parent
	to assign a different interrupt channel for each child.
FRMSER:	Start work on FINASS and FRMOP function .FOCSI=44.  /JMS 6-1-86

/P28
----

FRMSER:	Added table CNTFRM which is AOSed once for each FRMOP executed to
	allow us to keep track of FRMOPs by function.  /CARL 6-4-86


FRMSER:	Complete work on Exit in Child Frame and Logout in Child Frame.
/JMS 6-5-86

CLOCK1:	Move the instructions that turn off JNA from CLOCK1 to FRMSER.
	KSTOP now calls FRMDSN (Frame De-assign) to do this.  /JMS 6-5-86

/P29
----

SCNSER:	For TTYBMT and TTYBPN stopcodes, output IRPPDP, ORPPDP, IRING(IRPPDP),
	ORP620, IRP620, SAV30, and KEY620.  This will make it easier to tell if
	the Bad Message Type or Bad Port Number STOPCD resulted from the base
	zeroing IRP620 and ORP620 unexpectedly.  /JMS 6-12-86

ERRCON:	Output contents of KEY620 always when nonzero in 30, even if it looks
	like the base was not the cause of nonzero in 30.  /JMS 6-12-86


COMMON:	Correct off-by-one BLT when saving copy of IRING and ORING.
/JMS 6-16-86

FRMSER:	Finish adding FRMCSI - Cause Software Interrupt.  /JMS 6-16-86

CLOCK1:	Output both J and JOB on PAGZER stopcodes (UPT is zero).
/JMS 6-16-86

COMMON:	Moved ECF and LCF out of JBTFNT into a new table JBTPNT.
PICON,ERRCON,FRMSER: Use JBTPNT for Lost Child Frame and Exit in Child Frame.
CLOCK1:	Do not clear JBTPNT in CLRJBT, since that word applies to the parent.
/JMS 6-17-86

COMCON:	Output program name before version number.  /JMS 6-17-86

/P30
----

S,ERRCON:	Add stopcode type PATCH.  It will output a message like:
	%% PATCH stopcode FOOBAR at 25-Jun-86 17:11
/JMS 6-25-86

BPXKON:	Rename 3650 device driver to CPXKON, restore old BPXKON from (OSP).
RMXKON,APXKON:	Add FTDPAG feature test, nonzero if FILIO requests pages.
COMMON,FILIO:	Add FTDPAG feature test so KI/KL can run with old BPXKON
	if FTDPAG=0 and with the new CPXKON(3650) if FTDPAG=-1.  /JMS 6-25-86

SCNSER:	Remove check for bad port numbers on message type 3 and 4, since
	John Kopf's new code returns flag bit 200 when we come up.
	Remove stopcode TTYBZP - don't demand port 0 for supervisor clock.
/JMS 6-26-86

ONCDSK:	Use symbol UNIONC instead of UNIPAG to get the result of the capacity
	tests (unit off-line, unit write-protected, etc).  /JMS 6-26-86

ERRCON:	Add label DIEDDT at a JFCL that is executed when a serious stopcode
	occurs (not for INFO, EVENT, or PATCH stopcodes).
DDT:	Change 1 Control-B to use DIEDDT instead of DIE+3 as breakpoint.
COMMON:	CRSDEV and CRSMAP have self modifying code.  Never attempt to execute
	them twice.  If we get a STOPCD while trying to set DSKCLN type in
	the home blocks, then "HALT BOTLOD".  The operator can CONTINUE the
	CPU to try to get BOOTS.  /JMS 6-27-86

COMMON:	Fix 146 restart to load BOOTS on F3 and KS.  /JMS 6-28-86

/P30
----

IOCSS:	Possible explanation for SIMUUF and KILUP2 errors:
	The RESET uuo calls IOKILL which calls IOALL which calls RELEA5.
	At RELEA5 + a few, there was a "JRST .+3" which has been changed to
	"JRST RELE5A".  The bug affected programs that used SIMIO on channels
	above 17, but only when they had certain job numbers.
***	This is patch #11 for the P monitor, in RESET.PAT  /JMS 7-1-86

S and others: Changed all references from BLKSPP to P2BLSH (to convert pages to
	blocks).  Added B2PLSH, P2WLSH (pages to words), W2PLSH, B2WLSH (blocks
	to words), W2BLSH.  This replaces BLKLSH, -BLKLSH, PAGLSH, -PAGLSH.
	/JMS 7-1-86

SCNSER:	Clear LDBOUT when sending a ZAP to TYMNET.  Otherwise a left-over
	character gobbler may get released while an aux circuit is partially
	built (which will cause ISIS to crash the base with KEY=354).
***	This is patch #12 for the P monitor, in ZAPGOB.PAT  /JMS 7-2-86

SCNSER:	Call COMGMS when date/time received from the supervisor, even if we
	already have a valid date/time (the SUP is more accurate than the
	KL's interval timer).  This means that the date/time will be reset
	once a day (when the new SUP takes over).  /JMS 7-3-86

UUOCON:	Add routine COMGMS to set GMT time and cause an EVENT stopcode
	whenever the date/time is changed by more than 10 seconds.
	The old date/time and the new date/time get printed on the CTY and on
	the OPR terminal if any.  /JMS 7-3-86


/P31
----

IOCSS:	On RESET, release all devices regardless of JOBHCU.  /JMS 7-9-86

UUOCON:	Add suggestion from WRS to adjust the time of day gradually when
	supervisor clock message is received (or when OPR does SET TIME).
	Event stopcode TIMEOK is output when new time is requested, save
	the first valid date time in SYSUDT in UDT format.  /JMS 7-10-86

CLOCK1:	Adjust TIME when DTMADJ is nonzero (clock runs at double speed or
	half speed until it is correct).  When DTMADJ becomes zero, output
	"Date/time is now dd-Mmm-yyyy hh:mm:ss" using OPRDTM.
	Moved <PUSHJ P,MINUTE> to tail end of once-a-second code (it was at
	the beginning).  Do the same for HOUR and DAY.  Call UDTFIX every
	second to make sure LOCSEC,LOCMIN,LOCHOR,LOCDAY,LOCMON,LOCYER are
	all correct with respect to adjusted TIME.  /JMS 7-10-86

SCNSER:	Move the PUSHJ P,HNGALL to SCNSEC (it was in CLOCK1 once-a-second).
COMMON:	Moved KSSEC here from CLOCK1.  Don't give BOOTS "/D<CR><CR>" on a
	146 restart.  /JMS 7-10-86

COMCON:	Add MOVE, DUPLIC, and ZAP to commands which run programs from SYS:.
	Add routine OPRDTM to output date/time on OPR and CTY.  /JMS 7-10-86

ONCE:	Force OPR to CHANGE SYSTEM if SYSNUM is zero (such as "KL00-P034/P32".
	Initialize QQYTTY to 1/2 second (was 1/10 second).  /JMS 7-14-86

SCHED1:	Incorporate Bill Soley's SCHED1.PAT into the source code.
	Put jobs that come out of I/O wait into PQ2 instead of PQ1.
	Initially put jobs that are up to 32 K into PQ1 instead of PQ3.
	Change PQ2 <-> PQ3 transition from 1 second to 1/2 second.
	Give interactive jobs a longer quantum (QQYTTY in ONCE).  /JMS 7-14-86

COMMON:	When the KL does RDERA and read SBUS diags, use three different sets
	of locations.  One for parity error, one for stopcodes (including INFO)
	and one just before loading BOOTS.  /JMS 7-14-86

PICON:	Decode the error bits from <CONI APR,SAVAPR> at APRFAT.  /JMS 7-15-86

COMMON:	Define SYSUDT to be in the nonswapping table, item 5.  It gets set to
	the universal date/time of when the system came up.  Its value is
	minus one if the date/time has not been set yet.  /JMS 7-15-86

ONCDSK:	Don't ask OPR if DSKCLN mode is null, use FAST.  /JMS 7-16-86

CTYSIM:	Output ORING and IRING pointers on CTYBMT stopcode.  Jump to CTYBRK
	when ^Z B while in CONSOLE mode, or ^Z alone on CTY in NETWORK mode.
SCNSER:	Call CTYINP (new routine in CTYSIM) to check for input from CTY.
DDT:	Change MAKBUF 1 so 1^B uses CTYBRK correctly.  /JMS 7-16-86

CPXKON:	Remove one case where SA-10 was told to go before command list was set
	up properly.  Added labels CPXBP1 and CPXBP2 for EDDT.  /JMS 7-16-86

CLOCK1:	Don't do once-a-minute code every 30 seconds when advancing the clock.
	Make sure that HNGTIM decremented every 60 ticks (+/-1), and HNGMIN
	is decremented every 60 seconds (+/-1).  The once-an-hour code is
	called every time LOCMIN is zero, which is not 60 minutes apart when
	the clock is being adjusted.  /JMS 7-17-86

ONCDSK:	Use label instead of <JRST .+4>.  /JMS 7-17-86

/P32
----

IOCSS:	Put in a counter to not loop forever when chasing down the DDB chain.
	Stopcode DDBCNE(DDB Chain has No End).  C33 has a crash where the TTY
	DDBs loop back, causing COMCON to loop at clock level trying to locate
	SYS.  /JMS 7-17-86

SCNSER:	When updating the key during channel 1, check how long it's been since
	SCNTIC ran at channel 7.  If more than 1 minute, crash with KAF
	stopcode (Keep Alive Failure).  /JMS 7-17-86

COMMON:	Avoid using literals (XCTBU) at CRASHZ when saving PREVAC.  /JMS 7-17-86

SCNSER:	When TTYKDB kills a TTY DDB by removing it from the active DDB chain,
	save the current, forward, and back pointers of the current, next, and
	previous DDBs.  After the DDB has been killed, check if the DDB chain
	is still intact, die with DDBCNE if not.  /JMS 7-22-86

IOCSS:	Give "?Address check for device ..." if the three-word buffer header
	is in JOBDAT or the ACs.  Using the ACs is a no-no, since interrupt
	service routines (such as LPTSER) would update the wrong AC block
	if the Monitor was executing a UUO for the user when the interrupt
	occurred.  /JMS 7-22-86

CLOCK1:	Leave tracks for CRSHID by putting PC back in CH7.  Output CONFIG name
	instead of "BIGBEN at".  /JMS 7-23-86

/P33
----

SCNSER:	Replace both POPJs at RCVNSP with AOJA P4,SCNIN1 so we won't hang
	when a new supervisor takes over (KI/KL only bug introduced after
	/P19).  Save the date/time of the takeover in SUPTIM.  /JMS 8-4-86

COMMON:	Add variable SUPTIM.  Add routine ODEBUG to set DEBUGF.
/JMS 8-4-86

ONCE:	Add DEBUG command, which calls ODEBUG to set debugging flags.
/JMS 8-4-86

ONCDSK:	Allow the size of CRASH.SAV to be 8192+1 pages.  The extra page
	is for whenever we rename CRASH.SAV to be CRASH.EXE.  /JMS 8-4-86

COMMON:	INFO stopcodes never worked on KI.  Because IG.LLH was defined as
	"(1B0)" instead of "1B0", the routine to save all AC sets turned off
	paging.  This caused UIL when P pointed to a per process page.  Put
	in ",," where necessary, until S.MAC is revised.  /JMS 8-7-86

/P34
----

CLOCK1:	Use SKIPN instead of SKIPE when calculating null time.  (The original
	instruction was JUMPN J,.+2 before I changed it.  /JMS 8-11-86

COMMON:	Improper use of EXECAC macro at CPUSTS caused KL to get NXM
	during STOPCD processing (it did not fail on the KS due to sheer
	luck).  Replaced the macro with an explicit WRUBR.  /JMS 8-14-86

SETETY:	Rewrote so that SETE passwords and licenses can be specified in
	the config files.  In particular, CONFTW.MAC has the password
	hash for slot 0 in TRW's monitor.  /JMS 8-15-86

ERRCON:	Record CPU status block for all but EVENT/INFO/PATCH stopcodes.
	/JMS 8-19-86

/P35
----

SCNSER:	For Japanese customers, make "TTY TYPE 1" do "SET TTY D 15" for MAGNUM
	and "SET TTY KATAKANA" for the TYMSAT.  Make "TTY TYPE VT100" same as
	"SET TTY CLASS VT100".  /JMS 9-8-86

CPXKON:	Fix bug where read error on first block of a page would cause PGEZER.
FILIO:	Fixed one place where P4 had pages when expecting blocks (read error).
	Change names of stopcodes from PGExxx to SWPxxx (swap in/out errors).
	Output disk unit and page number when SWPZER occurs (alias PGEZER).
	/JMS 9-8-86

CPXKON,BPXKON,APXKON,RMXKON,COMMOD,FILIO: Go back to FTDPAG=0 to allow for
	block-by-block recovery of bad spots on disks formatted in blocks.
	/JMS 9-8-86


COMCON:	Add DISABLE command to save frame license then turn off license.
	Add ENABLE to set frame license back to what it was at the time
	of the DISABLE.  Like TOPS-10, these commands do not allow for
	enabling or disabling specific licenses (yet).  /JMS 9-8-86

/P36
----

SWAMP:	Fix typo that caused the system to crash horribly when a bad SAT was
	detected.  Output more info in STOPCD(BADSAT).  /JMS 9-16-86

SCNSER:	Call LOGLDB whenever command port is given to a job using RETACH uuo.
FRMSER:	Add CF.PLI=1B15 to CREFRM to run LOGINN in child frame and have it
	prompt "please log in", to get username and password.  Add routine
	LOGLDB to copy UPTLOG to LDBLOG if LDBLOG is zero.  /JMS 9-16-86

/P37
----

COMMON:	Fix bug in CRASHX when AC block was getting changed.  Moved the
	primitive disk read/write routines out of COMMON and into MONBTS.
MONBTS:	Defined routine NEWMON to reload monitor.  /JMS 9-30-86

UUOCON:	SHUT the system and ding the CTY's bell whenever the date/time is
	adjusted by more than 60 minutes.  /JMS 9-30-86

ERRCON:	Output more info from the MAP instruction on an IME.  Create PRTSYS as
	a seperate routine to output the configuration info.  /JMS 9-30-86

ONCE:	Use PRTSYS to output config info when the monitor is reloaded.
	Complain if the APR serial number does not match what is in config.
	Increase CTY width from 72 to 80 columns.  /JMS 9-30-86

CLOCK1:	Amplify comments near CLKINT.  Calculate day of week for OPRDTM.
	Slight change in how SECOND calls MINUTE.  /JMS 9-30-86

REFSTR:	In ADD-PACK, it is not an error if RIB pointer to SPAGES.SYS is zero.
	This will be the case for disks that were refeshed after SWAP.SYS was
	purged and before SPAGES.SYS was invented.  For systems that have been
	rebuilt from ASP only and still have SWAP.SYS, ADD-PACK will allocate
	two additional cylinders to SWAP.SYS.  /JMS 9-30-86

/P38 = P034/Q = P035
----


ERRCON:	Use PRT22A instead of HDWPNT so that BADSAT typeout does not go off
	the edge of the paper.  /JMS 10-14-86

UUOCON:	Fix typo, JRST @SIMTBL(T3) should have been JRST @SIMTBL(T4).
	This caused KI's to crash when ADJSP was simulated.  /JMS 10-14-86

SCNSER:	Add a name to a NONAME stopcode, TTYNNC,<TTY - No Next Chunk>.  Caused
	by count of characters in input buffer wrong.  /JMS 10-28-86


[this file last modified 10-28-86 by JMS]

******************************************
***  make further changes in P035.MEM  ***
******************************************
      K (